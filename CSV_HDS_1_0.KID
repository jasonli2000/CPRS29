KIDS Distribution saved on Sep 11, 2003@08:01:23
CSV HDS 1.0
**KIDS**:CSV HDS 1.0^GMPL*2.0*28^OR*3.0*181^GMRC*3.0*33^TIU*1.0*161^

**INSTALL NAME**
CSV HDS 1.0
"BLD",4353,0)
CSV HDS 1.0^^1^3030731^n
"BLD",4353,1,0)
^^51^51^3030729^
"BLD",4353,1,1,0)
**********************************************************************
"BLD",4353,1,2,0)
*   This build is part of the CSV Project and must be installed at   *
"BLD",4353,1,3,0)
*                all sites by September 30, 2003                     *
"BLD",4353,1,4,0)
*                                                                    *
"BLD",4353,1,5,0)
**********************************************************************
"BLD",4353,1,6,0)
 
"BLD",4353,1,7,0)
 
"BLD",4353,1,8,0)
This combined build supports Code Set Versioning, mandated under the 
"BLD",4353,1,9,0)
Health Information Portability and Accountability Act (HIPAA). It 
"BLD",4353,1,10,0)
contains routines, options and protocol changes necessary for 
"BLD",4353,1,11,0)
date-sensitive access to code sets for the International Classification 
"BLD",4353,1,12,0)
of Diseases, Clinical Modification (ICD-9-CM), Current Procedural 
"BLD",4353,1,13,0)
Terminology (CPT) and Health Care Financing Administration (HCFA) Common 
"BLD",4353,1,14,0)
Procedure Coding System (HCPCS).
"BLD",4353,1,15,0)
 
"BLD",4353,1,16,0)
The combined KIDS distribution (CSV HDS 1.0) contains 4 patch installs:  
"BLD",4353,1,17,0)
 
"BLD",4353,1,18,0)
         GMPL*2.0*28
"BLD",4353,1,19,0)
         OR*3.0*181
"BLD",4353,1,20,0)
         GMRC*3.0*33
"BLD",4353,1,21,0)
         TIU*1.0*161
"BLD",4353,1,22,0)
 
"BLD",4353,1,23,0)
The distribution consists of a KIDS host file named:
"BLD",4353,1,24,0)
 
"BLD",4353,1,25,0)
        CSV_HDS_1_0.KID
"BLD",4353,1,26,0)
 
"BLD",4353,1,27,0)
 
"BLD",4353,1,28,0)
Installation:
"BLD",4353,1,29,0)
 
"BLD",4353,1,30,0)
Please refer to the Health Insurance Portability and Accountability 
"BLD",4353,1,31,0)
Act (HIPAA) Code Set Versioning (CSV) Installation Guide for details
"BLD",4353,1,32,0)
of the installation procedure for this patch.
"BLD",4353,1,33,0)
 
"BLD",4353,1,34,0)
 
"BLD",4353,1,35,0)
    The HIPAA CSV Installation Guide can be found in the following
"BLD",4353,1,36,0)
    [ANONYMOUS.SOFTWARE] directories:
"BLD",4353,1,37,0)
  
"BLD",4353,1,38,0)
                                  Preferred Address
"BLD",4353,1,39,0)
                                  -------------------------
"BLD",4353,1,40,0)
     First available FTP server   download.domain.ext
"BLD",4353,1,41,0)
  
"BLD",4353,1,42,0)
     Specific Field Office        FTP Address
"BLD",4353,1,43,0)
     ---------------------        ------------------------
"BLD",4353,1,44,0)
     Albany                       ftp.domain.ext
"BLD",4353,1,45,0)
     Hines                        ftp.domain.ext
"BLD",4353,1,46,0)
     Salt Lake City               ftp.domain.ext
"BLD",4353,1,47,0)
  
"BLD",4353,1,48,0)
  
"BLD",4353,1,49,0)
     File Name       Description              Format         FTP Protocol
"BLD",4353,1,50,0)
     --------------  -------------            -------        ------------
"BLD",4353,1,51,0)
     CSV_1_0_IG.PDF  HIPAA CSV Install Guide  Adobe Acrobat  Binary
"BLD",4353,10,0)
^9.63^4^4
"BLD",4353,10,1,0)
GMPL*2.0*28^1
"BLD",4353,10,2,0)
OR*3.0*181^1
"BLD",4353,10,3,0)
GMRC*3.0*33^1
"BLD",4353,10,4,0)
TIU*1.0*161^1
"BLD",4353,10,"B","GMPL*2.0*28",1)

"BLD",4353,10,"B","GMRC*3.0*33",3)

"BLD",4353,10,"B","OR*3.0*181",2)

"BLD",4353,10,"B","TIU*1.0*161",4)

"BLD",4353,"KRN",0)
^9.67PA^8989.52^19
"BLD",4353,"KRN",.4,0)
.4
"BLD",4353,"KRN",.401,0)
.401
"BLD",4353,"KRN",.402,0)
.402
"BLD",4353,"KRN",.403,0)
.403
"BLD",4353,"KRN",.5,0)
.5
"BLD",4353,"KRN",.84,0)
.84
"BLD",4353,"KRN",3.6,0)
3.6
"BLD",4353,"KRN",3.8,0)
3.8
"BLD",4353,"KRN",9.2,0)
9.2
"BLD",4353,"KRN",9.8,0)
9.8
"BLD",4353,"KRN",19,0)
19
"BLD",4353,"KRN",19.1,0)
19.1
"BLD",4353,"KRN",101,0)
101
"BLD",4353,"KRN",409.61,0)
409.61
"BLD",4353,"KRN",771,0)
771
"BLD",4353,"KRN",870,0)
870
"BLD",4353,"KRN",8989.51,0)
8989.51
"BLD",4353,"KRN",8989.52,0)
8989.52
"BLD",4353,"KRN",8994,0)
8994
"BLD",4353,"KRN","B",.4,.4)

"BLD",4353,"KRN","B",.401,.401)

"BLD",4353,"KRN","B",.402,.402)

"BLD",4353,"KRN","B",.403,.403)

"BLD",4353,"KRN","B",.5,.5)

"BLD",4353,"KRN","B",.84,.84)

"BLD",4353,"KRN","B",3.6,3.6)

"BLD",4353,"KRN","B",3.8,3.8)

"BLD",4353,"KRN","B",9.2,9.2)

"BLD",4353,"KRN","B",9.8,9.8)

"BLD",4353,"KRN","B",19,19)

"BLD",4353,"KRN","B",19.1,19.1)

"BLD",4353,"KRN","B",101,101)

"BLD",4353,"KRN","B",409.61,409.61)

"BLD",4353,"KRN","B",771,771)

"BLD",4353,"KRN","B",870,870)

"BLD",4353,"KRN","B",8989.51,8989.51)

"BLD",4353,"KRN","B",8989.52,8989.52)

"BLD",4353,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
GMPL*2.0*28
"BLD",4256,0)
GMPL*2.0*28^PROBLEM LIST^0^3030731^y
"BLD",4256,1,0)
^^2^2^3030421^
"BLD",4256,1,1,0)
See the National Patch Module for a complete list of enhancements included
"BLD",4256,1,2,0)
in this patch.
"BLD",4256,4,0)
^9.64PA^^
"BLD",4256,"KRN",0)
^9.67PA^8989.52^19
"BLD",4256,"KRN",.4,0)
.4
"BLD",4256,"KRN",.401,0)
.401
"BLD",4256,"KRN",.402,0)
.402
"BLD",4256,"KRN",.403,0)
.403
"BLD",4256,"KRN",.5,0)
.5
"BLD",4256,"KRN",.84,0)
.84
"BLD",4256,"KRN",3.6,0)
3.6
"BLD",4256,"KRN",3.8,0)
3.8
"BLD",4256,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",4256,"KRN",3.8,"NM",1,0)
GMPL CODE SET VERSION UPDATES^^0
"BLD",4256,"KRN",3.8,"NM","B","GMPL CODE SET VERSION UPDATES",1)

"BLD",4256,"KRN",9.2,0)
9.2
"BLD",4256,"KRN",9.8,0)
9.8
"BLD",4256,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",4256,"KRN",9.8,"NM",1,0)
GMPLBLD^^0^B35403742
"BLD",4256,"KRN",9.8,"NM",2,0)
GMPLBLDC^^0^B32403515
"BLD",4256,"KRN",9.8,"NM",3,0)
GMPLBLD1^^0^B31647398
"BLD",4256,"KRN",9.8,"NM",4,0)
GMPLBLD2^^0^B48951620
"BLD",4256,"KRN",9.8,"NM",5,0)
GMPLBLD3^^0^B23258990
"BLD",4256,"KRN",9.8,"NM",6,0)
GMPLX^^0^B42400085
"BLD",4256,"KRN",9.8,"NM",7,0)
GMPLBLCK^^0^B56283038
"BLD",4256,"KRN",9.8,"NM",8,0)
GMPL1^^0^B26232725
"BLD",4256,"KRN",9.8,"NM",9,0)
GMPLCODE^^0^B11198487
"BLD",4256,"KRN",9.8,"NM",10,0)
GMPLMGR^^0^B24427031
"BLD",4256,"KRN",9.8,"NM",11,0)
GMPLMGR2^^0^B26697548
"BLD",4256,"KRN",9.8,"NM",12,0)
GMPLRPTR^^0^B14705450
"BLD",4256,"KRN",9.8,"NM",13,0)
GMPL^^0^B28597779
"BLD",4256,"KRN",9.8,"NM",14,0)
GMPLEDT1^^0^B35847612
"BLD",4256,"KRN",9.8,"NM","B","GMPL",13)

"BLD",4256,"KRN",9.8,"NM","B","GMPL1",8)

"BLD",4256,"KRN",9.8,"NM","B","GMPLBLCK",7)

"BLD",4256,"KRN",9.8,"NM","B","GMPLBLD",1)

"BLD",4256,"KRN",9.8,"NM","B","GMPLBLD1",3)

"BLD",4256,"KRN",9.8,"NM","B","GMPLBLD2",4)

"BLD",4256,"KRN",9.8,"NM","B","GMPLBLD3",5)

"BLD",4256,"KRN",9.8,"NM","B","GMPLBLDC",2)

"BLD",4256,"KRN",9.8,"NM","B","GMPLCODE",9)

"BLD",4256,"KRN",9.8,"NM","B","GMPLEDT1",14)

"BLD",4256,"KRN",9.8,"NM","B","GMPLMGR",10)

"BLD",4256,"KRN",9.8,"NM","B","GMPLMGR2",11)

"BLD",4256,"KRN",9.8,"NM","B","GMPLRPTR",12)

"BLD",4256,"KRN",9.8,"NM","B","GMPLX",6)

"BLD",4256,"KRN",19,0)
19
"BLD",4256,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",4256,"KRN",19,"NM",1,0)
GMPL ASSIGN LIST^^0
"BLD",4256,"KRN",19,"NM",2,0)
GMPL SELECTION LIST CSV CHECK^^0
"BLD",4256,"KRN",19,"NM",3,0)
GMPL BUILD LIST MENU^^2
"BLD",4256,"KRN",19,"NM","B","GMPL ASSIGN LIST",1)

"BLD",4256,"KRN",19,"NM","B","GMPL BUILD LIST MENU",3)

"BLD",4256,"KRN",19,"NM","B","GMPL SELECTION LIST CSV CHECK",2)

"BLD",4256,"KRN",19.1,0)
19.1
"BLD",4256,"KRN",101,0)
101
"BLD",4256,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",4256,"KRN",101,"NM",1,0)
GMPL SELECTION LIST CSV EVENT^^0
"BLD",4256,"KRN",101,"NM",2,0)
ICD CODE UPDATE EVENT^^2
"BLD",4256,"KRN",101,"NM","B","GMPL SELECTION LIST CSV EVENT",1)

"BLD",4256,"KRN",101,"NM","B","ICD CODE UPDATE EVENT",2)

"BLD",4256,"KRN",409.61,0)
409.61
"BLD",4256,"KRN",771,0)
771
"BLD",4256,"KRN",870,0)
870
"BLD",4256,"KRN",8989.51,0)
8989.51
"BLD",4256,"KRN",8989.52,0)
8989.52
"BLD",4256,"KRN",8994,0)
8994
"BLD",4256,"KRN","B",.4,.4)

"BLD",4256,"KRN","B",.401,.401)

"BLD",4256,"KRN","B",.402,.402)

"BLD",4256,"KRN","B",.403,.403)

"BLD",4256,"KRN","B",.5,.5)

"BLD",4256,"KRN","B",.84,.84)

"BLD",4256,"KRN","B",3.6,3.6)

"BLD",4256,"KRN","B",3.8,3.8)

"BLD",4256,"KRN","B",9.2,9.2)

"BLD",4256,"KRN","B",9.8,9.8)

"BLD",4256,"KRN","B",19,19)

"BLD",4256,"KRN","B",19.1,19.1)

"BLD",4256,"KRN","B",101,101)

"BLD",4256,"KRN","B",409.61,409.61)

"BLD",4256,"KRN","B",771,771)

"BLD",4256,"KRN","B",870,870)

"BLD",4256,"KRN","B",8989.51,8989.51)

"BLD",4256,"KRN","B",8989.52,8989.52)

"BLD",4256,"KRN","B",8994,8994)

"BLD",4256,"QUES",0)
^9.62^^
"BLD",4256,"REQB",0)
^9.611^6^6
"BLD",4256,"REQB",1,0)
GMPL*2.0*7^2
"BLD",4256,"REQB",2,0)
GMPL*2.0*11^2
"BLD",4256,"REQB",3,0)
GMPL*2.0*20^2
"BLD",4256,"REQB",4,0)
GMPL*2.0*21^2
"BLD",4256,"REQB",5,0)
GMPL*2.0*26^2
"BLD",4256,"REQB",6,0)
LEX*2.0*25^2
"BLD",4256,"REQB","B","GMPL*2.0*11",2)

"BLD",4256,"REQB","B","GMPL*2.0*20",3)

"BLD",4256,"REQB","B","GMPL*2.0*21",4)

"BLD",4256,"REQB","B","GMPL*2.0*26",5)

"BLD",4256,"REQB","B","GMPL*2.0*7",1)

"BLD",4256,"REQB","B","LEX*2.0*25",6)

"KRN",3.8,143,-1)
0^1
"KRN",3.8,143,0)
GMPL CODE SET VERSION UPDATES^PU^n^^^^
"KRN",3.8,143,2,0)
^3.801^2^2^3030414^^^
"KRN",3.8,143,2,1,0)
This mail group will be used to send information about the status of ICD9 
"KRN",3.8,143,2,2,0)
codes attached to problems on problem selection lists.
"KRN",3.8,143,3)

"KRN",19,3973,-1)
2^3
"KRN",19,3973,0)
GMPL BUILD LIST MENU^Create Problem Selection Lists^^M^.5^^^^^^^172
"KRN",19,3973,10,0)
^19.01IP^7^6
"KRN",19,3973,10,3,0)
3974^3^3
"KRN",19,3973,10,3,"^")
GMPL ASSIGN LIST
"KRN",19,3973,10,7,0)
9145^6^6
"KRN",19,3973,10,7,"^")
GMPL SELECTION LIST CSV CHECK
"KRN",19,3973,"U")
CREATE PROBLEM SELECTION LISTS
"KRN",19,3974,-1)
0^1
"KRN",19,3974,0)
GMPL ASSIGN LIST^Assign Selection List to User(s)^^R^^^^^^^^PROBLEM LIST^^
"KRN",19,3974,1,0)
^19.06^6^6^3030314^^^^
"KRN",19,3974,1,1,0)
This option allows a selection list to be assigned to user(s) as his/her
"KRN",19,3974,1,2,0)
preferred menu of problems to select from.  If a list is specified in
"KRN",19,3974,1,3,0)
the Problem List Default Menu field (#125.1) of the New Person file,
"KRN",19,3974,1,4,0)
then the Add New Problem(s) option will present this list of problems
"KRN",19,3974,1,5,0)
to select from; searching the Lexicon Utility for a problem not on this
"KRN",19,3974,1,6,0)
list is always an option from these menus.
"KRN",19,3974,20)

"KRN",19,3974,25)
ASSIGN^GMPLBLD2
"KRN",19,3974,"U")
ASSIGN SELECTION LIST TO USER(
"KRN",19,9145,-1)
0^2
"KRN",19,9145,0)
GMPL SELECTION LIST CSV CHECK^Check Problem Selection List problem codes^^R^^^^^^^^PROBLEM LIST
"KRN",19,9145,1,0)
^19.06^5^5^3030320^^
"KRN",19,9145,1,1,0)
This option will produce a report related to Problem Selection Lists. The
"KRN",19,9145,1,2,0)
report will contain a list of any Problem Selection Lists that contain 
"KRN",19,9145,1,3,0)
problems with inactive ICD9 codes attached. It will also determine if any 
"KRN",19,9145,1,4,0)
attached ICD9 codes are due to be inactivated in the future and a report 
"KRN",19,9145,1,5,0)
of those findings is also included.
"KRN",19,9145,25)
CSVOPT^GMPLBLCK
"KRN",19,9145,"U")
CHECK PROBLEM SELECTION LIST P
"KRN",101,6310,-1)
0^1
"KRN",101,6310,0)
GMPL SELECTION LIST CSV EVENT^Problem Selection List CSV event^^A^^^^^^^^PROBLEM LIST
"KRN",101,6310,1,0)
^^6^6^3030320^
"KRN",101,6310,1,1,0)
This protocol is invoked when a new ICD9 Code Set Version is installed. 
"KRN",101,6310,1,2,0)
The protocol will generate a mail message related to Problem Selection
"KRN",101,6310,1,3,0)
Lists. The mail message will contain a list of any Problem Selection Lists
"KRN",101,6310,1,4,0)
that contain problems with inactive ICD9 codes attached. It will also
"KRN",101,6310,1,5,0)
determine if any attached ICD9 codes are due to be inactivated in the
"KRN",101,6310,1,6,0)
future and a report of those findings is also included.
"KRN",101,6310,20)
D CSVPEP^GMPLBLCK
"KRN",101,6310,99)
59248,27137
"KRN",101,6367,-1)
2^2
"KRN",101,6367,0)
ICD CODE UPDATE EVENT^ICD Code Update^^X^1118^^^^^^^
"KRN",101,6367,10,0)
^101.01PA^2^2
"KRN",101,6367,10,2,0)
6310^^^
"KRN",101,6367,10,2,"^")
GMPL SELECTION LIST CSV EVENT
"MBREQ")
1
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",172,-1)
1^1
"PKG",172,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",172,20,0)
^9.402P^^
"PKG",172,22,0)
^9.49I^1^1
"PKG",172,22,1,0)
2.0^2940825^2941103
"PKG",172,22,1,"PAH",1,0)
28^3030731
"PKG",172,22,1,"PAH",1,1,0)
^^2^2^3030731
"PKG",172,22,1,"PAH",1,1,1,0)
See the National Patch Module for a complete list of enhancements included
"PKG",172,22,1,"PAH",1,1,2,0)
in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","GMPL")
0^13^B28597779
"RTN","GMPL",1,0)
GMPL ; SLC/MKB/AJB -- Problem List Driver ;;9-5-95 11:47am
"RTN","GMPL",2,0)
 ;;2.0;Problem List;**3,11,28**;Aug 25, 1994
"RTN","GMPL",3,0)
EN ; -- main entry point for GMPL PROBLEM LIST
"RTN","GMPL",4,0)
 S GMPLUSER=1
"RTN","GMPL",5,0)
 D EN^VALM("GMPL PROBLEM LIST")
"RTN","GMPL",6,0)
 Q
"RTN","GMPL",7,0)
 ;
"RTN","GMPL",8,0)
DE ; -- main entry point for GMPL DATA ENTRY
"RTN","GMPL",9,0)
 K GMPLUSER
"RTN","GMPL",10,0)
 D EN^VALM("GMPL DATA ENTRY")
"RTN","GMPL",11,0)
 Q
"RTN","GMPL",12,0)
 ;
"RTN","GMPL",13,0)
ADD ; -- add a new problem 
"RTN","GMPL",14,0)
 S VALMBCK="",GMPCLIN="" K GMPREBLD
"RTN","GMPL",15,0)
 I +$P(GMPDFN,U,4),'$$CKDEAD^GMPLX1($P(GMPDFN,U,4)) G ADDQ
"RTN","GMPL",16,0)
 S:$E(GMPLVIEW("VIEW"))'="S" GMPCLIN=$$CLINIC^GMPLX1("") G:GMPCLIN="^" ADDQ
"RTN","GMPL",17,0)
 S GMPLSLST=$P($G(^VA(200,DUZ,125)),U,2)
"RTN","GMPL",18,0)
 I 'GMPLSLST,GMPCLIN,$D(^GMPL(125,"C",+GMPCLIN)) S GMPLSLST=$O(^(+GMPCLIN,0)) ; if user has no list but clinic does, use clinic list
"RTN","GMPL",19,0)
 I GMPLSLST D  G ADD1
"RTN","GMPL",20,0)
 . S $P(GMPLSLST,U,2)=$P($G(^GMPL(125,+GMPLSLST,0)),U)
"RTN","GMPL",21,0)
 . D EN^VALM("GMPL LIST MENU")
"RTN","GMPL",22,0)
 W @IOF D FULL^VALM1 F  D ADD^GMPL1 Q:$D(GMPQUIT)  S:$D(GMPSAVED) GMPREBLD=1 K DUOUT,DTOUT,GMPSAVED W !!!,">>>  Please enter another problem, or press <return> to exit."
"RTN","GMPL",23,0)
 S VALMBCK="R"
"RTN","GMPL",24,0)
ADD1 I $D(GMPREBLD) D
"RTN","GMPL",25,0)
 . S VALMBCK="R",GMPRINT=1
"RTN","GMPL",26,0)
 . S VALMBG=$S(GMPARAM("REV"):1,VALMCNT<10:1,1:VALMCNT-9)
"RTN","GMPL",27,0)
 . D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPL",28,0)
ADDQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",29,0)
 Q
"RTN","GMPL",30,0)
 ;
"RTN","GMPL",31,0)
STATUS ; -- inactivate a problem
"RTN","GMPL",32,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 STQ
"RTN","GMPL",33,0)
 I GMPLVIEW("ACT")="I" W $C(7),!!,"Currently displayed problems are already inactive!",! G STQ
"RTN","GMPL",34,0)
 S GMPLSEL=$$SEL^GMPLX("inactivate") G:GMPLSEL="^" STQ
"RTN","GMPL",35,0)
 S GMPLNO=$L(GMPLSEL,",")
"RTN","GMPL",36,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D  Q:$D(GMPQUIT)
"RTN","GMPL",37,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) Q:GMPIFN'>0
"RTN","GMPL",38,0)
 . I $P(^AUPNPROB(GMPIFN,0),U,12)="I" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"is already inactive!",! H 2 Q
"RTN","GMPL",39,0)
 . I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has been removed from this patient's problem list!",! H 2 Q
"RTN","GMPL",40,0)
 . L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL",41,0)
 . D STATUS^GMPL1 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",42,0)
 I $D(GMPSAVED) D
"RTN","GMPL",43,0)
 . S VALMBCK="R",GMPRINT=1
"RTN","GMPL",44,0)
 . D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPL",45,0)
STQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",46,0)
 Q
"RTN","GMPL",47,0)
 ;
"RTN","GMPL",48,0)
NOTES ; -- annotate a problem
"RTN","GMPL",49,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 NTQ
"RTN","GMPL",50,0)
 S GMPLNUM=$$SEL1^GMPLX("add comment(s) to") G:GMPLNUM="^" NTQ
"RTN","GMPL",51,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 NTQ
"RTN","GMPL",52,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has been removed from this patient's problem list!",! H 2 G NTQ
"RTN","GMPL",53,0)
 ; Code Set Versioning (CSV)
"RTN","GMPL",54,0)
 I '$$CODESTS^GMPLX(GMPIFN,DT) W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has an inactive ICD9 code. Edit the problem before adding comments.",! H 3 G NTQ
"RTN","GMPL",55,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 G NTQ
"RTN","GMPL",56,0)
 D NEWNOTE^GMPL1 I $D(GMPSAVED) D
"RTN","GMPL",57,0)
 . S VALMBCK="R",GMPRINT=1
"RTN","GMPL",58,0)
 . D BUILD^GMPLMGR(.GMPLIST)
"RTN","GMPL",59,0)
 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",60,0)
NTQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",61,0)
 Q
"RTN","GMPL",62,0)
 ;
"RTN","GMPL",63,0)
EDIT ; -- edit allowable fields of a problem
"RTN","GMPL",64,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 EDQ
"RTN","GMPL",65,0)
 S GMPLNUM=$$SEL1^GMPLX("edit") G:GMPLNUM="^" EDQ
"RTN","GMPL",66,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 EDQ
"RTN","GMPL",67,0)
 ; Code Set Versioning (CSV)
"RTN","GMPL",68,0)
 ; I '$$CODESTS^GMPLX(GMPIFN,DT) W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has an inactive ICD code.",! H 3 G EDQ
"RTN","GMPL",69,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has been removed from this patient's problem list!",! H 2 G EDQ
"RTN","GMPL",70,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 G EDQ
"RTN","GMPL",71,0)
 D EN^VALM("GMPL EDIT PROBLEM")
"RTN","GMPL",72,0)
 I $D(GMPSAVED) D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR S GMPRINT=1
"RTN","GMPL",73,0)
 S VALMBCK="R" L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",74,0)
EDQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",75,0)
 Q
"RTN","GMPL",76,0)
 ;
"RTN","GMPL",77,0)
DELETE ; -- delete a problem
"RTN","GMPL",78,0)
 S VALMBCK="" G:+$G(GMPCOUNT)'>0 DELQ
"RTN","GMPL",79,0)
 S GMPLSEL=$$SEL^GMPLX("remove from the list") G:GMPLSEL="^" DELQ
"RTN","GMPL",80,0)
 S GMPLNO=$L(GMPLSEL,",") G:'$$SUREDEL^GMPLEDT2(GMPLNO-1) DELQ
"RTN","GMPL",81,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D  Q:$D(GMPQUIT)
"RTN","GMPL",82,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) Q:GMPIFN'>0
"RTN","GMPL",83,0)
 . I $P($G(^AUPNPROB(GMPIFN,1)),U,2)="H" W !!,$$PROBTEXT^GMPLX(GMPIFN),!,"has already been removed from this patient's problem list!",! H 2 Q
"RTN","GMPL",84,0)
 . L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL",85,0)
 . D DELETE^GMPL1 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPL",86,0)
 I $D(GMPSAVED) D
"RTN","GMPL",87,0)
 . S VALMBCK="R",GMPRINT=1 D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPL",88,0)
DELQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",89,0)
 Q
"RTN","GMPL",90,0)
 ;
"RTN","GMPL",91,0)
VERIFY ; -- verify a problem
"RTN","GMPL",92,0)
 S VALMBCK="" Q:+$G(GMPCOUNT)'>0
"RTN","GMPL",93,0)
 W !!,"Select the problem(s) you wish to verify as correct."
"RTN","GMPL",94,0)
 S GMPLSEL=$$SEL^GMPLX("mark as verified") G:GMPLSEL="^" VERQ
"RTN","GMPL",95,0)
 S GMPLNO=$L(GMPLSEL,",")
"RTN","GMPL",96,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D
"RTN","GMPL",97,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,GMPLNUM)),U,2)
"RTN","GMPL",98,0)
 . D:GMPIFN VERIFY^GMPL1
"RTN","GMPL",99,0)
 I $D(GMPSAVED) D BUILD^GMPLMGR(.GMPLIST) S VALMBCK="R"
"RTN","GMPL",100,0)
VERQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",101,0)
 Q
"RTN","GMPL",102,0)
 ;
"RTN","GMPL",103,0)
EXPAND ; -- detailed display of a problem
"RTN","GMPL",104,0)
 S VALMBCK="" Q:+$G(GMPCOUNT)'>0
"RTN","GMPL",105,0)
 S GMPLSEL=$$SEL^GMPLX("view") G:GMPLSEL="^" EXPQ
"RTN","GMPL",106,0)
 S GMPLNO=$L(GMPLSEL,",")-1,GMPI=0
"RTN","GMPL",107,0)
 D EN^VALM("GMPL DETAILED DISPLAY")
"RTN","GMPL",108,0)
 S VALMBCK="R"
"RTN","GMPL",109,0)
EXPQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX S:'VALMCC VALMBCK="R"
"RTN","GMPL",110,0)
 Q
"RTN","GMPL1")
0^8^B26232725
"RTN","GMPL1",1,0)
GMPL1 ; SLC/MKB/AJB -- Problem List actions ; 04/22/03
"RTN","GMPL1",2,0)
 ;;2.0;Problem List;**3,20,28**;Aug 25, 1994
"RTN","GMPL1",3,0)
 ; 10 MAR 2000 - MA - Added to the routine another user prompt
"RTN","GMPL1",4,0)
 ; to backup and refine Lexicon search if ICD code 799.9
"RTN","GMPL1",5,0)
ADD ;add new entry to list - Requires GMPDFN
"RTN","GMPL1",6,0)
 N GMPROB,GMPTERM,GMPICD,Y,DUP W !
"RTN","GMPL1",7,0)
 S GMPROB=$$TEXT^GMPLEDT4("") I GMPROB="^" S GMPQUIT=1 Q
"RTN","GMPL1",8,0)
 I 'GMPARAM("CLU")!('$D(GMPLUSER)&('$D(^XUSEC("GMPL ICD CODE",DUZ)))) S GMPTERM="",GMPICD="799.9" G ADD1
"RTN","GMPL1",9,0)
 F  D  Q:$D(GMPQUIT)!(+$G(Y))
"RTN","GMPL1",10,0)
 . D SEARCH^GMPLX(.GMPROB,.Y,"PROBLEM: ","1")
"RTN","GMPL1",11,0)
 . I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPL1",12,0)
 . S DUP=$$DUPL^GMPLX(+GMPDFN,+Y,GMPROB)
"RTN","GMPL1",13,0)
 . I DUP,'$$DUPLOK^GMPLX(DUP) S (Y,GMPROB)=""
"RTN","GMPL1",14,0)
 . I +Y=1 D ICDMSG
"RTN","GMPL1",15,0)
 Q:$D(GMPQUIT)
"RTN","GMPL1",16,0)
 S GMPTERM=$S(+$G(Y)>1:Y,1:""),GMPICD=$G(Y(1))
"RTN","GMPL1",17,0)
 S:'$L(GMPICD) GMPICD="799.9"
"RTN","GMPL1",18,0)
ADD1 ; set up default values
"RTN","GMPL1",19,0)
 ; -- May enter here with GMPROB=text,GMPICD=code,GMPTERM=#^term
"RTN","GMPL1",20,0)
 ; added for Code Set Versioning (CSV)
"RTN","GMPL1",21,0)
 I '+$$STATCHK^ICDAPIU(GMPICD,DT) W !,GMPROB,!,"has an inactive code.  Please edit before adding." H 3 Q
"RTN","GMPL1",22,0)
 N OK,GMPI,GMPFLD K GMPLJUMP
"RTN","GMPL1",23,0)
 S GMPFLD(1.01)=GMPTERM,GMPFLD(.05)=U_GMPROB
"RTN","GMPL1",24,0)
 S GMPFLD(.01)=$O(^ICD9("AB",GMPICD_" ",0))_U_GMPICD
"RTN","GMPL1",25,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX ; cannot resolve code
"RTN","GMPL1",26,0)
 S (GMPFLD(1.04),GMPFLD(1.05))=$G(GMPROV),GMPFLD(1.03)=DUZ
"RTN","GMPL1",27,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+GMPFLD(1.04)),GMPFLD(1.08)=$G(GMPCLIN)
"RTN","GMPL1",28,0)
 S (GMPFLD(.08),GMPFLD(1.09))=DT_U_$$EXTDT^GMPLX(DT)
"RTN","GMPL1",29,0)
 S GMPFLD(.12)="A^ACTIVE",GMPFLD(1.14)="",GMPFLD(10,0)=0
"RTN","GMPL1",30,0)
 S GMPFLD(1.02)=$S('$G(GMPARAM("VER")):"P",$D(GMPLUSER):"P",1:"T")
"RTN","GMPL1",31,0)
 S (GMPFLD(.13),GMPFLD(1.07))="" ; initialize dates
"RTN","GMPL1",32,0)
 S GMPFLD(1.1)=$S('GMPSC:"0^NO",1:""),GMPFLD(1.11)=$S('GMPAGTOR:"0^NO",1:"")
"RTN","GMPL1",33,0)
 S GMPFLD(1.12)=$S('GMPION:"0^NO",1:""),GMPFLD(1.13)=$S('GMPGULF:"0^NO",1:"")
"RTN","GMPL1",34,0)
ADD2 ; prompt for values
"RTN","GMPL1",35,0)
 D FLDS^GMPLEDT3 ; set GMPFLD("FLD") of editable fields
"RTN","GMPL1",36,0)
 F GMPI=2:1:7 D @(GMPFLD("FLD",GMPI)_"^GMPLEDT1") Q:$D(GMPQUIT)  K GMPLJUMP ; cannot ^-jump here
"RTN","GMPL1",37,0)
 Q:$D(GMPQUIT)
"RTN","GMPL1",38,0)
ADD3 ; Ok to save?
"RTN","GMPL1",39,0)
 S OK=$$ACCEPT^GMPLDIS1(.GMPFLD),GMPLJUMP=0 ; ok to save values?
"RTN","GMPL1",40,0)
 I OK="^" W !!?10,"< Nothing Saved !! >",! S GMPQUIT=1 H 1 Q
"RTN","GMPL1",41,0)
 I OK D  Q  ; ck DA for error?
"RTN","GMPL1",42,0)
 . N I W !!,"Saving ..." D NEW^GMPLSAVE
"RTN","GMPL1",43,0)
 . S I=$S(GMPLIST(0)'>0:1,GMPARAM("REV"):$O(GMPLIST(0))-.01,1:GMPLIST(0)+1)
"RTN","GMPL1",44,0)
 . S GMPLIST(I)=DA,GMPLIST("B",DA)=I,GMPLIST(0)=$G(GMPLIST(0))+1
"RTN","GMPL1",45,0)
 . W " done."
"RTN","GMPL1",46,0)
 ; Not ok -- edit values, ask again
"RTN","GMPL1",47,0)
 F GMPI=1:1:GMPFLD("FLD",0) D @(GMPFLD("FLD",GMPI)_"^GMPLEDT1") Q:$D(GMPQUIT)!($D(GMPSAVED))  I $G(GMPLJUMP) S GMPI=GMPLJUMP-1 S GMPLJUMP=0 ; reset GMPI to desired fld
"RTN","GMPL1",48,0)
 Q:$D(DTOUT)  K GMPQUIT,DUOUT G ADD3
"RTN","GMPL1",49,0)
 Q
"RTN","GMPL1",50,0)
 ;
"RTN","GMPL1",51,0)
 ; *********************************************************************
"RTN","GMPL1",52,0)
 ; *  GMPIFN expected for the following calls:
"RTN","GMPL1",53,0)
 ;
"RTN","GMPL1",54,0)
STATUS ; -- inactivate problem
"RTN","GMPL1",55,0)
 N DIE,DA,DR,X,Y,CHNGE,GMPFLD,PROMPT,DEFAULT
"RTN","GMPL1",56,0)
 S GMPFLD(.13)=$P($G(^AUPNPROB(GMPIFN,0)),U,13) ; Onset
"RTN","GMPL1",57,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN) D RESOLVED^GMPLEDT4 Q:$D(GMPQUIT)
"RTN","GMPL1",58,0)
 S PROMPT="COMMENT (<60 char): ",DEFAULT="" D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)
"RTN","GMPL1",59,0)
 W ! I Y'="" S GMPFLD(10,"NEW",1)=Y D NEWNOTE^GMPLSAVE W "."
"RTN","GMPL1",60,0)
 S DIE="^AUPNPROB(",DR=".12///I;1.07////"_$P($G(GMPFLD(1.07)),U)
"RTN","GMPL1",61,0)
 S DA=GMPIFN D ^DIE W "."
"RTN","GMPL1",62,0)
 S CHNGE=GMPIFN_"^.12^"_$$HTFM^XLFDT($H)_U_DUZ_"^A^I^^"_+$G(GMPROV)
"RTN","GMPL1",63,0)
 D AUDIT^GMPLX(CHNGE,"") W "." ; audit trail
"RTN","GMPL1",64,0)
 D DTMOD^GMPLX(GMPIFN) W "." ; update Dt Last Mod
"RTN","GMPL1",65,0)
 W "... inactivated!",!
"RTN","GMPL1",66,0)
 H 1 S GMPSAVED=1
"RTN","GMPL1",67,0)
 Q
"RTN","GMPL1",68,0)
 ;
"RTN","GMPL1",69,0)
NEWNOTE ; -- add a new comment
"RTN","GMPL1",70,0)
 N GMPFLD
"RTN","GMPL1",71,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN)
"RTN","GMPL1",72,0)
 I '$$CODESTS^GMPLX(GMPIFN,DT) W !,"is inactive.  Edit the problem before adding comments.",! H 2 Q
"RTN","GMPL1",73,0)
 D NOTE^GMPLEDT1 Q:$D(GMPQUIT)!($D(GMPFLD(10,"NEW"))'>9)
"RTN","GMPL1",74,0)
 D NEWNOTE^GMPLSAVE,DTMOD^GMPLX(GMPIFN)
"RTN","GMPL1",75,0)
 S GMPSAVED=1
"RTN","GMPL1",76,0)
 Q
"RTN","GMPL1",77,0)
 ;
"RTN","GMPL1",78,0)
DELETE ; -- delete a problem
"RTN","GMPL1",79,0)
 N PROMPT,DEFAULT,X,Y,CHNGE,GMPFLD
"RTN","GMPL1",80,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN)
"RTN","GMPL1",81,0)
 S PROMPT="REASON FOR REMOVAL: ",DEFAULT=""
"RTN","GMPL1",82,0)
 D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)  W !
"RTN","GMPL1",83,0)
 I Y'="" S GMPFLD(10,"NEW",1)=Y D NEWNOTE^GMPLSAVE W "."
"RTN","GMPL1",84,0)
 S CHNGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_"^P^H^Deleted^"_+$G(GMPROV)
"RTN","GMPL1",85,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="H",GMPSAVED=1 W "."
"RTN","GMPL1",86,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPL1",87,0)
 W "... removed!",! H 1
"RTN","GMPL1",88,0)
 Q
"RTN","GMPL1",89,0)
 ;
"RTN","GMPL1",90,0)
VERIFY ; -- verify a transcribed problem, if parameter on
"RTN","GMPL1",91,0)
 N NOW,CHNGE S NOW=$$HTFM^XLFDT($H)
"RTN","GMPL1",92,0)
 W !!,$$PROBTEXT^GMPLX(GMPIFN),!
"RTN","GMPL1",93,0)
 I '$$CODESTS^GMPLX(GMPIFN,DT) W "has an inactive ICD9 code. Edit the problem before verification.",! H 2 Q
"RTN","GMPL1",94,0)
 I $P($G(^AUPNPROB(GMPIFN,1)),U,2)'="T" W "does not require verification.",! H 2 Q
"RTN","GMPL1",95,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPL1",96,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="P",GMPSAVED=1 W "."
"RTN","GMPL1",97,0)
 S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ W "."
"RTN","GMPL1",98,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPL1",99,0)
 L -^AUPNPROB(GMPIFN,0) W " verified.",!
"RTN","GMPL1",100,0)
 Q
"RTN","GMPL1",101,0)
ICDMSG ; If Lexicon returns ICD code 799.9
"RTN","GMPL1",102,0)
 N DIR,DTOUT,DUOUT
"RTN","GMPL1",103,0)
 S DIR(0)="YAO"
"RTN","GMPL1",104,0)
 S DIR("A",1)="<< If you PROCEED WITH THIS NON SPECIFIC TERM, an ICD CODE OF 799.9 >>"
"RTN","GMPL1",105,0)
 S DIR("A",2)="<< OTHER UNKNOWN AND UNSPECIFIED CAUSE OF MORBIDITY OR MORTALITY    >>"
"RTN","GMPL1",106,0)
 S DIR("A",3)="<< will be assigned.  Adding more specificity to your diagnosis may >>"
"RTN","GMPL1",107,0)
 S DIR("A",4)="<< allow a more accurate ICD code.                                  >>"
"RTN","GMPL1",108,0)
 S DIR("A",5)=""
"RTN","GMPL1",109,0)
 S DIR("A")="Continue (YES/NO) ",DIR("B")="NO"
"RTN","GMPL1",110,0)
 S DIR("T")=DTIME
"RTN","GMPL1",111,0)
 D ^DIR
"RTN","GMPL1",112,0)
 I $D(DTOUT)!$D(DUOUT) S Y=0
"RTN","GMPL1",113,0)
 I +Y=0 S (GMPLY,GMPROB)=""
"RTN","GMPL1",114,0)
 Q
"RTN","GMPLBLCK")
0^7^B56283038
"RTN","GMPLBLCK",1,0)
GMPLBLCK ;SLC/JFR - check selection list ICD9 codes; 3/20/03 09:05
"RTN","GMPLBLCK",2,0)
 ;;2.0;Problem List;**28**;Aug 25, 1994
"RTN","GMPLBLCK",3,0)
 ;
"RTN","GMPLBLCK",4,0)
 ; This routine invokes IA #3990
"RTN","GMPLBLCK",5,0)
 Q
"RTN","GMPLBLCK",6,0)
CSVPEP ;called from protocol GMPL SELECTION LIST CSV EVENT
"RTN","GMPLBLCK",7,0)
 N CAT,LN,LST,LIST,XMSUB,XMTEXT,XMDUZ,XMY
"RTN","GMPLBLCK",8,0)
 D CKLISTS,CKCODES
"RTN","GMPLBLCK",9,0)
 K ^TMP("GMPLMSG",$J)
"RTN","GMPLBLCK",10,0)
 S LN=1
"RTN","GMPLBLCK",11,0)
 I $D(^TMP("GMPLSL",$J,"I")) D
"RTN","GMPLBLCK",12,0)
 . S ^TMP("GMPLMSG",$J,LN)="The following Problem Selection Lists contain one or more problems that",LN=LN+1
"RTN","GMPLBLCK",13,0)
 . S ^TMP("GMPLMSG",$J,LN)="have inactive ICD-9 codes attached to them. Any current users or clinics using",LN=LN+1
"RTN","GMPLBLCK",14,0)
 . S ^TMP("GMPLMSG",$J,LN)="these Selection Lists, will not be able to add the problems with inactive ",LN=LN+1
"RTN","GMPLBLCK",15,0)
 . S ^TMP("GMPLMSG",$J,LN)="codes, until the list and the inactive codes are updated. The list may not be",LN=LN+1
"RTN","GMPLBLCK",16,0)
 . S ^TMP("GMPLMSG",$J,LN)="assigned to any additional users or clinics until updated.",LN=LN+1
"RTN","GMPLBLCK",17,0)
 . S LST=0
"RTN","GMPLBLCK",18,0)
 . F  S LST=$O(^TMP("GMPLSL",$J,"I",LST)) Q:'LST  D
"RTN","GMPLBLCK",19,0)
 .. S ^TMP("GMPLMSG",$J,LN)="   "_^TMP("GMPLSL",$J,"I",LST)
"RTN","GMPLBLCK",20,0)
 .. S LN=LN+1
"RTN","GMPLBLCK",21,0)
 ;
"RTN","GMPLBLCK",22,0)
 I $D(^TMP("GMPLSL",$J,"F")) D  ;no future inact. dates
"RTN","GMPLBLCK",23,0)
 . S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",24,0)
 . S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",25,0)
 . S ^TMP("GMPLMSG",$J,LN)="The following Problem Selection List categories contain problems with ICD9 ",LN=LN+1
"RTN","GMPLBLCK",26,0)
 . S ^TMP("GMPLMSG",$J,LN)="codes that have a future inactivation date. These Categories should be updated",LN=LN+1
"RTN","GMPLBLCK",27,0)
 . S ^TMP("GMPLMSG",$J,LN)="as soon as possible after the inactivation date to reduce the interruption of",LN=LN+1
"RTN","GMPLBLCK",28,0)
 . S ^TMP("GMPLMSG",$J,LN)="use of the selection list(s) by users or clinics.",LN=LN+1
"RTN","GMPLBLCK",29,0)
 . S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",30,0)
 . S CAT=0
"RTN","GMPLBLCK",31,0)
 . F  S CAT=$O(^TMP("GMPLSL",$J,"F",CAT)) Q:'CAT  D
"RTN","GMPLBLCK",32,0)
 .. S ^TMP("GMPLMSG",$J,LN)=" Category name: "_$$GET1^DIQ(125.11,CAT,.01)
"RTN","GMPLBLCK",33,0)
 .. S LN=LN+1
"RTN","GMPLBLCK",34,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",35,0)
 .. S ^TMP("GMPLMSG",$J,LN)="    Problems with ICD9 codes due to be inactivated:",LN=LN+1
"RTN","GMPLBLCK",36,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",37,0)
 .. N PROB,TXT
"RTN","GMPLBLCK",38,0)
 .. S PROB=0
"RTN","GMPLBLCK",39,0)
 .. F  S PROB=$O(^TMP("GMPLSL",$J,"F",CAT,PROB)) Q:'PROB  D
"RTN","GMPLBLCK",40,0)
 ... S TXT=^TMP("GMPLSL",$J,"F",CAT,PROB)
"RTN","GMPLBLCK",41,0)
 ... S ^TMP("GMPLMSG",$J,LN)="       Problem text: "_$P(TXT,U),LN=LN+1
"RTN","GMPLBLCK",42,0)
 ... S ^TMP("GMPLMSG",$J,LN)="       Display text: "_$P(TXT,U,2),LN=LN+1
"RTN","GMPLBLCK",43,0)
 ... S ^TMP("GMPLMSG",$J,LN)="               Code: "_$P(TXT,U,3),LN=LN+1
"RTN","GMPLBLCK",44,0)
 ... S ^TMP("GMPLMSG",$J,LN)="      Inactive Date: "_$$FMTE^XLFDT($P(TXT,U,4),2),LN=LN+1
"RTN","GMPLBLCK",45,0)
 ... S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",46,0)
 .. I '$D(^TMP("GMPLSL",$J,"F",CAT,"L")) Q  ; category not part of lists
"RTN","GMPLBLCK",47,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",48,0)
 .. S ^TMP("GMPLMSG",$J,LN)="    This Category is part of the following Problem Selection Lists:",LN=LN+1
"RTN","GMPLBLCK",49,0)
 .. S LIST=0
"RTN","GMPLBLCK",50,0)
 .. F  S LIST=$O(^TMP("GMPLSL",$J,"F",CAT,"L",LIST)) Q:'LIST  D
"RTN","GMPLBLCK",51,0)
 ... S ^TMP("GMPLMSG",$J,LN)="     "_^TMP("GMPLSL",$J,"F",CAT,"L",LIST)
"RTN","GMPLBLCK",52,0)
 ... S LN=LN+1
"RTN","GMPLBLCK",53,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",54,0)
 .. S ^TMP("GMPLMSG",$J,LN)="",LN=LN+1
"RTN","GMPLBLCK",55,0)
 .. Q
"RTN","GMPLBLCK",56,0)
 I '$D(^TMP("GMPLSL",$J)) D  ; no problems found
"RTN","GMPLBLCK",57,0)
 . S ^TMP("GMPLMSG",$J,LN)="No Problems Selection List corrections/review required"
"RTN","GMPLBLCK",58,0)
 . S LN=LN+1
"RTN","GMPLBLCK",59,0)
 S XMY("G.GMPL CODE SET VERSION UPDATES")=""
"RTN","GMPLBLCK",60,0)
 S XMSUB="Problem Selection List Code Set Version review"
"RTN","GMPLBLCK",61,0)
 S XMDUZ="Code Set Version Install"
"RTN","GMPLBLCK",62,0)
 S XMTEXT="^TMP(""GMPLMSG"",$J,"
"RTN","GMPLBLCK",63,0)
 D ^XMD
"RTN","GMPLBLCK",64,0)
 K ^TMP("GMPLSL",$J),^TMP("GMPLMSG",$J)
"RTN","GMPLBLCK",65,0)
 Q
"RTN","GMPLBLCK",66,0)
 ;
"RTN","GMPLBLCK",67,0)
CSVOPT ; called from option GMPL SELECTION LIST CSV CHECK
"RTN","GMPLBLCK",68,0)
 ;
"RTN","GMPLBLCK",69,0)
 N %ZIS,POP
"RTN","GMPLBLCK",70,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","GMPLBLCK",71,0)
 I $D(IO("Q")) D  D ^%ZISC,HOME^%ZIS Q
"RTN","GMPLBLCK",72,0)
 . N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","GMPLBLCK",73,0)
 . S ZTDESC="Review of GMPL SEL LISTS for CSV"
"RTN","GMPLBLCK",74,0)
 . S ZTRTN="QUEUE^GMPLBLCK",ZTIO=ION,ZTDTH=$H
"RTN","GMPLBLCK",75,0)
 . D ^%ZTLOAD
"RTN","GMPLBLCK",76,0)
 . I '$G(ZTSK) W !,"Unable to task report"
"RTN","GMPLBLCK",77,0)
 . Q
"RTN","GMPLBLCK",78,0)
 ;
"RTN","GMPLBLCK",79,0)
QUEUE ; entry point for tasked report
"RTN","GMPLBLCK",80,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","GMPLBLCK",81,0)
 U IO
"RTN","GMPLBLCK",82,0)
 N CAT,LN,LST,LIST,PAGE
"RTN","GMPLBLCK",83,0)
 D CKLISTS,CKCODES
"RTN","GMPLBLCK",84,0)
 S PAGE=1 D PAGE(.PAGE)
"RTN","GMPLBLCK",85,0)
 I '$D(^TMP("GMPLSL",$J)) D  ; no problems found
"RTN","GMPLBLCK",86,0)
 . W !,"No Problems Selection List corrections/review required"
"RTN","GMPLBLCK",87,0)
 . I $E(IOST,1,2)="C-" D
"RTN","GMPLBLCK",88,0)
 .. N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","GMPLBLCK",89,0)
 .. S DIR(0)="E" D ^DIR
"RTN","GMPLBLCK",90,0)
 . Q
"RTN","GMPLBLCK",91,0)
 ;
"RTN","GMPLBLCK",92,0)
 I $D(^TMP("GMPLSL",$J,"I")) D  ; some inactive problem codes
"RTN","GMPLBLCK",93,0)
 . W !,"The following Problem Selection List(s) contain one or more problems that"
"RTN","GMPLBLCK",94,0)
 . W !,"have inactive ICD-9 codes attached to them. Any current users or clinics using"
"RTN","GMPLBLCK",95,0)
 . W !,"these Selection Lists, will not be able to add the problems with inactive "
"RTN","GMPLBLCK",96,0)
 . W !,"codes, until the list and the inactive codes are updated. The list may not be"
"RTN","GMPLBLCK",97,0)
 . W !,"assigned to any additional users or clinics until updated.",!
"RTN","GMPLBLCK",98,0)
 . S LST=0
"RTN","GMPLBLCK",99,0)
 . F  S LST=$O(^TMP("GMPLSL",$J,"I",LST)) Q:'LST!(PAGE<1)  D
"RTN","GMPLBLCK",100,0)
 .. I IOSL-$Y<3 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",101,0)
 .. W !,"   "_^TMP("GMPLSL",$J,"I",LST)
"RTN","GMPLBLCK",102,0)
 ;
"RTN","GMPLBLCK",103,0)
 I $D(^TMP("GMPLSL",$J,"F")) D  ; future inact. dates
"RTN","GMPLBLCK",104,0)
 . D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",105,0)
 . W !,"The following Problem Selection List categories contain problems with ICD9 "
"RTN","GMPLBLCK",106,0)
 . W !,"codes that have a future inactivation date. These Categories should be updated"
"RTN","GMPLBLCK",107,0)
 . W !,"as soon as possible after the inactivation date to reduce the interruption of"
"RTN","GMPLBLCK",108,0)
 . W !,"use of the selection list(s) by users or clinics.",!
"RTN","GMPLBLCK",109,0)
 . S CAT=0
"RTN","GMPLBLCK",110,0)
 . F  S CAT=$O(^TMP("GMPLSL",$J,"F",CAT)) Q:'CAT  D
"RTN","GMPLBLCK",111,0)
 .. I IOSL-$Y<8 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",112,0)
 .. W !!!," Category name: "_$$GET1^DIQ(125.11,CAT,.01),!
"RTN","GMPLBLCK",113,0)
 .. W !,"    Problems with ICD9 codes due to be inactivated:",!
"RTN","GMPLBLCK",114,0)
 .. N PROB,TXT
"RTN","GMPLBLCK",115,0)
 .. S PROB=0
"RTN","GMPLBLCK",116,0)
 .. F  S PROB=$O(^TMP("GMPLSL",$J,"F",CAT,PROB)) Q:'PROB!(PAGE<1)  D
"RTN","GMPLBLCK",117,0)
 ... S TXT=^TMP("GMPLSL",$J,"F",CAT,PROB)
"RTN","GMPLBLCK",118,0)
 ... I IOSL-$Y<5 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",119,0)
 ... W !,"       Problem text: "_$P(TXT,U)
"RTN","GMPLBLCK",120,0)
 ... W !,"       Display text: "_$P(TXT,U,2)
"RTN","GMPLBLCK",121,0)
 ... W !,"               Code: "_$P(TXT,U,3)
"RTN","GMPLBLCK",122,0)
 ... W !,"      Inactive Date: "_$P(TXT,U,4),!
"RTN","GMPLBLCK",123,0)
 .. I '$D(^TMP("GMPLSL",$J,"F",CAT,"L")) Q  ; category not part of lists
"RTN","GMPLBLCK",124,0)
 .. I IOSL-$Y<3 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",125,0)
 .. W !!,"    This Category is part of the following Problem Selection Lists:",!
"RTN","GMPLBLCK",126,0)
 .. S LIST=0
"RTN","GMPLBLCK",127,0)
 .. F  S LIST=$O(^TMP("GMPLSL",$J,"F",CAT,"L",LIST)) Q:'LIST!(PAGE<1)  D
"RTN","GMPLBLCK",128,0)
 ... I IOSL-$Y<3 D PAGE(.PAGE) Q:'PAGE
"RTN","GMPLBLCK",129,0)
 ... W !,"     "_^TMP("GMPLSL",$J,"F",CAT,"L",LIST)
"RTN","GMPLBLCK",130,0)
 .. Q
"RTN","GMPLBLCK",131,0)
 . Q
"RTN","GMPLBLCK",132,0)
 D:$E(IOST,1,2)'="C-" ^%ZISC
"RTN","GMPLBLCK",133,0)
 D HOME^%ZIS
"RTN","GMPLBLCK",134,0)
 K ^TMP("GMPLSL",$J)
"RTN","GMPLBLCK",135,0)
 Q
"RTN","GMPLBLCK",136,0)
 ;
"RTN","GMPLBLCK",137,0)
CKLISTS ; loop lists and see if any inactive problems
"RTN","GMPLBLCK",138,0)
 ;
"RTN","GMPLBLCK",139,0)
 ; returns ^TMP("GMPLSL",$J,"I"
"RTN","GMPLBLCK",140,0)
 ;
"RTN","GMPLBLCK",141,0)
 K ^TMP("GMPLSL",$J,"I")
"RTN","GMPLBLCK",142,0)
 N LST
"RTN","GMPLBLCK",143,0)
 S LST=0
"RTN","GMPLBLCK",144,0)
 F  S LST=$O(^GMPL(125,LST)) Q:'LST  I '$$VALLIST^GMPLBLD2(LST) D
"RTN","GMPLBLCK",145,0)
 . S ^TMP("GMPLSL",$J,"I",LST)=$P(^GMPL(125,LST,0),U)
"RTN","GMPLBLCK",146,0)
 . Q
"RTN","GMPLBLCK",147,0)
 Q
"RTN","GMPLBLCK",148,0)
 ;
"RTN","GMPLBLCK",149,0)
CKCODES ; check probs on lists for future inactivation dates
"RTN","GMPLBLCK",150,0)
 ;
"RTN","GMPLBLCK",151,0)
 ; returns:
"RTN","GMPLBLCK",152,0)
 ;   ^TMP("GMPLSL",$J,"F",category,problem)
"RTN","GMPLBLCK",153,0)
 ;   ^TMP("GMPLSL",$J,"F",category,"L",list)
"RTN","GMPLBLCK",154,0)
 ;
"RTN","GMPLBLCK",155,0)
 K ^TMP("GMPLSL",$J,"F")
"RTN","GMPLBLCK",156,0)
 N PROB,CAT,LIST
"RTN","GMPLBLCK",157,0)
 S PROB=0
"RTN","GMPLBLCK",158,0)
 F  S PROB=$O(^GMPL(125.12,PROB)) Q:'PROB  I $L($P(^(PROB,0),U,5)) D
"RTN","GMPLBLCK",159,0)
 . N PROB0,PROBTX,APIDATA,PROBCAT,ACTDT
"RTN","GMPLBLCK",160,0)
 . S PROB0=^GMPL(125.12,PROB,0)
"RTN","GMPLBLCK",161,0)
 . I '$$STATCHK^ICDAPIU($P(PROB0,U,5),DT) Q  ;already inactive
"RTN","GMPLBLCK",162,0)
 . S APIDATA=$$HIST^ICDAPIU($P(PROB0,U,5),.APIDATA)
"RTN","GMPLBLCK",163,0)
 . S ACTDT=+$O(APIDATA(DT))
"RTN","GMPLBLCK",164,0)
 . Q:'ACTDT  ; no future activity
"RTN","GMPLBLCK",165,0)
 . I $G(APIDATA(ACTDT)) Q  ; no future inactivation = OK
"RTN","GMPLBLCK",166,0)
 . S PROBTX=$$GET1^DIQ(125.12,PROB,2)
"RTN","GMPLBLCK",167,0)
 . S PROBCAT=$P(PROB0,U)
"RTN","GMPLBLCK",168,0)
 . S ^TMP("GMPLSL",$J,"F",PROBCAT,PROB)=PROBTX_U_$P(PROB0,U,4)_U_$P(PROB0,U,5)_U_$$FMTE^XLFDT(ACTDT)
"RTN","GMPLBLCK",169,0)
 . Q
"RTN","GMPLBLCK",170,0)
 ;
"RTN","GMPLBLCK",171,0)
 ; find lists that contain the categories
"RTN","GMPLBLCK",172,0)
 S CAT=0
"RTN","GMPLBLCK",173,0)
 F  S CAT=$O(^TMP("GMPLSL",$J,"F",CAT)) Q:'CAT  D
"RTN","GMPLBLCK",174,0)
 . I '$D(^GMPL(125.1,"G",CAT)) Q  ; category not part of any lists
"RTN","GMPLBLCK",175,0)
 . N LIST S LIST=0
"RTN","GMPLBLCK",176,0)
 . F  S LIST=$O(^GMPL(125.1,"G",CAT,LIST)) Q:'LIST  D
"RTN","GMPLBLCK",177,0)
 .. S ^TMP("GMPLSL",$J,"F",CAT,"L",LIST)=$$GET1^DIQ(125.1,LIST,.01)
"RTN","GMPLBLCK",178,0)
 .. Q
"RTN","GMPLBLCK",179,0)
 . Q
"RTN","GMPLBLCK",180,0)
 Q
"RTN","GMPLBLCK",181,0)
 ;
"RTN","GMPLBLCK",182,0)
PAGE(NUM) ;print header and raise page number
"RTN","GMPLBLCK",183,0)
 Q:'$G(NUM)
"RTN","GMPLBLCK",184,0)
 I NUM'=1,$E(IOST,1,2)="C-" D  Q:'NUM
"RTN","GMPLBLCK",185,0)
 . N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","GMPLBLCK",186,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLCK",187,0)
 . I $D(DTOUT)!($D(DUOUT)) S NUM=0
"RTN","GMPLBLCK",188,0)
 W @IOF
"RTN","GMPLBLCK",189,0)
 W "Code Set Version review of Problem Selection Lists"
"RTN","GMPLBLCK",190,0)
 W ?70,"Page: ",NUM
"RTN","GMPLBLCK",191,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","GMPLBLCK",192,0)
 S NUM=NUM+1
"RTN","GMPLBLCK",193,0)
 Q
"RTN","GMPLBLD")
0^1^B35403742
"RTN","GMPLBLD",1,0)
GMPLBLD ; SLC/MKB -- Build Problem Selection Lists ; 3/12/03  9:31
"RTN","GMPLBLD",2,0)
 ;;2.0;Problem List;**3,28**;Aug 25, 1994
"RTN","GMPLBLD",3,0)
 ;
"RTN","GMPLBLD",4,0)
 ;This routine invokes IA #3991
"RTN","GMPLBLD",5,0)
 ;
"RTN","GMPLBLD",6,0)
EN ; -- main entry point
"RTN","GMPLBLD",7,0)
 D EN^VALM("GMPL SELECTION LIST BUILD")
"RTN","GMPLBLD",8,0)
 Q
"RTN","GMPLBLD",9,0)
 ;
"RTN","GMPLBLD",10,0)
HDR ; -- header code
"RTN","GMPLBLD",11,0)
 N NAME,NUM,DATE
"RTN","GMPLBLD",12,0)
 S NUM=+^TMP("GMPLST",$J,0)_" categor"_$S(+^TMP("GMPLST",$J,0)'=1:"ies",1:"y")
"RTN","GMPLBLD",13,0)
 S DATE="Last Modified: "_$S(+$P(GMPLSLST,U,3):$$FMTE^XLFDT($P(GMPLSLST,U,3)),1:"<new list>")
"RTN","GMPLBLD",14,0)
 S VALMHDR(1)=DATE_$J(NUM,79-$L(DATE))
"RTN","GMPLBLD",15,0)
 S NAME=$P(GMPLSLST,U,2),VALMHDR(2)=$J(NAME,$L(NAME)\2+41)
"RTN","GMPLBLD",16,0)
 Q
"RTN","GMPLBLD",17,0)
 ;
"RTN","GMPLBLD",18,0)
INIT ; -- init variables and list array
"RTN","GMPLBLD",19,0)
 S GMPLSLST=$$LIST^GMPLBLD2("L") I GMPLSLST="^" S VALMQUIT=1 Q
"RTN","GMPLBLD",20,0)
 L +^GMPL(125,+GMPLSLST,0):1 I '$T D  G INIT
"RTN","GMPLBLD",21,0)
 . W $C(7),!!,"This list is currently being edited by another user!",!
"RTN","GMPLBLD",22,0)
 S GMPLMODE="E",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",23,0)
 D GETLIST,BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLD",24,0)
 Q
"RTN","GMPLBLD",25,0)
 ;
"RTN","GMPLBLD",26,0)
GETLIST ; Build ^TMP("GMPLIST",$J,#)
"RTN","GMPLBLD",27,0)
 N IFN,SEQ,GRP,ITEM,CNT K ^TMP("GMPLIST",$J) S CNT=0
"RTN","GMPLBLD",28,0)
 W !,"Searching for the list ..."
"RTN","GMPLBLD",29,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.1,"B",+GMPLSLST,IFN)) Q:IFN'>0  D
"RTN","GMPLBLD",30,0)
 . S ITEM=$G(^GMPL(125.1,IFN,0)),SEQ=$P(ITEM,U,2),GRP=$P(ITEM,U,3)
"RTN","GMPLBLD",31,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(ITEM,U,2,5),CNT=CNT+1 ; seq ^ group ^ subhdr ^ probs
"RTN","GMPLBLD",32,0)
 . S (^TMP("GMPLIST",$J,"GRP",GRP),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN
"RTN","GMPLBLD",33,0)
 S ^TMP("GMPLIST",$J,0)=CNT
"RTN","GMPLBLD",34,0)
 Q
"RTN","GMPLBLD",35,0)
 ;
"RTN","GMPLBLD",36,0)
BUILD(LIST,MODE) ; Build ^TMP("GMPLST",$J,)
"RTN","GMPLBLD",37,0)
 N SEQ,LCNT,NUM,HDR,GROUP,IFN,ITEM,PSEQ D CLEAN^VALM10
"RTN","GMPLBLD",38,0)
 S:'$D(^TMP("GMPLIST",$J,0)) ^TMP("GMPLIST",$J,0)=0
"RTN","GMPLBLD",39,0)
 I $P($G(^TMP("GMPLIST",$J,0)),U,1)'>0 S ^TMP("GMPLST",$J,1,0)="   ",^TMP("GMPLST",$J,2,0)="No items available.",^TMP("GMPLST",$J,0)="0^2",VALMCNT=2 Q
"RTN","GMPLBLD",40,0)
 S (LCNT,NUM,SEQ)=0
"RTN","GMPLBLD",41,0)
 F  S SEQ=$O(^TMP("GMPLIST",$J,"SEQ",SEQ)) Q:SEQ'>0  D
"RTN","GMPLBLD",42,0)
 . S IFN=^TMP("GMPLIST",$J,"SEQ",SEQ),LCNT=LCNT+1,NUM=NUM+1
"RTN","GMPLBLD",43,0)
 . S GROUP=$P(^TMP("GMPLIST",$J,IFN),U,2),HDR=$P(^TMP("GMPLIST",$J,IFN),U,3)
"RTN","GMPLBLD",44,0)
 . S:'$L(HDR) HDR="<no header>"
"RTN","GMPLBLD",45,0)
 . I LCNT>1,+$P(^TMP("GMPLIST",$J,IFN),U,4),^TMP("GMPLST",$J,LCNT-1,0)'="   " S LCNT=LCNT+1,^TMP("GMPLST",$J,LCNT,0)="   "
"RTN","GMPLBLD",46,0)
 . S ^TMP("GMPLST",$J,LCNT,0)=$S(MODE="I":$J("<"_SEQ_">",8),1:"        ")_$J(NUM,4)_" "_HDR,^TMP("GMPLST",$J,"B",NUM)=IFN
"RTN","GMPLBLD",47,0)
 . D CNTRL^VALM10(LCNT,9,5,IOINHI,IOINORM)
"RTN","GMPLBLD",48,0)
 . Q:'+$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLD",49,0)
 . D CNTRL^VALM10(LCNT,14,$L(HDR),IOUON,IOUOFF)
"RTN","GMPLBLD",50,0)
 . F PSEQ=0:0 S PSEQ=$O(^GMPL(125.12,"C",+GROUP,PSEQ)) Q:PSEQ'>0  D
"RTN","GMPLBLD",51,0)
 . . S IFN=$O(^GMPL(125.12,"C",+GROUP,PSEQ,0)),LCNT=LCNT+1
"RTN","GMPLBLD",52,0)
 . . S ITEM=$G(^GMPL(125.12,IFN,0)),^TMP("GMPLST",$J,LCNT,0)="             "_$P(ITEM,U,4)
"RTN","GMPLBLD",53,0)
 . . I $L($P(ITEM,U,5)) D
"RTN","GMPLBLD",54,0)
 ... S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_" ("_$P(ITEM,U,5)_")"
"RTN","GMPLBLD",55,0)
 ... I $$STATCHK^ICDAPIU($P(ITEM,U,5),DT) Q  ; code is active
"RTN","GMPLBLD",56,0)
 ... S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_"    <INACTIVE CODE>"
"RTN","GMPLBLD",57,0)
 . S LCNT=LCNT+1,^TMP("GMPLST",$J,LCNT,0)="   "
"RTN","GMPLBLD",58,0)
 S ^TMP("GMPLST",$J,0)=NUM_U_LCNT,VALMCNT=LCNT
"RTN","GMPLBLD",59,0)
 Q
"RTN","GMPLBLD",60,0)
 ;
"RTN","GMPLBLD",61,0)
HELP ; -- help code
"RTN","GMPLBLD",62,0)
 N X
"RTN","GMPLBLD",63,0)
 W !!?4,"You may take a variety of actions to update this selection list."
"RTN","GMPLBLD",64,0)
 W !?4,"New categories may be added to this list, or an existing one"
"RTN","GMPLBLD",65,0)
 W !?4,"removed; Edit Category will allow you to change the contents of"
"RTN","GMPLBLD",66,0)
 W !?4,"a category, or create a new one that may be added to this list."
"RTN","GMPLBLD",67,0)
 W !?4,"You may also change how each category appears in this list,"
"RTN","GMPLBLD",68,0)
 W !?4,"view each category's sequence number to facilitate resequencing,"
"RTN","GMPLBLD",69,0)
 W !?4,"assign this list to a clinic or user(s), or edit a different list."
"RTN","GMPLBLD",70,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMPLBLD",71,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLD",72,0)
 Q
"RTN","GMPLBLD",73,0)
 ;
"RTN","GMPLBLD",74,0)
EXIT ; -- exit code
"RTN","GMPLBLD",75,0)
 I $D(GMPLSAVE),$$CKSAVE^GMPLBLD2 D
"RTN","GMPLBLD",76,0)
 . D SAVE^GMPLBLD2
"RTN","GMPLBLD",77,0)
 . S ^GMPL(125,+GMPLSLST,0)=$P(GMPLSLST,U,2)_U_DT_U_$P(GMPLSLST,U,4)
"RTN","GMPLBLD",78,0)
 L -^GMPL(125,+GMPLSLST,0)
"RTN","GMPLBLD",79,0)
 K GMPLIST,GMPLST,GMPLMODE,GMPLSLST,GMPLSAVE,GMPREBLD,GMPQUIT,RT,TMPLST
"RTN","GMPLBLD",80,0)
 K ^TMP("GMPLIST",$J),^TMP("GMPLST",$J)
"RTN","GMPLBLD",81,0)
 Q
"RTN","GMPLBLD",82,0)
 ;
"RTN","GMPLBLD",83,0)
ADD ; Add group(s)
"RTN","GMPLBLD",84,0)
 N SEQ,GROUP,HDR,IFN,GMPQUIT,GMPREBLD D FULL^VALM1
"RTN","GMPLBLD",85,0)
 F  D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLD",86,0)
 . S GROUP=$$GROUP^GMPLBLD2("") I GROUP="^" S GMPQUIT=1 Q
"RTN","GMPLBLD",87,0)
 . I $D(^TMP("GMPLIST",$J,"GRP",+GROUP)) W !?4,">>>  This category is already part of this list!" Q
"RTN","GMPLBLD",88,0)
 . I '$$VALGRP^GMPLBLD2(+GROUP) D  Q
"RTN","GMPLBLD",89,0)
 .. D FULL^VALM1
"RTN","GMPLBLD",90,0)
 .. W !!,$C(7),"This category contains one or more problems with inactive ICD-9 codes. "
"RTN","GMPLBLD",91,0)
 .. W !,"These codes must be updated before adding the category to a selection list."
"RTN","GMPLBLD",92,0)
 .. N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","GMPLBLD",93,0)
 .. S DIR(0)="E" D ^DIR
"RTN","GMPLBLD",94,0)
 .. S VALMBCK="R"
"RTN","GMPLBLD",95,0)
 . S HDR=$$HDR^GMPLBLD1($P(GROUP,U,2)) I HDR="^" S GMPQUIT=1 Q
"RTN","GMPLBLD",96,0)
 . S RT="^TMP(""GMPLIST"",$J,""SEQ"",",SEQ=+$$LAST^GMPLBLD2(RT)+1
"RTN","GMPLBLD",97,0)
 . S SEQ=$$SEQ^GMPLBLD1(SEQ) I SEQ="^" S GMPQUIT=1 Q
"RTN","GMPLBLD",98,0)
 . S IFN=$$TMPIFN^GMPLBLD1,^TMP("GMPLIST",$J,IFN)=SEQ_U_+GROUP_U_HDR_"^1"
"RTN","GMPLBLD",99,0)
 . S (^TMP("GMPLIST",$J,"GRP",+GROUP),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN,^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)+1,GMPREBLD=1
"RTN","GMPLBLD",100,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLD",101,0)
 S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",102,0)
 Q
"RTN","GMPLBLD",103,0)
 ;
"RTN","GMPLBLD",104,0)
EDIT ; Edit category contents
"RTN","GMPLBLD",105,0)
 N GMPLIST,GMPLST,GMPLMODE,GMPLGRP,GMPLSAVE
"RTN","GMPLBLD",106,0)
 D EN^VALM("GMPL SELECTION GROUP BUILD")
"RTN","GMPLBLD",107,0)
 S GMPLMODE="E"
"RTN","GMPLBLD",108,0)
 D GETLIST,BUILD("TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLD",109,0)
 S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",110,0)
 Q
"RTN","GMPLBLD",111,0)
 ;
"RTN","GMPLBLD",112,0)
REMOVE ; Remove group
"RTN","GMPLBLD",113,0)
 N NUM,IFN,SEQ,GRP,DIR,X,Y S VALMBCK=""
"RTN","GMPLBLD",114,0)
 S NUM=$$SEL1^GMPLBLD1 G:NUM="^" RMQ
"RTN","GMPLBLD",115,0)
 S IFN=$G(^TMP("GMPLST",$J,"B",NUM)) G:+IFN'>0 RMQ
"RTN","GMPLBLD",116,0)
 I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Category is not part of this list!" H 2 G RMQ
"RTN","GMPLBLD",117,0)
 S DIR("A")="Are you sure you want to remove '"_$P(^TMP("GMPLIST",$J,IFN),U,3)_"'? "
"RTN","GMPLBLD",118,0)
 S DIR("?")="Enter YES to delete this category from the current list; enter NO to exit."
"RTN","GMPLBLD",119,0)
 S DIR(0)="YA",DIR("B")="NO" D ^DIR
"RTN","GMPLBLD",120,0)
 I 'Y W !?5,"< Nothing removed! >" H 1 G RMQ
"RTN","GMPLBLD",121,0)
 D DELETE^GMPLBLD1(IFN) S VALMBCK="R",GMPLSAVE=1
"RTN","GMPLBLD",122,0)
 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLD",123,0)
RMQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD",124,0)
 Q
"RTN","GMPLBLD",125,0)
 ;
"RTN","GMPLBLD1")
0^3^B31647398
"RTN","GMPLBLD1",1,0)
GMPLBLD1 ; SLC/MKB -- Bld PL Selection Lists cont ;;3/12/03 13:48
"RTN","GMPLBLD1",2,0)
 ;;2.0;Problem List;**3,28**;Aug 25, 1994
"RTN","GMPLBLD1",3,0)
 ;
"RTN","GMPLBLD1",4,0)
 ; This routine invokes IA #3991,#10082
"RTN","GMPLBLD1",5,0)
 ;
"RTN","GMPLBLD1",6,0)
SEL() ; Select item(s) from list
"RTN","GMPLBLD1",7,0)
 N DIR,X,Y,MAX,GRP S GRP=$D(GMPLGRP) ; =1 if editing groups, 0 if lists
"RTN","GMPLBLD1",8,0)
 S MAX=$P($G(^TMP("GMPLST",$J,0)),U,1) I MAX'>0 Q "^"
"RTN","GMPLBLD1",9,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select "_$S('GRP:"Category",1:"Problem")_"(s)"
"RTN","GMPLBLD1",10,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLBLD1",11,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLBLD1",12,0)
 S DIR("?")="Enter the "_$S('GRP:"categories",1:"problems")_" you wish to select, as a range or list of numbers"
"RTN","GMPLBLD1",13,0)
 D ^DIR S:$D(DTOUT)!(X="") Y="^"
"RTN","GMPLBLD1",14,0)
 Q Y
"RTN","GMPLBLD1",15,0)
 ;
"RTN","GMPLBLD1",16,0)
SEL1() ; Select item from list
"RTN","GMPLBLD1",17,0)
 N DIR,X,Y,MAX,GRP S GRP=$D(GMPLGRP) ; =1 if editing groups, 0 if lists
"RTN","GMPLBLD1",18,0)
 S MAX=$P($G(^TMP("GMPLST",$J,0)),U,1) I MAX'>0 Q "^"
"RTN","GMPLBLD1",19,0)
 S DIR(0)="NAO^1:"_MAX_":0",DIR("A")="Select "_$S('GRP:"Category",1:"Problem")
"RTN","GMPLBLD1",20,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLBLD1",21,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLBLD1",22,0)
 S DIR("?")="Enter the "_$S('GRP:"category",1:"problem")_" you wish to select, by number"
"RTN","GMPLBLD1",23,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLBLD1",24,0)
 Q Y
"RTN","GMPLBLD1",25,0)
 ;
"RTN","GMPLBLD1",26,0)
SEQ(NUM) ; Enter/edit seq #, returns new #
"RTN","GMPLBLD1",27,0)
 N DIR,X,Y,GRP S GRP=$D(GMPLGRP) ; =1 if editing groups, 0 if lists
"RTN","GMPLBLD1",28,0)
 S DIR(0)="NA^.01:999.99:2",DIR("A")="SEQUENCE: " S:NUM DIR("B")=NUM
"RTN","GMPLBLD1",29,0)
 S DIR("?",1)="Enter a number indicating the sequence of this item in the "_$S('GRP:"list;",1:"category;")
"RTN","GMPLBLD1",30,0)
 S DIR("?")="up to 2 decimal places may be used, to order these items."
"RTN","GMPLBLD1",31,0)
SQ D ^DIR I $D(DTOUT)!(X="^") Q "^"
"RTN","GMPLBLD1",32,0)
 I X?1"^".E W $C(7),$$NOJUMP G SQ
"RTN","GMPLBLD1",33,0)
 I Y=NUM Q NUM
"RTN","GMPLBLD1",34,0)
 I $D(^TMP("GMPLIST",$J,"SEQ",Y)) D  G SQ
"RTN","GMPLBLD1",35,0)
 . W $C(7),!!,"Sequence number already in use!  Please enter another number."
"RTN","GMPLBLD1",36,0)
 . W !,"Use the 'Change View' option to display the current sequence numbers.",!
"RTN","GMPLBLD1",37,0)
 Q Y
"RTN","GMPLBLD1",38,0)
 ;
"RTN","GMPLBLD1",39,0)
HDR(TEXT) ; Enter/edit group subheader text in list
"RTN","GMPLBLD1",40,0)
 N DIR,X,Y S:$L(TEXT) DIR("B")=TEXT
"RTN","GMPLBLD1",41,0)
 S DIR(0)="FAO^2:30",DIR("A")="HEADER: "
"RTN","GMPLBLD1",42,0)
 S DIR("?")="Enter the text you wish displayed as a header for this category of problems"
"RTN","GMPLBLD1",43,0)
 S:$D(DIR("B")) DIR("?",1)=DIR("?")_";",DIR("?")="enter '@' if no header text is desired."
"RTN","GMPLBLD1",44,0)
H1 D ^DIR I $D(DTOUT)!(X="^") Q "^"
"RTN","GMPLBLD1",45,0)
 I X?1"^".E W $C(7),$$NOJUMP G H1
"RTN","GMPLBLD1",46,0)
 I X="@" Q:$$SURE^GMPLX "" G H1
"RTN","GMPLBLD1",47,0)
 Q Y
"RTN","GMPLBLD1",48,0)
 ;
"RTN","GMPLBLD1",49,0)
TEXT(TEXT) ; Edit problem text
"RTN","GMPLBLD1",50,0)
 N DIR,X,Y S:$L(TEXT) DIR("B")=TEXT
"RTN","GMPLBLD1",51,0)
 S DIR(0)="FAO^2:80",DIR("A")="DISPLAY TEXT: "
"RTN","GMPLBLD1",52,0)
 S DIR("?")="Enter the text you wish presented here for this problem."
"RTN","GMPLBLD1",53,0)
T1 D ^DIR I $D(DTOUT)!("^"[X) S Y="^" G TQ
"RTN","GMPLBLD1",54,0)
 I X?1"^".E W $C(7),$$NOJUMP G T1
"RTN","GMPLBLD1",55,0)
 I X="@" G:'$$SURE^GMPLX T1 S Y="@" G TQ
"RTN","GMPLBLD1",56,0)
TQ Q Y
"RTN","GMPLBLD1",57,0)
 ;
"RTN","GMPLBLD1",58,0)
CODE(CODE) ; Enter/edit problem code
"RTN","GMPLBLD1",59,0)
 N DIR,X,Y
"RTN","GMPLBLD1",60,0)
 S DIR(0)="PAO^ICD9(:QEMZ",DIR("A")="ICD CODE: " S:$L(CODE) DIR("B")=CODE
"RTN","GMPLBLD1",61,0)
 S DIR("?")="Enter the code you wish to be displayed with this problem."
"RTN","GMPLBLD1",62,0)
 S DIR("S")="I $$STATCHK^ICDAPIU($P(^(0),U),DT)"
"RTN","GMPLBLD1",63,0)
C1 D ^DIR I $D(DTOUT)!(X="^") S Y="^" G CQ
"RTN","GMPLBLD1",64,0)
 I X?1"^".E W $C(7),$$NOJUMP G C1
"RTN","GMPLBLD1",65,0)
 I X="@" G:'$$SURE^GMPLX C1 S Y=""
"RTN","GMPLBLD1",66,0)
 S:+Y'>0 Y="" S:+Y>0 Y=Y(0,0)
"RTN","GMPLBLD1",67,0)
CQ Q Y
"RTN","GMPLBLD1",68,0)
 ;
"RTN","GMPLBLD1",69,0)
FLAG(DFLT) ; Edit category flag
"RTN","GMPLBLD1",70,0)
 N DIR,X,Y S DIR(0)="YAO",DIR("B")=$S(+DFLT:"YES",1:"NO")
"RTN","GMPLBLD1",71,0)
 S DIR("A")="SHOW PROBLEMS AUTOMATICALLY? "
"RTN","GMPLBLD1",72,0)
 S DIR("?",1)="Enter YES if you wish the problems contained in this category to be",DIR("?",2)="automatically displayed upon entry to this list; NO will display only the",DIR("?")="category header until the user selects it to view."
"RTN","GMPLBLD1",73,0)
F1 D ^DIR I $D(DTOUT)!(X="^") Q "^"
"RTN","GMPLBLD1",74,0)
 I X?1"^".E W $C(7),$$NOJUMP G F1
"RTN","GMPLBLD1",75,0)
 Q Y
"RTN","GMPLBLD1",76,0)
 ;
"RTN","GMPLBLD1",77,0)
NOJUMP() ; Message
"RTN","GMPLBLD1",78,0)
 Q "   ^-jumping not allowed!"
"RTN","GMPLBLD1",79,0)
 ;
"RTN","GMPLBLD1",80,0)
RETURN() ; End of page prompt
"RTN","GMPLBLD1",81,0)
 N DIR,X,Y
"RTN","GMPLBLD1",82,0)
 S DIR(0)="E" D ^DIR
"RTN","GMPLBLD1",83,0)
 Q +Y
"RTN","GMPLBLD1",84,0)
 ;
"RTN","GMPLBLD1",85,0)
TMPIFN() ; Get temporary IFN ("#N") for ^TMP("GMPLIST",$J,)
"RTN","GMPLBLD1",86,0)
 N I,LAST S (I,LAST)=0
"RTN","GMPLBLD1",87,0)
 F  S I=$O(^TMP("GMPLIST",$J,I)) Q:+I'>0  S:I?1.N1"N" LAST=+I
"RTN","GMPLBLD1",88,0)
 S I=LAST+1,I=$E("0000",1,4-$L(I))_I
"RTN","GMPLBLD1",89,0)
TMPQ Q I_"N"
"RTN","GMPLBLD1",90,0)
 ;
"RTN","GMPLBLD1",91,0)
DELETE(IFN) ; Kill entry in ^TMP("GMPLIST",$J,)
"RTN","GMPLBLD1",92,0)
 N SEQ,ITEM S ^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)-1
"RTN","GMPLBLD1",93,0)
 S SEQ=+^TMP("GMPLIST",$J,IFN),ITEM=$P(^TMP("GMPLIST",$J,IFN),U,2),^TMP("GMPLIST",$J,IFN)="@"
"RTN","GMPLBLD1",94,0)
 K ^TMP("GMPLIST",$J,"SEQ",SEQ),^TMP("GMPLIST",$J,"PROB",ITEM),^TMP("GMPLIST",$J,"GRP",ITEM)
"RTN","GMPLBLD1",95,0)
 K:IFN?1.N1"N" ^TMP("GMPLIST",$J,IFN)
"RTN","GMPLBLD1",96,0)
 Q
"RTN","GMPLBLD1",97,0)
 ;
"RTN","GMPLBLD1",98,0)
RESEQ ; Resequence items
"RTN","GMPLBLD1",99,0)
 N SEL,NUM,SEQ,NSEQ,PIECE,IFN,GMPQUIT S VALMBCK=""
"RTN","GMPLBLD1",100,0)
 S SEL=$$SEL G:SEL="^" RSQ
"RTN","GMPLBLD1",101,0)
 F PIECE=1:1:$L(SEL,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLD1",102,0)
 . S NUM=$P(SEL,",",PIECE) Q:NUM'>0
"RTN","GMPLBLD1",103,0)
 . S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:+IFN'>0  S SEQ=$P(^TMP("GMPLIST",$J,IFN),U,1)
"RTN","GMPLBLD1",104,0)
 . W !!,$P(^TMP("GMPLIST",$J,IFN),U,3)
"RTN","GMPLBLD1",105,0)
 . S NSEQ=$$SEQ(SEQ) I NSEQ="^" S GMPQUIT=1 Q 
"RTN","GMPLBLD1",106,0)
 .I SEQ'=NSEQ S ^TMP("GMPLIST",$J,IFN)=NSEQ_U_$P(^TMP("GMPLIST",$J,IFN),U,2,$L(^TMP("GMPLIST",$J,IFN),U)),^TMP("GMPLIST",$J,"SEQ",NSEQ)=IFN,GMPREBLD=1 K ^TMP("GMPLIST",$J,"SEQ",SEQ)
"RTN","GMPLBLD1",107,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 ; D BUILD in exit action
"RTN","GMPLBLD1",108,0)
RSQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD1",109,0)
 Q
"RTN","GMPLBLD1",110,0)
 ;
"RTN","GMPLBLD1",111,0)
EDIT ; Edit category display
"RTN","GMPLBLD1",112,0)
 N GRPS,NUM,IFN,HDR,FLG,PIECE,GMPQUIT,GMPREBLD S VALMBCK=""
"RTN","GMPLBLD1",113,0)
 S GRPS=$$SEL G:GRPS="^" EDQ
"RTN","GMPLBLD1",114,0)
 F PIECE=1:1:$L(GRPS,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLD1",115,0)
 . S NUM=$P(GRPS,",",PIECE) Q:NUM'>0
"RTN","GMPLBLD1",116,0)
 .S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:+IFN'>0
"RTN","GMPLBLD1",117,0)
 . S HDR=$P(^TMP("GMPLIST",$J,IFN),U,3),FLG=$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLD1",118,0)
 . S HDR=$$HDR(HDR) I HDR="^" S GMPQUIT=1 Q
"RTN","GMPLBLD1",119,0)
 . S FLG=$$FLAG(FLG) I FLG="^" S GMPQUIT=1 Q
"RTN","GMPLBLD1",120,0)
 . S $P(^TMP("GMPLIST",$J,IFN),U,3,4)=HDR_U_FLG,GMPREBLD=1
"RTN","GMPLBLD1",121,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD^GMPLBLD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLD1",122,0)
EDQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD1",123,0)
 Q
"RTN","GMPLBLD2")
0^4^B48951620
"RTN","GMPLBLD2",1,0)
GMPLBLD2 ; SLC/MKB,JFR -- Bld PL Selection Lists cont ; 3/14/03 11:20
"RTN","GMPLBLD2",2,0)
 ;;2.0;Problem List;**3,28**;Aug 25, 1994
"RTN","GMPLBLD2",3,0)
 ;
"RTN","GMPLBLD2",4,0)
 ; This routine invokes IA #3991
"RTN","GMPLBLD2",5,0)
 ;
"RTN","GMPLBLD2",6,0)
NEWGRP ; Change problem groups
"RTN","GMPLBLD2",7,0)
 N NEWGRP D FULL^VALM1
"RTN","GMPLBLD2",8,0)
 I $D(GMPLSAVE),$$CKSAVE D SAVE
"RTN","GMPLBLD2",9,0)
NG1 S NEWGRP=$$GROUP("L") G:+NEWGRP'>0 NGQ G:+NEWGRP=+GMPLGRP NGQ
"RTN","GMPLBLD2",10,0)
 L +^GMPL(125.11,+NEWGRP,0):1 I '$T D  G NG1
"RTN","GMPLBLD2",11,0)
 . W $C(7),!!,"This category is currently being edited by another user!",!
"RTN","GMPLBLD2",12,0)
 L -^GMPL(125.11,+GMPLGRP,0) S GMPLGRP=NEWGRP
"RTN","GMPLBLD2",13,0)
 D GETLIST^GMPLBLDC,BUILD^GMPLBLDC("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR^GMPLBLDC
"RTN","GMPLBLD2",14,0)
NGQ S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD2",15,0)
 Q
"RTN","GMPLBLD2",16,0)
 ;
"RTN","GMPLBLD2",17,0)
GROUP(L) ; Lookup into Problem Selection Group file #125.11
"RTN","GMPLBLD2",18,0)
 N DIC,X,Y,DLAYGO ; L = "" or "L", if LAYGO is [not] allowed
"RTN","GMPLBLD2",19,0)
 S DIC="^GMPL(125.11,",DIC(0)="AEQMZ"_L,DIC("A")="Select CATEGORY NAME: "
"RTN","GMPLBLD2",20,0)
 S:DIC(0)["L" DLAYGO=125.11
"RTN","GMPLBLD2",21,0)
 D ^DIC S:Y'>0 Y="^" S:Y'="^" Y=+Y_U_Y(0)
"RTN","GMPLBLD2",22,0)
 Q Y
"RTN","GMPLBLD2",23,0)
 ;
"RTN","GMPLBLD2",24,0)
NEWLST ; Change selection lists
"RTN","GMPLBLD2",25,0)
 N NEWLST D FULL^VALM1
"RTN","GMPLBLD2",26,0)
 I $D(GMPLSAVE),$$CKSAVE D SAVE
"RTN","GMPLBLD2",27,0)
NL1 S NEWLST=$$LIST("L") G:+NEWLST'>0 NLQ G:+NEWLST=+GMPLSLST NLQ
"RTN","GMPLBLD2",28,0)
 L +^GMPL(125,+NEWLST,0):1 I '$T D  G NL1
"RTN","GMPLBLD2",29,0)
 . W $C(7),!!,"This list is currently being edited by another user!",!
"RTN","GMPLBLD2",30,0)
 L -^GMPL(125,+GMPLSLST,0) S GMPLSLST=NEWLST
"RTN","GMPLBLD2",31,0)
 D GETLIST^GMPLBLD,BUILD^GMPLBLD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR^GMPLBLD
"RTN","GMPLBLD2",32,0)
NLQ S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD2",33,0)
 Q
"RTN","GMPLBLD2",34,0)
 ;
"RTN","GMPLBLD2",35,0)
LIST(L) ; Lookup into Problem Selection List file #125
"RTN","GMPLBLD2",36,0)
 N DIC,X,Y,DLAYGO ; L="" or "L" if LAYGO [not] allowed
"RTN","GMPLBLD2",37,0)
 S DIC="^GMPL(125,",DIC(0)="AEQMZ"_L,DIC("A")="Select LIST NAME: "
"RTN","GMPLBLD2",38,0)
 S:DIC(0)["L" DLAYGO=125
"RTN","GMPLBLD2",39,0)
 D ^DIC S:Y'>0 Y="^" S:Y'="^" Y=+Y_U_Y(0)
"RTN","GMPLBLD2",40,0)
 Q Y
"RTN","GMPLBLD2",41,0)
 ;
"RTN","GMPLBLD2",42,0)
LAST(ROOT) ; Returns last subscript
"RTN","GMPLBLD2",43,0)
 N I,J S (I,J)=""
"RTN","GMPLBLD2",44,0)
 F  S I=$O(@(ROOT_"I)")) Q:I=""  S J=I
"RTN","GMPLBLD2",45,0)
 Q J
"RTN","GMPLBLD2",46,0)
 ;
"RTN","GMPLBLD2",47,0)
CKSAVE() ; Save [changes] ??
"RTN","GMPLBLD2",48,0)
 N DIR,X,Y,TEXT S TEXT=$S($D(GMPLGRP):"category",1:"list")
"RTN","GMPLBLD2",49,0)
 S DIR("A")="Save the changes to this "_TEXT_"? ",DIR("B")="YES"
"RTN","GMPLBLD2",50,0)
 S DIR("?",1)="Enter YES to save the changes that have been made to this "_TEXT,DIR("?")="before exiting it; NO will leave this "_TEXT_" unchanged."
"RTN","GMPLBLD2",51,0)
 S DIR(0)="YA" D ^DIR
"RTN","GMPLBLD2",52,0)
 Q +Y
"RTN","GMPLBLD2",53,0)
 ;
"RTN","GMPLBLD2",54,0)
SAVE ; Save changes to group/list
"RTN","GMPLBLD2",55,0)
 N GMPLQT,LABEL,DA
"RTN","GMPLBLD2",56,0)
 S GMPLQT=0
"RTN","GMPLBLD2",57,0)
 I $D(GMPLGRP) D  I GMPLQT Q
"RTN","GMPLBLD2",58,0)
 . N ITM,CODE
"RTN","GMPLBLD2",59,0)
 . S ITM=0
"RTN","GMPLBLD2",60,0)
 . F  S ITM=$O(^TMP("GMPLIST",$J,ITM)) Q:'ITM!(GMPLQT)  D
"RTN","GMPLBLD2",61,0)
 .. S CODE=$P(^TMP("GMPLIST",$J,ITM),U,4) Q:'$L(CODE)
"RTN","GMPLBLD2",62,0)
 .. I '$$STATCHK^ICDAPIU(CODE,DT) S GMPLQT=1 Q
"RTN","GMPLBLD2",63,0)
 . I 'GMPLQT Q  ;no inactive codes in the category
"RTN","GMPLBLD2",64,0)
 . D FULL^VALM1
"RTN","GMPLBLD2",65,0)
 . W !!,$C(7),"This Group contains problems with inactive ICD9 codes associated with them."
"RTN","GMPLBLD2",66,0)
 . W !,"The codes must be edited and corrected before the group can be saved."
"RTN","GMPLBLD2",67,0)
 . N DIR,DUOUT,DTOUT,DIRUT
"RTN","GMPLBLD2",68,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLD2",69,0)
 . S VALMBCK="R",GMPLQT=1
"RTN","GMPLBLD2",70,0)
 . Q
"RTN","GMPLBLD2",71,0)
 ;
"RTN","GMPLBLD2",72,0)
 I '$D(GMPLGRP),$D(GMPLSLST) D  I GMPLQT Q
"RTN","GMPLBLD2",73,0)
 . N GRP
"RTN","GMPLBLD2",74,0)
 . S GRP=0
"RTN","GMPLBLD2",75,0)
 . F  S GRP=$O(^TMP("GMPLIST",$J,"GRP",GRP)) Q:'GRP!(GMPLQT)  D
"RTN","GMPLBLD2",76,0)
 .. I $$VALGRP(GRP) Q  ;no inactive codes in the GROUP
"RTN","GMPLBLD2",77,0)
 .. S GMPLQT=1
"RTN","GMPLBLD2",78,0)
 . I 'GMPLQT Q  ; all groups and problems OK
"RTN","GMPLBLD2",79,0)
 . D FULL^VALM1
"RTN","GMPLBLD2",80,0)
 . W !!,$C(7),"This Selection List contains problems with inactive ICD9 codes associated with"
"RTN","GMPLBLD2",81,0)
 . W !,"them. The codes must be edited and corrected before the list can be saved."
"RTN","GMPLBLD2",82,0)
 . N DIR,DUOUT,DTOUT,DIRUT
"RTN","GMPLBLD2",83,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLD2",84,0)
 . S VALMBCK="R",GMPLQT=1
"RTN","GMPLBLD2",85,0)
 . Q
"RTN","GMPLBLD2",86,0)
 W !!,"Saving ..."
"RTN","GMPLBLD2",87,0)
 S DA=0,LABEL=$S($D(GMPLGRP):"SAVGRP",1:"SAVLST")
"RTN","GMPLBLD2",88,0)
 F  S DA=$O(^TMP("GMPLIST",$J,DA)) Q:+DA'>0  D @LABEL
"RTN","GMPLBLD2",89,0)
 K GMPLSAVE S:$D(GMPLGRP) GMPSAVED=1
"RTN","GMPLBLD2",90,0)
 S VALMBCK="Q" W " done." H 1
"RTN","GMPLBLD2",91,0)
 Q
"RTN","GMPLBLD2",92,0)
SAVGRP ; Save changes to existing group
"RTN","GMPLBLD2",93,0)
 N DIK,DIE,DR,ITEM,TMPITEM
"RTN","GMPLBLD2",94,0)
 S DIK="^GMPL(125.12,"
"RTN","GMPLBLD2",95,0)
 I +DA'=DA D  Q
"RTN","GMPLBLD2",96,0)
 . Q:"@"[$G(^TMP("GMPLIST",$J,DA))  ; nothing to save
"RTN","GMPLBLD2",97,0)
 . S TMPITEM=^TMP("GMPLIST",$J,DA) D NEW(DIK,+GMPLGRP,TMPITEM)
"RTN","GMPLBLD2",98,0)
 I "@"[$G(^TMP("GMPLIST",$J,DA)) D ^DIK Q
"RTN","GMPLBLD2",99,0)
 S ITEM=$P($G(^GMPL(125.12,DA,0)),U,2,5)
"RTN","GMPLBLD2",100,0)
 I ITEM'=^TMP("GMPLIST",$J,DA) D
"RTN","GMPLBLD2",101,0)
 . S DR="",DIE=DIK
"RTN","GMPLBLD2",102,0)
 . F I=1:1:4 D
"RTN","GMPLBLD2",103,0)
 .. S:$P(^TMP("GMPLIST",$J,DA),U,I)'=$P(ITEM,U,I) DR=DR_";"_I_"////"_$S($P(^TMP("GMPLIST",$J,DA),U,I)="":"@",1:$P(^TMP("GMPLIST",$J,DA),U,I))
"RTN","GMPLBLD2",104,0)
 . S:$E(DR)=";" DR=$E(DR,2,999) D ^DIE
"RTN","GMPLBLD2",105,0)
 Q
"RTN","GMPLBLD2",106,0)
 ;
"RTN","GMPLBLD2",107,0)
SAVLST ; Save changes to existing list
"RTN","GMPLBLD2",108,0)
 N DIK,DIE,DR,ITEM,TMPLST
"RTN","GMPLBLD2",109,0)
 S DIK="^GMPL(125.1,"
"RTN","GMPLBLD2",110,0)
 I +DA'=DA D  Q  ; new link
"RTN","GMPLBLD2",111,0)
 . Q:"@"[$G(^TMP("GMPLIST",$J,DA))  ; nothing to save
"RTN","GMPLBLD2",112,0)
 . S TMPLST=^TMP("GMPLIST",$J,DA) D NEW(DIK,+GMPLSLST,TMPLST)
"RTN","GMPLBLD2",113,0)
 I "@"[$G(^TMP("GMPLIST",$J,DA)) D ^DIK Q
"RTN","GMPLBLD2",114,0)
 S ITEM=$P($G(^GMPL(125.1,DA,0)),U,2,5)
"RTN","GMPLBLD2",115,0)
 I ITEM'=^TMP("GMPLIST",$J,DA) D
"RTN","GMPLBLD2",116,0)
 . S DR="",DIE=DIK
"RTN","GMPLBLD2",117,0)
 . F I=1,2,3,4 D
"RTN","GMPLBLD2",118,0)
 .. S:$P(^TMP("GMPLIST",$J,DA),U,I)'=$P(ITEM,U,I) DR=DR_";"_I_"////"_$S($P(^TMP("GMPLIST",$J,DA),U,I)="":"@",1:$P(^TMP("GMPLIST",$J,DA),U,I))
"RTN","GMPLBLD2",119,0)
 . S:$E(DR)=";" DR=$E(DR,2,999) D ^DIE
"RTN","GMPLBLD2",120,0)
 Q
"RTN","GMPLBLD2",121,0)
 ;
"RTN","GMPLBLD2",122,0)
NEW(DIK,LIST,ITEM) ; Create new entry in Contents file #125.1 or #125.12
"RTN","GMPLBLD2",123,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","GMPLBLD2",124,0)
 S HDR=$G(@(DIK_"0)")),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLBLD2",125,0)
 F I=(LAST+1):1 Q:'$D(@(DIK_"I,0)"))
"RTN","GMPLBLD2",126,0)
 S DA=I,@(DIK_"DA,0)")=LIST_U_ITEM
"RTN","GMPLBLD2",127,0)
 S $P(@(DIK_"0)"),U,3,4)=DA_U_(TOTAL+1)
"RTN","GMPLBLD2",128,0)
 D IX1^DIK ; set Xrefs
"RTN","GMPLBLD2",129,0)
 Q
"RTN","GMPLBLD2",130,0)
 ;
"RTN","GMPLBLD2",131,0)
DELETE ; Delete problem group
"RTN","GMPLBLD2",132,0)
 N DIR,X,Y,DA,DIK,IFN S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLD2",133,0)
 I $D(^GMPL(125.1,"G",+GMPLGRP)) W $C(7),!!,">>>  This category belongs to at least one problem selection list!",!,"     CANNOT DELETE" H 2 Q
"RTN","GMPLBLD2",134,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A")="Are you sure you want to delete the entire '"_$P(GMPLGRP,U,2)_"' category? "
"RTN","GMPLBLD2",135,0)
 S DIR("?")="Enter YES to completely remove this category and all its items."
"RTN","GMPLBLD2",136,0)
 D ^DIR Q:'Y
"RTN","GMPLBLD2",137,0)
DEL1 ; Ok, go for it ...
"RTN","GMPLBLD2",138,0)
 W !!,"Deleting category items ..."
"RTN","GMPLBLD2",139,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.12,"B",+GMPLGRP,IFN)) Q:IFN'>0  S DA=IFN,DIK="^GMPL(125.12," D ^DIK W "."
"RTN","GMPLBLD2",140,0)
 S DA=+GMPLGRP,DIK="^GMPL(125.11," D ^DIK W "."
"RTN","GMPLBLD2",141,0)
 L -^GMPL(125.11,+GMPLGRP,0) S GMPLGRP=0 K GMPLSAVE W " <done>"
"RTN","GMPLBLD2",142,0)
 D NEWGRP S:+GMPLGRP'>0 VALMBCK="Q"
"RTN","GMPLBLD2",143,0)
 Q
"RTN","GMPLBLD2",144,0)
 ;
"RTN","GMPLBLD2",145,0)
VALGRP(GMPLCAT) ; check all problems in the category for inactive codes
"RTN","GMPLBLD2",146,0)
 ; Input:
"RTN","GMPLBLD2",147,0)
 ;    GMPLCAT  = ien from file 125.11
"RTN","GMPLBLD2",148,0)
 ;
"RTN","GMPLBLD2",149,0)
 ; Output:
"RTN","GMPLBLD2",150,0)
 ;    1     = category has no problems with inactive codes
"RTN","GMPLBLD2",151,0)
 ;    0     = category has one or more problems with inactive codes
"RTN","GMPLBLD2",152,0)
 ;    O^ERR = category is invalid^error message
"RTN","GMPLBLD2",153,0)
 ;
"RTN","GMPLBLD2",154,0)
 I '$G(GMPLCAT) Q "0^No category selected"
"RTN","GMPLBLD2",155,0)
 N PROB,GMPLVALC
"RTN","GMPLBLD2",156,0)
 S GMPLVALC=1,PROB=0
"RTN","GMPLBLD2",157,0)
 F  S PROB=$O(^GMPL(125.12,"B",GMPLCAT,PROB)) Q:'PROB!('GMPLVALC)  D
"RTN","GMPLBLD2",158,0)
 . N GMPLCOD
"RTN","GMPLBLD2",159,0)
 . S GMPLCOD=$P(^GMPL(125.12,PROB,0),U,5)
"RTN","GMPLBLD2",160,0)
 . Q:'$L(GMPLCOD)  ; no code there
"RTN","GMPLBLD2",161,0)
 . I '$$STATCHK^ICDAPIU(GMPLCOD,DT) S GMPLVALC=0
"RTN","GMPLBLD2",162,0)
 . Q
"RTN","GMPLBLD2",163,0)
 Q GMPLVALC
"RTN","GMPLBLD2",164,0)
 ;
"RTN","GMPLBLD2",165,0)
VALLIST(LIST) ;check all categories in list for probs w/ inactive codes
"RTN","GMPLBLD2",166,0)
 ; Input:
"RTN","GMPLBLD2",167,0)
 ;   LIST = ien from file 125
"RTN","GMPLBLD2",168,0)
 ;
"RTN","GMPLBLD2",169,0)
 ; Output:
"RTN","GMPLBLD2",170,0)
 ;    1     = list has no problems with inactive codes
"RTN","GMPLBLD2",171,0)
 ;    0     = list has one or more problems with inactive codes
"RTN","GMPLBLD2",172,0)
 ;    O^ERR = list is invalid^error message 
"RTN","GMPLBLD2",173,0)
 ;
"RTN","GMPLBLD2",174,0)
 N GMPLIEN,GMPLVAL
"RTN","GMPLBLD2",175,0)
 I '$G(LIST) Q 0
"RTN","GMPLBLD2",176,0)
 S GMPLIEN=0,GMPLVAL=1
"RTN","GMPLBLD2",177,0)
 F  S GMPLIEN=$O(^GMPL(125.1,"B",LIST,GMPLIEN)) Q:'GMPLIEN!('GMPLVAL)  D
"RTN","GMPLBLD2",178,0)
 . N GMPLCAT
"RTN","GMPLBLD2",179,0)
 . S GMPLCAT=$P(^GMPL(125.1,GMPLIEN,0),U,3) I 'GMPLCAT Q
"RTN","GMPLBLD2",180,0)
 . I '$$VALGRP(GMPLCAT) S GMPLVAL=0
"RTN","GMPLBLD2",181,0)
 . Q
"RTN","GMPLBLD2",182,0)
 Q GMPLVAL
"RTN","GMPLBLD2",183,0)
 ;
"RTN","GMPLBLD2",184,0)
ASSIGN ; allow lookup of PROB SEL LIST and assign to users
"RTN","GMPLBLD2",185,0)
 ;
"RTN","GMPLBLD2",186,0)
 N DIC,X,Y,DUOUT,DTOUT,GMPLSLST
"RTN","GMPLBLD2",187,0)
 S DIC="^GMPL(125,",DIC(0)="AEQMZ",DIC("A")="Select LIST NAME: "
"RTN","GMPLBLD2",188,0)
 D ^DIC
"RTN","GMPLBLD2",189,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","GMPLBLD2",190,0)
 Q:Y<0
"RTN","GMPLBLD2",191,0)
 I '$$VALLIST(+Y) D  G ASSIGN
"RTN","GMPLBLD2",192,0)
 . W !!,$C(7),"This Selection List contains problems with inactive ICD9 codes associated with"
"RTN","GMPLBLD2",193,0)
 . W !,"them. The codes must be edited and corrected before the list can be assigned to",!,"users.",!!
"RTN","GMPLBLD2",194,0)
 ;
"RTN","GMPLBLD2",195,0)
 S GMPLSLST=+Y
"RTN","GMPLBLD2",196,0)
 D USERS^GMPLBLD3("1")
"RTN","GMPLBLD2",197,0)
 Q
"RTN","GMPLBLD3")
0^5^B23258990
"RTN","GMPLBLD3",1,0)
GMPLBLD3 ; SLC/MKB -- Bld PL Selection Lists cont ;3/12/03 13:40
"RTN","GMPLBLD3",2,0)
 ;;2.0;Problem List;**28**;Aug 25, 1994
"RTN","GMPLBLD3",3,0)
 ;
"RTN","GMPLBLD3",4,0)
 ; This routine invokes IA #3991
"RTN","GMPLBLD3",5,0)
 ;
"RTN","GMPLBLD3",6,0)
ASSIGN ; Assign list to clinic, users: Expects GMPLSLST
"RTN","GMPLBLD3",7,0)
 N DIE,DA,DR D FULL^VALM1 G:+$G(GMPLSLST)'>0 ASQ
"RTN","GMPLBLD3",8,0)
 I '$$VALLIST^GMPLBLD2(+GMPLSLST) D  G ASQ
"RTN","GMPLBLD3",9,0)
 . W !!,$C(7),"This Selection List contains problems with inactive ICD9 codes associated with"
"RTN","GMPLBLD3",10,0)
 . W !,"them. The codes must be edited and corrected before the list can be assigned",!,"to users or clinics."
"RTN","GMPLBLD3",11,0)
 . W !!,"If you have edited the list during this session to correct inactive codes, "
"RTN","GMPLBLD3",12,0)
 . W !,"save the list prior to attempting to assign it."
"RTN","GMPLBLD3",13,0)
 . N DIR,DUOUT,DTOUT,DIRUT
"RTN","GMPLBLD3",14,0)
 . S DIR(0)="E" D ^DIR
"RTN","GMPLBLD3",15,0)
 . Q
"RTN","GMPLBLD3",16,0)
 ;
"RTN","GMPLBLD3",17,0)
 W !!,"You may assign this list to a clinic as its default selection list,"
"RTN","GMPLBLD3",18,0)
 W !,"as well as to individual users as a preferred selection list.",!
"RTN","GMPLBLD3",19,0)
 S DA=+GMPLSLST,DR=.03,DIE="^GMPL(125," D ^DIE Q:$D(DTOUT)!($D(DUOUT))
"RTN","GMPLBLD3",20,0)
 D USERS("1") ; assign
"RTN","GMPLBLD3",21,0)
ASQ S VALMBCK="R",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLD3",22,0)
 Q
"RTN","GMPLBLD3",23,0)
 ;
"RTN","GMPLBLD3",24,0)
USERS(ADD) ; -- select user(s) to de-/assign list
"RTN","GMPLBLD3",25,0)
 N DIR,DIC,DIE,DR,DA,X,Y,GMPLUSER,GMPLI
"RTN","GMPLBLD3",26,0)
 Q:+$G(GMPLSLST)'>0  S GMPLUSER=""
"RTN","GMPLBLD3",27,0)
 S DIC="^VA(200,",DIC(0)="EQM",DIC("A")="Select USER: "
"RTN","GMPLBLD3",28,0)
 F  D READ Q:+Y'>0  S GMPLUSER=GMPLUSER_U_+Y,DIC("A")="ANOTHER ONE: "
"RTN","GMPLBLD3",29,0)
 I '$L(GMPLUSER) W !!,"No users selected.",! Q
"RTN","GMPLBLD3",30,0)
 S DIR(0)="YA",DIR("A")="Are you ready? ",DIR("B")="NO"
"RTN","GMPLBLD3",31,0)
 S DIR("?",1)="Enter YES to "_$S(ADD:"assign",1:"remove")_" the "_$P(GMPLSLST,U,2)_" list "_$S(ADD:"to the",1:"from the")
"RTN","GMPLBLD3",32,0)
 S DIR("?")=($L(GMPLUSER,U)-1)_" user(s) selected; enter NO to exit."
"RTN","GMPLBLD3",33,0)
 D ^DIR Q:'Y
"RTN","GMPLBLD3",34,0)
USR W !,$S(ADD:"Assigning ",1:"Removing ")_$P(GMPLSLST,U,2)_" list ..."
"RTN","GMPLBLD3",35,0)
 S DIE="^VA(200,",DR="125.1///"_$S(ADD:"/"_(+GMPLSLST),1:"@")
"RTN","GMPLBLD3",36,0)
 F GMPLI=1:1:$L(GMPLUSER,U) S DA=$P(GMPLUSER,U,GMPLI) I DA D
"RTN","GMPLBLD3",37,0)
 . W !?4,$P($G(^VA(200,DA,0)),U) D ^DIE
"RTN","GMPLBLD3",38,0)
 W !!,"DONE."
"RTN","GMPLBLD3",39,0)
 Q
"RTN","GMPLBLD3",40,0)
 ;
"RTN","GMPLBLD3",41,0)
READ ; prompt for username, respond
"RTN","GMPLBLD3",42,0)
 W !,DIC("A") R X:DTIME I '$T!("^"[X) S Y=-1 Q
"RTN","GMPLBLD3",43,0)
 I X="?" W !!,"Enter the name of the user you wish this list to be "_$S(ADD:"assigned to;",1:"removed from;"),!,"enter '??' to see users currently assigned this list, or '???' to see",!,"all users on this system.",! G READ
"RTN","GMPLBLD3",44,0)
 I X?1"??".E D  G READ
"RTN","GMPLBLD3",45,0)
 . I X="??" S DIC("S")="I $P($G(^(125)),U,2)="_+GMPLSLST W !!,"Users currently assigned "_$P(GMPLSLST,U,2)_" list:"
"RTN","GMPLBLD3",46,0)
 . S D="B",DZ="??" D DQ^DICQ K D,DZ,DIC("S")
"RTN","GMPLBLD3",47,0)
 D ^DIC G:Y'>0 READ
"RTN","GMPLBLD3",48,0)
 Q
"RTN","GMPLBLD3",49,0)
 ;
"RTN","GMPLBLD3",50,0)
DELETE ; Delete Selection List
"RTN","GMPLBLD3",51,0)
 N DIR,DIK,DA,X,Y,VIEW,USER,GMPCOUNT,GMPQUIT,GMPLSLST
"RTN","GMPLBLD3",52,0)
 S GMPCOUNT=0,GMPLSLST=$$LIST^GMPLBLD2("") Q:GMPLSLST="^"
"RTN","GMPLBLD3",53,0)
 W !!,"Checking the New Person file for use of this list ..."
"RTN","GMPLBLD3",54,0)
 F USER=0:0 S USER=$O(^VA(200,USER)) Q:USER'>0  D
"RTN","GMPLBLD3",55,0)
 . S VIEW=$P($G(^VA(200,USER,125)),U,2) Q:'VIEW  Q:VIEW'=+GMPLSLST
"RTN","GMPLBLD3",56,0)
 . S GMPCOUNT=GMPCOUNT+1 W "."
"RTN","GMPLBLD3",57,0)
 I GMPCOUNT W $C(7),!!,GMPCOUNT_" user(s) are currently assigned this list!",!,"CANNOT DELETE",! Q
"RTN","GMPLBLD3",58,0)
 W !,"0 users found."
"RTN","GMPLBLD3",59,0)
DEL1 S DIR(0)="Y",DIR("B")="NO"
"RTN","GMPLBLD3",60,0)
 S DIR("A")="Are you sure you want to delete this list"
"RTN","GMPLBLD3",61,0)
 S DIR("?",1)="Enter YES if you wish to completely remove this list; press <return>",DIR("?")="to leave this list unchanged and exit this option."
"RTN","GMPLBLD3",62,0)
 W $C(7),! D ^DIR Q:'Y
"RTN","GMPLBLD3",63,0)
 W !!,"Deleting "_$P(GMPLSLST,U,2)_" selection list ..."
"RTN","GMPLBLD3",64,0)
 S DIK="^GMPL(125.1,",DA=0 ; list contents
"RTN","GMPLBLD3",65,0)
 F  S DA=$O(^GMPL(125.1,"B",+GMPLSLST,DA)) Q:DA'>0  D ^DIK W "."
"RTN","GMPLBLD3",66,0)
 S DA=+GMPLSLST,DIK="^GMPL(125," D ^DIK W "." ; list
"RTN","GMPLBLD3",67,0)
 W !,"DONE.",!
"RTN","GMPLBLD3",68,0)
 Q
"RTN","GMPLBLD3",69,0)
 ;
"RTN","GMPLBLD3",70,0)
MENU ; -- init variables and list array for GMPL LIST MENU list template
"RTN","GMPLBLD3",71,0)
 ;    Expects GMPLSLST=selection list
"RTN","GMPLBLD3",72,0)
 N GSEQ,PSEQ,GCNT,PCNT,GROUP,HDR,IFN,LCNT,ITEM,TEXT,CODE
"RTN","GMPLBLD3",73,0)
 S (GSEQ,GCNT,LCNT)=0 K ^TMP("GMPLMENU",$J)
"RTN","GMPLBLD3",74,0)
 W !!,"Retrieving list of "_$P(GMPLSLST,U,2)_" problems ..."
"RTN","GMPLBLD3",75,0)
 F  S GSEQ=$O(^GMPL(125.1,"C",+GMPLSLST,GSEQ)) Q:GSEQ'>0  D
"RTN","GMPLBLD3",76,0)
 . S IFN=$O(^GMPL(125.1,"C",+GMPLSLST,GSEQ,0)) Q:IFN'>0
"RTN","GMPLBLD3",77,0)
 . S ITEM=$G(^GMPL(125.1,IFN,0)),GROUP=$P(ITEM,U,3),HDR=$P(ITEM,U,4,5)
"RTN","GMPLBLD3",78,0)
 . S GCNT=GCNT+1,(PSEQ,PCNT)=0,^TMP("GMPLMENU",$J,GCNT,0)=HDR
"RTN","GMPLBLD3",79,0)
 . F  S PSEQ=$O(^GMPL(125.12,"C",+GROUP,PSEQ)) Q:PSEQ'>0  D
"RTN","GMPLBLD3",80,0)
 . . S IFN=$O(^GMPL(125.12,"C",+GROUP,PSEQ,0)) Q:IFN'>0
"RTN","GMPLBLD3",81,0)
 . . S ITEM=$G(^GMPL(125.12,IFN,0)),TEXT=$P(ITEM,U,4),CODE=$P(ITEM,U,5)
"RTN","GMPLBLD3",82,0)
 . . I $L(CODE),'$$STATCHK^ICDAPIU(CODE,DT) Q  ; screen inactive codes
"RTN","GMPLBLD3",83,0)
 . . S PCNT=PCNT+1,^TMP("GMPLMENU",$J,GCNT,PCNT)=$P(ITEM,U,3,5)
"RTN","GMPLBLD3",84,0)
 I '$D(^TMP("GMPLMENU",$J)) W !!,"No items available.  Returning to Problem List ..." H 2 S VALMBCK="Q",VALMQUIT=1 Q
"RTN","GMPLBLD3",85,0)
 D BUILD^GMPLMENU
"RTN","GMPLBLD3",86,0)
 Q
"RTN","GMPLBLDC")
0^2^B32403515
"RTN","GMPLBLDC",1,0)
GMPLBLDC ; SLC/MKB -- Build Problem Selection Categories ;3/12/03 9:22
"RTN","GMPLBLDC",2,0)
 ;;2.0;Problem List;**3,7,28**;Aug 25, 1994
"RTN","GMPLBLDC",3,0)
 ;
"RTN","GMPLBLDC",4,0)
 ; This routine invokes IA #3991
"RTN","GMPLBLDC",5,0)
 ;
"RTN","GMPLBLDC",6,0)
EN ; -- main entry point for GMPL SELECTION GROUP BUILD
"RTN","GMPLBLDC",7,0)
 D EN^VALM("GMPL SELECTION GROUP BUILD")
"RTN","GMPLBLDC",8,0)
 Q
"RTN","GMPLBLDC",9,0)
 ;
"RTN","GMPLBLDC",10,0)
HDR ; -- header code
"RTN","GMPLBLDC",11,0)
 N NAME,NUM,DATE S NUM=+^TMP("GMPLST",$J,0)_" problem"_$S(+^TMP("GMPLST",$J,0)'=1:"s",1:"")
"RTN","GMPLBLDC",12,0)
 S DATE="Last Modified: "_$S(+$P(GMPLGRP,U,3):$$FMTE^XLFDT($P(GMPLGRP,U,3)),1:"<new category>")
"RTN","GMPLBLDC",13,0)
 S VALMHDR(1)=DATE_$J(NUM,79-$L(DATE))
"RTN","GMPLBLDC",14,0)
 S NAME=$P(GMPLGRP,U,2),VALMHDR(2)=$J(NAME,$L(NAME)\2+41)
"RTN","GMPLBLDC",15,0)
 Q
"RTN","GMPLBLDC",16,0)
 ;
"RTN","GMPLBLDC",17,0)
INIT ; -- init variables and list array
"RTN","GMPLBLDC",18,0)
 S GMPLGRP=$$GROUP^GMPLBLD2("L") I GMPLGRP="^" S VALMQUIT=1 Q
"RTN","GMPLBLDC",19,0)
 L +^GMPL(125.11,+GMPLGRP,0):1 I '$T D  G INIT
"RTN","GMPLBLDC",20,0)
 . W $C(7),!!,"This category is currently being edited by another user!",!
"RTN","GMPLBLDC",21,0)
 S GMPLMODE="E",VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",22,0)
 D GETLIST,BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLDC",23,0)
 Q
"RTN","GMPLBLDC",24,0)
 ;
"RTN","GMPLBLDC",25,0)
GETLIST ; Build ^TMP("GMPLIST",$J,#) of problems
"RTN","GMPLBLDC",26,0)
 N SEQ,IFN,ITEM,PROB,CNT K ^TMP("GMPLIST",$J) S CNT=0
"RTN","GMPLBLDC",27,0)
 W !,"Searching for the problems ..."
"RTN","GMPLBLDC",28,0)
 F IFN=0:0 S IFN=$O(^GMPL(125.12,"B",+GMPLGRP,IFN)) Q:IFN'>0  D
"RTN","GMPLBLDC",29,0)
 . S ITEM=$G(^GMPL(125.12,IFN,0)),SEQ=$P(ITEM,U,2),PROB=$P(ITEM,U,3)
"RTN","GMPLBLDC",30,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(ITEM,U,2,5),CNT=CNT+1 ; seq ^ prob ^ text ^ code
"RTN","GMPLBLDC",31,0)
 . S (^TMP("GMPLIST",$J,"PROB",PROB),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN ; Xrefs
"RTN","GMPLBLDC",32,0)
 S ^TMP("GMPLIST",$J,0)=CNT
"RTN","GMPLBLDC",33,0)
 Q
"RTN","GMPLBLDC",34,0)
 ;
"RTN","GMPLBLDC",35,0)
BUILD(LIST,MODE) ; Build ^TMP("GMPLST",$J,) of current items in LIST for display
"RTN","GMPLBLDC",36,0)
 N SEQ,LCNT,NUM,PROB,TEXT,IFN,ITEM,CODE D CLEAN^VALM10
"RTN","GMPLBLDC",37,0)
 I $P($G(^TMP("GMPLIST",$J,0)),U,1)'>0 S ^TMP("GMPLST",$J,1,0)="   ",^TMP("GMPLST",$J,2,0)="No items available.",^TMP("GMPLST",$J,0)="0^2",VALMCNT=2 Q
"RTN","GMPLBLDC",38,0)
 S (LCNT,NUM,SEQ)=0
"RTN","GMPLBLDC",39,0)
 F  S SEQ=$O(^TMP("GMPLIST",$J,"SEQ",SEQ)) Q:SEQ'>0  D
"RTN","GMPLBLDC",40,0)
 . S IFN=^TMP("GMPLIST",$J,"SEQ",SEQ),LCNT=LCNT+1,NUM=NUM+1
"RTN","GMPLBLDC",41,0)
 . S PROB=$P(^TMP("GMPLIST",$J,IFN),U,2),TEXT=$P(^TMP("GMPLIST",$J,IFN),U,3),CODE=$P(^TMP("GMPLIST",$J,IFN),U,4)
"RTN","GMPLBLDC",42,0)
 . S ^TMP("GMPLST",$J,LCNT,0)=$S(MODE="I":$J("<"_SEQ_">",8),1:"        ")_$J(NUM,4)_" "_TEXT
"RTN","GMPLBLDC",43,0)
 . I $L(CODE) D
"RTN","GMPLBLDC",44,0)
 .. S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_" ("_CODE_")"
"RTN","GMPLBLDC",45,0)
 .. I $$STATCHK^ICDAPIU(CODE,DT) Q  ; OK - code is active
"RTN","GMPLBLDC",46,0)
 .. S ^TMP("GMPLST",$J,LCNT,0)=^TMP("GMPLST",$J,LCNT,0)_"     <INACTIVE CODE>"
"RTN","GMPLBLDC",47,0)
 . D CNTRL^VALM10(LCNT,9,5,IOINHI,IOINORM)
"RTN","GMPLBLDC",48,0)
 . S ^TMP("GMPLST",$J,"B",NUM)=IFN
"RTN","GMPLBLDC",49,0)
 S ^TMP("GMPLST",$J,0)=NUM_U_LCNT,VALMCNT=LCNT
"RTN","GMPLBLDC",50,0)
 Q
"RTN","GMPLBLDC",51,0)
 ;
"RTN","GMPLBLDC",52,0)
HELP ; -- help code
"RTN","GMPLBLDC",53,0)
 N X
"RTN","GMPLBLDC",54,0)
 W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLBLDC",55,0)
 W !?4,"this category you may add new problems or remove an existing"
"RTN","GMPLBLDC",56,0)
 W !?4,"one; you may also change the text or code displayed, or the order"
"RTN","GMPLBLDC",57,0)
 W !?4,"in which each problem is displayed.  Select View w/wo Seq Numbers"
"RTN","GMPLBLDC",58,0)
 W !?4,"to toggle seeing the sequence number in addition to the display"
"RTN","GMPLBLDC",59,0)
 W !?4,"number per problem.  If necessary, the current category may be"
"RTN","GMPLBLDC",60,0)
 W !?4,"deleted; you may change to a different category to continue editing."
"RTN","GMPLBLDC",61,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","GMPLBLDC",62,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLBLDC",63,0)
 Q
"RTN","GMPLBLDC",64,0)
 ;
"RTN","GMPLBLDC",65,0)
EXIT ; -- exit code
"RTN","GMPLBLDC",66,0)
 I $D(GMPLSAVE),$$CKSAVE^GMPLBLD2 D
"RTN","GMPLBLDC",67,0)
 . D SAVE^GMPLBLD2
"RTN","GMPLBLDC",68,0)
 . S ^GMPL(125.11,+GMPLGRP,0)=$P(GMPLGRP,U,2)_U_DT
"RTN","GMPLBLDC",69,0)
 L -^GMPL(125.11,+GMPLGRP,0)
"RTN","GMPLBLDC",70,0)
 K GMPLIST,GMPLST,GMPLMODE,GMPLGRP,GMPLSAVE,GMPREBLD,GMPQUIT,RT1,TMPITEM
"RTN","GMPLBLDC",71,0)
 K VALMBCK,VALMCNT,VALMSG,VALMHDR
"RTN","GMPLBLDC",72,0)
 K ^TMP("GMPLIST",$J),^TMP("GMPLST",$J)
"RTN","GMPLBLDC",73,0)
 Q
"RTN","GMPLBLDC",74,0)
 ;
"RTN","GMPLBLDC",75,0)
ADD ; Add new problem(s)
"RTN","GMPLBLDC",76,0)
 N X,Y,SEQ,CODE,IFN,GMPVOCAB,GMPQUIT,GMPREBLD S VALMBCK=""
"RTN","GMPLBLDC",77,0)
 S GMPVOCAB=$$VOCAB^GMPLX1 Q:GMPVOCAB="^"
"RTN","GMPLBLDC",78,0)
 F  D  Q:$D(GMPQUIT)  W !!
"RTN","GMPLBLDC",79,0)
 . S (X,Y)="" D SEARCH^GMPLX(.X,.Y,"PROBLEM: ","1",GMPVOCAB)
"RTN","GMPLBLDC",80,0)
 . I +Y'>0 S GMPQUIT=1 Q
"RTN","GMPLBLDC",81,0)
 . S X=$$TEXT^GMPLBLD1(X) I X="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",82,0)
 . S CODE=$$CODE^GMPLBLD1($G(Y(1))) I CODE="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",83,0)
 . S RT1="^TMP(""GMPLIST"",$J,""SEQ"",",SEQ=+$$LAST^GMPLBLD2(RT1)+1 ; dflt = next #
"RTN","GMPLBLDC",84,0)
 . S SEQ=$$SEQ^GMPLBLD1(SEQ) I SEQ="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",85,0)
 . S IFN=$$TMPIFN^GMPLBLD1,^TMP("GMPLIST",$J,0)=^TMP("GMPLIST",$J,0)+1
"RTN","GMPLBLDC",86,0)
 . S ^TMP("GMPLIST",$J,IFN)=SEQ_U_+Y_U_X_U_CODE ; seq ^ # ^ text ^ code
"RTN","GMPLBLDC",87,0)
 . S (^TMP("GMPLIST",$J,"PROB",+Y),^TMP("GMPLIST",$J,"SEQ",SEQ))=IFN,GMPREBLD=1
"RTN","GMPLBLDC",88,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLDC",89,0)
 S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",90,0)
 Q
"RTN","GMPLBLDC",91,0)
 ;
"RTN","GMPLBLDC",92,0)
REMOVE ; Remove problem from group
"RTN","GMPLBLDC",93,0)
 N NUM,IFN S VALMBCK=""
"RTN","GMPLBLDC",94,0)
 S NUM=$$SEL1^GMPLBLD1 G:NUM="^" RMQ
"RTN","GMPLBLDC",95,0)
 S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) G:+IFN'>0 RMQ
"RTN","GMPLBLDC",96,0)
 I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Problem does not exist in this category!" H 2 G RMQ
"RTN","GMPLBLDC",97,0)
 I '$$SURE^GMPLX W !?5,"< Nothing removed! >" H 1 G RMQ
"RTN","GMPLBLDC",98,0)
 D DELETE^GMPLBLD1(IFN) S VALMBCK="R",GMPLSAVE=1
"RTN","GMPLBLDC",99,0)
 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE),HDR
"RTN","GMPLBLDC",100,0)
RMQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",101,0)
 Q
"RTN","GMPLBLDC",102,0)
 ;
"RTN","GMPLBLDC",103,0)
EDIT ; Edit problem text and code
"RTN","GMPLBLDC",104,0)
 N NUM,SEL,IFN,PIECE,CODE,PROB,PROBLEM,GMPQUIT,GMPREBLD S VALMBCK=""
"RTN","GMPLBLDC",105,0)
 S SEL=$$SEL^GMPLBLD1 G:SEL="^" EDQ
"RTN","GMPLBLDC",106,0)
 F PIECE=1:1:$L(SEL,",") D  Q:$D(GMPQUIT)  W !
"RTN","GMPLBLDC",107,0)
 . S NUM=$P(SEL,",",PIECE) Q:NUM'>0
"RTN","GMPLBLDC",108,0)
 . S IFN=$P($G(^TMP("GMPLST",$J,"B",NUM)),U,1) Q:IFN'>0
"RTN","GMPLBLDC",109,0)
 . I "@"[$G(^TMP("GMPLIST",$J,IFN)) W $C(7),!!,"Problem #"_NUM_" does not exist in this category!" H 2 Q
"RTN","GMPLBLDC",110,0)
 . W !!,">>>  Problem #"_NUM S PROBLEM=^TMP("GMPLIST",$J,IFN)
"RTN","GMPLBLDC",111,0)
 . W:$P(PROBLEM,U,2)>1 " = "_$G(^LEX(757.01,+$P(PROBLEM,U,2),0)) W ! ; KER
"RTN","GMPLBLDC",112,0)
 . S PROB=$$TEXT^GMPLBLD1($P(PROBLEM,U,3)) I PROB="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",113,0)
 . I PROB="@" D DELETE^GMPLBLD1(IFN) S GMPREBLD=1 Q
"RTN","GMPLBLDC",114,0)
 . S CODE=$$CODE^GMPLBLD1($P(PROBLEM,U,4)) I CODE="^" S GMPQUIT=1 Q
"RTN","GMPLBLDC",115,0)
 . S ^TMP("GMPLIST",$J,IFN)=$P(PROBLEM,U,1,2)_U_PROB_U_CODE,GMPREBLD=1
"RTN","GMPLBLDC",116,0)
 I $D(GMPREBLD) S VALMBCK="R",GMPLSAVE=1 D BUILD("^TMP(""GMPLIST"",$J)",GMPLMODE)
"RTN","GMPLBLDC",117,0)
EDQ S:'VALMCC VALMBCK="R" S VALMSG=$$MSG^GMPLX
"RTN","GMPLBLDC",118,0)
 Q
"RTN","GMPLCODE")
0^9^B11198487
"RTN","GMPLCODE",1,0)
GMPLCODE ; SLC/MKB/AJB -- Problem List ICD Code Utilities ;5/27/94  08:23
"RTN","GMPLCODE",2,0)
 ;;2.0;Problem List;**28**;Aug 25, 1994
"RTN","GMPLCODE",3,0)
EN ; -- main entry point for GMPL CODE LIST
"RTN","GMPLCODE",4,0)
 K GMPLUSER
"RTN","GMPLCODE",5,0)
 D EN^VALM("GMPL CODE LIST")
"RTN","GMPLCODE",6,0)
 Q
"RTN","GMPLCODE",7,0)
 ;
"RTN","GMPLCODE",8,0)
INIT ; -- init variables and list array
"RTN","GMPLCODE",9,0)
 S GMPDFN=$$PAT^GMPLX1 I +GMPDFN'>0 K GMPDFN S VALMQUIT=1 Q
"RTN","GMPLCODE",10,0)
 S GMPVA=$S($G(DUZ("AG"))="V":1,1:0),GMPVAMC=+$G(DUZ(2))
"RTN","GMPLCODE",11,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(+GMPDFN)
"RTN","GMPLCODE",12,0)
 S (GMPLVIEW("ACT"),GMPLVIEW("VIEW"))="",GMPLVIEW("PROV")=0
"RTN","GMPLCODE",13,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLCODE",14,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLCODE",15,0)
 D BUILD^GMPLMGR(.GMPLIST)
"RTN","GMPLCODE",16,0)
 S VALMSG=$$MSG^GMPLX
"RTN","GMPLCODE",17,0)
 Q
"RTN","GMPLCODE",18,0)
 ;
"RTN","GMPLCODE",19,0)
HELP ; -- help code
"RTN","GMPLCODE",20,0)
 N X
"RTN","GMPLCODE",21,0)
 W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLCODE",22,0)
 W !?4,"the ICD Code assigned to a problem, you may choose to search"
"RTN","GMPLCODE",23,0)
 W !?4,"either the ICD Diagnosis file or the Clinical Lexicon for a"
"RTN","GMPLCODE",24,0)
 W !?4,"match; the code of the entry you select will be assigned to the"
"RTN","GMPLCODE",25,0)
 W !?4,"current problem in the list.  If you need more information on a"
"RTN","GMPLCODE",26,0)
 W !?4,"problem, select Detailed Display.  To see a listing of"
"RTN","GMPLCODE",27,0)
 W !?4,"actions that facilitate navigating the list, enter '??'."
"RTN","GMPLCODE",28,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLCODE",29,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLCODE",30,0)
 Q
"RTN","GMPLCODE",31,0)
 ;
"RTN","GMPLCODE",32,0)
EDIT ; -- edit field .01
"RTN","GMPLCODE",33,0)
 N GMPLSEL,GMPLNO,GMPI,GMPIFN,GMPLNUM,GMPSAVED
"RTN","GMPLCODE",34,0)
 S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLCODE",35,0)
 S GMPLSEL=$$SEL^GMPLX("code") G:GMPLSEL="^" EDQ
"RTN","GMPLCODE",36,0)
 S GMPLNO=$L(GMPLSEL,",")
"RTN","GMPLCODE",37,0)
 F GMPI=1:1:GMPLNO S GMPLNUM=$P(GMPLSEL,",",GMPI) I GMPLNUM D  Q:$D(GMPQUIT)
"RTN","GMPLCODE",38,0)
 . S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) Q:GMPIFN'>0
"RTN","GMPLCODE",39,0)
 . L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPLCODE",40,0)
 . D ICD(GMPLNUM,GMPIFN) L -^AUPNPROB(GMPIFN,0)
"RTN","GMPLCODE",41,0)
 S:$D(GMPSAVED) VALMBCK="R"
"RTN","GMPLCODE",42,0)
EDQ D KILL^GMPLX S VALMSG=$$MSG^GMPLX
"RTN","GMPLCODE",43,0)
 Q
"RTN","GMPLCODE",44,0)
 ;
"RTN","GMPLCODE",45,0)
ICD(NUM,IFN) ; -- search ICD Diagnosis file #80
"RTN","GMPLCODE",46,0)
 N X,Y,DIC,DIR,OLD,NEW,DA,DR,DIE,LCNT,CHNGE
"RTN","GMPLCODE",47,0)
 W !,IFN,!
"RTN","GMPLCODE",48,0)
 D FULL^VALM1 S VALMBCK="R" W !!
"RTN","GMPLCODE",49,0)
 S OLD=+$G(^AUPNPROB(IFN,0)),OLD=OLD_U_$P($G(^ICD9(OLD,0)),U)
"RTN","GMPLCODE",50,0)
 S DIR(0)="PAO^ICD9(:QEM",DIR("A")="Enter ICD CODE or DESCRIPTION: "
"RTN","GMPLCODE",51,0)
 S DIR("A",1)="Problem #"_NUM_": "_$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLCODE",52,0)
 S DIR("?")="Enter a new code number or a brief free text description on which to search",DIR("B")=$P(OLD,U,2)
"RTN","GMPLCODE",53,0)
 ; Added for Code Set Versioning (CSV) - screen allows ONLY active codes
"RTN","GMPLCODE",54,0)
 S DIR("S")="I +($$STATCHK^ICDAPIU($$CODEC^ICDCODE(+($G(Y))),DT))>0"
"RTN","GMPLCODE",55,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) S GMPQUIT=1 Q
"RTN","GMPLCODE",56,0)
 I X="@" Q:'$D(DIR("B"))  S:$$SURE^GMPLX Y=$$NOS^GMPLX
"RTN","GMPLCODE",57,0)
 I +Y>0,Y'=OLD D  S GMPSAVED=1
"RTN","GMPLCODE",58,0)
 . S NEW=Y,DIE="^AUPNPROB(",DA=IFN,DR=".01////"_+NEW D ^DIE
"RTN","GMPLCODE",59,0)
 . S CHNGE=IFN_"^.01^"_$$HTFM^XLFDT($H)_U_DUZ_U_+OLD_U_+NEW
"RTN","GMPLCODE",60,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLCODE",61,0)
 . S LCNT=+$G(^TMP("GMPLIDX",$J,NUM))
"RTN","GMPLCODE",62,0)
 . D FLDTEXT^VALM10(LCNT,"ICD",$P(NEW,U,2))
"RTN","GMPLCODE",63,0)
 D BUILD^GMPLMGR(.GMPLIST) S VALMBCK="R"
"RTN","GMPLCODE",64,0)
 Q
"RTN","GMPLEDT1")
0^14^B35847612
"RTN","GMPLEDT1",1,0)
GMPLEDT1 ; SLC/MKB/KER/AJB -- Edit Problem List fields ; 04/21/2003
"RTN","GMPLEDT1",2,0)
 ;;2.0;Problem List;**17,20,26,28**;Aug 25, 1994
"RTN","GMPLEDT1",3,0)
 ;
"RTN","GMPLEDT1",4,0)
 ; External References
"RTN","GMPLEDT1",5,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLEDT1",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT1",7,0)
 ;   DBIA   341  DIS^SDROUT2
"RTN","GMPLEDT1",8,0)
 ;                
"RTN","GMPLEDT1",9,0)
ONSET ; Edit Date of Onset - field .13
"RTN","GMPLEDT1",10,0)
 N X,Y,ENTERED,PROMPT,HELPMSG,DEFAULT
"RTN","GMPLEDT1",11,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(.13))
"RTN","GMPLEDT1",12,0)
 S PROMPT="DATE OF ONSET: ",HELPMSG="Enter the date this problem was first observed, as precisely as known."
"RTN","GMPLEDT1",13,0)
O1 ;   Get Date of Onset
"RTN","GMPLEDT1",14,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",15,0)
 I Y>ENTERED W !!,"Date of Onset cannot be later than the date the problem was entered!",$C(7) G O1
"RTN","GMPLEDT1",16,0)
 I +$P(GMPDFN,U,4),Y>$P(GMPDFN,U,4) W !!,"Date of Onset cannot be later than the date of death!",$C(7) G O1
"RTN","GMPLEDT1",17,0)
 S GMPFLD(.13)=Y S:Y'="" GMPFLD(.13)=GMPFLD(.13)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",18,0)
 Q
"RTN","GMPLEDT1",19,0)
STATUS ; Edit Status - field .12
"RTN","GMPLEDT1",20,0)
 ;   Then Edit Date Resolved - Field 1.07, if inactive
"RTN","GMPLEDT1",21,0)
 N DIR,X,Y
"RTN","GMPLEDT1",22,0)
 S DIR(0)="9000011,.12"
"RTN","GMPLEDT1",23,0)
 S:$L($G(GMPFLD(.12))) DIR("B")=$P(GMPFLD(.12),U,2)
"RTN","GMPLEDT1",24,0)
ST1 ;   Get Status
"RTN","GMPLEDT1",25,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",26,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ST1
"RTN","GMPLEDT1",27,0)
 S:Y'="" Y=Y_U_$S(Y="A":"ACTIVE",1:"INACTIVE") S GMPFLD(.12)=Y
"RTN","GMPLEDT1",28,0)
 S:$E(Y)'="I" GMPFLD(1.07)="" S:$E(Y)'="A" GMPFLD(1.14)=""
"RTN","GMPLEDT1",29,0)
 D:$E(GMPFLD(.12))="I" RESOLVED^GMPLEDT4
"RTN","GMPLEDT1",30,0)
 D:$E(GMPFLD(.12))="A" PRIORITY^GMPLEDT4
"RTN","GMPLEDT1",31,0)
 Q
"RTN","GMPLEDT1",32,0)
RECORDED ; Edit Date Recorded - field 1.09
"RTN","GMPLEDT1",33,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT,ENTERED
"RTN","GMPLEDT1",34,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(1.09))
"RTN","GMPLEDT1",35,0)
 S PROMPT="DATE RECORDED: ",HELPMSG="Enter the date this problem was first recorded, as precisely as known."
"RTN","GMPLEDT1",36,0)
RC1 ;   Get Date
"RTN","GMPLEDT1",37,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",38,0)
 I Y>ENTERED W !!,"Date Recorded cannot be later than the problem was entered!",$C(7) G RC1
"RTN","GMPLEDT1",39,0)
 S GMPFLD(1.09)=Y S:Y'="" GMPFLD(1.09)=GMPFLD(1.09)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",40,0)
 Q
"RTN","GMPLEDT1",41,0)
SC ; Edit Service Connected - field 1.1
"RTN","GMPLEDT1",42,0)
 N DFN,DIR,X,Y
"RTN","GMPLEDT1",43,0)
 ;
"RTN","GMPLEDT1",44,0)
 ;   The following allows changing a problem's SC/NSC to
"RTN","GMPLEDT1",45,0)
 ;   NSC if there is no SC on file for patient and Problem 
"RTN","GMPLEDT1",46,0)
 ;   original SC was set to "YES"
"RTN","GMPLEDT1",47,0)
 ;
"RTN","GMPLEDT1",48,0)
 I +$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",49,0)
 . W !!,">>>  Currently known service-connection data for "_$P(GMPDFN,U,2)_":"
"RTN","GMPLEDT1",50,0)
 ELSE  Q:'GMPSC
"RTN","GMPLEDT1",51,0)
 S DFN=+GMPDFN D DIS^SDROUT2
"RTN","GMPLEDT1",52,0)
 I +GMPSC=0,+$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",53,0)
 . S DIR("A")="Patient has no service-connected condition !! "
"RTN","GMPLEDT1",54,0)
 . S DIR("B")="NO"
"RTN","GMPLEDT1",55,0)
 ELSE  D
"RTN","GMPLEDT1",56,0)
 . S DIR("A")="Is this problem related to a service-connected condition? "
"RTN","GMPLEDT1",57,0)
 . S:$L($G(GMPFLD(1.1))) DIR("B")=$P(GMPFLD(1.1),U,2) W !
"RTN","GMPLEDT1",58,0)
 S DIR("?",1)="If this problem is due to a service-connected condition, enter YES;",DIR("?")="press <return> and leave blank if this is unknown.",DIR(0)="YAO"
"RTN","GMPLEDT1",59,0)
SC1 ;   Get Service Connection
"RTN","GMPLEDT1",60,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",61,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G SC1
"RTN","GMPLEDT1",62,0)
 I X="@" G:'$$SURE^GMPLX SC1 S Y=""
"RTN","GMPLEDT1",63,0)
 S GMPFLD(1.1)=Y S:Y'="" GMPFLD(1.1)=GMPFLD(1.1)_U_$S(Y:"YES",1:"NO")
"RTN","GMPLEDT1",64,0)
 Q
"RTN","GMPLEDT1",65,0)
SP ; Edit Exposures/Conditions
"RTN","GMPLEDT1",66,0)
 ;   Agent Orange - field 1.11
"RTN","GMPLEDT1",67,0)
 ;   Ionizing Radiation - field 1.12
"RTN","GMPLEDT1",68,0)
 ;   Persian Gulf/Environmental Contaminants - field 1.13
"RTN","GMPLEDT1",69,0)
 ;   Head and/or Neck Cancer - field 1.15
"RTN","GMPLEDT1",70,0)
 ;   Military Sexual Trauma - field 1.16
"RTN","GMPLEDT1",71,0)
 G SPEXP^GMPLEDT2
"RTN","GMPLEDT1",72,0)
 Q
"RTN","GMPLEDT1",73,0)
SOURCE ; Edit Service - field 1.06
"RTN","GMPLEDT1",74,0)
 ; or Clinic - field 1.08
"RTN","GMPLEDT1",75,0)
 N DIC,X,Y,HELPMSG,PROMPT,DEFAULT,VIEW S VIEW=$E(GMPLVIEW("VIEW"))
"RTN","GMPLEDT1",76,0)
 S DIC=$S(VIEW="S":"^DIC(49,",1:"^SC("),DIC(0)="EMQ"
"RTN","GMPLEDT1",77,0)
 S DIC("S")="I $P(^(0),U,"_$S(VIEW="S":9,1:3)_")=""C"""
"RTN","GMPLEDT1",78,0)
 I VIEW="S" S PROMPT="SERVICE: ",DEFAULT=$P(GMPFLD(1.06),U,2)
"RTN","GMPLEDT1",79,0)
 E  S PROMPT="CLINIC: ",DEFAULT=$P(GMPFLD(1.08),U,2)
"RTN","GMPLEDT1",80,0)
 S HELPMSG="Enter the clinic"_$S(VIEW="S":"al service",1:"")_" to be associated with this problem."
"RTN","GMPLEDT1",81,0)
S1 ;   Get Service/Clinic
"RTN","GMPLEDT1",82,0)
 W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","GMPLEDT1",83,0)
 R X:DTIME S:'$T X="^",DTOUT=1 S:X="^" GMPQUIT=1 Q:(X="^")!(X="")
"RTN","GMPLEDT1",84,0)
 I X?1"^".E D JUMP^GMPLEDT3(X) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G S1
"RTN","GMPLEDT1",85,0)
 I X="?" W !!,HELPMSG,! G S1
"RTN","GMPLEDT1",86,0)
 I X["??" D @("LIST"_$S(VIEW="S":"SERV",1:"CLIN")_"^GMPLMGR1") W !,HELPMSG G S1
"RTN","GMPLEDT1",87,0)
 I X="@" G:'$$SURE^GMPLX S1 S Y="" G SQ
"RTN","GMPLEDT1",88,0)
 D ^DIC I Y'>0 W !?5,"Only clinic"_$S(VIEW="S":"al service",1:"")_"s are allowed!",! G S1
"RTN","GMPLEDT1",89,0)
SQ ;   Quit Service/Clinic
"RTN","GMPLEDT1",90,0)
 S:VIEW'="S" GMPFLD(1.08)=Y S:VIEW="S" GMPFLD(1.06)=Y
"RTN","GMPLEDT1",91,0)
 Q
"RTN","GMPLEDT1",92,0)
AUTHOR ; Edit Recording Provider - field 1.04
"RTN","GMPLEDT1",93,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT S PROMPT="RECORDING PROVIDER: "
"RTN","GMPLEDT1",94,0)
 S DEFAULT=$G(GMPFLD(1.04)),HELPMSG="Enter the name of the provider responsible for the recording of this data."
"RTN","GMPLEDT1",95,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",96,0)
 S GMPFLD(1.04)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",97,0)
 Q
"RTN","GMPLEDT1",98,0)
PROV ; Edit Responsible Provider - field 1.05
"RTN","GMPLEDT1",99,0)
 N X,Y,PROMPT,DEFAULT,HELPMSG S DEFAULT=$G(GMPFLD(1.05))
"RTN","GMPLEDT1",100,0)
 S PROMPT="PROVIDER: ",HELPMSG="Enter the name of the local provider treating this problem."
"RTN","GMPLEDT1",101,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",102,0)
 S GMPFLD(1.05)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",103,0)
 Q
"RTN","GMPLEDT1",104,0)
ICD ; Edit ICD-9-CM Code - field .01
"RTN","GMPLEDT1",105,0)
 N DIC,DIR,X,Y
"RTN","GMPLEDT1",106,0)
ICD0 ;   Prompt for ICD Code
"RTN","GMPLEDT1",107,0)
 K DIR S DIR(0)="FAO^2:6",DIR("A")="ICD CODE: "
"RTN","GMPLEDT1",108,0)
 S:$P($G(GMPFLD(.01)),U,2)="799.9" DIR("A")=IORVON_"ICD CODE: "
"RTN","GMPLEDT1",109,0)
 S:+$G(GMPFLD(.01)) DIR("B")=$P(GMPFLD(.01),U,2)
"RTN","GMPLEDT1",110,0)
 S DIR("?")="Enter the ICD code to be associated with this problem"
"RTN","GMPLEDT1",111,0)
ICD1 ;   Get ICD Code
"RTN","GMPLEDT1",112,0)
 D ^DIR W IORVOFF I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",113,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ICD1
"RTN","GMPLEDT1",114,0)
 I X="@" W !!,"ICD Code may not be deleted!",!,$C(7) G ICD1
"RTN","GMPLEDT1",115,0)
 Q:X=""  Q:$P($G(GMPFLD(.01)),U,2)=Y
"RTN","GMPLEDT1",116,0)
 S DIC=80,DIC(0)="EQM" D ^DIC G:Y'>0 ICD0
"RTN","GMPLEDT1",117,0)
 S GMPFLD(.01)=Y
"RTN","GMPLEDT1",118,0)
 Q
"RTN","GMPLEDT1",119,0)
NOTE ; Attach a note to problem - field 11
"RTN","GMPLEDT1",120,0)
 N X,Y,I,DEFAULT,PROMPT,DONE,NXT,NCNT S (I,NCNT,DONE)=0
"RTN","GMPLEDT1",121,0)
 ; added for Code Set Versioning (CSV)
"RTN","GMPLEDT1",122,0)
 I $G(GMPICD),'+$$STATCHK^ICDAPIU(GMPICD,DT) D  Q
"RTN","GMPLEDT1",123,0)
 . W !!,"This problem has an inactive ICD code. Please edit the problem before using.",! H 3
"RTN","GMPLEDT1",124,0)
 I $G(GMPIFN),'$$CODESTS^GMPLX(GMPIFN,DT) D  Q
"RTN","GMPLEDT1",125,0)
 . W !!,"This problem has an inactive ICD code. Please edit the problem before using.",! H 3
"RTN","GMPLEDT1",126,0)
 F  D  Q:$D(GMPQUIT)!($G(GMPLJUMP))!DONE
"RTN","GMPLEDT1",127,0)
 . S NXT=$O(GMPFLD(10,"NEW",I)) S:'NXT NXT=I+1
"RTN","GMPLEDT1",128,0)
 . S I=NXT,NCNT=NCNT+1
"RTN","GMPLEDT1",129,0)
 . S PROMPT=$S(NCNT=1:"",1:"ANOTHER ")_"COMMENT"_$S(NCNT=1:" (<60 char): ",1:": "),DEFAULT=$G(GMPFLD(10,"NEW",I))
"RTN","GMPLEDT1",130,0)
 . D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",131,0)
 . I X="@" K GMPFLD(10,"NEW",I) Q
"RTN","GMPLEDT1",132,0)
 . I Y="" S DONE=1 Q
"RTN","GMPLEDT1",133,0)
 . S GMPFLD(10,"NEW",I)=Y
"RTN","GMPLEDT1",134,0)
 Q
"RTN","GMPLEDT1",135,0)
TERM ; Edit Problem - field 1.01
"RTN","GMPLEDT1",136,0)
 G TERM^GMPLEDT4
"RTN","GMPLEDT1",137,0)
 Q
"RTN","GMPLEDT1",138,0)
Q ; No Editing
"RTN","GMPLEDT1",139,0)
 Q
"RTN","GMPLMGR")
0^10^B24427031
"RTN","GMPLMGR",1,0)
GMPLMGR ; SLC/MKB/AJB -- Problem List VALM Utilities ;3/1/00  12:28
"RTN","GMPLMGR",2,0)
 ;;2.0;Problem List;**21,28**;Aug 25, 1994
"RTN","GMPLMGR",3,0)
 ; 28 Feb 00 - MA added view comments accross Divisions
"RTN","GMPLMGR",4,0)
INIT ; -- init variables, list array
"RTN","GMPLMGR",5,0)
 S:'$G(GMPDFN) GMPDFN=$$PAT^GMPLX1 I +GMPDFN'>0 K GMPDFN S VALMQUIT=1 Q
"RTN","GMPLMGR",6,0)
 S GMPROV=$$REQPROV^GMPLX1 I +GMPROV'>0 K GMPDFN,GMPROV S VALMQUIT=1 Q
"RTN","GMPLMGR",7,0)
IN1 S GMPVA=$S($G(DUZ("AG"))="V":1,1:0),GMPVAMC=+$G(DUZ(2))
"RTN","GMPLMGR",8,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(+GMPDFN) ;reset
"RTN","GMPLMGR",9,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0
"RTN","GMPLMGR",10,0)
 S GMPLVIEW("VIEW")=$$VIEW^GMPLX1(DUZ)
"RTN","GMPLMGR",11,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLMGR",12,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW),BUILD(.GMPLIST)
"RTN","GMPLMGR",13,0)
 D:$E(GMPLVIEW("VIEW"))="S" CHGCAP^VALM("CLINIC","Service/Provider")
"RTN","GMPLMGR",14,0)
 S VALMSG=$$MSG^GMPLX
"RTN","GMPLMGR",15,0)
 Q
"RTN","GMPLMGR",16,0)
 ;
"RTN","GMPLMGR",17,0)
BUILD(PLIST) ; -- build list array
"RTN","GMPLMGR",18,0)
 N I D CLEAN^VALM10 K ^TMP("GMPLIDX",$J) S (I,GMPCOUNT,VALMCNT)=0
"RTN","GMPLMGR",19,0)
 D:$D(XRTL) T0^%ZOSV ; Start RT Monitor
"RTN","GMPLMGR",20,0)
 F  S I=$O(PLIST(I)) Q:I'>0  D:$D(GMPLUSER) BLDPROB(+PLIST(I)) D:'$D(GMPLUSER) BLDPROB^GMPLMGR2(+PLIST(I))
"RTN","GMPLMGR",21,0)
 S ^TMP("GMPL",$J,0)=+$G(GMPCOUNT)_U_+$G(VALMCNT) ; # entries^# lines
"RTN","GMPLMGR",22,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV ; Stop RT Monitor
"RTN","GMPLMGR",23,0)
 I $G(GMPCOUNT)'>0 S ^TMP("GMPL",$J,1,0)="   ",^TMP("GMPL",$J,2,0)="    No data available meeting criteria."
"RTN","GMPLMGR",24,0)
 Q
"RTN","GMPLMGR",25,0)
BLDPROB(IFN) ; Add problem line
"RTN","GMPLMGR",26,0)
 N GMPL0,GMPL1,DATE,TEXT,NAME,LINE,ACTIVE,I,NOTE,FAC,PROBLEM,NIFN,DELETED
"RTN","GMPLMGR",27,0)
 S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)) Q:'$L(GMPL0)
"RTN","GMPLMGR",28,0)
 S DELETED=$S($P(GMPL1,U,2)="H":1,1:0) ; flag if prob was deleted
"RTN","GMPLMGR",29,0)
 S ACTIVE=$P(GMPL0,U,12),DATE=$J($$EXTDT^GMPLX($P(GMPL0,U,3)),8)
"RTN","GMPLMGR",30,0)
 S PROBLEM=$S(DELETED:"< DELETED >",1:$$PROBTEXT^GMPLX(IFN))
"RTN","GMPLMGR",31,0)
 I ACTIVE="A",$P(GMPL0,U,13),'DELETED S PROBLEM=PROBLEM_", Onset "_$$EXTDT^GMPLX($P(GMPL0,U,13))
"RTN","GMPLMGR",32,0)
 I ACTIVE="I",$P(GMPL1,U,7),'DELETED S PROBLEM=PROBLEM_", Resolved "_$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLMGR",33,0)
 D WRAP^GMPLX(PROBLEM,40,.TEXT) ; format text to 41 chr
"RTN","GMPLMGR",34,0)
 I $E(GMPLVIEW("VIEW"))="S" S NAME=$$SERV^GMPLX1($P(GMPL1,U,6))_$$NAME^GMPLX1($P(GMPL1,U,5))
"RTN","GMPLMGR",35,0)
 E  S NAME=$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLMGR",36,0)
BLD1 S GMPCOUNT=+$G(GMPCOUNT)+1
"RTN","GMPLMGR",37,0)
 S LINE=$$SETFLD^VALM1(GMPCOUNT,"","NUMBER")
"RTN","GMPLMGR",38,0)
 S:ACTIVE="A" ACTIVE=$S($P(GMPL1,U,14)="A":"*",1:"") ; reset for priority
"RTN","GMPLMGR",39,0)
 S LINE=$$SETFLD^VALM1(ACTIVE,LINE,"STATUS")
"RTN","GMPLMGR",40,0)
 S LINE=$$SETFLD^VALM1(TEXT(1),LINE,"PROBLEM")
"RTN","GMPLMGR",41,0)
 S LINE=$$SETFLD^VALM1(DATE,LINE,"DATE")
"RTN","GMPLMGR",42,0)
 S LINE=$$SETFLD^VALM1(NAME,LINE,"CLINIC"),VALMCNT=+$G(VALMCNT)+1
"RTN","GMPLMGR",43,0)
 S ^TMP("GMPL",$J,VALMCNT,0)=LINE,^TMP("GMPL",$J,"IDX",VALMCNT,GMPCOUNT)=""
"RTN","GMPLMGR",44,0)
 S ^TMP("GMPLIDX",$J,GMPCOUNT)=VALMCNT_U_IFN
"RTN","GMPLMGR",45,0)
 I GMPARAM("VER"),$P(GMPL1,U,2)="T",'DELETED S LINE=$E(LINE,1,4)_"$"_$E(LINE,6,79),^TMP("GMPL",$J,VALMCNT,0)=LINE D CNTRL^VALM10(VALMCNT,5,1,IOINHI,IOINORM)
"RTN","GMPLMGR",46,0)
 ; added for Code Set Versioning (CSV) - annotates inactive ICD code with #
"RTN","GMPLMGR",47,0)
 I '$$CODESTS^GMPLX(IFN,DT) S LINE=$E(LINE,1,4)_"#"_$E(LINE,6,79),^TMP("GMPL",$J,VALMCNT,0)=LINE D CNTRL^VALM10(VALMCNT,5,1,IOINHI,IOINORM)
"RTN","GMPLMGR",48,0)
 Q:DELETED
"RTN","GMPLMGR",49,0)
BLD2 I TEXT>1 F I=2:1:TEXT D
"RTN","GMPLMGR",50,0)
 . S LINE="",LINE=$$SETFLD^VALM1(TEXT(I),LINE,"PROBLEM")
"RTN","GMPLMGR",51,0)
 . S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,VALMCNT,0)=LINE
"RTN","GMPLMGR",52,0)
 . S ^TMP("GMPL",$J,"IDX",VALMCNT,GMPCOUNT)=""
"RTN","GMPLMGR",53,0)
 ;Q:'$D(^AUPNPROB(IFN,11,"B",+GMPVAMC))  ; display current user's notes
"RTN","GMPLMGR",54,0)
 ; Routine has been changed to show all Problem List Comments for
"RTN","GMPLMGR",55,0)
 ; Divisions per Clinical Workgroup decision 26 Jan 2000
"RTN","GMPLMGR",56,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLMGR",57,0)
 . F NIFN=0:0  S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:+NIFN'>0  D
"RTN","GMPLMGR",58,0)
 . . S NOTE=$P($G(^AUPNPROB(IFN,11,FAC,11,NIFN,0)),U,3)
"RTN","GMPLMGR",59,0)
 . . S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,"IDX",VALMCNT,GMPCOUNT)=""
"RTN","GMPLMGR",60,0)
 . . S ^TMP("GMPL",$J,VALMCNT,0)="        "_NOTE
"RTN","GMPLMGR",61,0)
 Q
"RTN","GMPLMGR",62,0)
 ;
"RTN","GMPLMGR",63,0)
HDR ; -- header code
"RTN","GMPLMGR",64,0)
 N HDR,LNM,FNM,PAT,NUM
"RTN","GMPLMGR",65,0)
 S PAT=$P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLMGR",66,0)
 S NUM=GMPCOUNT S:GMPTOTAL>GMPCOUNT NUM=NUM_" of "_GMPTOTAL
"RTN","GMPLMGR",67,0)
 S NUM=NUM_$S(GMPLVIEW("ACT")="A":" active",GMPLVIEW("ACT")="I":" inactive",1:"")_" problems"
"RTN","GMPLMGR",68,0)
 S VALMHDR(1)=PAT_$J(NUM,79-$L(PAT))
"RTN","GMPLMGR",69,0)
 S HDR=$S(GMPLVIEW("ACT")="I":"INACTIVE",GMPLVIEW("ACT")="A":"ACTIVE",1:"ALL")
"RTN","GMPLMGR",70,0)
 I $L(GMPLVIEW("VIEW"))>2 S HDR=HDR_$S($E(GMPLVIEW("VIEW"))="S":" SERVICE",1:" CLINIC") ; screened
"RTN","GMPLMGR",71,0)
 S HDR=HDR_" PROBLEMS"
"RTN","GMPLMGR",72,0)
 S:GMPLVIEW("PROV") LNM=$P($P(GMPLVIEW("PROV"),U,2),","),FNM=$P($P(GMPLVIEW("PROV"),U,2),",",2),HDR=HDR_" BY "_FNM_" "_LNM
"RTN","GMPLMGR",73,0)
 S VALMHDR(2)=$J(HDR,$L(HDR)\2+41)
"RTN","GMPLMGR",74,0)
 Q
"RTN","GMPLMGR",75,0)
 ;
"RTN","GMPLMGR",76,0)
HELP ; -- help code
"RTN","GMPLMGR",77,0)
 N X
"RTN","GMPLMGR",78,0)
 W !!?4,"To update the problem list first select from Add, Remove, Edit,"
"RTN","GMPLMGR",79,0)
 W !?4 W:GMPARAM("VER") "Verify, "
"RTN","GMPLMGR",80,0)
 W "Inactivate, or Comment, then enter the problem number(s)."
"RTN","GMPLMGR",81,0)
 W !?4,"If you need more information on a problem, select Detailed"
"RTN","GMPLMGR",82,0)
 W !?4,"Display; to change whether all or only selected problems for this"
"RTN","GMPLMGR",83,0)
 W !?4,"patient are listed, choose Select View.  Enter ?? to see more"
"RTN","GMPLMGR",84,0)
 W !?4,"actions for facilitating navigation of the list."
"RTN","GMPLMGR",85,0)
 W !?4,"Problem statuses: *-Acute I-Inactive #-Inactive ICD Code"
"RTN","GMPLMGR",86,0)
 W:GMPARAM("VER") " $-Unverified"
"RTN","GMPLMGR",87,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLMGR",88,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLMGR",89,0)
 Q
"RTN","GMPLMGR2")
0^11^B26697548
"RTN","GMPLMGR2",1,0)
GMPLMGR2 ; SLC/MKB/KER/AJB -- Problem List VALM Utilities cont ; 04/15/2002
"RTN","GMPLMGR2",2,0)
 ;;2.0;Problem List;**26,28**;Aug 25, 1994
"RTN","GMPLMGR2",3,0)
 ;
"RTN","GMPLMGR2",4,0)
 ; External References
"RTN","GMPLMGR2",5,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMPLMGR2",6,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLMGR2",7,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLMGR2",8,0)
 ;   DBIA 10116  $$SETFLD^VALM1
"RTN","GMPLMGR2",9,0)
 ;   DBIA 10116  CLEAR^VALM1
"RTN","GMPLMGR2",10,0)
 ;   DBIA 10140  EN^XQORM
"RTN","GMPLMGR2",11,0)
 ;                      
"RTN","GMPLMGR2",12,0)
BLDPROB(IFN) ; Build Line for Problem in List
"RTN","GMPLMGR2",13,0)
 ;   Input INF   Pointer to Problem file 9000011
"RTN","GMPLMGR2",14,0)
 ;   Expects GMPCOUNT
"RTN","GMPLMGR2",15,0)
 N GMPL0,GMPL1,RESOLVED,TEXT,I,LINE,STR,SC,SP,ICD,ONSET,PROBLEM,STATUS
"RTN","GMPLMGR2",16,0)
 Q:'$D(GMPCOUNT)  S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)) Q:'$L(GMPL0)
"RTN","GMPLMGR2",17,0)
 S SC=$P(GMPL1,U,10),SP=$P(GMPL1,U,11,13)_"^"_$P(GMPL1,U,15,16),STATUS=$P(GMPL0,U,12)
"RTN","GMPLMGR2",18,0)
 S:$P(GMPL1,U,2)="H" PROBLEM="< DELETED >" I $P(GMPL1,U,2)'="H" D
"RTN","GMPLMGR2",19,0)
 . S PROBLEM=$$PROBTEXT^GMPLX(IFN),ONSET=$P(GMPL0,U,13)
"RTN","GMPLMGR2",20,0)
 . I ONSET S PROBLEM=PROBLEM_", Onset "_$$EXTDT^GMPLX(ONSET)
"RTN","GMPLMGR2",21,0)
 S RESOLVED=$J($$EXTDT^GMPLX($P(GMPL1,U,7)),8)
"RTN","GMPLMGR2",22,0)
 S ICD=$P($G(^ICD9(+GMPL0,0)),U),GMPCOUNT=GMPCOUNT+1
"RTN","GMPLMGR2",23,0)
 D WRAP^GMPLX(PROBLEM,40,.TEXT)
"RTN","GMPLMGR2",24,0)
 S LINE=$$SETFLD^VALM1(GMPCOUNT,"","NUMBER")
"RTN","GMPLMGR2",25,0)
 ; added for Code Set Versioning (CSV) - checks ICD code - # if inactive
"RTN","GMPLMGR2",26,0)
 I '$$CODESTS^GMPLX(IFN,DT) D
"RTN","GMPLMGR2",27,0)
 . I STATUS="A" S LINE=$$SETFLD^VALM1(" #",LINE,"STATUS")
"RTN","GMPLMGR2",28,0)
 . I STATUS="I" S LINE=$$SETFLD^VALM1(STATUS_"#",LINE,"STATUS")
"RTN","GMPLMGR2",29,0)
 E  S:STATUS="I" LINE=$$SETFLD^VALM1(STATUS,LINE,"STATUS")
"RTN","GMPLMGR2",30,0)
 ; S:STATUS="I" LINE=$$SETFLD^VALM1(STATUS,LINE,"STATUS")
"RTN","GMPLMGR2",31,0)
 S LINE=$$SETFLD^VALM1(TEXT(1),LINE,"PROBLEM")
"RTN","GMPLMGR2",32,0)
 S LINE=$$SETFLD^VALM1(ICD,LINE,"ICD")
"RTN","GMPLMGR2",33,0)
 I $L(SC) D
"RTN","GMPLMGR2",34,0)
 . S STR=$S(+SC:"YES",SC=0:"NO",1:"   ")
"RTN","GMPLMGR2",35,0)
 . S LINE=$$SETFLD^VALM1(STR,LINE,"SERV CONNECTED")
"RTN","GMPLMGR2",36,0)
 I $L(SP) D
"RTN","GMPLMGR2",37,0)
 . S STR=$S(+$P(SP,U):"Agent Orange",+$P(SP,U,2):"Radiation",+$P(SP,U,3):"Contaminants",+$P(SP,U,4):"Head/Neck Cancer",+$P(SP,U,5):"Mil Sexual Trauma",1:"")
"RTN","GMPLMGR2",38,0)
 . S LINE=$$SETFLD^VALM1(STR,LINE,"EXPOSURE")
"RTN","GMPLMGR2",39,0)
 S LINE=$$SETFLD^VALM1(RESOLVED,LINE,"RESOLVED")
"RTN","GMPLMGR2",40,0)
 S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,VALMCNT,0)=LINE
"RTN","GMPLMGR2",41,0)
 S ^TMP("GMPLIDX",$J,GMPCOUNT)=VALMCNT_U_IFN
"RTN","GMPLMGR2",42,0)
 I TEXT>1 F I=2:1:TEXT D
"RTN","GMPLMGR2",43,0)
 . S LINE="",LINE=$$SETFLD^VALM1(TEXT(I),LINE,"PROBLEM")
"RTN","GMPLMGR2",44,0)
 . S VALMCNT=VALMCNT+1,^TMP("GMPL",$J,VALMCNT,0)=LINE
"RTN","GMPLMGR2",45,0)
 Q
"RTN","GMPLMGR2",46,0)
 ;
"RTN","GMPLMGR2",47,0)
HELP ; Help Code
"RTN","GMPLMGR2",48,0)
 N X W !!?4,"You may take a variety of actions from this prompt.  To update"
"RTN","GMPLMGR2",49,0)
 W !?4,"the problem list select from Add, Remove, Edit, Inactivate,"
"RTN","GMPLMGR2",50,0)
 W !?4,"and Enter Comment; you will then be prompted for the problem"
"RTN","GMPLMGR2",51,0)
 W !?4,"number.  To see all of this patient's problems, both active and"
"RTN","GMPLMGR2",52,0)
 W !?4,"inactive, select Show All Problems; select Print to print the"
"RTN","GMPLMGR2",53,0)
 W !?4,"same complete list in a chartable format.  To see a listing of"
"RTN","GMPLMGR2",54,0)
 W !?4,"actions that facilitate navigating the list, enter '??'."
"RTN","GMPLMGR2",55,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLMGR2",56,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLMGR2",57,0)
 Q
"RTN","GMPLMGR2",58,0)
 ;
"RTN","GMPLMGR2",59,0)
EXIT ; Exit Code
"RTN","GMPLMGR2",60,0)
 I GMPARAM("PRT"),$D(GMPRINT) D AUTO
"RTN","GMPLMGR2",61,0)
 K ^TMP("GMPL",$J),^TMP("GMPLIDX",$J)
"RTN","GMPLMGR2",62,0)
 K XQORM("KEY","="),XQORM("XLATE")
"RTN","GMPLMGR2",63,0)
 K GMPDFN,GMPROV,GMPLVIEW,GMPARAM,VALMBCK,VALMHDR,VALMCNT,GMPCOUNT,GMPLUSER,GMPSC,VALMSG,GMPVAMC,GMPLIST,GMPAGTOR,GMPION,GMPGULF,GMPVA,GMPTOTAL,GMPRINT,AUPNSEX,GMPCLIN
"RTN","GMPLMGR2",64,0)
 Q
"RTN","GMPLMGR2",65,0)
 ;
"RTN","GMPLMGR2",66,0)
AUTO ; Print Problem List when Exiting Patient?
"RTN","GMPLMGR2",67,0)
 ;   Called from EXIT,NEWPAT^GMPLMGR1
"RTN","GMPLMGR2",68,0)
 N DIR,X,Y Q:'GMPARAM("PRT")  Q:'$D(GMPRINT)
"RTN","GMPLMGR2",69,0)
 S DIR(0)="YA",DIR("A")="Print a new problem list? ",DIR("B")="YES"
"RTN","GMPLMGR2",70,0)
 S DIR("?",1)="Press <return> to generate a new complete problem list for this patient;",DIR("?")="enter NO to continue without printing."
"RTN","GMPLMGR2",71,0)
 W $C(7),!!,">>>  THIS PATIENT'S PROBLEM LIST HAS CHANGED!"
"RTN","GMPLMGR2",72,0)
 D ^DIR I $D(DTOUT)!($D(DTOUT)) S GMPQUIT=1 Q
"RTN","GMPLMGR2",73,0)
 Q:'Y  D VAF^GMPLPRNT,DEVICE^GMPLPRNT G:$D(GMPQUIT) AUTQ
"RTN","GMPLMGR2",74,0)
 D CLEAR^VALM1,PRT^GMPLPRNT
"RTN","GMPLMGR2",75,0)
AUTQ ; Quit Auto-Print
"RTN","GMPLMGR2",76,0)
 D KILL^GMPLX
"RTN","GMPLMGR2",77,0)
 Q
"RTN","GMPLMGR2",78,0)
 ;
"RTN","GMPLMGR2",79,0)
SHOW ; Show Current View of List
"RTN","GMPLMGR2",80,0)
 N VIEW,NUM,NAME S VIEW=$E(GMPLVIEW("VIEW")),NUM=$L(GMPLVIEW("VIEW"),"/")
"RTN","GMPLMGR2",81,0)
 W !!,"CURRENT VIEW: "_$S(VIEW="S":"Inpatient, ",1:"Outpatient, ")
"RTN","GMPLMGR2",82,0)
 I '((NUM>2)!($L(GMPLVIEW("ACT")))!(GMPLVIEW("PROV"))) W "all problems" Q
"RTN","GMPLMGR2",83,0)
 W $S(GMPLVIEW("ACT")="A":"active",GMPLVIEW("ACT")="I":"inactive",1:"all")_" problems"
"RTN","GMPLMGR2",84,0)
 I NUM>2 W " from "_$S(GMPLVIEW("VIEW")=$$VIEW^GMPLX1(DUZ):"preferred",1:"selected")_$S(VIEW="S":" services",1:" clinics")
"RTN","GMPLMGR2",85,0)
 I GMPLVIEW("PROV") S NAME=$$NAME^GMPLX1(GMPLVIEW("PROV")) W:($X+$L(NAME)+4>80) ! W " by "_NAME
"RTN","GMPLMGR2",86,0)
 Q
"RTN","GMPLMGR2",87,0)
 ;
"RTN","GMPLMGR2",88,0)
ENVIEW ; Entry Action to Display Appropriate View Menu
"RTN","GMPLMGR2",89,0)
 N XQORM,X,Y,GMPLX S GMPLX=0 D SHOW S X="GMPL VIEW "_$S($E(GMPLVIEW("VIEW"))="S":"INPAT",1:"OUTPAT")
"RTN","GMPLMGR2",90,0)
 S XQORM=+$O(^ORD(101,"B",X,0))_";ORD(101,",XQORM(0)="3AD"
"RTN","GMPLMGR2",91,0)
 W !,"You may change your view of this patient's problem list by selecting one or",!,"more of the following attributes to alter:",!
"RTN","GMPLMGR2",92,0)
 D EN^XQORM F  S GMPLX=$O(Y(GMPLX)) Q:GMPLX'>0  X:$D(^ORD(101,+$P(Y(GMPLX),U,2),20)) ^(20)
"RTN","GMPLMGR2",93,0)
 Q
"RTN","GMPLMGR2",94,0)
 ;
"RTN","GMPLMGR2",95,0)
EXVIEW ; Exit Action to Rebuild List w/New View
"RTN","GMPLMGR2",96,0)
 S VALMBCK=$S(VALMCC:"",1:"R") I '$D(GMPQUIT),$G(GMPREBLD) D
"RTN","GMPLMGR2",97,0)
 . S VALMBG=1,VALMBCK="R" D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLMGR2",98,0)
 . D BUILD^GMPLMGR(.GMPLIST),HDR^GMPLMGR
"RTN","GMPLMGR2",99,0)
 K GMPQUIT,GMPREBLD S VALMSG=$$MSG^GMPLX
"RTN","GMPLMGR2",100,0)
 Q
"RTN","GMPLRPTR")
0^12^B14705450
"RTN","GMPLRPTR",1,0)
GMPLRPTR ; SLC/MKB/AJB -- Problem List Report of Removed Problems ;4/10/03
"RTN","GMPLRPTR",2,0)
 ;;2.0;Problem List;**28**;Aug 25, 1994
"RTN","GMPLRPTR",3,0)
EN ; -- main entry point
"RTN","GMPLRPTR",4,0)
 S GMPDFN=$$PAT^GMPLX1 Q:+GMPDFN'>0
"RTN","GMPLRPTR",5,0)
 D WAIT^DICD,GETLIST
"RTN","GMPLRPTR",6,0)
 I GMPLIST(0)'>0 W $C(7),!!?10,"No 'removed' problems found for this patient.",! Q
"RTN","GMPLRPTR",7,0)
 D DISPLAY,REPLACE
"RTN","GMPLRPTR",8,0)
 K GMPDFN,GMPLIST
"RTN","GMPLRPTR",9,0)
 Q
"RTN","GMPLRPTR",10,0)
 ;
"RTN","GMPLRPTR",11,0)
GETLIST ; -- build GMPLIST() of removed problems
"RTN","GMPLRPTR",12,0)
 N IFN,CNT,NODE S CNT=0
"RTN","GMPLRPTR",13,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",+GMPDFN,IFN)) Q:IFN'>0  D
"RTN","GMPLRPTR",14,0)
 . S NODE=$G(^AUPNPROB(IFN,1)) Q:$P(NODE,U,2)'="H"
"RTN","GMPLRPTR",15,0)
 . S CNT=CNT+1,GMPLIST(CNT)=IFN W "."
"RTN","GMPLRPTR",16,0)
 S GMPLIST(0)=CNT
"RTN","GMPLRPTR",17,0)
 Q
"RTN","GMPLRPTR",18,0)
 ;
"RTN","GMPLRPTR",19,0)
DISPLAY ; -- show list on screen
"RTN","GMPLRPTR",20,0)
 N PROBLEM,DATE,USER,NUM,PROV,IDT,AIFN,NODE,DONE,GMPQUIT D HDR
"RTN","GMPLRPTR",21,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D  Q:$D(GMPQUIT)
"RTN","GMPLRPTR",22,0)
 . S IFN=GMPLIST(NUM) Q:'IFN
"RTN","GMPLRPTR",23,0)
 . S PROBLEM=$$PROBTEXT^GMPLX(IFN),(DATE,PROV)="" K DONE
"RTN","GMPLRPTR",24,0)
 . ; added for Code Set Versioning (CSV)
"RTN","GMPLRPTR",25,0)
 . I '$$CODESTS^GMPLX(IFN,DT) S PROBLEM="#"_PROBLEM
"RTN","GMPLRPTR",26,0)
 . F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",IFN,IDT)) Q:IDT'>0  D  Q:$D(DONE)
"RTN","GMPLRPTR",27,0)
 . . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",IFN,IDT,AIFN)) Q:AIFN'>0  D  Q:$D(DONE)
"RTN","GMPLRPTR",28,0)
 . . . S NODE=$G(^GMPL(125.8,AIFN,0)) Q:$P(NODE,U,2)'=1.02
"RTN","GMPLRPTR",29,0)
 . . . I $P(NODE,U,6)="H" S DATE=9999999-IDT,PROV=$P(NODE,U,8),DONE=1
"RTN","GMPLRPTR",30,0)
 . I $Y>(IOSL-4) S:'$$CONTINUE GMPQUIT=1 Q:$D(GMPQUIT)  D HDR
"RTN","GMPLRPTR",31,0)
 . ; added for Code Set Versioning
"RTN","GMPLRPTR",32,0)
 . N GMPLBUF S GMPLBUF=$S(PROBLEM["#":3,1:4)
"RTN","GMPLRPTR",33,0)
 . W !,NUM,?GMPLBUF,PROBLEM,?51,$$EXTDT^GMPLX(DATE),?60,$$NAME^GMPLX1(PROV)
"RTN","GMPLRPTR",34,0)
 Q
"RTN","GMPLRPTR",35,0)
 ;
"RTN","GMPLRPTR",36,0)
HDR ; -- header code
"RTN","GMPLRPTR",37,0)
 W @IOF,"REMOVED PROBLEMS FOR "_$P(GMPDFN,U,2)_" ("_$P(GMPDFN,U,3)_"):"
"RTN","GMPLRPTR",38,0)
 W !!,"    Problem",?51,"Removed  By Whom",!,$$REPEAT^XLFSTR("-",79)
"RTN","GMPLRPTR",39,0)
 Q
"RTN","GMPLRPTR",40,0)
 ;
"RTN","GMPLRPTR",41,0)
CONTINUE() ; -- end of page prompt
"RTN","GMPLRPTR",42,0)
 N DIR,X,Y
"RTN","GMPLRPTR",43,0)
 S DIR(0)="E",DIR("A")="Press <return> to continue or ^ to exit ..."
"RTN","GMPLRPTR",44,0)
 D ^DIR
"RTN","GMPLRPTR",45,0)
 Q +Y
"RTN","GMPLRPTR",46,0)
 ;
"RTN","GMPLRPTR",47,0)
REPLACE ; -- replace problem on patient's list
"RTN","GMPLRPTR",48,0)
 N GMPLSEL,GMPLNO,NUM,CHNGE,NOW,DA,DR,DIE W !!
"RTN","GMPLRPTR",49,0)
 S GMPLSEL=$$SEL Q:GMPLSEL="^"  Q:'$$SURE
"RTN","GMPLRPTR",50,0)
 W !!,"Replacing problem(s) on patient's list ..."
"RTN","GMPLRPTR",51,0)
 S GMPLNO=$L(GMPLSEL,","),NOW=$$HTFM^XLFDT($H)
"RTN","GMPLRPTR",52,0)
 F I=1:1:GMPLNO S NUM=$P(GMPLSEL,",",I) I NUM D
"RTN","GMPLRPTR",53,0)
 . ; added for Code Set Versioning (CSV)
"RTN","GMPLRPTR",54,0)
 . I '$$CODESTS^GMPLX(GMPLIST(NUM),DT) W !!,$$PROBTEXT^GMPLX(GMPLIST(NUM)),!,"has an inactive ICD9 code and will not be replaced." Q
"RTN","GMPLRPTR",55,0)
 . S DA=GMPLIST(NUM),DR="1.02////P",DIE="^AUPNPROB(" D ^DIE
"RTN","GMPLRPTR",56,0)
 . S CHNGE=DA_"^1.02^"_NOW_U_DUZ_"^H^P^Replaced^"_DUZ
"RTN","GMPLRPTR",57,0)
 . D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(DA)
"RTN","GMPLRPTR",58,0)
 . W !,"  "_$$PROBTEXT^GMPLX(DA)
"RTN","GMPLRPTR",59,0)
 D
"RTN","GMPLRPTR",60,0)
 . N DIR S DIR(0)="E" W ! D ^DIR
"RTN","GMPLRPTR",61,0)
 Q
"RTN","GMPLRPTR",62,0)
 ;
"RTN","GMPLRPTR",63,0)
SEL() ; -- select problem(s)
"RTN","GMPLRPTR",64,0)
 N DIR,X,Y,MAX
"RTN","GMPLRPTR",65,0)
 S MAX=+GMPLIST(0) I MAX'>0 Q "^"
"RTN","GMPLRPTR",66,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select the problem(s) you wish to replace on this patient's list: "
"RTN","GMPLRPTR",67,0)
 S DIR("?",1)="Enter the problems you wish to add back on this patient's problem list,",DIR("?")="as a range or list of numbers."
"RTN","GMPLRPTR",68,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLRPTR",69,0)
 Q Y
"RTN","GMPLRPTR",70,0)
 ;
"RTN","GMPLRPTR",71,0)
SURE() ; -- are you sure you want to do this?
"RTN","GMPLRPTR",72,0)
 N DIR,X,Y
"RTN","GMPLRPTR",73,0)
 S DIR(0)="Y",DIR("A")="Are you sure you want to do this",DIR("B")="NO"
"RTN","GMPLRPTR",74,0)
 S DIR("?",1)="Enter YES if you are ready to have the selected problems put back on this",DIR("?")="patient's problem list; press <return> to exit without further action."
"RTN","GMPLRPTR",75,0)
 W $C(7) D ^DIR
"RTN","GMPLRPTR",76,0)
 Q +Y
"RTN","GMPLX")
0^6^B42400085
"RTN","GMPLX",1,0)
GMPLX ; SLC/MKB/AJB -- Problem List Problem Utilities ; 03/12/03
"RTN","GMPLX",2,0)
 ;;2.0;Problem List;**7,23,26,28**;Aug 25, 1994
"RTN","GMPLX",3,0)
 ;
"RTN","GMPLX",4,0)
 ; External References
"RTN","GMPLX",5,0)
 ;   DBIA   446  ^AUTNPOV(
"RTN","GMPLX",6,0)
 ;   DBIA 10082  ^ICD9("BA"
"RTN","GMPLX",7,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLX",8,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLX",9,0)
 ;   DBIA 10009  FILE^DICN
"RTN","GMPLX",10,0)
 ;   DBIA 10013  EN^DIK
"RTN","GMPLX",11,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMPLX",12,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLX",13,0)
 ;   DBIA  1609  CONFIG^LEXSET
"RTN","GMPLX",14,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMPLX",15,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLX",16,0)
 ;   DBIA  2742  GMPLX
"RTN","GMPLX",17,0)
 ;   DBIA  3991  $$STATCHK^ICDAPIU
"RTN","GMPLX",18,0)
 ;
"RTN","GMPLX",19,0)
SEARCH(X,Y,PROMPT,UNRES,VIEW) ; Search Lexicon for Problem X
"RTN","GMPLX",20,0)
 N DIC S:'$L($G(VIEW)) VIEW="PL1" D CONFIG^LEXSET("GMPL",VIEW,DT)
"RTN","GMPLX",21,0)
 S DIC("A")=$S($L($G(PROMPT)):PROMPT,1:"Select PROBLEM: ")
"RTN","GMPLX",22,0)
 S DIC="^LEX(757.01,",DIC(0)=$S('$L($G(X)):"A",1:"")_"EQM"
"RTN","GMPLX",23,0)
 S:'$G(UNRES) LEXUN=0 D ^DIC S:+Y>1 X=$P(Y,U,2)
"RTN","GMPLX",24,0)
 Q
"RTN","GMPLX",25,0)
 ;
"RTN","GMPLX",26,0)
PROVNARR(X,CL) ; Returns IFN ^ Text of Narrative (#9999999.27)
"RTN","GMPLX",27,0)
 N DIC,Y,DLAYGO,DD,DO,DA S:$L(X)>80 X=$E(X,1,80)
"RTN","GMPLX",28,0)
 S DIC="^AUTNPOV(",DIC(0)="L",DLAYGO=9999999.27,(DA,Y)=0
"RTN","GMPLX",29,0)
 F  S DA=$O(^AUTNPOV("B",$E(X,1,30),DA)) Q:DA'>0  I $P(^AUTNPOV(DA,0),U)=X S Y=DA_U_X Q
"RTN","GMPLX",30,0)
 I '(+Y) K DA,Y D FILE^DICN S:Y'>0 Y=U_X I Y>0,CL>1 S ^AUTNPOV(+Y,757)=CL
"RTN","GMPLX",31,0)
 Q $P(Y,U,1,2)
"RTN","GMPLX",32,0)
 ;
"RTN","GMPLX",33,0)
PROBTEXT(IFN) ; Returns Display Text
"RTN","GMPLX",34,0)
 N X,Y,GMPLEXP,GMPLPOV,GMPLSO,GMPLTXT
"RTN","GMPLX",35,0)
 S Y=$P($G(^AUPNPROB(+IFN,0)),U,5),X=$P($G(^AUTNPOV(+Y,0)),U)
"RTN","GMPLX",36,0)
 S GMPLEXP=$$EP(IFN),GMPLSO=$$CS(X),GMPLPOV=$$PT(X,GMPLSO)
"RTN","GMPLX",37,0)
 S GMPLTXT=GMPLPOV S:$L(GMPLEXP) GMPLTXT=GMPLTXT_" ("_GMPLEXP_")"
"RTN","GMPLX",38,0)
 S:$L(GMPLSO) GMPLTXT=GMPLTXT_" "_GMPLSO
"RTN","GMPLX",39,0)
 S:GMPLTXT["*" GMPLTXT=$TR(GMPLTXT,"*","")
"RTN","GMPLX",40,0)
 ;S:$L(GMPLTXT) GMPLTXT=GMPLTXT_" ("_$$HFP^GMPLUTL4_","_$$PTR^GMPLUTL4_")"
"RTN","GMPLX",41,0)
 S:$L(GMPLTXT) X=GMPLTXT Q X
"RTN","GMPLX",42,0)
PROBNARR(IFN) ; Returns Provider Narrative
"RTN","GMPLX",43,0)
 N X,Y S Y=$P($G(^AUPNPROB(+IFN,0)),U,5),X=$P($G(^AUTNPOV(+Y,0)),U)
"RTN","GMPLX",44,0)
 Q X
"RTN","GMPLX",45,0)
CS(X) ; Problem Codes
"RTN","GMPLX",46,0)
 N GMPLSAB,GMPLSO S GMPLSO="" S X=$G(X) Q:X'["(" ""
"RTN","GMPLX",47,0)
 F GMPLSAB="ICD-","CPT-","DSM-","HCPCS","NANDA","NIC","NOC","LOINC","SNOMED","OMAHA" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",48,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",49,0)
 F GMPLSAB="ACR","AI/RHEUM","CONGRESS","COSTAR","COSTART","CRISP","DODFAC" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",50,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",51,0)
 F GMPLSAB="DORLAND","DXPLAIN","HHCC","MCMASTER","META","MTF","MeSH","RVC","TITLE 38","UMDNS","UWA" S:$G(X)[("("_GMPLSAB) GMPLSO="("_GMPLSAB_$P(X,("("_GMPLSAB),2,299) Q:$L(GMPLSO)
"RTN","GMPLX",52,0)
 I $L(GMPLSO) S X=GMPLSO Q X
"RTN","GMPLX",53,0)
 Q ""
"RTN","GMPLX",54,0)
EP(X) ; Exposures
"RTN","GMPLX",55,0)
 N GMPLSC S X=+($G(X)) D SCS^GMPLX1(+X,.GMPLSC) S X=$G(GMPLSC(1)) Q X
"RTN","GMPLX",56,0)
PT(X,C) ; Problem Text (only)
"RTN","GMPLX",57,0)
 N GMPLTERM,GMPLSO S GMPLTERM=$G(X),GMPLSO=$G(C)
"RTN","GMPLX",58,0)
 S:$L(GMPLSO)&(GMPLTERM[GMPLSO) GMPLTERM=$P(GMPLTERM,GMPLSO,1) S GMPLTERM=$$TRIM(GMPLTERM)
"RTN","GMPLX",59,0)
 S:$L(GMPLTERM) X=GMPLTERM Q X
"RTN","GMPLX",60,0)
TRIM(X) ; Trim Spaces and "*"
"RTN","GMPLX",61,0)
 S X=$G(X) F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",62,0)
 F  Q:$E(X,$L(X))'="*"  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",63,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX",64,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMPLX",65,0)
 Q X
"RTN","GMPLX",66,0)
WRAP(PROB,MAX,TEXT) ; Splits Text into TEXT array
"RTN","GMPLX",67,0)
 N I,J S J=0 K TEXT I $L(PROB)'>MAX S J=J+1,TEXT(J)=PROB G WRQ
"RTN","GMPLX",68,0)
WR0 ;   Loop for Remaining Text
"RTN","GMPLX",69,0)
 S I=$F(PROB," ") I ('I)!(I>(MAX+2)) S J=J+1,TEXT(J)=$E(PROB,1,MAX),PROB=$E(PROB,MAX+1,999)
"RTN","GMPLX",70,0)
 I $L(PROB)>MAX F I=(MAX+1):-1:1 I $E(PROB,I)=" " S J=J+1,TEXT(J)=$E(PROB,1,I-1),PROB=$E(PROB,I+1,999) Q
"RTN","GMPLX",71,0)
 G:$L(PROB)>MAX WR0
"RTN","GMPLX",72,0)
 S:$L(PROB) J=J+1,TEXT(J)=PROB
"RTN","GMPLX",73,0)
WRQ ;   Quit Wrap
"RTN","GMPLX",74,0)
 S TEXT=J
"RTN","GMPLX",75,0)
 Q
"RTN","GMPLX",76,0)
 ;
"RTN","GMPLX",77,0)
NOS() ; Return PTR ^ 799.9 ICD code
"RTN","GMPLX",78,0)
 N X S X=$O(^ICD9("BA",799.9,0)) Q (+X_"^799.9")
"RTN","GMPLX",79,0)
 ;
"RTN","GMPLX",80,0)
SEL(HELP) ; Select List of Problems
"RTN","GMPLX",81,0)
 N X,Y,DIR,MAX S MAX=+$G(^TMP("GMPL",$J,0)) I MAX'>0 Q "^"
"RTN","GMPLX",82,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select Problem(s)"
"RTN","GMPLX",83,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLX",84,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLX",85,0)
 S DIR("?")="Enter the problems you wish to "
"RTN","GMPLX",86,0)
 S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")_", as a range or list of numbers"
"RTN","GMPLX",87,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLX",88,0)
 Q Y
"RTN","GMPLX",89,0)
 ;
"RTN","GMPLX",90,0)
SEL1(HELP) ; Select 1 Problem
"RTN","GMPLX",91,0)
 N X,Y,DIR,MAX S MAX=+$G(^TMP("GMPL",$J,0)) I MAX'>0 Q "^"
"RTN","GMPLX",92,0)
 S DIR(0)="NAO^1:"_MAX_":0",DIR("A")="Select Problem"
"RTN","GMPLX",93,0)
 S:MAX>1 DIR("A")=DIR("A")_" (1-"_MAX_"): "
"RTN","GMPLX",94,0)
 S:MAX'>1 DIR("A")=DIR("A")_": ",DIR("B")=1
"RTN","GMPLX",95,0)
 S DIR("?")="Enter the number of the problem you wish to "
"RTN","GMPLX",96,0)
 S DIR("?")=DIR("?")_$S($L(HELP):HELP,1:"act on")
"RTN","GMPLX",97,0)
 D ^DIR I $D(DTOUT)!(X="") S Y="^"
"RTN","GMPLX",98,0)
 Q Y
"RTN","GMPLX",99,0)
 ;
"RTN","GMPLX",100,0)
DUPL(DFN,TERM,TEXT) ; Check's for Duplicate Entries
"RTN","GMPLX",101,0)
 N DA,IFN,NODE0,NODE1 S DA=0,TEXT=$$UP^XLFSTR(TEXT)
"RTN","GMPLX",102,0)
 I '$D(^AUPNPROB("C",TERM))!('$D(^AUPNPROB("AC",DFN))) Q DA
"RTN","GMPLX",103,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",DFN,IFN)) Q:IFN'>0  D  Q:DA>0
"RTN","GMPLX",104,0)
 . S NODE0=$G(^AUPNPROB(IFN,0)),NODE1=$G(^(1)) Q:$P(NODE1,U,2)="H"
"RTN","GMPLX",105,0)
 . I TERM>1 S:+NODE1=TERM DA=IFN Q
"RTN","GMPLX",106,0)
 . S:TEXT=$$UP^XLFSTR($P(^AUTNPOV($P(NODE0,U,5),0),U)) DA=IFN
"RTN","GMPLX",107,0)
 Q DA
"RTN","GMPLX",108,0)
 ;
"RTN","GMPLX",109,0)
DUPLOK(IFN) ; Ask to Duplicate Problem
"RTN","GMPLX",110,0)
 N DIR,X,Y,GMPL0,GMPL1,DATE,PROV S DIR(0)="YA",GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1))
"RTN","GMPLX",111,0)
 S DIR("A")="Are you sure you want to continue? ",DIR("B")="NO"
"RTN","GMPLX",112,0)
 S DIR("?",1)="Enter YES if you want to duplicate this problem on this patient's list;",DIR("?")="press <return> to re-enter the problem name."
"RTN","GMPLX",113,0)
 W $C(7),!!,">>>  "_$$PROBTEXT(IFN),!?5,"is already an "
"RTN","GMPLX",114,0)
 W $S($P(GMPL0,U,12)="I":"IN",1:"")_"ACTIVE problem on this patient's list!",!
"RTN","GMPLX",115,0)
 S PROV=+$P(GMPL1,U,5) W:PROV !?5,"Provider: "_$P($G(^VA(200,PROV,0)),U)_" ("_$P($$SERVICE^GMPLX1(PROV),U,2)_")"
"RTN","GMPLX",116,0)
 I $P(GMPL0,U,12)="A" W !?8,"Onset: " S DATE=$P(GMPL0,U,13)
"RTN","GMPLX",117,0)
 I $P(GMPL0,U,12)="I" W !?5,"Resolved: " S DATE=$P(GMPL1,U,7)
"RTN","GMPLX",118,0)
 W $S(DATE>0:$$FMTE^XLFDT(DATE),1:"unspecified"),!
"RTN","GMPLX",119,0)
 D ^DIR W !
"RTN","GMPLX",120,0)
 Q +Y
"RTN","GMPLX",121,0)
 ;
"RTN","GMPLX",122,0)
LOCKED() ; Returns Message that Problem is Locked
"RTN","GMPLX",123,0)
 Q "This problem is currently being edited by another user!"
"RTN","GMPLX",124,0)
 ;
"RTN","GMPLX",125,0)
SURE() ; Ask to Delete 
"RTN","GMPLX",126,0)
 ;   Returns 1 if YES, else 0
"RTN","GMPLX",127,0)
 N DIR,X,Y S DIR(0)="YA",DIR("B")="NO"
"RTN","GMPLX",128,0)
 S DIR("?")="Enter YES to remove this value or NO to leave it unchanged."
"RTN","GMPLX",129,0)
 S DIR("A")="Are you sure you want to remove this value? " D ^DIR
"RTN","GMPLX",130,0)
 Q +Y
"RTN","GMPLX",131,0)
 ;
"RTN","GMPLX",132,0)
EXTDT(DATE) ; Formats Date into MM/DD/YY
"RTN","GMPLX",133,0)
 N X,MM,DD,YY,YYY S X="",DATE=$P(DATE,".") Q:'DATE ""
"RTN","GMPLX",134,0)
 S MM=+$E(DATE,4,5),DD=+$E(DATE,6,7),YY=$E(DATE,2,3),YYY=$E(DATE,1,3)
"RTN","GMPLX",135,0)
 S:MM X=MM_"/" S:DD X=X_DD_"/" S X=$S($L(X):X_YY,1:1700+YYY)
"RTN","GMPLX",136,0)
 Q X
"RTN","GMPLX",137,0)
 ;
"RTN","GMPLX",138,0)
AUDIT(DATA,OLD) ; Makes Entry in Audit File
"RTN","GMPLX",139,0)
 ;   DATA = string for 0-node
"RTN","GMPLX",140,0)
 ;   OLD  = string for 1-node
"RTN","GMPLX",141,0)
 ;        = 0-node from reform/react problem
"RTN","GMPLX",142,0)
 N DA,DD,DO,DIC,X,Y,DIK,DLAYGO
"RTN","GMPLX",143,0)
 S DIC="^GMPL(125.8,",DIC(0)="L",X=$P(DATA,U),DLAYGO=125.8
"RTN","GMPLX",144,0)
 D FILE^DICN Q:+Y'>0  S DA=+Y,DIK="^GMPL(125.8,"
"RTN","GMPLX",145,0)
 S ^GMPL(125.8,DA,0)=DATA D IX1^DIK
"RTN","GMPLX",146,0)
 S:$L(OLD) ^GMPL(125.8,DA,1)=OLD
"RTN","GMPLX",147,0)
 Q
"RTN","GMPLX",148,0)
 ;
"RTN","GMPLX",149,0)
DTMOD(DA) ; Update Date Last Modified
"RTN","GMPLX",150,0)
 S $P(^AUPNPROB(DA,0),U,3)=DT S DIK="^AUPNPROB(",DIK(1)=.03 D EN^DIK K DIK
"RTN","GMPLX",151,0)
 Q
"RTN","GMPLX",152,0)
 ;
"RTN","GMPLX",153,0)
MSG() ; List Manager Message Bar
"RTN","GMPLX",154,0)
 Q "+ Next Screen  - Prev Screen  ?? More actions"
"RTN","GMPLX",155,0)
 ;
"RTN","GMPLX",156,0)
KILL ; Clean-Up Variables
"RTN","GMPLX",157,0)
 K X,Y,DIC,DIE,DR,DA,DUOUT,DTOUT,GMPQUIT,GMPRT,GMPSAVED,GMPIFN,GMPLNO,GMPLNUM,GMPLSEL,GMPREBLD,GMPI,GMPLSLST,GMPLJUMP
"RTN","GMPLX",158,0)
 Q
"RTN","GMPLX",159,0)
 ;
"RTN","GMPLX",160,0)
CODESTS(PROB,ADATE) ;check status of code associated with a problem
"RTN","GMPLX",161,0)
 ; Input:
"RTN","GMPLX",162,0)
 ;    PROB  = pointer to the PROBLEM (#9000011) file
"RTN","GMPLX",163,0)
 ;    ADATE = FM date on which to check the status of ICD9 code  (opt.) 
"RTN","GMPLX",164,0)
 ;
"RTN","GMPLX",165,0)
 ; Output:
"RTN","GMPLX",166,0)
 ;   1  = ACTIVE on the date passed or current date if not passed
"RTN","GMPLX",167,0)
 ;   0  = INACTIVE on the date passed or current date if not passed
"RTN","GMPLX",168,0)
 ;
"RTN","GMPLX",169,0)
 I '$G(ADATE) S ADATE=DT
"RTN","GMPLX",170,0)
 I '$D(^AUPNPROB(PROB,0)) Q 0
"RTN","GMPLX",171,0)
 S PROB=$P(^AUPNPROB(PROB,0),U)
"RTN","GMPLX",172,0)
 Q +($$STATCHK^ICDAPIU($$CODEC^ICDCODE(+(PROB)),ADATE))
"VER")
8.0^22.0
**INSTALL NAME**
OR*3.0*181
"BLD",4239,0)
OR*3.0*181^ORDER ENTRY/RESULTS REPORTING^0^3030731^y
"BLD",4239,1,0)
^^2^2^3030421^
"BLD",4239,1,1,0)
Please see the National Patch Module for details of the enhancements 
"BLD",4239,1,2,0)
included in this patch.
"BLD",4239,4,0)
^9.64PA^^
"BLD",4239,"KRN",0)
^9.67PA^8989.52^19
"BLD",4239,"KRN",.4,0)
.4
"BLD",4239,"KRN",.401,0)
.401
"BLD",4239,"KRN",.402,0)
.402
"BLD",4239,"KRN",.403,0)
.403
"BLD",4239,"KRN",.5,0)
.5
"BLD",4239,"KRN",.84,0)
.84
"BLD",4239,"KRN",3.6,0)
3.6
"BLD",4239,"KRN",3.8,0)
3.8
"BLD",4239,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",4239,"KRN",3.8,"NM",1,0)
ORCM CSV EVENT^^0
"BLD",4239,"KRN",3.8,"NM","B","ORCM CSV EVENT",1)

"BLD",4239,"KRN",9.2,0)
9.2
"BLD",4239,"KRN",9.8,0)
9.8
"BLD",4239,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",4239,"KRN",9.8,"NM",1,0)
ORCDGMRC^^0^B39851331
"BLD",4239,"KRN",9.8,"NM",2,0)
ORCMGMCK^^0^B37075731
"BLD",4239,"KRN",9.8,"NM",3,0)
ORCHART^^0^B71486852
"BLD",4239,"KRN",9.8,"NM",4,0)
ORCHTAB2^^0^B22410347
"BLD",4239,"KRN",9.8,"NM",5,0)
ORCPROB^^0^B26200127
"BLD",4239,"KRN",9.8,"NM","B","ORCDGMRC",1)

"BLD",4239,"KRN",9.8,"NM","B","ORCHART",3)

"BLD",4239,"KRN",9.8,"NM","B","ORCHTAB2",4)

"BLD",4239,"KRN",9.8,"NM","B","ORCMGMCK",2)

"BLD",4239,"KRN",9.8,"NM","B","ORCPROB",5)

"BLD",4239,"KRN",19,0)
19
"BLD",4239,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",4239,"KRN",19,"NM",1,0)
ORCM GMRC CSV CHECK^^0
"BLD",4239,"KRN",19,"NM",2,0)
ORCM MGMT^^2
"BLD",4239,"KRN",19,"NM","B","ORCM GMRC CSV CHECK",1)

"BLD",4239,"KRN",19,"NM","B","ORCM MGMT",2)

"BLD",4239,"KRN",19.1,0)
19.1
"BLD",4239,"KRN",101,0)
101
"BLD",4239,"KRN",101,"NM",0)
^9.68A^2^2
"BLD",4239,"KRN",101,"NM",1,0)
ORCM GMRC CSV EVENT^^0
"BLD",4239,"KRN",101,"NM",2,0)
ICD CODE UPDATE EVENT^^2
"BLD",4239,"KRN",101,"NM","B","ICD CODE UPDATE EVENT",2)

"BLD",4239,"KRN",101,"NM","B","ORCM GMRC CSV EVENT",1)

"BLD",4239,"KRN",409.61,0)
409.61
"BLD",4239,"KRN",409.61,"NM",0)
^9.68A^^
"BLD",4239,"KRN",771,0)
771
"BLD",4239,"KRN",870,0)
870
"BLD",4239,"KRN",8989.51,0)
8989.51
"BLD",4239,"KRN",8989.52,0)
8989.52
"BLD",4239,"KRN",8994,0)
8994
"BLD",4239,"KRN","B",.4,.4)

"BLD",4239,"KRN","B",.401,.401)

"BLD",4239,"KRN","B",.402,.402)

"BLD",4239,"KRN","B",.403,.403)

"BLD",4239,"KRN","B",.5,.5)

"BLD",4239,"KRN","B",.84,.84)

"BLD",4239,"KRN","B",3.6,3.6)

"BLD",4239,"KRN","B",3.8,3.8)

"BLD",4239,"KRN","B",9.2,9.2)

"BLD",4239,"KRN","B",9.8,9.8)

"BLD",4239,"KRN","B",19,19)

"BLD",4239,"KRN","B",19.1,19.1)

"BLD",4239,"KRN","B",101,101)

"BLD",4239,"KRN","B",409.61,409.61)

"BLD",4239,"KRN","B",771,771)

"BLD",4239,"KRN","B",870,870)

"BLD",4239,"KRN","B",8989.51,8989.51)

"BLD",4239,"KRN","B",8989.52,8989.52)

"BLD",4239,"KRN","B",8994,8994)

"BLD",4239,"QUES",0)
^9.62^^
"BLD",4239,"REQB",0)
^9.611^6^6
"BLD",4239,"REQB",1,0)
GMPL*2.0*28^2
"BLD",4239,"REQB",2,0)
OR*3.0*100^2
"BLD",4239,"REQB",3,0)
LEX*2.0*25^2
"BLD",4239,"REQB",4,0)
OR*3.0*141^2
"BLD",4239,"REQB",5,0)
OR*3.0*58^2
"BLD",4239,"REQB",6,0)
OR*3.0*48^2
"BLD",4239,"REQB","B","GMPL*2.0*28",1)

"BLD",4239,"REQB","B","LEX*2.0*25",3)

"BLD",4239,"REQB","B","OR*3.0*100",2)

"BLD",4239,"REQB","B","OR*3.0*141",4)

"BLD",4239,"REQB","B","OR*3.0*48",6)

"BLD",4239,"REQB","B","OR*3.0*58",5)

"KRN",3.8,141,-1)
0^1
"KRN",3.8,141,0)
ORCM CSV EVENT^PU^n^^^^
"KRN",3.8,141,2,0)
^3.801^3^3^3030326^^
"KRN",3.8,141,2,1,0)
This mail group will be used to define the recipients of a mail message 
"KRN",3.8,141,2,2,0)
containing a list of quick orders from the ORDER DIALOG (#101.41) file 
"KRN",3.8,141,2,3,0)
that are affected by an ICD-9 code set version installation.
"KRN",3.8,141,3)

"KRN",19,6550,-1)
2^2
"KRN",19,6550,0)
ORCM MGMT^Order Menu Management^^M^10
"KRN",19,6550,10,0)
^19.01IP^14^14
"KRN",19,6550,10,14,0)
9143^CS^50
"KRN",19,6550,10,14,"^")
ORCM GMRC CSV CHECK
"KRN",19,6550,"U")
ORDER MENU MANAGEMENT
"KRN",19,9143,-1)
0^1
"KRN",19,9143,0)
ORCM GMRC CSV CHECK^Review Quick Orders for Inactive ICD9 Codes^^R^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",19,9143,1,0)
^^3^3^3030311^
"KRN",19,9143,1,1,0)
This option may be run at any time to produce a report of Consult or 
"KRN",19,9143,1,2,0)
Procedure quick orders that have a provisional diagnosis code that 
"KRN",19,9143,1,3,0)
has been inactivated or will be inactivated in the future.
"KRN",19,9143,25)
CSVOPT^ORCMGMCK
"KRN",19,9143,"U")
REVIEW QUICK ORDERS FOR INACTI
"KRN",101,6305,-1)
0^1
"KRN",101,6305,0)
ORCM GMRC CSV EVENT^Quick order code set version event^^A^^^^^^^^ORDER ENTRY/RESULTS REPORTING
"KRN",101,6305,1,0)
^^5^5^3030311^
"KRN",101,6305,1,1,0)
This protocol will be invoked by the ICD event protocol upon installation 
"KRN",101,6305,1,2,0)
of a new code set version. The protocol will be responsible for 
"KRN",101,6305,1,3,0)
generating a mail message to a mail group containing any consult or 
"KRN",101,6305,1,4,0)
procedure quick orders that have provisional diagnoses with inactive IDC9 
"KRN",101,6305,1,5,0)
codes or codes that will be inactivated in the future.
"KRN",101,6305,20)
D CSVPEP^ORCMGMCK
"KRN",101,6305,99)
59239,49834
"KRN",101,6367,-1)
2^2
"KRN",101,6367,0)
ICD CODE UPDATE EVENT^ICD Code Update^^X^1118^^^^^^^
"KRN",101,6367,10,0)
^101.01PA^2^2
"KRN",101,6367,10,1,0)
6305^^^
"KRN",101,6367,10,1,"^")
ORCM GMRC CSV EVENT
"MBREQ")
1
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",110,-1)
1^1
"PKG",110,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",110,20,0)
^9.402P^^
"PKG",110,22,0)
^9.49I^1^1
"PKG",110,22,1,0)
3.0^2971217
"PKG",110,22,1,"PAH",1,0)
181^3030731
"PKG",110,22,1,"PAH",1,1,0)
^^2^2^3030731
"PKG",110,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements 
"PKG",110,22,1,"PAH",1,1,2,0)
included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","ORCDGMRC")
0^1^B39851331
"RTN","ORCDGMRC",1,0)
ORCDGMRC ;SLC/MKB-Utility functions for GMRC dialogs ;3/10/03  07:34
"RTN","ORCDGMRC",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**4,26,68,100,181**;Dec 17, 1997
"RTN","ORCDGMRC",3,0)
 ; External References
"RTN","ORCDGMRC",4,0)
 ;    DBIA 10006 Call to ^DIC
"RTN","ORCDGMRC",5,0)
 ;    DBIA 10026 Call to ^DIR
"RTN","ORCDGMRC",6,0)
 ;    DBIA  2426 Call to SERV1^GMRCASV
"RTN","ORCDGMRC",7,0)
 ;    DBIA  3119 Call to GETDEF^GMRCDRFR
"RTN","ORCDGMRC",8,0)
 ;    DBIA  2982 Call to GETSVC^GMRCPR0
"RTN","ORCDGMRC",9,0)
 ;    DBIA  3121 Call to APIs $$PROVDX and PREREQ in routine ^GMRCUTL1
"RTN","ORCDGMRC",10,0)
 ;    DBIA  1609 Call to CONFIG^LEXSET
"RTN","ORCDGMRC",11,0)
 ;    DBIA 10104 Call to APIs $$RJ and $$UP in routine ^XLFSTR
"RTN","ORCDGMRC",12,0)
 ;    DBIA 10102 Call to DISP^XQORM1
"RTN","ORCDGMRC",13,0)
 ;    DBIA  3991 Call to $$STATCHK^ICDAPIU
"RTN","ORCDGMRC",14,0)
URGENCY(TYPE) ; -- Returns index of allowable urgencies from file #101.42
"RTN","ORCDGMRC",15,0)
 N X S X=$S($$VAL^ORCD("CATEGORY")'="I":"O",TYPE="C":"T",1:"R")
"RTN","ORCDGMRC",16,0)
 S ORDIALOG(PROMPT,"D")="S.GMRC"_X
"RTN","ORCDGMRC",17,0)
 Q
"RTN","ORCDGMRC",18,0)
 ;
"RTN","ORCDGMRC",19,0)
PLACE ; -- Returns list of allowable places of consultation
"RTN","ORCDGMRC",20,0)
 Q:$D(ORDIALOG(PROMPT,"LIST"))  N CHOICES,I,J,INPT,X
"RTN","ORCDGMRC",21,0)
 S INPT=($$VAL^ORCD("CATEGORY")="I")
"RTN","ORCDGMRC",22,0)
 I INPT S CHOICES="B^Bedside;C^Consultant's Choice"
"RTN","ORCDGMRC",23,0)
 I 'INPT S CHOICES="E^Emergency Room;C^Consultant's Choice"
"RTN","ORCDGMRC",24,0)
 S I=0 F J=1:1:$L(CHOICES,";") S X=$P(CHOICES,";",J) D
"RTN","ORCDGMRC",25,0)
 . S I=I+1,ORDIALOG(PROMPT,"LIST",I)=X
"RTN","ORCDGMRC",26,0)
 . S ORDIALOG(PROMPT,"LIST","B",$$UP^XLFSTR($P(X,U,2)))=$P(X,U)
"RTN","ORCDGMRC",27,0)
 S ORDIALOG(PROMPT,"LIST")=I_"^1"
"RTN","ORCDGMRC",28,0)
 Q
"RTN","ORCDGMRC",29,0)
 ;
"RTN","ORCDGMRC",30,0)
CHANGED(PRMT) ; -- Kill lists for Request Service or Place of Consultation
"RTN","ORCDGMRC",31,0)
 N I,P
"RTN","ORCDGMRC",32,0)
 S I=$S(PRMT="OI":"REQUEST SERVICE",1:"PLACE OF CONSULTATION")
"RTN","ORCDGMRC",33,0)
 S P=$$PTR^ORCD("OR GTX "_I) Q:'P
"RTN","ORCDGMRC",34,0)
 K ORDIALOG(P,"LIST"),ORDIALOG(P,1)
"RTN","ORCDGMRC",35,0)
 Q
"RTN","ORCDGMRC",36,0)
 ;
"RTN","ORCDGMRC",37,0)
GETSERV ; -- Get list of orderable services
"RTN","ORCDGMRC",38,0)
 N GMRCTO,GMRCDG,I,X K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","ORCDGMRC",39,0)
 S (GMRCTO,GMRCDG)=1 D SERV1^GMRCASV ; get list of orderable services
"RTN","ORCDGMRC",40,0)
 F I=1:1 S X=+$G(^TMP("GMRCSLIST",$J,I)) Q:X'>0  S $P(^TMP("GMRCS",$J,X),U,2)=I
"RTN","ORCDGMRC",41,0)
 Q
"RTN","ORCDGMRC",42,0)
 ;
"RTN","ORCDGMRC",43,0)
LISTSERV(ORI) ; -- List Consult services from ORSERV
"RTN","ORCDGMRC",44,0)
 N ORSTK,ORCNT,ORX,ORQ
"RTN","ORCDGMRC",45,0)
 W !,"Choose from:" S:$G(ORI)'>0 ORI=1
"RTN","ORCDGMRC",46,0)
 S (ORSTK,ORQ)=0,ORCNT=1,ORSTK(0)=$P(^TMP("GMRCSLIST",$J,ORI),U,3)
"RTN","ORCDGMRC",47,0)
 F  S ORX=$G(^TMP("GMRCSLIST",$J,ORI)) Q:ORX=""  D  Q:ORQ  S ORI=ORI+1
"RTN","ORCDGMRC",48,0)
 . I $P(ORX,U,3)'=+$G(ORSTK(ORSTK)) D POP I ORSTK'>0 S ORQ=1 Q
"RTN","ORCDGMRC",49,0)
 . S ORCNT=ORCNT+1 I ORCNT>(IOSL-6) S:'$$CONT ORQ=1 Q:$G(ORQ)  S ORCNT=1
"RTN","ORCDGMRC",50,0)
 . W !,?((ORSTK*2)),$P(ORX,U,2)
"RTN","ORCDGMRC",51,0)
 . W:$P(ORX,U,5) "  ("_$S($P(ORX,U,5)=1:"Grouper",1:"Tracking")_" Only)"
"RTN","ORCDGMRC",52,0)
 . I $P(ORX,U,4)="+" S ORSTK=ORSTK+1,ORSTK(ORSTK)=+ORX
"RTN","ORCDGMRC",53,0)
 Q
"RTN","ORCDGMRC",54,0)
 ;
"RTN","ORCDGMRC",55,0)
POP ; -- pop stack
"RTN","ORCDGMRC",56,0)
 S ORSTK=ORSTK-1 Q:ORSTK'>0
"RTN","ORCDGMRC",57,0)
 I ORSTK(ORSTK)'=$P(ORX,U,3) G POP
"RTN","ORCDGMRC",58,0)
 Q
"RTN","ORCDGMRC",59,0)
 ;
"RTN","ORCDGMRC",60,0)
CONT() ; -- continue?
"RTN","ORCDGMRC",61,0)
 N X,Y,DIR S DIR(0)="E" D ^DIR
"RTN","ORCDGMRC",62,0)
 Q +Y
"RTN","ORCDGMRC",63,0)
 ;
"RTN","ORCDGMRC",64,0)
CKSERV ; -- Ck service usage in Post-Selection Action
"RTN","ORCDGMRC",65,0)
 N GMRCI,ORI
"RTN","ORCDGMRC",66,0)
 S GMRCI=+$P(^ORD(101.43,+Y,0),U,2)
"RTN","ORCDGMRC",67,0)
 S ORI=+$P($G(^TMP("GMRCS",$J,GMRCI)),U,2) S:ORI'>0 ORI=1
"RTN","ORCDGMRC",68,0)
 I $P($G(^TMP("GMRCSLIST",$J,ORI)),U,5)=1 D LISTSERV^ORCDGMRC(ORI) K DONE
"RTN","ORCDGMRC",69,0)
 Q
"RTN","ORCDGMRC",70,0)
 ;
"RTN","ORCDGMRC",71,0)
PROCSVC ; -- Get list of services for procedure
"RTN","ORCDGMRC",72,0)
 Q:$D(ORDIALOG(PROMPT,"LIST"))  Q:'$L($T(GETSVC^GMRCPR0))
"RTN","ORCDGMRC",73,0)
 N OI,PROTCL,ORY,ORI,X
"RTN","ORCDGMRC",74,0)
 S OI=+$$VAL^ORCD("PROCEDURE"),PROTCL=$P($G(^ORD(101.43,OI,0)),U,2) ;ID
"RTN","ORCDGMRC",75,0)
 D:PROTCL GETSVC^GMRCPR0(.ORY,PROTCL)
"RTN","ORCDGMRC",76,0)
 I $G(ORY)'>0 W $C(7),!,"There are no services defined for this procedure!" H 1 S ORQUIT=1 Q
"RTN","ORCDGMRC",77,0)
 M ORDIALOG(PROMPT,"LIST")=ORY S $P(ORDIALOG(PROMPT,"LIST"),U,2)=1
"RTN","ORCDGMRC",78,0)
 S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  S X=$P(ORY(ORI),U,2),ORDIALOG(PROMPT,"LIST","B",X)=+ORY(ORI)
"RTN","ORCDGMRC",79,0)
 Q
"RTN","ORCDGMRC",80,0)
 ;
"RTN","ORCDGMRC",81,0)
CKPROCSV ; -- Make sure procedure has at least one service
"RTN","ORCDGMRC",82,0)
 N PROT,ORY S PROT=$P($G(^ORD(101.43,+Y,0)),U,2)
"RTN","ORCDGMRC",83,0)
 D GETSVC^GMRCPR0(.ORY,PROT) I $G(ORY)'>0 W $C(7),!,"There are no services defined for this procedure!",! K DONE
"RTN","ORCDGMRC",84,0)
 Q
"RTN","ORCDGMRC",85,0)
 ;
"RTN","ORCDGMRC",86,0)
NWHELP ; -- help code for NW action
"RTN","ORCDGMRC",87,0)
 N X
"RTN","ORCDGMRC",88,0)
 W !!,"Select the type of request you wish to enter, either a consult to a service",!,"or a procedure that may be ordered without a formal consult."
"RTN","ORCDGMRC",89,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCDGMRC",90,0)
 S X="?" D DISP^XQORM1 W !
"RTN","ORCDGMRC",91,0)
 Q
"RTN","ORCDGMRC",92,0)
 ;
"RTN","ORCDGMRC",93,0)
REASON ; -- Get default Reason for Request text for Service
"RTN","ORCDGMRC",94,0)
 N ORIT,ORSERV,OROOT
"RTN","ORCDGMRC",95,0)
 S ORIT=$G(ORDIALOG($$PTR^ORCD("OR GTX ORDERABLE ITEM"),1))
"RTN","ORCDGMRC",96,0)
 S ORSERV=$P($G(^ORD(101.43,+ORIT,0)),U,2) Q:'ORSERV!(ORSERV["99PRO")
"RTN","ORCDGMRC",97,0)
 S OROOT=$NA(^TMP("ORWORD",$J,PROMPT,INST)) D
"RTN","ORCDGMRC",98,0)
 . N PROMPT,INST,X,Y,DIR,ACTION,REQD,MULT,ITEM,COND ;protect var's
"RTN","ORCDGMRC",99,0)
 . D GETDEF^GMRCDRFR(OROOT,ORSERV,+$G(ORVP),$S($G(ORVP):1,1:0))
"RTN","ORCDGMRC",100,0)
 S:$D(^TMP("ORWORD",$J,PROMPT,INST)) Y=OROOT
"RTN","ORCDGMRC",101,0)
 Q
"RTN","ORCDGMRC",102,0)
 ;
"RTN","ORCDGMRC",103,0)
ENPDX ; -- setup Prov Dx field
"RTN","ORCDGMRC",104,0)
 N CODE
"RTN","ORCDGMRC",105,0)
 S ORPDX=$$PROVDX^GMRCUTL1($S($D(ORPROC):ORPROC,1:$G(ORSERV)))
"RTN","ORCDGMRC",106,0)
 S CODE=$$PTR^ORCD("OR GTX CODE")
"RTN","ORCDGMRC",107,0)
 I $P(ORPDX,U)="S" K ORDIALOG(PROMPT,INST),ORDIALOG(CODE,INST) S COND="I 0" Q
"RTN","ORCDGMRC",108,0)
 S:$G(ORTYPE)'="Z" REQD=$S($P(ORPDX,U)="R":1,1:0)
"RTN","ORCDGMRC",109,0)
 K:$P(ORPDX,U,2)'="L" ORDIALOG(CODE,INST)
"RTN","ORCDGMRC",110,0)
 I $P(ORPDX,U,2)="L" S ORDIALOG(PROMPT,"?")="Select a preliminary diagnosis from the Lexicon, as text or an ICD code." K:'$L($G(ORDIALOG(CODE,INST))) ORDIALOG(PROMPT,INST)
"RTN","ORCDGMRC",111,0)
 I $L($G(ORDIALOG(CODE,INST))),'$$STATCHK^ICDAPIU(ORDIALOG(CODE,INST),DT)  D  ;csv
"RTN","ORCDGMRC",112,0)
 . D EN^DDIOL("The existing diagnosis is associated with an inactive ICD-9 code.")
"RTN","ORCDGMRC",113,0)
 . I $G(REQD) D EN^DDIOL("Another code must be selected before proceeding.")
"RTN","ORCDGMRC",114,0)
 . I '$G(REQD) D EN^DDIOL("If another code is not selected, no code will be saved with the new order.")
"RTN","ORCDGMRC",115,0)
 . D EN^DDIOL(" ")
"RTN","ORCDGMRC",116,0)
 . K ORDIALOG(PROMPT,INST),ORDIALOG(CODE,INST)
"RTN","ORCDGMRC",117,0)
 . S ACTION=$G(ACTION)_"W"
"RTN","ORCDGMRC",118,0)
 Q
"RTN","ORCDGMRC",119,0)
 ;
"RTN","ORCDGMRC",120,0)
LEX ; -- search Lexicon for Prov Dx
"RTN","ORCDGMRC",121,0)
 I $L($G(ORESET)),ORESET=Y Q  ;no change
"RTN","ORCDGMRC",122,0)
 I Y?1." " K DONE W !!,$C(7),"Use of only spaces not allowed!",! Q
"RTN","ORCDGMRC",123,0)
 Q:$P(ORPDX,U,2)'="L"  ;free text only, no ICD code
"RTN","ORCDGMRC",124,0)
 N DIC,DUOUT,DTOUT
"RTN","ORCDGMRC",125,0)
 D CONFIG^LEXSET("ICD","ICD",DT)
"RTN","ORCDGMRC",126,0)
 S DIC="^LEX(757.01,",DIC(0)="EQM",DIC("A")="Provisional Diagnosis: "
"RTN","ORCDGMRC",127,0)
 S:$L($G(ORESET)) DIC("B")=ORESET
"RTN","ORCDGMRC",128,0)
 D ^DIC I Y'>0 D  Q
"RTN","ORCDGMRC",129,0)
 . I $L($G(ORESET)) S ORDIALOG(PROMPT,ORI)=ORESET
"RTN","ORCDGMRC",130,0)
 . E  K ORDIALOG(PROMPT,ORI)
"RTN","ORCDGMRC",131,0)
 . I $D(DTOUT)!$D(DUOUT) S ORQUIT=1 Q
"RTN","ORCDGMRC",132,0)
 . I REQD,'$D(ORDIALOG(PROMPT,ORI)) K DONE W !!,$C(7),$$REQUIRED^ORCDLG1,!
"RTN","ORCDGMRC",133,0)
 S ORDIALOG(PROMPT,ORI)=$P(Y,U,2)
"RTN","ORCDGMRC",134,0)
 S ORDIALOG($$PTR^ORCD("OR GTX CODE"),ORI)=$G(Y(1)) K Y(1)
"RTN","ORCDGMRC",135,0)
 Q
"RTN","ORCDGMRC",136,0)
 ;
"RTN","ORCDGMRC",137,0)
SERVMSG ; -- Get, display text message for service ORSERV
"RTN","ORCDGMRC",138,0)
 Q:'$G(ORSERV)&('$G(ORPROC))  Q:'FIRST  ;show first time only
"RTN","ORCDGMRC",139,0)
 N ORTXT,I,CNT,HDR S HDR=$S($G(ORMENU):5,1:7)
"RTN","ORCDGMRC",140,0)
 D PREREQ^GMRCUTL1("ORTXT",$S($D(ORPROC):ORPROC,1:ORSERV),+ORVP)
"RTN","ORCDGMRC",141,0)
 Q:'$D(ORTXT)
"RTN","ORCDGMRC",142,0)
 I $D(ORPROC) W !!,$$RJ^XLFSTR("** Procedure Pre-requisite **",57)
"RTN","ORCDGMRC",143,0)
 E  W !!,$$RJ^XLFSTR("** Consult Service Pre-requisite **",57)
"RTN","ORCDGMRC",144,0)
 S (I,CNT)=0 F  S I=$O(ORTXT(I)) Q:I'>0  D  Q:$G(ORQUIT)
"RTN","ORCDGMRC",145,0)
 . S CNT=CNT+1 I CNT>(IOSL-HDR) S CNT=0 I '$$CONT S ORQUIT=1 Q
"RTN","ORCDGMRC",146,0)
 . W !,ORTXT(I,0)
"RTN","ORCDGMRC",147,0)
 Q:$G(ORQUIT)  S:'$$CONT ORQUIT=1 W !
"RTN","ORCDGMRC",148,0)
 Q
"RTN","ORCHART")
0^3^B71486852
"RTN","ORCHART",1,0)
ORCHART ;SLC/MKB/REV-OE/RR ; 11 March 2003 14:02
"RTN","ORCHART",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**7,27,48,70,72,92,141,181**;Dec 17, 1997
"RTN","ORCHART",3,0)
EN ; -- main entry point
"RTN","ORCHART",4,0)
 K ^TMP("OR",$J) ;ensure fresh start
"RTN","ORCHART",5,0)
 D EN^ORQPT Q:+$G(ORVP)'>0
"RTN","ORCHART",6,0)
 D EN^VALM("OR CHART") G:'$G(OREXIT) EN
"RTN","ORCHART",7,0)
 K OREXIT
"RTN","ORCHART",8,0)
 Q
"RTN","ORCHART",9,0)
 ;
"RTN","ORCHART",10,0)
INIT ; -- init variables and list array
"RTN","ORCHART",11,0)
 S:'$D(ORTAB) ORTAB=$$UP^XLFSTR($$GET^XPAR("ALL","ORCH INITIAL TAB",1,"E"))
"RTN","ORCHART",12,0)
 S:ORTAB="DCSUMM" ORTAB="SUMMRIES" S:'$L(ORTAB) ORTAB="COVER"
"RTN","ORCHART",13,0)
 S ORACTION=0 D TAB(ORTAB)
"RTN","ORCHART",14,0)
 Q
"RTN","ORCHART",15,0)
 ;
"RTN","ORCHART",16,0)
PHDR ; -- protocol header code
"RTN","ORCHART",17,0)
 N ORM,ORI,ORS,ORSYN K ORNMBR,OREBUILD
"RTN","ORCHART",18,0)
 S:$G(ORTAB)'="LABS" VALMSG=$$MSG D SHOW^VALM
"RTN","ORCHART",19,0)
 S:XQORM("B")="Quit" XQORM("B")=$S('$G(DGPMT):"Chart Contents",1:"Close Patient Chart")
"RTN","ORCHART",20,0)
 S:$G(^TMP("OR",$J,"CURRENT","#")) XQORM("#")=^("#")
"RTN","ORCHART",21,0)
 S ORM=$S(ORTAB="CONSULTS":+$O(^ORD(101,"B","ORC CONSULT SERVICE MENU",0)),1:+$G(XQORM("#"))),ORI=0 ;set XQORM("KEY",<synonym>)
"RTN","ORCHART",22,0)
 F  S ORI=$O(^ORD(101,ORM,10,"B",ORI)) Q:ORI'>0  I $D(^ORD(101,+ORI,2)) D
"RTN","ORCHART",23,0)
 . S ORS=0 F  S ORS=$O(^ORD(101,+ORI,2,ORS)) Q:ORS'>0  S ORSYN=$G(^(ORS,0)) S:$L(ORSYN) XQORM("KEY",ORSYN)=+ORI_"^1"
"RTN","ORCHART",24,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","ORC EXIT",0))_"^1"
"RTN","ORCHART",25,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","ORC NEXT SCREEN",0))_"^1"
"RTN","ORCHART",26,0)
 S XQORM("KEY","PL")=$O(^ORD(101,"B","ORC PRINT LIST",0))_"^1"
"RTN","ORCHART",27,0)
 Q
"RTN","ORCHART",28,0)
 ;
"RTN","ORCHART",29,0)
HDR ; -- header code
"RTN","ORCHART",30,0)
 ;    Expects ORPNM, ORSSN, ORL, ORDOB, ORAGE [, ORPD]
"RTN","ORCHART",31,0)
 ;    N DFN S DFN=+ORVP D SLCT1^ORQPT if any are missing ??
"RTN","ORCHART",32,0)
 N ORX,ORX1,ORX2,ORX3,ORCWAD,L,SP K VALMHDR
"RTN","ORCHART",33,0)
 S ORX1=$P($G(^DPT(+ORVP,0)),U,3),ORX3=$$FMTE^XLFDT(ORX1,2)_"("_ORAGE_")"
"RTN","ORCHART",34,0)
 S ORX2="" I +$G(ORL) D  S:$L($G(ORL(1))) ORX2=ORX2_"/"_ORL(1)
"RTN","ORCHART",35,0)
 . S L=$G(^SC(+ORL,0)),ORX2=$P(L,U,2)
"RTN","ORCHART",36,0)
 . S:'$L(ORX2) ORX2=$E($P(L,U),1,4)
"RTN","ORCHART",37,0)
 S L=80-$L(ORPNM)-$L(ORSSN)-$L(ORX2)-$L(ORX3),SP=$$REPEAT^XLFSTR(" ",L\3)
"RTN","ORCHART",38,0)
 S ORX1=ORPNM_SP_ORSSN_SP_ORX2,VALMHDR(1)=ORX1_$J(ORX3,80-$L(ORX1))
"RTN","ORCHART",39,0)
 S ORX1=$S(ORATTEND:"Attend: "_$$LNAMEF^ORCHTAB(ORATTEND),1:"")
"RTN","ORCHART",40,0)
 S ORX2="PrimCare: "_$$LNAMEF^ORCHTAB(+$$OUTPTPR^SDUTL3(+ORVP))
"RTN","ORCHART",41,0)
 S ORX3="PCTeam: "_$P($$OUTPTTM^SDUTL3(+ORVP),U,2)
"RTN","ORCHART",42,0)
 S ORX=$S($L(ORX1):$$LJ^XLFSTR(ORX1,20),1:"")_ORX2,VALMHDR(2)=$$LJ^XLFSTR(ORX,42)_ORX3
"RTN","ORCHART",43,0)
 S ORCWAD=$$CWAD^ORQPT2(+ORVP) S:ORCWAD]"" ORCWAD="<"_ORCWAD_">"
"RTN","ORCHART",44,0)
 S ORX=$S($G(ORTAB)="COVER":"",$G(ORTAB)="REPORTS":"",1:$$VIEW),VALMHDR(3)=ORX_$J(ORCWAD,80-$L(ORX))
"RTN","ORCHART",45,0)
 Q
"RTN","ORCHART",46,0)
 ;
"RTN","ORCHART",47,0)
MSG() ; -- LMgr message bar
"RTN","ORCHART",48,0)
 Q "Enter the numbers of the items you wish to act on."
"RTN","ORCHART",49,0)
 ;
"RTN","ORCHART",50,0)
HELP ; -- help code
"RTN","ORCHART",51,0)
 N X,DX,DY D FULL^VALM1
"RTN","ORCHART",52,0)
 W !!,"Enter the display numbers of the items you wish to change or act on; a menu of",!,"available actions will then be presented for selection."
"RTN","ORCHART",53,0)
 W !!,"To see a different 'page' of the chart, enter CC; if you'd like another view of",!,"the current page, by date range for example, enter CV.  You may add new orders"
"RTN","ORCHART",54,0)
 W !,"for this patient from any page in the chart by entering AD and review them",!,"using RV.  Enter ?? to see a list of actions available for navigating the list."
"RTN","ORCHART",55,0)
 W:ORTAB="PROBLEMS" !!,"* = Acute problem",!,"$ = Unverified problem",!,"# = Problem references inactive code"
"RTN","ORCHART",56,0)
 W:(ORTAB="SUMMRIES")!(ORTAB="NOTES") !!,"+ = Addenda attached"
"RTN","ORCHART",57,0)
 W:(ORTAB="ORDERS")!(ORTAB="MEDS") !!,"* = Order has been updated by service"
"RTN","ORCHART",58,0)
 W:ORTAB="ORDERS" !,"+ = Sub-orders exist"
"RTN","ORCHART",59,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCHART",60,0)
 S VALMBCK="R" S:$G(ORTAB)'="LABS" VALMSG=$$MSG
"RTN","ORCHART",61,0)
 S (DX,DY)=0 X ^%ZOSF("XY")
"RTN","ORCHART",62,0)
 Q
"RTN","ORCHART",63,0)
 ;
"RTN","ORCHART",64,0)
ITEMHELP ; -- help code for action menus
"RTN","ORCHART",65,0)
 N X
"RTN","ORCHART",66,0)
 W !!,"Enter the action you wish to take on the items selected and highlighted",!,"above; each item will be processed in order, one at a time."
"RTN","ORCHART",67,0)
 W !!,"Press <return> to continue ..." R X:DTIME
"RTN","ORCHART",68,0)
 S X="?" D DISP^XQORM1 W !
"RTN","ORCHART",69,0)
 Q
"RTN","ORCHART",70,0)
 ;
"RTN","ORCHART",71,0)
EXIT ; -- exit code
"RTN","ORCHART",72,0)
 I $G(ORVP),$$MORE^ORCMENU2 D  ;unsig orders
"RTN","ORCHART",73,0)
 . ;I '$D(^TMP("ORNEW",$J)),'$D(^XUSEC("ORES",DUZ)) Q  ;msg like 2.5??
"RTN","ORCHART",74,0)
 . W !!,"You have new or unsigned orders for this patient!" H 1
"RTN","ORCHART",75,0)
 . S ORRV=1 D EN1^ORCMENU2,NOTIF^ORCMENU2 ;sign, notif if not all signed
"RTN","ORCHART",76,0)
 D UNLOCK^ORX2(+ORVP) K ^TMP("OR",$J),^TMP("ORNEW",$J),^TMP("LRRR",$J)
"RTN","ORCHART",77,0)
 K VALMCNT,VALMHDR,VALMBG,ORQUIT,ORVP,ORSEX,ORTAB,ORPNM,ORSSN,ORL,ORDOB,ORAGE,ORPD,ORNP,ORSC,ORTS,ORWARD,ORATTEND,ORNMBR,ORACTION,OREBUILD,OREBLD,ORRV,OREVENT
"RTN","ORCHART",78,0)
 Q
"RTN","ORCHART",79,0)
 ;
"RTN","ORCHART",80,0)
TAB(NEWTAB,REBUILD) ; -- switch focus to new chart tab from ORTAB
"RTN","ORCHART",81,0)
 S VALMBCK="",VALMBG=$S($G(ORTAB)'=NEWTAB:1,'$G(VALMBG):1,1:VALMBG)
"RTN","ORCHART",82,0)
 S ORTAB=NEWTAB I '$G(^TMP("OR",$J,ORTAB,0))!($G(REBUILD)) D
"RTN","ORCHART",83,0)
 . W !,"Searching the patient's chart ..."
"RTN","ORCHART",84,0)
 . D FULL^VALM1,EN^ORCHTAB ; [re]build list
"RTN","ORCHART",85,0)
 D CLEAN^VALM10 M ^TMP("OR",$J,"CURRENT")=^TMP("OR",$J,ORTAB)
"RTN","ORCHART",86,0)
 M ^TMP("VALM VIDEO",$J,VALMEVL)=^TMP("OR",$J,"CURRENT","VIDEO")
"RTN","ORCHART",87,0)
 I $D(^TMP("OR",$J,"CURRENT","CAPTION")) D
"RTN","ORCHART",88,0)
 . N FLD,LBL S FLD=""
"RTN","ORCHART",89,0)
 . F  S FLD=$O(^TMP("OR",$J,"CURRENT","CAPTION",FLD)) Q:FLD=""  S LBL=$G(^(FLD)) D CHGCAP^VALM(FLD,LBL)
"RTN","ORCHART",90,0)
 S VALM("TITLE")=$G(^TMP("OR",$J,"CURRENT","TITLE")),VALM("RM")=^("RM")
"RTN","ORCHART",91,0)
 S:$D(^TMP("OR",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","ORCHART",92,0)
 S VALMCNT=+$G(^TMP("OR",$J,"CURRENT",0)),VALMLFT=$P(VALMDDF("DATA"),U,2)
"RTN","ORCHART",93,0)
 D HDR S VALMBCK="R" ; reset VALMHDR nodes
"RTN","ORCHART",94,0)
 Q
"RTN","ORCHART",95,0)
 ;
"RTN","ORCHART",96,0)
NEWPAT ; -- Select new patient
"RTN","ORCHART",97,0)
 I $$MORE^ORCMENU2 D  ;unsigned orders
"RTN","ORCHART",98,0)
 . ;I '$D(^TMP("ORNEW",$J)),'$D(^XUSEC("ORES",DUZ)) Q
"RTN","ORCHART",99,0)
 . W !!,"You have new or unsigned orders for this patient!" H 1
"RTN","ORCHART",100,0)
 . S ORRV=1 D EN1^ORCMENU2,NOTIF^ORCMENU2 ;sign, notif if not all signed
"RTN","ORCHART",101,0)
 N TAB,OLD,T,ORT,CTXT K ORRV S OLD=+ORVP,TAB=ORTAB
"RTN","ORCHART",102,0)
 D EN^ORQPT I OLD=+ORVP S VALMBCK="R" D:$G(OREBUILD) REBLD^ORCMENU K OREBUILD Q  ; no change
"RTN","ORCHART",103,0)
 S T="" F  S T=$O(^TMP("OR",$J,T)) Q:T=""  D
"RTN","ORCHART",104,0)
 . I T="MEDS" K ^TMP("OR",$J,T) Q
"RTN","ORCHART",105,0)
 . S CTXT=$P($G(^TMP("OR",$J,T,0)),U,3) S:$L(CTXT) ORT(T,0)="^^"_$S(T="NOTES"&($P(CTXT,";",3)=1):"",1:CTXT)_U_$P(^(0),U,4) ; save tab contexts
"RTN","ORCHART",106,0)
 D UNLOCK^ORX2(+ORVP) K ^TMP("OR",$J),^TMP("ORNEW",$J),^TMP("LRRR",$J)
"RTN","ORCHART",107,0)
 K VALMHDR,ORTAB,ORNEW,OREBUILD,OREBLD
"RTN","ORCHART",108,0)
 M ^TMP("OR",$J)=ORT D TAB(TAB) S VALMBCK="R"
"RTN","ORCHART",109,0)
 Q
"RTN","ORCHART",110,0)
 ;
"RTN","ORCHART",111,0)
ORDERS(ACTION) ; -- Return order numbers to act on, if action chosen first
"RTN","ORCHART",112,0)
 N X,Y,DIR,MAX S:'$L($G(ACTION)) ACTION="act on"
"RTN","ORCHART",113,0)
 S MAX=+$P($G(^TMP("OR",$J,ORTAB,0)),U,2) Q:MAX'>0 "^"
"RTN","ORCHART",114,0)
 S DIR(0)="LAO^1:"_MAX,DIR("A")="Select item(s): " S:MAX=1 DIR("B")=1
"RTN","ORCHART",115,0)
 S DIR("?")="Enter the items you wish to "_ACTION_", as a range or list of numbers"
"RTN","ORCHART",116,0)
 D ^DIR S:$D(DTOUT)!(Y="") Y="^"
"RTN","ORCHART",117,0)
 Q Y
"RTN","ORCHART",118,0)
 ;
"RTN","ORCHART",119,0)
ALL ; -- Return all items on ORTAB
"RTN","ORCHART",120,0)
 N X,Y,DIR,MAX
"RTN","ORCHART",121,0)
 S MAX=+$P($G(^TMP("OR",$J,ORTAB,0)),U,2) Q:MAX'>0 ""
"RTN","ORCHART",122,0)
 S DIR(0)="L^1:"_MAX,DIR("V")="",X="1-"_MAX D ^DIR
"RTN","ORCHART",123,0)
 Q Y
"RTN","ORCHART",124,0)
 ;
"RTN","ORCHART",125,0)
SELECT(NMBR) ; -- rev video on selected items
"RTN","ORCHART",126,0)
 N ORI,ORJ,NUM,ROW,ROWS,VALID S VALID=0
"RTN","ORCHART",127,0)
 F ORI=1:1:$L(NMBR,",") S NUM=$P(NMBR,",",ORI) I NUM D
"RTN","ORCHART",128,0)
 . I '$L($P($G(@VALMAR@("IDX",NUM)),U)) W !,NUM_" is not a valid selection." H 2 Q
"RTN","ORCHART",129,0)
 . S VALID=1
"RTN","ORCHART",130,0)
 . S ROW=$P(@VALMAR@("IDX",NUM),U,2),ROWS=$P(^(NUM),U,3)
"RTN","ORCHART",131,0)
 . F ORJ=ROW:1:(ROW+ROWS-1) I ORJ'<VALMBG,ORJ'>(VALMBG+VALM("LINES")-1) D
"RTN","ORCHART",132,0)
 . . K ^TMP("VALM VIDEO",$J,VALMEVL,ORJ)
"RTN","ORCHART",133,0)
 . . D CNTRL^VALM10(ORJ,1,80,IORVON,IORVOFF)
"RTN","ORCHART",134,0)
 . . D WRITE^VALM10(ORJ)
"RTN","ORCHART",135,0)
 I 'VALID S XQORQUIT=1
"RTN","ORCHART",136,0)
 Q
"RTN","ORCHART",137,0)
 ;
"RTN","ORCHART",138,0)
DESELECT(NMBR) ; -- norm video on selected items
"RTN","ORCHART",139,0)
 N ORI,ORJ,NUM,IFN,ROW,ROWS,ON,OFF,I,IDX
"RTN","ORCHART",140,0)
 F ORI=1:1:$L(NMBR,",") S NUM=$P(NMBR,",",ORI) I NUM D
"RTN","ORCHART",141,0)
 . S IDX=$G(@VALMAR@("IDX",NUM)) Q:'$L(IDX)  ;invalid NUM
"RTN","ORCHART",142,0)
 . S IFN=$P(IDX,U),ROW=$P(IDX,U,2),ROWS=$P(IDX,U,3)
"RTN","ORCHART",143,0)
 . F ORJ=ROW:1:(ROW+ROWS-1) I ORJ'<VALMBG,ORJ'>(VALMBG+VALM("LINES")-1) D
"RTN","ORCHART",144,0)
 . . K ^TMP("VALM VIDEO",$J,VALMEVL,ORJ) Q:'$L(IFN)  ;deleted
"RTN","ORCHART",145,0)
 . . S ON=IOINHI,OFF=IOINORM
"RTN","ORCHART",146,0)
 . . I ORTAB="ORDERS",$G(^OR(100,+IFN,8,+$P(IFN,";",2),3)) S ON=IORVON,OFF=IORVOFF ; flagged
"RTN","ORCHART",147,0)
 . . D CNTRL^VALM10(ORJ,1,5,ON,OFF)
"RTN","ORCHART",148,0)
 . . I ORTAB="ORDERS" S I=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*UNSIGNED*") I I D CNTRL^VALM10(ORJ,I-10,10,IOINHI,IOINORM)
"RTN","ORCHART",149,0)
 . . I ORTAB="XRAYS" S I=$F(^TMP("OR",$J,ORTAB,ORJ,0),"*ABNORMAL*") I I D CNTRL^VALM10(ORJ,I-10,10,IOINHI,IOINORM)
"RTN","ORCHART",150,0)
 . . I ORTAB="LABS" D CNTRL^VALM10(ORJ,24,2,IOINHI,IOINORM)
"RTN","ORCHART",151,0)
 . . D:VALMBCK="" WRITE^VALM10(ORJ)
"RTN","ORCHART",152,0)
 Q
"RTN","ORCHART",153,0)
 ;
"RTN","ORCHART",154,0)
CHANGE ; -- Change view of current list
"RTN","ORCHART",155,0)
 G EN^ORCHANGE
"RTN","ORCHART",156,0)
 Q
"RTN","ORCHART",157,0)
 ;
"RTN","ORCHART",158,0)
REV(ORVP) ; -- Review orders for patient
"RTN","ORCHART",159,0)
 Q:'$G(ORVP)  Q:$D(ZTQUEUED)  Q:$G(DGQUIET)  ;silent
"RTN","ORCHART",160,0)
 I $D(SDAMEVT) Q:$S(SDAMEVT=1:0,1:1)  ;continue if new appt
"RTN","ORCHART",161,0)
 Q:'$$GET^XPAR("ALL","ORPF REVIEW ON PATIENT MVMT")
"RTN","ORCHART",162,0)
 Q:'$$ACCESS^ORCHTAB  ;CPRS not in user's option menu tree
"RTN","ORCHART",163,0)
 N X,Y,DIR,DTOUT,DUOUT,DIRUT,DIROUT,DFN ;protect DFN
"RTN","ORCHART",164,0)
 S DFN=+ORVP,ORVP=DFN_";DPT("  Q:'$D(^OR(100,"AC",ORVP))  ; no orders
"RTN","ORCHART",165,0)
 S DIR(0)="YA",DIR("A")="Review active orders? ",DIR("B")="YES"
"RTN","ORCHART",166,0)
 S DIR("?")="Answer YES to review this patient's active orders"
"RTN","ORCHART",167,0)
 D ^DIR Q:Y'>0  K DIR
"RTN","ORCHART",168,0)
 D SLCT1^ORQPT Q:'$G(ORVP)
"RTN","ORCHART",169,0)
 S ORTAB="ORDERS" D EN^VALM("OR CHART")
"RTN","ORCHART",170,0)
 Q
"RTN","ORCHART",171,0)
 ;
"RTN","ORCHART",172,0)
VIEW() ; -- return line 3 of header w/current view of tab 
"RTN","ORCHART",173,0)
 N BEGIN,END,ITEMS,STS,TEXT,X
"RTN","ORCHART",174,0)
 I $G(ORTAB)']"" Q ""
"RTN","ORCHART",175,0)
 S X=$P($G(^TMP("OR",$J,ORTAB,0)),U,3),TEXT=""
"RTN","ORCHART",176,0)
 S BEGIN=$P(X,";"),END=$P(X,";",2),STS=$P(X,";",3),ITEMS=$P(X,";",5)
"RTN","ORCHART",177,0)
 I ORTAB="NOTES",(STS'=5) S TEXT=$S(ITEMS:"up to "_ITEMS,1:"all")_$S(STS=1:" notes",STS=2:" unsigned notes",STS=3:" uncosigned notes",STS=4:" signed notes by author",1:"")
"RTN","ORCHART",178,0)
 E  D
"RTN","ORCHART",179,0)
 . S:$L(BEGIN)!$L(END) TEXT=$$FDATE^VALM1($$DT^ORCHTAB1(BEGIN))_" thru "_$$FDATE^VALM1($$DT^ORCHTAB1(END))
"RTN","ORCHART",180,0)
 . I ORTAB="XRAYS",ITEMS>0 S TEXT=$S($L(TEXT):TEXT_", ",1:"")_"limit "_ITEMS
"RTN","ORCHART",181,0)
 S:$L(TEXT) TEXT="Current View: "_TEXT,TEXT=$J(TEXT,40+($L(TEXT)\2))
"RTN","ORCHART",182,0)
 Q TEXT
"RTN","ORCHTAB2")
0^4^B22410347
"RTN","ORCHTAB2",1,0)
ORCHTAB2 ;SLC/MKB/REV-Add item to tab listing cont ;03/11/03 14:01
"RTN","ORCHTAB2",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,58,181**;Dec 17, 1997
"RTN","ORCHTAB2",3,0)
GMRA ; -- allergies
"RTN","ORCHTAB2",4,0)
 N ORY,ORI,ALLG,SEV,ID,SIGNS,J,ORIFN,DATA,X,ORTX
"RTN","ORCHTAB2",5,0)
 D SUBHDR^ORCHTAB("Allergies/Adverse Reactions")
"RTN","ORCHTAB2",6,0)
 D EN1^GMRAOR1(+ORVP,"ORY")
"RTN","ORCHTAB2",7,0)
 I '$G(ORY) S X=$S($G(ORY)="":"No assessment available",1:"No known allergies") D LINE^ORCHTAB Q
"RTN","ORCHTAB2",8,0)
 S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  D
"RTN","ORCHTAB2",9,0)
 . S ALLG=$P(ORY(ORI),U),SEV=$P(ORY(ORI),U,2),ID=$P(ORY(ORI),U,3)
"RTN","ORCHTAB2",10,0)
 . S X=$S($L(SEV):$$LOWER^VALM1(SEV)_" reaction to ",1:"")_ALLG
"RTN","ORCHTAB2",11,0)
 . S SIGNS="",J=0 F  S J=$O(ORY(ORI,"S",J)) Q:J'>0  S SIGNS=SIGNS_$S($L(SIGNS):", ",1:"")_$$LOW^XLFSTR(ORY(ORI,"S",J))
"RTN","ORCHTAB2",12,0)
 . S:$L(SIGNS) X=X_" ("_SIGNS_")"
"RTN","ORCHTAB2",13,0)
 . S:$L(X)'>ORMAX ORTX=1,ORTX(1)=X I $L(X)>ORMAX D TXT^ORCHTAB
"RTN","ORCHTAB2",14,0)
 . S DATA(1)=$$DATE^ORCHTAB($P(^GMR(120.8,ID,0),U,4)),DATA=1,ORIFN="GMRA"
"RTN","ORCHTAB2",15,0)
 . D ADD^ORCHTAB
"RTN","ORCHTAB2",16,0)
 Q
"RTN","ORCHTAB2",17,0)
 ;
"RTN","ORCHTAB2",18,0)
GMRV ; -- Vitals
"RTN","ORCHTAB2",19,0)
 N ORY,ORI,X,Y,DATA
"RTN","ORCHTAB2",20,0)
 D SUBHDR^ORCHTAB("Recent Vitals"),FASTVIT^ORQQVI(.ORY,+ORVP)
"RTN","ORCHTAB2",21,0)
 I '$O(ORY(0)) S X="No data available" D LINE^ORCHTAB Q
"RTN","ORCHTAB2",22,0)
 S ORI=0 F  S ORI=$O(ORY(ORI)) Q:ORI'>0  D
"RTN","ORCHTAB2",23,0)
 . S Y=$P(ORY(ORI),U,5)_" "_$P(ORY(ORI),U,6) S:$L(Y)'>1 Y=$P(ORY(ORI),U,3)
"RTN","ORCHTAB2",24,0)
 . S X=$P(ORY(ORI),U,2),X=$S(X="BP":"B/P:   ",X="HT":"Ht:    ",X="P":"Pulse: ",X="R":"Resp:  ",X="T":"Temp:  ",X="WT":"Wt:    ",X="PN":"Pain:  ",1:$$LJ^XLFSTR(X_":",7))_Y
"RTN","ORCHTAB2",25,0)
 . S DATA=$$DATETIME^ORCHTAB($P(ORY(ORI),U,4))
"RTN","ORCHTAB2",26,0)
 . D LINE^ORCHTAB
"RTN","ORCHTAB2",27,0)
 Q
"RTN","ORCHTAB2",28,0)
 ;
"RTN","ORCHTAB2",29,0)
IMM ; -- Immunizations
"RTN","ORCHTAB2",30,0)
 N ORIMM,ORIDT,ORI,X,Y,DATA K ^TMP("PXI",$J)
"RTN","ORCHTAB2",31,0)
 D SUBHDR^ORCHTAB("Recent Immunizations"),IMMUN^PXRHS03(+ORVP)
"RTN","ORCHTAB2",32,0)
 S ORIMM=0 F  S ORIMM=$O(^TMP("PXI",$J,ORIMM)) Q:ORIMM=""  D
"RTN","ORCHTAB2",33,0)
 . S ORIDT=$O(^TMP("PXI",$J,ORIMM,0)),ORI=$O(^(ORIDT,0)),Y=$G(^(ORI,0))
"RTN","ORCHTAB2",34,0)
 . S X=ORIMM_$S($L($P(Y,U,6)):" ("_$P(Y,U,6)_")",1:"")
"RTN","ORCHTAB2",35,0)
 . S DATA=$S('ORI:"",1:$$DATETIME^ORCHTAB($P(Y,U,3)))
"RTN","ORCHTAB2",36,0)
 . D LINE^ORCHTAB
"RTN","ORCHTAB2",37,0)
 Q
"RTN","ORCHTAB2",38,0)
 ;
"RTN","ORCHTAB2",39,0)
SC ; -- Service Connected data
"RTN","ORCHTAB2",40,0)
 N DFN,VAEL,VASV,VAERR,X,DATA
"RTN","ORCHTAB2",41,0)
 S DFN=+ORVP D 7^VADPT,SUBHDR^ORCHTAB("Eligibility")
"RTN","ORCHTAB2",42,0)
 I VAEL(3) S X="Service Connected "_$P(VAEL(3),U,2)_"%"
"RTN","ORCHTAB2",43,0)
 E  S X="Not Service Connected"
"RTN","ORCHTAB2",44,0)
 D LINE^ORCHTAB
"RTN","ORCHTAB2",45,0)
 I VASV(2) S X="Agent Orange Exposure" D LINE^ORCHTAB
"RTN","ORCHTAB2",46,0)
 I VASV(3) S X="Radiation Exposure" D LINE^ORCHTAB
"RTN","ORCHTAB2",47,0)
 I $P($G(^DPT(+ORVP,.322)),U,10) S X="Environmental Contaminants exposure" D LINE^ORCHTAB
"RTN","ORCHTAB2",48,0)
 Q
"RTN","ORCHTAB2",49,0)
 ;
"RTN","ORCHTAB2",50,0)
CWAD ; -- postings
"RTN","ORCHTAB2",51,0)
 N ORI,ORX,MSG,CNT,X,ID,DATA,ORIFN,ORTX K ^TMP("TIUPPCV",$J)
"RTN","ORCHTAB2",52,0)
 D SUBHDR^ORCHTAB("Patient Postings")
"RTN","ORCHTAB2",53,0)
 D ENCOVER^TIUPP3(+ORVP)
"RTN","ORCHTAB2",54,0)
 S CNT=0,ORIFN="TIU"
"RTN","ORCHTAB2",55,0)
 S ORI=0 F  S ORI=$O(^TMP("TIUPPCV",$J,ORI)) Q:ORI'>0  S ORX=$G(^(ORI)) D
"RTN","ORCHTAB2",56,0)
 . S ID=$P(ORX,U) Q:'$L(ID)
"RTN","ORCHTAB2",57,0)
 . S X=$P(ORX,U,3),DATA(1)=$$DATETIME^ORCHTAB($P(ORX,U,5)),DATA=1
"RTN","ORCHTAB2",58,0)
 . S:$L(X)'>ORMAX ORTX=1,ORTX(1)=X I $L(X)>ORMAX D TXT^ORCHTAB
"RTN","ORCHTAB2",59,0)
 . D ADD^ORCHTAB S CNT=CNT+1
"RTN","ORCHTAB2",60,0)
 I 'CNT S LCNT=LCNT+1,^TMP("OR",$J,ORTAB,LCNT,0)="     "_$$PAD^ORCHTAB("<None>",40)_"|"
"RTN","ORCHTAB2",61,0)
 K ^TMP("TIUPPCV",$J)
"RTN","ORCHTAB2",62,0)
 Q
"RTN","ORCHTAB2",63,0)
 ;
"RTN","ORCHTAB2",64,0)
PROB ; -- problem
"RTN","ORCHTAB2",65,0)
 N ID,DATA,X,ORTX,FIRST,ORJ,ORIFN
"RTN","ORCHTAB2",66,0)
 S ID=$P(ORX,U),ORIFN=$P(ORX,U,2) ;problem ptr, status
"RTN","ORCHTAB2",67,0)
 ;I $E(ORX,1,3)="   " S X=ORX D TXT^ORCHTAB Q  ;comment line only ??
"RTN","ORCHTAB2",68,0)
 S X=$P(ORX,U,3)_$S($L($P(ORX,U,4)):" ("_$P(ORX,U,4)_")",1:"")
"RTN","ORCHTAB2",69,0)
 S:$L(X)'>ORMAX ORTX=1,ORTX(1)=X I $L(X)>ORMAX D TXT^ORCHTAB
"RTN","ORCHTAB2",70,0)
 S DATA(1)=$$PAD^ORCHTAB($$DATE^ORCHTAB($P(ORX,U,5)),10)_$$PAD^ORCHTAB($$DATE^ORCHTAB($P(ORX,U,6)),10)_$S($P(ORX,U,2)="I":"inactive",1:"active "_$P(ORX,U,9)),DATA=1
"RTN","ORCHTAB2",71,0)
 I COMM,$O(ORY(ORI,0)) S ORJ=0 F  S ORJ=$O(ORY(ORI,ORJ)) Q:ORJ'>0  S X=" "_ORY(ORI,ORJ) I $L(X)>1 S ORTX=ORTX+1,ORTX(ORTX)="" D TXT^ORCHTAB ;add comments
"RTN","ORCHTAB2",72,0)
 S FIRST=LCNT+1 D ADD^ORCHTAB
"RTN","ORCHTAB2",73,0)
 I $L($P(ORX,U,10)) S $E(^TMP("OR",$J,ORTAB,FIRST,0),5)=$P(ORX,U,10)  ; unverified flag    ($)
"RTN","ORCHTAB2",74,0)
 ; CSV change - check for active code, for active problem list only
"RTN","ORCHTAB2",75,0)
 ; Inactive code flag (#) takes precedence and replaces unverified flag ($)
"RTN","ORCHTAB2",76,0)
 I $P(ORX,U,2)="A",'$$CODESTS^GMPLX(ID,DT) S $E(^TMP("OR",$J,ORTAB,FIRST,0),5)="#"
"RTN","ORCHTAB2",77,0)
 Q
"RTN","ORCHTAB2",78,0)
 ;
"RTN","ORCHTAB2",79,0)
NOTE ; -- progress note
"RTN","ORCHTAB2",80,0)
 N ID,DATA,X,ORTX
"RTN","ORCHTAB2",81,0)
 S DATA(1)=$$PAD^ORCHTAB($$DATETIME^ORCHTAB($P(ORX,U,3)),16)_$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(+$P(ORX,U,5)),12)_$E($P(ORX,U,7),1,5),DATA=1
"RTN","ORCHTAB2",82,0)
 S ID=$P(ORX,U),X=$P(ORX,U,2)
"RTN","ORCHTAB2",83,0)
 S:$L(X)'>ORMAX ORTX=1,ORTX(1)=X I $L(X)>ORMAX D TXT^ORCHTAB
"RTN","ORCHTAB2",84,0)
 I SUBJ,$L($P(ORX,U,12)) S X=" "_$P(ORX,U,12),ORTX=ORTX+1,ORTX(ORTX)="" D TXT^ORCHTAB ;add note subject
"RTN","ORCHTAB2",85,0)
 D ADD^ORCHTAB
"RTN","ORCHTAB2",86,0)
 Q
"RTN","ORCHTAB2",87,0)
 ;
"RTN","ORCHTAB2",88,0)
SUMM ; -- discharge summary
"RTN","ORCHTAB2",89,0)
 N ID,DATA,ORTX
"RTN","ORCHTAB2",90,0)
 S DATA(1)=$$DATE^ORCHTAB($P(ORX,U,3))_"     "_$$PAD^ORCHTAB($$LNAMEF^ORCHTAB(+$P(ORX,U,5)),15)_$E($P(ORX,U,7),1,5)_$P($P(ORX,U,8)," ",2)_"  "_$P($P(ORX,U,9)," ",2)
"RTN","ORCHTAB2",91,0)
 S ID=$P(ORX,U),ORTX=1,ORTX(1)=$P(ORX,U,2),DATA=1
"RTN","ORCHTAB2",92,0)
 D ADD^ORCHTAB
"RTN","ORCHTAB2",93,0)
 Q
"RTN","ORCHTAB2",94,0)
 ;
"RTN","ORCHTAB2",95,0)
INITIALS(USER) ; -- Return initials of USER
"RTN","ORCHTAB2",96,0)
 N X,Y S X=$G(^VA(200,+$G(USER),0)),Y=$P(X,U,2)
"RTN","ORCHTAB2",97,0)
 S:'$L(Y) Y=" x "
"RTN","ORCHTAB2",98,0)
 Q Y
"RTN","ORCMGMCK")
0^2^B37075731
"RTN","ORCMGMCK",1,0)
ORCMGMCK ;SLC/JFR - FIND GMRC QO'S WITH INACTIVE CODES ;6/4/03 11:33
"RTN","ORCMGMCK",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**181**;Dec 17, 1997
"RTN","ORCMGMCK",3,0)
 ;
"RTN","ORCMGMCK",4,0)
 ; This routine invokes IA # 3990
"RTN","ORCMGMCK",5,0)
 ;
"RTN","ORCMGMCK",6,0)
 Q
"RTN","ORCMGMCK",7,0)
FINDQOS ; find cons/proc quick orders with a default Prov. DX code
"RTN","ORCMGMCK",8,0)
 N ORDLG,ORPDLG,ORDGC,ORDGP
"RTN","ORCMGMCK",9,0)
 K ^TMP("ORCMGMCK",$J)
"RTN","ORCMGMCK",10,0)
 S ORDGC=$$FIND1^DIC(100.98,,"QX","CONSULTS") ;find disp. group ien
"RTN","ORCMGMCK",11,0)
 S ORDGP=$$FIND1^DIC(100.98,,"QX","PROCEDURES") ;find disp. group ien
"RTN","ORCMGMCK",12,0)
 S ORPDLG=$$PTR^ORCD("OR GTX CODE")
"RTN","ORCMGMCK",13,0)
 S ORDLG=0
"RTN","ORCMGMCK",14,0)
 F  S ORDLG=$O(^ORD(101.41,ORDLG)) Q:'ORDLG  I $P(^(ORDLG,0),U,4)="Q" D
"RTN","ORCMGMCK",15,0)
 . N ORQDG,ORCODEF,ORPRMPT,ORAPIVAL,ACTDT
"RTN","ORCMGMCK",16,0)
 . S ORQDG=$P(^ORD(101.41,ORDLG,0),U,5)
"RTN","ORCMGMCK",17,0)
 . I ORQDG'=ORDGC&(ORQDG'=ORDGP) Q  ;not in CONS or PROC display group
"RTN","ORCMGMCK",18,0)
 . S ORPRMPT=$O(^ORD(101.41,ORDLG,6,"D",ORPDLG,0))
"RTN","ORCMGMCK",19,0)
 . I 'ORPRMPT Q  ;no PD prompt
"RTN","ORCMGMCK",20,0)
 . S ORCODEF=$G(^ORD(101.41,ORDLG,6,ORPRMPT,1))
"RTN","ORCMGMCK",21,0)
 . I '$L(ORPRMPT) Q  ; no default CODE stored.
"RTN","ORCMGMCK",22,0)
 . I '$$STATCHK^ICDAPIU(ORCODEF,DT) D  Q
"RTN","ORCMGMCK",23,0)
 .. S ^TMP("ORCMGMCK",$J,"I",ORDLG)=$P(^ORD(101.41,ORDLG,0),U)_U_ORCODEF
"RTN","ORCMGMCK",24,0)
 . S ORAPIVAL=$$HIST^ICDAPIU(ORCODEF,.ORAPIVAL)
"RTN","ORCMGMCK",25,0)
 . S ACTDT=$O(ORAPIVAL(DT))
"RTN","ORCMGMCK",26,0)
 . I ACTDT,'$G(ORAPIVAL(ACTDT)) D  ; future inactivation
"RTN","ORCMGMCK",27,0)
 .. S ^TMP("ORCMGMCK",$J,"F",ORDLG)=$P(^ORD(101.41,ORDLG,0),U)_U_ORCODEF_U_$$FMTE^XLFDT(ACTDT)
"RTN","ORCMGMCK",28,0)
 Q
"RTN","ORCMGMCK",29,0)
 ;
"RTN","ORCMGMCK",30,0)
CSVPEP ; protocol event point called upon CSV install
"RTN","ORCMGMCK",31,0)
 ;  Called by Protocol -  ??
"RTN","ORCMGMCK",32,0)
 ;
"RTN","ORCMGMCK",33,0)
 N LN,XMSUB,XMTEXT,XMDUZ,XMY
"RTN","ORCMGMCK",34,0)
 D FINDQOS
"RTN","ORCMGMCK",35,0)
 K ^TMP("ORCMMSG",$J)
"RTN","ORCMGMCK",36,0)
 S LN=1
"RTN","ORCMGMCK",37,0)
 I $D(^TMP("ORCMGMCK",$J,"I")) D
"RTN","ORCMGMCK",38,0)
 . S ^TMP("ORCMMSG",$J,LN)="The following Consult or Procedure quick orders were found that currently",LN=LN+1
"RTN","ORCMGMCK",39,0)
 . S ^TMP("ORCMMSG",$J,LN)="have a provisional diagnosis code that is inactive. These should be edited",LN=LN+1
"RTN","ORCMGMCK",40,0)
 . S ^TMP("ORCMMSG",$J,LN)="as soon as possible to reduce interruption of ordering these quick orders.",LN=LN+1
"RTN","ORCMGMCK",41,0)
 . S ^TMP("ORCMMSG",$J,LN)=" ",LN=LN+1
"RTN","ORCMGMCK",42,0)
 . S IREC=0
"RTN","ORCMGMCK",43,0)
 . F  S IREC=$O(^TMP("ORCMGMCK",$J,"I",IREC)) Q:'IREC  D
"RTN","ORCMGMCK",44,0)
 .. S ^TMP("ORCMMSG",$J,LN)="Quick order name: "_$P(^TMP("ORCMGMCK",$J,"I",IREC),U)_"    IEN: "_IREC,LN=LN+1
"RTN","ORCMGMCK",45,0)
 .. S ^TMP("ORCMMSG",$J,LN)="Provisional Diagnosis code: "_$P(^TMP("ORCMGMCK",$J,"I",IREC),U,2),LN=LN+1
"RTN","ORCMGMCK",46,0)
 .. S ^TMP("ORCMMSG",$J,LN)=" ",LN=LN+1
"RTN","ORCMGMCK",47,0)
 . Q
"RTN","ORCMGMCK",48,0)
 ;
"RTN","ORCMGMCK",49,0)
 I $D(^TMP("ORCMGMCK",$J,"F")) D
"RTN","ORCMGMCK",50,0)
 . S ^TMP("ORCMMSG",$J,LN)="The following Consult or Procedure quick orders were found to have a",LN=LN+1
"RTN","ORCMGMCK",51,0)
 . S ^TMP("ORCMMSG",$J,LN)="provisional diagnosis code that will become inactive in the future.",LN=LN+1
"RTN","ORCMGMCK",52,0)
 . S ^TMP("ORCMMSG",$J,LN)="These should be edited as soon as possible after the inactivation date to",LN=LN+1
"RTN","ORCMGMCK",53,0)
 . S ^TMP("ORCMMSG",$J,LN)="reduce interruption in ordering these quick orders.",LN=LN+1
"RTN","ORCMGMCK",54,0)
 . S ^TMP("ORCMMSG",$J,LN)=" ",LN=LN+1
"RTN","ORCMGMCK",55,0)
 . S FREC=0
"RTN","ORCMGMCK",56,0)
 . F  S FREC=$O(^TMP("ORCMGMCK",$J,"F",FREC)) Q:'FREC  D
"RTN","ORCMGMCK",57,0)
 .. S ^TMP("ORCMMSG",$J,LN)="Quick order name: "_$P(^TMP("ORCMGMCK",$J,"F",FREC),U)_"    IEN: "_FREC,LN=LN+1
"RTN","ORCMGMCK",58,0)
 .. S ^TMP("ORCMMSG",$J,LN)="Provisional Diagnosis code: "_$P(^TMP("ORCMGMCK",$J,"F",FREC),U,2)_"  Inactivation Date: "_$$FMTE^XLFDT($P(^(FREC),U,3),2)
"RTN","ORCMGMCK",59,0)
 .. S LN=LN+1
"RTN","ORCMGMCK",60,0)
 . Q
"RTN","ORCMGMCK",61,0)
 I '$D(^TMP("ORCMMSG",$J)) D
"RTN","ORCMGMCK",62,0)
 . S ^TMP("ORCMMSG",$J,LN)="There were no problem quick orders found."
"RTN","ORCMGMCK",63,0)
 . S LN=LN+1
"RTN","ORCMGMCK",64,0)
 S XMY("G.ORCM CSV EVENT")=""
"RTN","ORCMGMCK",65,0)
 S XMSUB="DX Code check of Consult/Procedure QO's"
"RTN","ORCMGMCK",66,0)
 S XMDUZ="Code Set Version Install"
"RTN","ORCMGMCK",67,0)
 S XMTEXT="^TMP(""ORCMMSG"",$J,"
"RTN","ORCMGMCK",68,0)
 D ^XMD
"RTN","ORCMGMCK",69,0)
 K ^TMP("ORCMGMCK",$J),^TMP("ORCMMSG",$J)
"RTN","ORCMGMCK",70,0)
 Q
"RTN","ORCMGMCK",71,0)
 ;
"RTN","ORCMGMCK",72,0)
CSVOPT ; report of CSV affected quick orders from option ORCM ...
"RTN","ORCMGMCK",73,0)
 N %ZIS,POP
"RTN","ORCMGMCK",74,0)
 S %ZIS="QM" D ^%ZIS Q:POP
"RTN","ORCMGMCK",75,0)
 I $D(IO("Q")) D  D ^%ZISC,HOME^%ZIS Q
"RTN","ORCMGMCK",76,0)
 . N ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK
"RTN","ORCMGMCK",77,0)
 . S ZTDESC="Review of OR Quick orders for CSV"
"RTN","ORCMGMCK",78,0)
 . S ZTRTN="QUEUE^ORCMGMCK",ZTIO=ION,ZTDTH=$H
"RTN","ORCMGMCK",79,0)
 . D ^%ZTLOAD
"RTN","ORCMGMCK",80,0)
 . I '$G(ZTSK) W !,"Unable to task report"
"RTN","ORCMGMCK",81,0)
 . Q
"RTN","ORCMGMCK",82,0)
 ;
"RTN","ORCMGMCK",83,0)
QUEUE ; entry point for tasked report
"RTN","ORCMGMCK",84,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORCMGMCK",85,0)
 N PG
"RTN","ORCMGMCK",86,0)
 U IO
"RTN","ORCMGMCK",87,0)
 D FINDQOS  ;will return ^TMP("ORCMGMCK",$J) with list of quick orders
"RTN","ORCMGMCK",88,0)
 S PG=1 D PAGE(.PG)
"RTN","ORCMGMCK",89,0)
 I $D(^TMP("ORCMGMCK",$J,"I")) D
"RTN","ORCMGMCK",90,0)
 . N IREC
"RTN","ORCMGMCK",91,0)
 . W !,"The following Consult or Procedure quick orders were found that currently"
"RTN","ORCMGMCK",92,0)
 . W !,"have a provisional diagnosis code that is inactive. These should be edited"
"RTN","ORCMGMCK",93,0)
 . W !,"as soon as possible to reduce interruption of ordering these quick orders.",!
"RTN","ORCMGMCK",94,0)
 . S IREC=0
"RTN","ORCMGMCK",95,0)
 . F  S IREC=$O(^TMP("ORCMGMCK",$J,"I",IREC)) Q:'IREC!(PG<1)  D
"RTN","ORCMGMCK",96,0)
 .. I IOSL-$Y<4 D PAGE(.PG) Q:'PG
"RTN","ORCMGMCK",97,0)
 .. W !,"Quick order name: ",$P(^TMP("ORCMGMCK",$J,"I",IREC),U),"    IEN: ",IREC
"RTN","ORCMGMCK",98,0)
 .. W !,"Provisional Diagnosis code: ",$P(^TMP("ORCMGMCK",$J,"I",IREC),U,2)
"RTN","ORCMGMCK",99,0)
 .. W !," "
"RTN","ORCMGMCK",100,0)
 . Q
"RTN","ORCMGMCK",101,0)
 ;
"RTN","ORCMGMCK",102,0)
 I $D(^TMP("ORCMGMCK",$J,"F")) D
"RTN","ORCMGMCK",103,0)
 . I IOSL=$Y<8 D PAGE(.PG) Q:'PG
"RTN","ORCMGMCK",104,0)
 . W !,"The following Consult or Procedure quick orders were found to have a"
"RTN","ORCMGMCK",105,0)
 . W !,"provisional diagnosis code that will become inactive in the future."
"RTN","ORCMGMCK",106,0)
 . W !,"These should be edited as soon as possible after the inactivation date to"
"RTN","ORCMGMCK",107,0)
 . W !,"reduce interruption in ordering these quick orders."
"RTN","ORCMGMCK",108,0)
 . W !," "
"RTN","ORCMGMCK",109,0)
 . N FREC
"RTN","ORCMGMCK",110,0)
 . S FREC=0
"RTN","ORCMGMCK",111,0)
 . F  S FREC=$O(^TMP("ORCMGMCK",$J,"F",FREC)) Q:'FREC!(PG<1)  D
"RTN","ORCMGMCK",112,0)
 .. I IOSL-$Y<4 D PAGE(.PG) Q:'PG
"RTN","ORCMGMCK",113,0)
 .. W !,"Quick order name: ",$P(^TMP("ORCMGMCK",$J,"F",FREC),U),"    IEN: ",FREC
"RTN","ORCMGMCK",114,0)
 .. W !,"Provisional Diagnosis code: ",$P(^TMP("ORCMGMCK",$J,"F",FREC),U,2),"  Inactivation Date: ",$$FMTE^XLFDT($P(^(FREC),U,3),2)
"RTN","ORCMGMCK",115,0)
 . Q
"RTN","ORCMGMCK",116,0)
 I '$D(^TMP("ORCMGMCK",$J)) D
"RTN","ORCMGMCK",117,0)
 . W !,"There were no problem quick orders found.",!
"RTN","ORCMGMCK",118,0)
 . I $E(IOST,1,2)="C-" D
"RTN","ORCMGMCK",119,0)
 .. N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","ORCMGMCK",120,0)
 .. S DIR(0)="E" D ^DIR
"RTN","ORCMGMCK",121,0)
 . Q
"RTN","ORCMGMCK",122,0)
 D:$E(IOST,1,2)'="C-" ^%ZISC
"RTN","ORCMGMCK",123,0)
 D HOME^%ZIS
"RTN","ORCMGMCK",124,0)
 K ^TMP("ORCMGMCK",$J)
"RTN","ORCMGMCK",125,0)
 Q
"RTN","ORCMGMCK",126,0)
 ;
"RTN","ORCMGMCK",127,0)
PAGE(NUM) ;print header and raise page number
"RTN","ORCMGMCK",128,0)
 I NUM'=1,$E(IOST,1,2)="C-" D  Q:'NUM
"RTN","ORCMGMCK",129,0)
 . N DIR,DTOUT,DIRUT,DUOUT,X,Y
"RTN","ORCMGMCK",130,0)
 . S DIR(0)="E" D ^DIR
"RTN","ORCMGMCK",131,0)
 . I $D(DUOUT)!($D(DTOUT)) S NUM=0
"RTN","ORCMGMCK",132,0)
 W @IOF
"RTN","ORCMGMCK",133,0)
 W "Code Set Version review of Consult/Procedure Quick Orders"
"RTN","ORCMGMCK",134,0)
 W ?70,"Page: ",NUM
"RTN","ORCMGMCK",135,0)
 W !,$$REPEAT^XLFSTR("-",78)
"RTN","ORCMGMCK",136,0)
 S NUM=NUM+1
"RTN","ORCMGMCK",137,0)
 Q
"RTN","ORCPROB")
0^5^B26200127
"RTN","ORCPROB",1,0)
ORCPROB ; SLC/MKB/REV - Problem List interface ;03/11/03  14:03
"RTN","ORCPROB",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**27,48,181**;Dec 17, 1997
"RTN","ORCPROB",3,0)
ADD ; -- add new problem
"RTN","ORCPROB",4,0)
 N GMPLIST,ORPROV
"RTN","ORCPROB",5,0)
 D FULL^VALM1 S VALMBCK="R",ORPROV=$$PROVIDER Q:ORPROV="^"
"RTN","ORCPROB",6,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 Q:'ORL
"RTN","ORCPROB",7,0)
 D ADD^GMPLUTL2(+ORVP,+ORL,ORPROV)
"RTN","ORCPROB",8,0)
 D:$O(GMPLIST(0)) TAB^ORCHART(ORTAB,1)
"RTN","ORCPROB",9,0)
 Q
"RTN","ORCPROB",10,0)
 ;
"RTN","ORCPROB",11,0)
EDIT ; -- edit problem
"RTN","ORCPROB",12,0)
 N GMPLIST,ORPROV,PIECE,NMBR,IFN S VALMBCK=""
"RTN","ORCPROB",13,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("edit") Q:'ORNMBR
"RTN","ORCPROB",14,0)
 D FULL^VALM1 S VALMBCK="R",ORPROV=$$PROVIDER Q:ORPROV="^"
"RTN","ORCPROB",15,0)
 S:'$G(ORL) ORL=$$LOCATION^ORCMENU1 Q:'ORL
"RTN","ORCPROB",16,0)
 F PIECE=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",PIECE) I NMBR D
"RTN","ORCPROB",17,0)
 . S IFN=+$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCPROB",18,0)
 . I 'IFN W !,"Problem #"_NMBR_" has been removed!",! H 1 Q
"RTN","ORCPROB",19,0)
 . K GMPLIST D EDIT^GMPLUTL2(+ORVP,+ORL,ORPROV,IFN)
"RTN","ORCPROB",20,0)
 . S:$D(GMPLIST) OREBUILD=1
"RTN","ORCPROB",21,0)
 Q
"RTN","ORCPROB",22,0)
 ;
"RTN","ORCPROB",23,0)
INACT ; -- inactivate a problem
"RTN","ORCPROB",24,0)
 N ORPROV,ORPL,ORY,NUM,NMBR,PIECE,IFN,STS S VALMBCK=""
"RTN","ORCPROB",25,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("inactivate") Q:'ORNMBR
"RTN","ORCPROB",26,0)
 S NUM=$L(ORNMBR,",")-1 Q:'$$OK("inactivate",NUM)
"RTN","ORCPROB",27,0)
 S ORPROV=$$PROVIDER Q:ORPROV="^"
"RTN","ORCPROB",28,0)
 F PIECE=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",PIECE) I NMBR D
"RTN","ORCPROB",29,0)
 . S IFN=$G(^TMP("OR",$J,"CURRENT","IDX",NMBR)),STS=$P(IFN,U,4),IFN=+IFN
"RTN","ORCPROB",30,0)
 . I 'IFN W !,"Problem #"_NMBR_" has been removed!",! H 1 Q
"RTN","ORCPROB",31,0)
 . I STS="I" W !,"Problem #"_NMBR_" is already inactive!",! H 1 Q
"RTN","ORCPROB",32,0)
 . S ORPL("PROVIDER")=ORPROV,ORPL("STATUS")="I",ORPL("PROBLEM")=IFN
"RTN","ORCPROB",33,0)
 . W !,$$PROBTEXT^GMPLX(IFN)
"RTN","ORCPROB",34,0)
 . D UPDATE^GMPLUTL(.ORPL,.ORY) I ORY'>0 W !?5,"ERROR - "_ORY(0) H 1 Q
"RTN","ORCPROB",35,0)
 . W:$X>64 !?5 W " ... inactivated" H 1 S OREBUILD=1
"RTN","ORCPROB",36,0)
 . S $P(^TMP("OR",$J,"CURRENT","IDX",NMBR),U,4)="I"
"RTN","ORCPROB",37,0)
 Q
"RTN","ORCPROB",38,0)
 ;
"RTN","ORCPROB",39,0)
CMMT ; -- comment problem
"RTN","ORCPROB",40,0)
 N DIR,X,Y,ORPL,ORY,NMBR,PIECE,QUIT,TEXT,ORPROV,CMMT S VALMBCK=""
"RTN","ORCPROB",41,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("") Q:'ORNMBR
"RTN","ORCPROB",42,0)
 D FULL^VALM1 S VALMBCK="R",ORPROV=$$PROVIDER Q:ORPROV="^"
"RTN","ORCPROB",43,0)
 S CMMT=+$P($P($G(^TMP("OR",$J,ORTAB,0)),U,3),";",4) ;show comments
"RTN","ORCPROB",44,0)
 F PIECE=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",PIECE) I NMBR D  Q:$D(QUIT)
"RTN","ORCPROB",45,0)
 . S IFN=+$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCPROB",46,0)
 . I 'IFN W !,"Problem #"_NMBR_" has been removed!",! H 2 Q
"RTN","ORCPROB",47,0)
 . I '$$CODESTS^GMPLX(IFN,DT) D  Q
"RTN","ORCPROB",48,0)
 . . W !,"Problem #"_NMBR_" has an inactive code.  Please use the EDIT action instead",! H 2 S QUIT=1
"RTN","ORCPROB",49,0)
 . S DIR(0)="FAO^1:60",DIR("A")="COMMENT (<60 char): "
"RTN","ORCPROB",50,0)
 . S DIR("A",1)=$$UP^XLFSTR($$PROBTEXT^GMPLX(IFN))
"RTN","ORCPROB",51,0)
 . S DIR("?")="Enter up to 60 characters of additional text to be appended to this problem" S:$D(TEXT) DIR("B")=TEXT
"RTN","ORCPROB",52,0)
 . W ! D ^DIR I $D(DTOUT)!("^"[Y) S QUIT=1 Q
"RTN","ORCPROB",53,0)
 . S (TEXT,ORPL("COMMENT"))=Y,ORPL("PROBLEM")=IFN
"RTN","ORCPROB",54,0)
 . S ORPL("PROVIDER")=ORPROV
"RTN","ORCPROB",55,0)
 . D UPDATE^GMPLUTL(.ORPL,.ORY) S:CMMT&(ORY>0) OREBUILD=1
"RTN","ORCPROB",56,0)
 . W !?5,$S(ORY>0:"... 1 comment added",1:"ERROR - "_ORY(0)) H 1
"RTN","ORCPROB",57,0)
 Q
"RTN","ORCPROB",58,0)
 ;
"RTN","ORCPROB",59,0)
REMOVE ; -- remove problem
"RTN","ORCPROB",60,0)
 N DIR,X,Y,IFN,TEXT,ORY,SUB,NUM,NMBR,PIECE,QUIT,ORPROV S VALMBCK=""
"RTN","ORCPROB",61,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("remove") Q:'ORNMBR
"RTN","ORCPROB",62,0)
 S NUM=$L(ORNMBR,",")-1 Q:'$$OK("remove",NUM)
"RTN","ORCPROB",63,0)
 D FULL^VALM1 S VALMBCK="R",ORPROV=$$PROVIDER Q:ORPROV="^"
"RTN","ORCPROB",64,0)
 F PIECE=1:1:$L(ORNMBR,",") S NMBR=$P(ORNMBR,",",PIECE) I NMBR D  Q:$D(QUIT)
"RTN","ORCPROB",65,0)
 . S IFN=+$G(^TMP("OR",$J,"CURRENT","IDX",NMBR))
"RTN","ORCPROB",66,0)
 . I 'IFN W !,"Problem #"_NMBR_" has already been removed!",! H 1 Q
"RTN","ORCPROB",67,0)
 . S DIR(0)="FAO^1:60",DIR("A")="REASON FOR REMOVAL: "
"RTN","ORCPROB",68,0)
 . S DIR("A",1)=$$UP^XLFSTR($$PROBTEXT^GMPLX(IFN))
"RTN","ORCPROB",69,0)
 . S:$D(TEXT) DIR("B")=TEXT
"RTN","ORCPROB",70,0)
 . S DIR("?")="Enter up to 60 characters of additional text to be appended to this problem"
"RTN","ORCPROB",71,0)
 . W ! D ^DIR I $D(DTOUT)!($D(DUOUT)) S QUIT=1 Q
"RTN","ORCPROB",72,0)
 . S TEXT=Y D REMOVE^GMPLUTL2(IFN,ORPROV,TEXT,.ORY)
"RTN","ORCPROB",73,0)
 . I ORY'>0 W !?5,"ERROR - "_ORY(0) H 1 Q
"RTN","ORCPROB",74,0)
 . W !?5,"... removed" H 1 S OREBUILD=1
"RTN","ORCPROB",75,0)
 Q
"RTN","ORCPROB",76,0)
 ;
"RTN","ORCPROB",77,0)
VERIFY ; -- verify problem
"RTN","ORCPROB",78,0)
 I '$P($$PARAM^GMPLUTL2,U,2) W !,"This action is not in use.",! H 1 Q
"RTN","ORCPROB",79,0)
 I '$D(^XUSEC("ORES",DUZ)),'$D(^XUSEC("ORELSE",DUZ)) W !,"You must have either the ORES or ORELSE key to verify these problems!",! H 1 Q
"RTN","ORCPROB",80,0)
 N NUM,PIECE,GMPIFN,OROLD S VALMBCK=""
"RTN","ORCPROB",81,0)
 I '$G(ORNMBR) S ORNMBR=$$ORDERS^ORCHART("verify") Q:'ORNMBR
"RTN","ORCPROB",82,0)
 S VALMBCK="",NUM=$L(ORNMBR,",")-1 Q:'$$OK("verify",NUM)
"RTN","ORCPROB",83,0)
 F PIECE=1:1:$L(ORNMBR,",") S NUM=$P(ORNMBR,",",PIECE) I NUM D
"RTN","ORCPROB",84,0)
 . S GMPIFN=+$G(^TMP("OR",$J,"CURRENT","IDX",NUM))
"RTN","ORCPROB",85,0)
 . I 'GMPIFN W !,"Problem #"_NUM_" has already been removed!",! H 1 Q
"RTN","ORCPROB",86,0)
 . S OROLD=$G(^AUPNPROB(GMPIFN,1)) D VERIFY^GMPL1
"RTN","ORCPROB",87,0)
 . S:OROLD'=$G(^AUPNPROB(GMPIFN,1)) OREBUILD=1
"RTN","ORCPROB",88,0)
 Q
"RTN","ORCPROB",89,0)
 ;
"RTN","ORCPROB",90,0)
OK(ACTION,NUM) ; -- Are you sure?
"RTN","ORCPROB",91,0)
 N DIR,X,Y
"RTN","ORCPROB",92,0)
 S DIR(0)="YA",DIR("B")="NO",DIR("A")="Are you sure you want to "_ACTION_" "_$S(NUM>1:"these problems? ",1:"this problem? ")
"RTN","ORCPROB",93,0)
 S DIR("?")="Enter YES to continue with this action, or NO to cancel"
"RTN","ORCPROB",94,0)
 D ^DIR
"RTN","ORCPROB",95,0)
 Q +Y
"RTN","ORCPROB",96,0)
 ;
"RTN","ORCPROB",97,0)
PROVIDER() ; --Return Responsible Provider
"RTN","ORCPROB",98,0)
 N X,Y,DIC
"RTN","ORCPROB",99,0)
 I '$D(^XUSEC("OREMAS",DUZ)),'$G(ORNP)!($G(ORNP)=DUZ) S Y=DUZ_U_$P($G(^VA(200,DUZ,0)),U) G PVQ
"RTN","ORCPROB",100,0)
 S DIC=200,DIC(0)="AEQM",DIC("A")="Requesting Clinician: "
"RTN","ORCPROB",101,0)
 S:$G(ORNP) DIC("B")=ORNP D ^DIC S:Y'>0 Y="^"
"RTN","ORCPROB",102,0)
PVQ Q Y
"RTN","ORCPROB",103,0)
 ;
"RTN","ORCPROB",104,0)
EX ; -- exit action
"RTN","ORCPROB",105,0)
 D:$G(OREBUILD) TAB^ORCHART(ORTAB,1)
"RTN","ORCPROB",106,0)
 S:$D(^TMP("OR",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","ORCPROB",107,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
GMRC*3.0*33
"BLD",4258,0)
GMRC*3.0*33^CONSULT/REQUEST TRACKING^0^3030731^y
"BLD",4258,1,0)
^^2^2^3030321^
"BLD",4258,1,1,0)
Refer to the National Patch Module for complete details of the 
"BLD",4258,1,2,0)
enhancements included in this patch.
"BLD",4258,4,0)
^9.64PA^^
"BLD",4258,"ABPKG")
n
"BLD",4258,"KRN",0)
^9.67PA^8989.52^19
"BLD",4258,"KRN",.4,0)
.4
"BLD",4258,"KRN",.401,0)
.401
"BLD",4258,"KRN",.402,0)
.402
"BLD",4258,"KRN",.403,0)
.403
"BLD",4258,"KRN",.5,0)
.5
"BLD",4258,"KRN",.84,0)
.84
"BLD",4258,"KRN",3.6,0)
3.6
"BLD",4258,"KRN",3.8,0)
3.8
"BLD",4258,"KRN",9.2,0)
9.2
"BLD",4258,"KRN",9.8,0)
9.8
"BLD",4258,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",4258,"KRN",9.8,"NM",1,0)
GMRCEDT2^^0^B16549229
"BLD",4258,"KRN",9.8,"NM",2,0)
GMRCEDT4^^0^B75533249
"BLD",4258,"KRN",9.8,"NM",3,0)
GMRCGUIC^^0^B51068740
"BLD",4258,"KRN",9.8,"NM",4,0)
GMRCEDT1^^0^B38760045
"BLD",4258,"KRN",9.8,"NM",5,0)
GMRCHL7A^^0^B27421740
"BLD",4258,"KRN",9.8,"NM",6,0)
GMRCHL7B^^0^B25860722
"BLD",4258,"KRN",9.8,"NM","B","GMRCEDT1",4)

"BLD",4258,"KRN",9.8,"NM","B","GMRCEDT2",1)

"BLD",4258,"KRN",9.8,"NM","B","GMRCEDT4",2)

"BLD",4258,"KRN",9.8,"NM","B","GMRCGUIC",3)

"BLD",4258,"KRN",9.8,"NM","B","GMRCHL7A",5)

"BLD",4258,"KRN",9.8,"NM","B","GMRCHL7B",6)

"BLD",4258,"KRN",19,0)
19
"BLD",4258,"KRN",19.1,0)
19.1
"BLD",4258,"KRN",101,0)
101
"BLD",4258,"KRN",409.61,0)
409.61
"BLD",4258,"KRN",771,0)
771
"BLD",4258,"KRN",870,0)
870
"BLD",4258,"KRN",8989.51,0)
8989.51
"BLD",4258,"KRN",8989.52,0)
8989.52
"BLD",4258,"KRN",8994,0)
8994
"BLD",4258,"KRN","B",.4,.4)

"BLD",4258,"KRN","B",.401,.401)

"BLD",4258,"KRN","B",.402,.402)

"BLD",4258,"KRN","B",.403,.403)

"BLD",4258,"KRN","B",.5,.5)

"BLD",4258,"KRN","B",.84,.84)

"BLD",4258,"KRN","B",3.6,3.6)

"BLD",4258,"KRN","B",3.8,3.8)

"BLD",4258,"KRN","B",9.2,9.2)

"BLD",4258,"KRN","B",9.8,9.8)

"BLD",4258,"KRN","B",19,19)

"BLD",4258,"KRN","B",19.1,19.1)

"BLD",4258,"KRN","B",101,101)

"BLD",4258,"KRN","B",409.61,409.61)

"BLD",4258,"KRN","B",771,771)

"BLD",4258,"KRN","B",870,870)

"BLD",4258,"KRN","B",8989.51,8989.51)

"BLD",4258,"KRN","B",8989.52,8989.52)

"BLD",4258,"KRN","B",8994,8994)

"BLD",4258,"QUES",0)
^9.62^^
"BLD",4258,"REQB",0)
^9.611^2^2
"BLD",4258,"REQB",1,0)
GMRC*3.0*22^2
"BLD",4258,"REQB",2,0)
LEX*2.0*25^2
"BLD",4258,"REQB","B","GMRC*3.0*22",1)

"BLD",4258,"REQB","B","LEX*2.0*25",2)

"MBREQ")
1
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^13
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
33^3030731
"PKG",128,22,1,"PAH",1,1,0)
^^2^2^3030731
"PKG",128,22,1,"PAH",1,1,1,0)
Refer to the National Patch Module for complete details of the 
"PKG",128,22,1,"PAH",1,1,2,0)
enhancements included in this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMRCEDT1")
0^4^B38760045
"RTN","GMRCEDT1",1,0)
GMRCEDT1 ;SLC/DCM,JFR - EDIT A CONSULT AND RE-SEND AS NEW ;3/20/03 22:22
"RTN","GMRCEDT1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,22,33**;DEC 27, 1997
"RTN","GMRCEDT1",3,0)
 ;
"RTN","GMRCEDT1",4,0)
 ; This routine invokes IA #2638,#3991
"RTN","GMRCEDT1",5,0)
 ;
"RTN","GMRCEDT1",6,0)
EN(GMRCO) ;GMRCO=IEN of consult from file 123
"RTN","GMRCEDT1",7,0)
 ;GMRCSS=To Service   GMRCPROC=Procedure Request Type
"RTN","GMRCEDT1",8,0)
 ;GMRCURG=Urgency     GMRCPL=Place Of Consultation
"RTN","GMRCEDT1",9,0)
 ;GMRCATN=Attention   GMRCINO=Service is In/Out Patient
"RTN","GMRCEDT1",10,0)
 ;GMRCPNM=Patient Name  GMRCDIAG=Provisional Diagnosis
"RTN","GMRCEDT1",11,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCINO,GMRCDIAG,LN
"RTN","GMRCEDT1",12,0)
 K ^TMP("GMRCR",$J,"ED") S GMRCLNO=1
"RTN","GMRCEDT1",13,0)
 I $L($P(^GMR(123,+GMRCO,0),"^",12)) S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CURRENT STATUS: (Not Editable): "_$P(^ORD(100.01,$P(^(0),"^",12),0),"^",1),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",14,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="" F  S GMRCDD=$O(^GMR(123,GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",15,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=19 S LN=0 D
"RTN","GMRCEDT1",16,0)
 ..N GMRCPERS,GMRCTX
"RTN","GMRCEDT1",17,0)
 ..I '$D(^GMR(123,+GMRCO,12)) D
"RTN","GMRCEDT1",18,0)
 ...S GMRCPERS=+$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",5)
"RTN","GMRCEDT1",19,0)
 ...S GMRCPERS=$$GET1^DIQ(200,GMRCPERS,.01)
"RTN","GMRCEDT1",20,0)
 ..I $D(^GMR(123,+GMRCO,12)) D
"RTN","GMRCEDT1",21,0)
 ...S GMRCPERS=$P($G(^GMR(123,+GMRCO,40,GMRCDD,2)),U,2)
"RTN","GMRCEDT1",22,0)
 ..S GMRCTX="  CANCELLED BY (Not Editable): "_GMRCPERS
"RTN","GMRCEDT1",23,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=GMRCTX,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",24,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  CANCELLED COMMENT (Not Editable):",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",25,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG)
"RTN","GMRCEDT1",26,0)
 ..I '$D(FLG) S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",27,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",$P(^(0),"-",79)=""
"RTN","GMRCEDT1",28,0)
 ..S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",29,0)
 ..Q
"RTN","GMRCEDT1",30,0)
 .Q
"RTN","GMRCEDT1",31,0)
 S GMRCSS=$S($D(GMRCEDT(1)):GMRCEDT(1),1:$P(^GMR(123,+GMRCO,0),"^",5)_U_$P(^GMR(123.5,$P(^GMR(123,+GMRCO,0),"^",5),0),U))
"RTN","GMRCEDT1",32,0)
 S GMRCPROC=$S($D(GMRCED(1)):GMRCED(1),1:$P(^GMR(123,+GMRCO,0),"^",8)_U_$$GET1^DIQ(123.3,+$P(^GMR(123,+GMRCO,0),"^",8),.01))
"RTN","GMRCEDT1",33,0)
 S GMRCURG=$S($D(GMRCED(3)):GMRCED(3),1:$P(^GMR(123,+GMRCO,0),"^",9)_U_$$GET1^DIQ(101,+$P(^(0),"^",9),1))
"RTN","GMRCEDT1",34,0)
 S GMRCPL=$S($D(GMRCED(4)):GMRCED(4),1:$P(^GMR(123,+GMRCO,0),"^",10)_U_$$GET1^DIQ(101,+$P(^(0),U,10),1))
"RTN","GMRCEDT1",35,0)
 S GMRCATN=$S($D(GMRCED(5)):GMRCED(5),1:$P(^GMR(123,+GMRCO,0),"^",11)_U_$$GET1^DIQ(200,+$P(^(0),U,11),.01))
"RTN","GMRCEDT1",36,0)
 I '$D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",37,0)
 . I $D(GMRCED(6)),$L($P(GMRCED(6),U,2)) D  Q
"RTN","GMRCEDT1",38,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",39,0)
 . S GMRCDIAG=$S($D(GMRCED(6)):GMRCED(6),1:$G(^GMR(123,+GMRCO,30)))
"RTN","GMRCEDT1",40,0)
 I $D(^GMR(123,GMRCO,30.1)) D
"RTN","GMRCEDT1",41,0)
 . I $D(GMRCED(6)),$L(GMRCED(6)) D  Q
"RTN","GMRCEDT1",42,0)
 .. S GMRCDIAG=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT1",43,0)
 . S GMRCDIAG=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT1",44,0)
 . I '$$STATCHK^ICDAPIU(^GMR(123,GMRCO,30.1),DT) D
"RTN","GMRCEDT1",45,0)
 .. S GMRCDIAG=GMRCDIAG_"   <INACTIVE CODE>"
"RTN","GMRCEDT1",46,0)
 I $D(GMRCED(2)) S GMRCINO=GMRCED(2)
"RTN","GMRCEDT1",47,0)
 I '$D(GMRCINO) S GMRCINO=$P(^GMR(123,+GMRCO,0),U,18)_U_$S($P(^(0),U,18)="I":"Inpatient",1:"Outpatient")
"RTN","GMRCEDT1",48,0)
 S GMRCREQ=$S(+$P(^GMR(123,+GMRCO,0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCEDT1",49,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="SENDING PROVIDER (Not Editable): "_$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),"^",14),.01),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",50,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="REQUEST TYPE (Not Editable): "_GMRCREQ,GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",51,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=$$REPEAT^XLFSTR("-",79),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",52,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  TO SERVICE (Not Editable): "_$P(GMRCSS,U,2) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",53,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=" ",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",54,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="1 PROCEDURE: "_$P(GMRCPROC,U,2)
"RTN","GMRCEDT1",55,0)
 D:+GMRCPROC RVRS(GMRCLNO,$D(GMRCED(1))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",56,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="2 Performed as INPT OR OUTPT: "_$P(GMRCINO,U,2) D RVRS(GMRCLNO,$D(GMRCED(2))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",57,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="3 URGENCY: "_$P(GMRCURG,U,2) D RVRS(GMRCLNO,$D(GMRCED(3))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",58,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="4 PLACE OF CONSULTATION: "_$P(GMRCPL,U,2) D RVRS(GMRCLNO,$D(GMRCED(4))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",59,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="5 ATTENTION (CONSULTANT): "_$P(GMRCATN,U,2) D RVRS(GMRCLNO,$D(GMRCED(5))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",60,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="6 PROVISIONAL DIAGNOSIS: "_GMRCDIAG D RVRS(GMRCLNO,$D(GMRCED(6))) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",61,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="7 REASON FOR REQUEST:" D RVRS(GMRCLNO,$D(^TMP("GMRCED",$J,20))) S GMRCLNO=GMRCLNO+1 D
"RTN","GMRCEDT1",62,0)
 . I $D(^TMP("GMRCED",$J,20)) D  Q
"RTN","GMRCEDT1",63,0)
 .. N ND S ND=0
"RTN","GMRCEDT1",64,0)
 .. F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT1",65,0)
 ... D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",66,0)
 ... S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT1",67,0)
 ... S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",68,0)
 . N ND S ND=0
"RTN","GMRCEDT1",69,0)
 . F  S ND=$O(^GMR(123,+GMRCO,20,ND)) Q:ND=""  D
"RTN","GMRCEDT1",70,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^GMR(123,+GMRCO,20,ND,0)
"RTN","GMRCEDT1",71,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",72,0)
 .Q
"RTN","GMRCEDT1",73,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="8 COMMENT(S): (Add Only)" D RVRS(GMRCLNO) S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",74,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT1",75,0)
 . D KILL^VALM10(GMRCLNO)
"RTN","GMRCEDT1",76,0)
 . S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="  New Comment:",GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",77,0)
 . N ND S ND=0 F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT1",78,0)
 .. S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT1",79,0)
 .. S GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",80,0)
 N GMRCEDCT
"RTN","GMRCEDT1",81,0)
 S GMRCD=0,GMRCEDCT=0 F  S GMRCD=$O(^GMR(123,+GMRCO,40,"B",GMRCD)) Q:'GMRCD  S GMRCDD="",GMRCDD=$O(^GMR(123,+GMRCO,40,"B",GMRCD,GMRCDD)) Q:'GMRCDD  D
"RTN","GMRCEDT1",82,0)
 .I $P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",2)=20 S LN=0,GMRCEDCT=GMRCEDCT+1,GMRCEDCM(GMRCEDCT)=GMRCDD D
"RTN","GMRCEDT1",83,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)="",GMRCLNO=GMRCLNO+1,^TMP("GMRCR",$J,"ED",GMRCLNO,0)="ADDED COMMENT (Not Editable) Entered: "_$P($$FMTE^XLFDT($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",1)),"@",1)
"RTN","GMRCEDT1",84,0)
 ..S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^TMP("GMRCR",$J,"ED",GMRCLNO,0)_" BY: "_$S($L($P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4)):$P(^VA(200,$P(^GMR(123,+GMRCO,40,GMRCDD,0),"^",4),0),"^",1),1:"UNKNOWN"),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",85,0)
 ..S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  I $L(^GMR(123,+GMRCO,40,GMRCDD,1,LN,0))>75 S FLG=1 D WPSET^GMRCUTIL("^GMR(123,+GMRCO,40,GMRCDD,1)","^TMP(""GMRCR"",$J,""ED"")","",.GMRCLNO,"",FLG) Q
"RTN","GMRCEDT1",86,0)
 ..S LN=0 F  S LN=$O(^GMR(123,+GMRCO,40,GMRCDD,1,LN)) Q:LN=""!(LN?1A.E)  S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=^(LN,0),GMRCLNO=GMRCLNO+1
"RTN","GMRCEDT1",87,0)
 ..Q
"RTN","GMRCEDT1",88,0)
 .Q
"RTN","GMRCEDT1",89,0)
 S ^TMP("GMRCR",$J,"ED",GMRCLNO,0)=""
"RTN","GMRCEDT1",90,0)
 K FLG
"RTN","GMRCEDT1",91,0)
 Q
"RTN","GMRCEDT1",92,0)
RVRS(LINE,EDITED) ;reverse video for fields that can be edited
"RTN","GMRCEDT1",93,0)
 I '$G(EDITED) D CNTRL^VALM10(LINE,1,1,IORVON,IORVOFF) Q
"RTN","GMRCEDT1",94,0)
 D CNTRL^VALM10(LINE,1,1,IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","GMRCEDT1",95,0)
 Q
"RTN","GMRCEDT2")
0^1^B16549229
"RTN","GMRCEDT2",1,0)
GMRCEDT2 ;SLC/JFR,DCM - RESUBMIT A CANCELLED CONSULT ;3/14/03 07:27
"RTN","GMRCEDT2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,22,33**;DEC 27, 1997
"RTN","GMRCEDT2",3,0)
EN(GMRCO,COMNO) ;entry point into the routine
"RTN","GMRCEDT2",4,0)
 ;COMNO=CMDA from ^GMRCEDT2=comments array IEN from ^GMR(123,IEN,40,
"RTN","GMRCEDT2",5,0)
 ;GMRCO=IEN of the consult from file 123
"RTN","GMRCEDT2",6,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT2",7,0)
 .S GMRCMSG="***     Consult Has Already Been Resubmitted   ***"
"RTN","GMRCEDT2",8,0)
 .S GMRCMSG(1)="***  No Further Action Is Required Or Allowed ***"
"RTN","GMRCEDT2",9,0)
 .D EXAC^GMRCADC(.GMRCMSG)
"RTN","GMRCEDT2",10,0)
 .S:'$D(GMRCRSUB) GMRCRSUB=1
"RTN","GMRCEDT2",11,0)
 .Q
"RTN","GMRCEDT2",12,0)
 N MSG S MSG=$$EDRESOK(GMRCO)
"RTN","GMRCEDT2",13,0)
 I '+MSG D EXAC^GMRCADC($P(MSG,U,2)) Q
"RTN","GMRCEDT2",14,0)
 I '$$PDOK^GMRCEDT4(GMRCO) D  Q
"RTN","GMRCEDT2",15,0)
 . D EXAC^GMRCADC("Can't resubmit!")
"RTN","GMRCEDT2",16,0)
 . S GMRCRSUB=1
"RTN","GMRCEDT2",17,0)
 . Q
"RTN","GMRCEDT2",18,0)
 I '$D(GMRCGUIF) W !,"Resubmitting Consult ... One moment please ..."
"RTN","GMRCEDT2",19,0)
 K ^TMP("GMRCSUB",$J) S ^TMP("GMRCSUB",$J)=0
"RTN","GMRCEDT2",20,0)
 I $D(GMRCEDT(1)) S ^TMP("GMRCSUB",$J,1)="GMRCSS^"_+GMRCEDT(1)
"RTN","GMRCEDT2",21,0)
 I $D(GMRCED(1)) D
"RTN","GMRCEDT2",22,0)
 . I $P(GMRCED(1),U)=$P(^GMR(123,+GMRCO,0),U,8) K GMRCED(1) Q
"RTN","GMRCEDT2",23,0)
 . S ^TMP("GMRCSUB",$J,2)="GMRCPROC^"_+GMRCED(1)_";GMR(123.3,"
"RTN","GMRCEDT2",24,0)
 I $D(GMRCED(2)) D
"RTN","GMRCEDT2",25,0)
 . I $P(GMRCED(2),U)=$P(^GMR(123,+GMRCO,0),U,18) K GMRCED(2) Q
"RTN","GMRCEDT2",26,0)
 . S ^TMP("GMRCSUB",$J,3)="GMRCION^"_$P(GMRCED(2),U)
"RTN","GMRCEDT2",27,0)
 I $D(GMRCED(3)) D
"RTN","GMRCEDT2",28,0)
 . I $P(GMRCED(3),U)=$P(^GMR(123,+GMRCO,0),U,9) K GMRCED(3) Q
"RTN","GMRCEDT2",29,0)
 . S ^TMP("GMRCSUB",$J,4)="GMRCURG^"_$P(GMRCED(3),U)
"RTN","GMRCEDT2",30,0)
 I $D(GMRCED(4)) D
"RTN","GMRCEDT2",31,0)
 . I $P(GMRCED(4),U)=$P(^GMR(123,+GMRCO,0),U,10) K GMRCED(4) Q
"RTN","GMRCEDT2",32,0)
 . S ^TMP("GMRCSUB",$J,5)="GMRCPL^"_$P(GMRCED(4),U)
"RTN","GMRCEDT2",33,0)
 I $D(GMRCED(5)) D
"RTN","GMRCEDT2",34,0)
 . I $P(GMRCED(5),U)=$P(^GMR(123,+GMRCO,0),U,11) K GMRCED(5) Q
"RTN","GMRCEDT2",35,0)
 . I '$L($P(GMRCED(5),U)) S $P(GMRCED(5),U)="@"
"RTN","GMRCEDT2",36,0)
 . S ^TMP("GMRCSUB",$J,6)="GMRCATN^"_$P(GMRCED(5),U)
"RTN","GMRCEDT2",37,0)
 I $D(GMRCED(6)) D
"RTN","GMRCEDT2",38,0)
 . I GMRCED(6)=$G(^GMR(123,+GMRCO,30)) K GMRCED(6) Q
"RTN","GMRCEDT2",39,0)
 . I $P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"=$G(^GMR(123,GMRCO,30)) K GMRCED(6) Q
"RTN","GMRCEDT2",40,0)
 . I '$L($P(GMRCED(6),U)) S $P(GMRCED(6),U,1,2)="@"
"RTN","GMRCEDT2",41,0)
 . I $L($P(GMRCED(6),U,2)),$P(GMRCED(6),U,2)'="@" D
"RTN","GMRCEDT2",42,0)
 .. S $P(GMRCED(6),U)=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT2",43,0)
 . S ^TMP("GMRCSUB",$J,7)="GMRCDIAG^"_GMRCED(6)
"RTN","GMRCEDT2",44,0)
 I $D(^TMP("GMRCED",$J,20)) S ^TMP("GMRCSUB",$J,20)="GMRCRFQ^" D
"RTN","GMRCEDT2",45,0)
 . N ND S ND=0
"RTN","GMRCEDT2",46,0)
 . F  S ND=$O(^TMP("GMRCED",$J,20,ND)) Q:'ND  D
"RTN","GMRCEDT2",47,0)
 .. S ^TMP("GMRCSUB",$J,20,ND)=^TMP("GMRCED",$J,20,ND,0)
"RTN","GMRCEDT2",48,0)
 I $D(^TMP("GMRCED",$J,40)) S ^TMP("GMRCSUB",$J,40)="COMMENT^" D
"RTN","GMRCEDT2",49,0)
 . N ND S ND=0
"RTN","GMRCEDT2",50,0)
 . F  S ND=$O(^TMP("GMRCED",$J,40,ND)) Q:'ND  D
"RTN","GMRCEDT2",51,0)
 .. S ^TMP("GMRCSUB",$J,40,ND)=^TMP("GMRCED",$J,40,ND,0)
"RTN","GMRCEDT2",52,0)
 D FILE^GMRCGUIC(+GMRCO,$NAME(^TMP("GMRCSUB",$J)),1)
"RTN","GMRCEDT2",53,0)
 N GMRCADUZ S GMRCADUZ=""
"RTN","GMRCEDT2",54,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14)
"RTN","GMRCEDT2",55,0)
 S GMRCTYPE=$P(^GMR(123,+GMRCO,0),U,17),GMRCTRLC="XX",VISIT="",RMBED=""
"RTN","GMRCEDT2",56,0)
 S DIE="^GMR(123,",DA=+GMRCO,DR="8////^S X=5;9////^S X=11" D ^DIE
"RTN","GMRCEDT2",57,0)
 K DIE,DA,DR
"RTN","GMRCEDT2",58,0)
 S GMRCRSUB=1
"RTN","GMRCEDT2",59,0)
 S GMRCURG=$P(^GMR(123,+GMRCO,0),"^",9)
"RTN","GMRCEDT2",60,0)
 I +$P(^GMR(123,+GMRCO,0),"^",11) S GMRCADUZ($P(^(0),"^",11))=""
"RTN","GMRCEDT2",61,0)
 S GMRCSVC=$P(^GMR(123,+GMRCO,0),"^",5)
"RTN","GMRCEDT2",62,0)
 I +GMRCSVC D
"RTN","GMRCEDT2",63,0)
 . D EN^GMRCT(GMRCSVC)
"RTN","GMRCEDT2",64,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)_$S(+GMRCURG:" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",1:"")
"RTN","GMRCEDT2",65,0)
 K GMRCFL,GMRCPROV,GMRCTYPE,GMRCTRLC,VISIT,RMBED,GMRCOM,GMRCURG
"RTN","GMRCEDT2",66,0)
 K GMRCSVC,GMRCORTX
"RTN","GMRCEDT2",67,0)
 Q
"RTN","GMRCEDT2",68,0)
EDRESOK(GMRCDA) ;check cslt or proc to see if still resubmittable
"RTN","GMRCEDT2",69,0)
 ; if procedure is inactive or no services, not resubmittable
"RTN","GMRCEDT2",70,0)
 ; if service is grouper or disabled, not resubmittable
"RTN","GMRCEDT2",71,0)
 N MSG,GMRC
"RTN","GMRCEDT2",72,0)
 Q:'$D(^GMR(123,+$G(GMRCDA),0)) "0^Invalid Consult Number"
"RTN","GMRCEDT2",73,0)
 I $P($G(^GMR(123,+GMRCDA,12)),U,5)="F" D  Q MSG
"RTN","GMRCEDT2",74,0)
 . S MSG="0^This inter-facility cconsult may only be resubmitted by the"
"RTN","GMRCEDT2",75,0)
 . S MSG=MSG_" ordering facility."
"RTN","GMRCEDT2",76,0)
 S GMRC(0)=^GMR(123,+GMRCDA,0)
"RTN","GMRCEDT2",77,0)
 I '$P(GMRC(0),U,8) D  Q MSG
"RTN","GMRCEDT2",78,0)
 . I "19"[+$P(^GMR(123.5,+$P(GMRC(0),U,5),0),U,2) D  Q
"RTN","GMRCEDT2",79,0)
 .. S MSG="0^The service for this Consult is no longer orderable."
"RTN","GMRCEDT2",80,0)
 . S MSG=1
"RTN","GMRCEDT2",81,0)
 S MSG=1
"RTN","GMRCEDT2",82,0)
 I "19"[+$P(^GMR(123.5,+$P(GMRC(0),U,5),0),U,2) S MSG=0
"RTN","GMRCEDT2",83,0)
 I '$L($$GET1^DIQ(123.3,+$P(GMRC(0),U,8),.01)) S MSG=0
"RTN","GMRCEDT2",84,0)
 I +$$GET1^DIQ(123.3,+$P(GMRC(0),U,8),.02) S MSG=0
"RTN","GMRCEDT2",85,0)
 I '$D(^GMR(123.3,+$P(GMRC(0),U,8),2,"B",+$P(GMRC(0),U,5))) S MSG=0
"RTN","GMRCEDT2",86,0)
 I MSG=0 D
"RTN","GMRCEDT2",87,0)
 . S MSG=MSG_"^This procedure may no longer be ordered or the service "
"RTN","GMRCEDT2",88,0)
 . S MSG=MSG_"may no longer perform it."
"RTN","GMRCEDT2",89,0)
 Q MSG
"RTN","GMRCEDT4")
0^2^B75533249
"RTN","GMRCEDT4",1,0)
GMRCEDT4 ;SLC/DCM,JFR - UTILITIES FOR EDITING FIELDS ;6/25/03 11:42
"RTN","GMRCEDT4",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,22,33**;DEC 27, 1997
"RTN","GMRCEDT4",3,0)
 ;
"RTN","GMRCEDT4",4,0)
 ; This routine invokes IA #3991
"RTN","GMRCEDT4",5,0)
 ;
"RTN","GMRCEDT4",6,0)
 Q
"RTN","GMRCEDT4",7,0)
EDITFLD(GMRCO)    ;edit field in file 123.
"RTN","GMRCEDT4",8,0)
 ;GMRCO=IEN of consult record in file 123
"RTN","GMRCEDT4",9,0)
 N DIR,X,Y,GMRCSS,GMRCPROC,GMRCPROC,GMRCURG,GMRCPL,GMRCREND,GMRCY,GMRCX
"RTN","GMRCEDT4",10,0)
 N GMRCMSG,GMRCTAG
"RTN","GMRCEDT4",11,0)
 I $S($P(^GMR(123,GMRCO,0),"^",12)'=13:1,$D(GMRCRSUB):1,1:0) D  Q
"RTN","GMRCEDT4",12,0)
 .S GMRCMSG="This consult is no longer editable." D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",13,0)
 S GMRCMSG=$$EDRESOK^GMRCEDT2(GMRCO)
"RTN","GMRCEDT4",14,0)
 I '+GMRCMSG D EXAC^GMRCADC($P(GMRCMSG,U,2)) Q
"RTN","GMRCEDT4",15,0)
 I $$PDOK(GMRCO)
"RTN","GMRCEDT4",16,0)
 S DIR(0)="LAO^1:8",DIR("A")="Select the fields to edit: "
"RTN","GMRCEDT4",17,0)
 D ^DIR I $D(DIRUT) Q
"RTN","GMRCEDT4",18,0)
 I $P(Y,",")<1 Q
"RTN","GMRCEDT4",19,0)
 S GMRCY=Y
"RTN","GMRCEDT4",20,0)
 F GMRCX=1:1:8 S GMRCTAG=$P(GMRCY,",",GMRCX) Q:'GMRCTAG  D
"RTN","GMRCEDT4",21,0)
 . D SETUP
"RTN","GMRCEDT4",22,0)
 . D @GMRCTAG
"RTN","GMRCEDT4",23,0)
 . K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCEDT4",24,0)
 . D EN^GMRCEDT1(+GMRCO),INIT^GMRCEDIT
"RTN","GMRCEDT4",25,0)
 Q
"RTN","GMRCEDT4",26,0)
SETUP   ;get info needed for edit (save global reads)
"RTN","GMRCEDT4",27,0)
 S:$D(GMRCEDT(1)) GMRCSS=GMRCEDT(1)
"RTN","GMRCEDT4",28,0)
 I '$D(GMRCSS) S GMRCSS=$P(^GMR(123,+GMRCO,0),U,5),GMRCSS=GMRCSS_U_$P(^GMR(123.5,GMRCSS,0),U)
"RTN","GMRCEDT4",29,0)
 S:$D(GMRCED(1)) GMRCPROC=GMRCED(1)
"RTN","GMRCEDT4",30,0)
 I '$D(GMRCPROC) S GMRCPROC=+$P(^GMR(123,+GMRCO,0),U,8),GMRCPROC=GMRCPROC_U_$$GET1^DIQ(123.3,+GMRCPROC,.01)
"RTN","GMRCEDT4",31,0)
 S:$D(GMRCED(2)) GMRCREND=GMRCED(2)
"RTN","GMRCEDT4",32,0)
 I '$D(GMRCREND) S GMRCREND=$P(^GMR(123,GMRCO,0),U,18),GMRCREND=GMRCREND_U_$S(GMRCREND="I":"In",1:"Out")_"patient"
"RTN","GMRCEDT4",33,0)
 S:$D(GMRCED(3)) GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",34,0)
 I '$D(GMRCURG) S GMRCURG=$P(^GMR(123,+GMRCO,0),U,9),GMRCURG=GMRCURG_U_$$GET1^DIQ(101,+GMRCURG,1)
"RTN","GMRCEDT4",35,0)
 S:$D(GMRCED(4)) GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",36,0)
 I '$D(GMRCPL) S GMRCPL=$P(^GMR(123,+GMRCO,0),U,10),GMRCPL=GMRCPL_U_$$GET1^DIQ(101,+GMRCPL,1)
"RTN","GMRCEDT4",37,0)
 Q
"RTN","GMRCEDT4",38,0)
01       ;edit TO SERVICE
"RTN","GMRCEDT4",39,0)
 N I,PROCSERV,DIR,X,Y
"RTN","GMRCEDT4",40,0)
 I $G(GMRCPROC) D  Q:'PROCSERV
"RTN","GMRCEDT4",41,0)
 . N I S I=0,PROCSERV=0 F  S I=$O(^GMR(123.3,+GMRCPROC,2,"B",I)) Q:'I  D
"RTN","GMRCEDT4",42,0)
 .. S PROCSERV(I)="",PROCSERV=PROCSERV+1
"RTN","GMRCEDT4",43,0)
 . I PROCSERV=1 W !,"Only one SERVICE can perform this procedure.",!
"RTN","GMRCEDT4",44,0)
 S DIR(0)="PA^123.5:EMQ"
"RTN","GMRCEDT4",45,0)
 I $G(PROCSERV) D
"RTN","GMRCEDT4",46,0)
 . I $D(PROCSERV(+GMRCSS)) Q
"RTN","GMRCEDT4",47,0)
 . S DIR("B")=$$GET1^DIQ(123.5,$O(PROCSERV(0)),.01)
"RTN","GMRCEDT4",48,0)
 I '$D(DIR("B")) S DIR("B")=$P(GMRCSS,U,2)
"RTN","GMRCEDT4",49,0)
 S DIR("A")="Select the Service to perform this request: "
"RTN","GMRCEDT4",50,0)
 S DIR("S")="I $P(^(0),U,2)<1"
"RTN","GMRCEDT4",51,0)
 I +$G(GMRCPROC) S DIR("S")=DIR("S")_",$D(PROCSERV(+Y))"
"RTN","GMRCEDT4",52,0)
 S DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCEDT4",53,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) Q
"RTN","GMRCEDT4",54,0)
 I Y<1!(+Y=+GMRCSS) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",55,0)
 S GMRCEDT(1)=Y,GMRCSS=Y
"RTN","GMRCEDT4",56,0)
 Q
"RTN","GMRCEDT4",57,0)
1 ;edit Procedure
"RTN","GMRCEDT4",58,0)
 W !,$C(7),"The procedure associated with a request may not be changed."
"RTN","GMRCEDT4",59,0)
 W !,"Place a new request if a different procedure is desired"
"RTN","GMRCEDT4",60,0)
 H 2
"RTN","GMRCEDT4",61,0)
 Q
"RTN","GMRCEDT4",62,0)
2       ;edit service rendered
"RTN","GMRCEDT4",63,0)
 N DIR,X,Y,GMRCURSV,GMRCPLSV,GMRCED4,GMRCED5,RENDED
"RTN","GMRCEDT4",64,0)
 S DIR(0)="S:A^I:Inpatient;O:Outpatient",DIR("B")=$P(GMRCREND,U,2)
"RTN","GMRCEDT4",65,0)
 S DIR("A")="Service to be performed Inpatient or Outpatient: "
"RTN","GMRCEDT4",66,0)
 D ^DIR I $D(DUOUT)!($D(DTOUT)) W !,$$NOCHG,! Q
"RTN","GMRCEDT4",67,0)
 I Y'=$P(GMRCREND,U) S RENDED=Y_U_Y(0)
"RTN","GMRCEDT4",68,0)
 I '$D(RENDED) Q
"RTN","GMRCEDT4",69,0)
 I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",70,0)
 . N GMRCREND,CHGIO S GMRCREND=RENDED
"RTN","GMRCEDT4",71,0)
 . W $C(7),!!,"The urgency of this request is no longer valid.",!
"RTN","GMRCEDT4",72,0)
 . S GMRCURSV=GMRCURG S:$D(GMRCED(3)) GMRCED3=GMRCED(3)
"RTN","GMRCEDT4",73,0)
 . S CHGREND="" D 3
"RTN","GMRCEDT4",74,0)
 . I '$$VALIDUR(GMRCURG,RENDED,+$G(GMRCPROC)) D  Q
"RTN","GMRCEDT4",75,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",76,0)
 .. K RENDED S GMRCURG=GMRCURSV S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",77,0)
 I '$$VALIDPL(GMRCPL,RENDED) D  I '$D(RENDED) Q
"RTN","GMRCEDT4",78,0)
 . N GMRCREND,CHGREND S GMRCREND=RENDED
"RTN","GMRCEDT4",79,0)
 . W $C(7),!!,"The Place of Consultation is no longer valid.",!
"RTN","GMRCEDT4",80,0)
 . S GMRCPLSV=GMRCPL S:$D(GMRCED(4)) GMRCED4=GMRCED(4) S CHGREND="" D 4
"RTN","GMRCEDT4",81,0)
 . I '$$VALIDPL(GMRCPL,RENDED) D  Q
"RTN","GMRCEDT4",82,0)
 .. W !,$C(7),"Unable to change the way service is rendered.",!
"RTN","GMRCEDT4",83,0)
 .. K RENDED S GMRCPL=GMRCPLSV S:$D(GMRCED4) GMRCED(4)=GMRCED4
"RTN","GMRCEDT4",84,0)
 .. S:$D(GMRCURSV) GMRCURG=GMRCURSV
"RTN","GMRCEDT4",85,0)
 .. S:$D(GMRCED3) GMRCED(3)=GMRCED3
"RTN","GMRCEDT4",86,0)
 S (GMRCREND,GMRCED(2))=RENDED
"RTN","GMRCEDT4",87,0)
 Q
"RTN","GMRCEDT4",88,0)
3 ;edit urgency
"RTN","GMRCEDT4",89,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",90,0)
 I $P(GMRCREND,U)="O" S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM - OUTPATIENT")
"RTN","GMRCEDT4",91,0)
 I '$D(Y) D  ;inpatient
"RTN","GMRCEDT4",92,0)
 .I '$G(GMRCPROC) S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM CSLT - INPATIENT") Q
"RTN","GMRCEDT4",93,0)
 .S Y=$$FIND1^DIC(101,"","QX","GMRCURGENCYM REQ - INPATIENT")
"RTN","GMRCEDT4",94,0)
 I 'Y W !,$C(7),"Unable to change urgency." Q
"RTN","GMRCEDT4",95,0)
 S XQORM=+Y_";ORD(101,",XQORM(0)="1A\",XQORM("A")="Urgency: "
"RTN","GMRCEDT4",96,0)
 S XQORM("^^NO")=0
"RTN","GMRCEDT4",97,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCURG),U,2)
"RTN","GMRCEDT4",98,0)
 D EN^XQORM
"RTN","GMRCEDT4",99,0)
 Q:Y'>0
"RTN","GMRCEDT4",100,0)
 I $P(Y(1),U,2)'=+GMRCURG D
"RTN","GMRCEDT4",101,0)
 . S GMRCED(3)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCURG=GMRCED(3)
"RTN","GMRCEDT4",102,0)
 Q
"RTN","GMRCEDT4",103,0)
4 ;edit place of CSLT
"RTN","GMRCEDT4",104,0)
 N X,Y,XQORM
"RTN","GMRCEDT4",105,0)
 S Y=$$FIND1^DIC(101,,"QX","GMRCPLACEM - "_$$UP^XLFSTR($P(GMRCREND,U,2))) Q:'Y
"RTN","GMRCEDT4",106,0)
 S XQORM=Y_";ORD(101,"
"RTN","GMRCEDT4",107,0)
 S XQORM(0)="1AR\",XQORM("A")="Place of Consultation: ",XQORM("NO^^")=""
"RTN","GMRCEDT4",108,0)
 S:'$D(CHGREND) XQORM("B")=$P($G(GMRCPL),U,2)
"RTN","GMRCEDT4",109,0)
 D EN^XQORM
"RTN","GMRCEDT4",110,0)
 Q:Y'>0
"RTN","GMRCEDT4",111,0)
 I $P(Y(1),U,2)'=+GMRCPL D
"RTN","GMRCEDT4",112,0)
 . S GMRCED(4)=$P(Y(1),U,2)_U_$P(Y(1),U,3),GMRCPL=GMRCED(4)
"RTN","GMRCEDT4",113,0)
 Q
"RTN","GMRCEDT4",114,0)
5 ;edit ATTN person
"RTN","GMRCEDT4",115,0)
 N X,Y,DIR
"RTN","GMRCEDT4",116,0)
 S DIR(0)="PAO^200:EQM",DIR("A")="Select ATTENTION person: "
"RTN","GMRCEDT4",117,0)
 S DIR("B")=$$GET1^DIQ(200,+$P(^GMR(123,+GMRCO,0),U,11),.01)
"RTN","GMRCEDT4",118,0)
 S:$D(GMRCED(5)) DIR("B")=$P($G(GMRCED(5)),U,2)
"RTN","GMRCEDT4",119,0)
 K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",120,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",121,0)
 I $G(DIR("B"))=$P(Y,U,2) Q
"RTN","GMRCEDT4",122,0)
 S GMRCED(5)=$S(Y=-1:"",1:Y)
"RTN","GMRCEDT4",123,0)
 I GMRCED(5)="" W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",124,0)
 Q
"RTN","GMRCEDT4",125,0)
6 ;edit prov. DX
"RTN","GMRCEDT4",126,0)
 N X,Y,DIC,DIR,PRMPT
"RTN","GMRCEDT4",127,0)
 S PRMPT=$$PROVDX^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCEDT4",128,0)
 I $P(PRMPT,U,2)="F" D
"RTN","GMRCEDT4",129,0)
 . S DIR(0)="FA^2:180",DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",130,0)
 . I $P(PRMPT,U)'="R" S $P(DIR(0),U)="FAO"
"RTN","GMRCEDT4",131,0)
 . S:$D(GMRCED(6)) DIR("B")=$P(GMRCED(6),U)
"RTN","GMRCEDT4",132,0)
 . I '$D(DIR("B")) S DIR("B")=$G(^GMR(123,+GMRCO,30))
"RTN","GMRCEDT4",133,0)
 . K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",134,0)
 . D ^DIR Q:$D(DTOUT)!($D(DUOUT))  Q:Y=$G(DIR("B"))
"RTN","GMRCEDT4",135,0)
 . I '$L(Y) W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",136,0)
 . S GMRCED(6)=Y
"RTN","GMRCEDT4",137,0)
 I $P(PRMPT,U,2)="L" D
"RTN","GMRCEDT4",138,0)
 . N DIR,X,Y,DTOUT,DUOUT,VAL
"RTN","GMRCEDT4",139,0)
 . I $D(GMRCED(6)) D
"RTN","GMRCEDT4",140,0)
 .. I '$L($P(GMRCED(6),U,2)) S DIR("B")=$P(GMRCED(6),U) Q
"RTN","GMRCEDT4",141,0)
 .. S DIR("B")=$P(GMRCED(6),U)_" ("_$P(GMRCED(6),U,2)_")"
"RTN","GMRCEDT4",142,0)
 . I '$D(DIR("B")) S DIR("B")=$G(^GMR(123,GMRCO,30))
"RTN","GMRCEDT4",143,0)
 . K:'$L(DIR("B")) DIR("B")
"RTN","GMRCEDT4",144,0)
 . S DIR("?")="Enter a code or term for the provisional diagnosis."
"RTN","GMRCEDT4",145,0)
 . S DIR("A")="Provisional Diagnosis: "
"RTN","GMRCEDT4",146,0)
 . S DIR(0)="FA"_$S($P(PRMPT,U)'="R":"O",1:"")_"^1:180"
"RTN","GMRCEDT4",147,0)
 . D ^DIR
"RTN","GMRCEDT4",148,0)
 . I $D(DTOUT)!($D(DUOUT)) Q
"RTN","GMRCEDT4",149,0)
 . I '$L(Y) W !,?5,"<DELETED>",! S GMRCED(6)="" Q
"RTN","GMRCEDT4",150,0)
 . I Y=$G(DIR("B")) Q
"RTN","GMRCEDT4",151,0)
 . I $E(Y,1)=" " W !,"Leading space not allowed, no change." Q
"RTN","GMRCEDT4",152,0)
 . S VAL=$$LEXLKUP(Y)
"RTN","GMRCEDT4",153,0)
 . I '$L(VAL),$P(PRMPT,U)="R" W !,"Prov. DX required. No change." Q
"RTN","GMRCEDT4",154,0)
 . I VAL=$G(^GMR(123,GMRCO,30)) W !,"No change." Q
"RTN","GMRCEDT4",155,0)
 . I ($P(VAL,U)_" ("_$P(VAL,U,2)_")")=$G(^GMR(123,GMRCO,30)) D  Q
"RTN","GMRCEDT4",156,0)
 .. W !,"No change."
"RTN","GMRCEDT4",157,0)
 . I '$L(VAL) W !,?5,"<DELETED>",!
"RTN","GMRCEDT4",158,0)
 . S GMRCED(6)=VAL
"RTN","GMRCEDT4",159,0)
 Q
"RTN","GMRCEDT4",160,0)
 ;
"RTN","GMRCEDT4",161,0)
LEXLKUP(GMRCX)  ; run input through the Lexicon
"RTN","GMRCEDT4",162,0)
 ;
"RTN","GMRCEDT4",163,0)
 N DIC,X,Y,DUOUT,DTOUT
"RTN","GMRCEDT4",164,0)
 D CONFIG^LEXSET("ICD","ICD",DT)
"RTN","GMRCEDT4",165,0)
 S DIC="^LEX(757.01,",DIC(0)="EQM",DIC("B")=GMRCX,X=GMRCX
"RTN","GMRCEDT4",166,0)
 D ^DIC
"RTN","GMRCEDT4",167,0)
 I $D(DTOUT)!($D(DUOUT))!($G(Y)<1) Q ""
"RTN","GMRCEDT4",168,0)
 Q $P(Y,U,2)_U_Y(1)
"RTN","GMRCEDT4",169,0)
 ;
"RTN","GMRCEDT4",170,0)
7 ;edit Reason for Request
"RTN","GMRCEDT4",171,0)
 N DIC,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",172,0)
 I $D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCEDSV",$J,20)=^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",173,0)
 I '$D(^TMP("GMRCED",$J,20)) M ^TMP("GMRCED",$J,20)=^GMR(123,+GMRCO,20)
"RTN","GMRCEDT4",174,0)
 S DIC="^TMP(""GMRCED"",$J,20,",DIWESUB="Reason for Request"
"RTN","GMRCEDT4",175,0)
 W !,"Editing Reason for Request:",!
"RTN","GMRCEDT4",176,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",177,0)
 I '$$DIFFRFR($D(^TMP("GMRCEDSV",$J,20))) D  Q
"RTN","GMRCEDT4",178,0)
 . I $D(^TMP("GMRCEDSV",$J,20)) K ^TMP("GMRCEDSV",$J,20) Q
"RTN","GMRCEDT4",179,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",180,0)
 K ^TMP("GMRCEDSV",$J,20)
"RTN","GMRCEDT4",181,0)
 I '$D(^TMP("GMRCED",$J,20))!('$O(^TMP("GMRCED",$J,20,0))) D
"RTN","GMRCEDT4",182,0)
 . N GMRCMSG
"RTN","GMRCEDT4",183,0)
 . S GMRCMSG="Unable to delete Reason for Request (REQUIRED)"
"RTN","GMRCEDT4",184,0)
 . D EXAC^GMRCADC(GMRCMSG)
"RTN","GMRCEDT4",185,0)
 . K ^TMP("GMRCED",$J,20)
"RTN","GMRCEDT4",186,0)
 Q
"RTN","GMRCEDT4",187,0)
8 ;add comment
"RTN","GMRCEDT4",188,0)
 N DIC,DIWEPSE,DIWESUB,DWLW,DWPK
"RTN","GMRCEDT4",189,0)
 I $D(^TMP("GMRCED",$J,40)) D
"RTN","GMRCEDT4",190,0)
 . W !,"An unsaved comment exists. You may edit this comment.",!
"RTN","GMRCEDT4",191,0)
 . S DIWEPSE=1
"RTN","GMRCEDT4",192,0)
 S DIC="^TMP(""GMRCED"",$J,40,",DIWESUB="New Comment"
"RTN","GMRCEDT4",193,0)
 W !,"Adding new comment:",!
"RTN","GMRCEDT4",194,0)
 S DWPK=1,DWLW=74 D EN^DIWE
"RTN","GMRCEDT4",195,0)
 I '$O(^TMP("GMRCED",$J,40,0)) K ^TMP("GMRCED",$J,40)
"RTN","GMRCEDT4",196,0)
 Q
"RTN","GMRCEDT4",197,0)
DIFFRFR(SAVED) ;edited reason for req same as original?
"RTN","GMRCEDT4",198,0)
 N I,DIFF
"RTN","GMRCEDT4",199,0)
 I SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^TMP("GMRCEDSV",$J,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",200,0)
 I 'SAVED,$P($G(^TMP("GMRCED",$J,20,0)),U,3,4)'=$P($G(^GMR(123,+GMRCO,20,0)),U,3,4) S DIFF=1 Q 1
"RTN","GMRCEDT4",201,0)
 I SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",202,0)
 . I ^TMP("GMRCED",$J,20,I,0)=$G(^TMP("GMRCEDSV",$J,20,I,0)) Q
"RTN","GMRCEDT4",203,0)
 . S DIFF=1
"RTN","GMRCEDT4",204,0)
 . Q
"RTN","GMRCEDT4",205,0)
 I 'SAVED S I=0 F  S I=$O(^TMP("GMRCED",$J,20,I)) Q:'I!($D(DIFF))  D
"RTN","GMRCEDT4",206,0)
 . I ^TMP("GMRCED",$J,20,I,0)'=$G(^GMR(123,+GMRCO,20,I,0)) S DIFF=1
"RTN","GMRCEDT4",207,0)
 . Q
"RTN","GMRCEDT4",208,0)
 Q $G(DIFF)
"RTN","GMRCEDT4",209,0)
VALIDPL(PL,REND) ; place still valid?
"RTN","GMRCEDT4",210,0)
 N PLMENU
"RTN","GMRCEDT4",211,0)
 S PLMENU=$S($P(REND,U)="I":"IN",1:"OUT")
"RTN","GMRCEDT4",212,0)
 S PLMENU="GMRCPLACEM - "_PLMENU_"PATIENT"
"RTN","GMRCEDT4",213,0)
 S PLMENU=$$FIND1^DIC(101,,"QX",PLMENU) Q:PLMENU'>1 0
"RTN","GMRCEDT4",214,0)
 Q $D(^ORD(101,PLMENU,10,"B",+PL))
"RTN","GMRCEDT4",215,0)
VALIDUR(URG,REND,PROC) ;urgency still valid?
"RTN","GMRCEDT4",216,0)
 N URMENU
"RTN","GMRCEDT4",217,0)
 I $P(REND,U)="I" D
"RTN","GMRCEDT4",218,0)
 .I 'PROC S URMENU="GMRCURGENCYM CSLT - INPATIENT" Q
"RTN","GMRCEDT4",219,0)
 .S URMENU="GMRCURGENCYM REQ - INPATIENT" Q
"RTN","GMRCEDT4",220,0)
 I '$D(URMENU) S URMENU="GMRCURGENCYM - OUTPATIENT"
"RTN","GMRCEDT4",221,0)
 S URMENU=$$FIND1^DIC(101,,"QX",URMENU) Q:URMENU<0 0
"RTN","GMRCEDT4",222,0)
 Q $D(^ORD(101,URMENU,10,"B",+URG))
"RTN","GMRCEDT4",223,0)
 Q
"RTN","GMRCEDT4",224,0)
NOCHG() ;no changes made
"RTN","GMRCEDT4",225,0)
 Q "No Changes made!"
"RTN","GMRCEDT4",226,0)
PDOK(GMRCDA) ;check validity of Prov. DX code for active status
"RTN","GMRCEDT4",227,0)
 N MSG
"RTN","GMRCEDT4",228,0)
 I '$L($G(^GMR(123,GMRCDA,30.1))) Q 1
"RTN","GMRCEDT4",229,0)
 I +$$STATCHK^ICDAPIU(^GMR(123,GMRCDA,30.1),DT) Q 1 ;code still active
"RTN","GMRCEDT4",230,0)
 S MSG="The provisional DX code must be edited before this request"
"RTN","GMRCEDT4",231,0)
 S MSG=MSG_" may be resubmitted."
"RTN","GMRCEDT4",232,0)
 D EN^DDIOL(MSG,,"!!")
"RTN","GMRCEDT4",233,0)
 Q 0
"RTN","GMRCGUIC")
0^3^B51068740
"RTN","GMRCGUIC",1,0)
GMRCGUIC ;SLC/DCM,JFR - GUI actions for editing consults; 3/13/03 12:21
"RTN","GMRCGUIC",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,12,20,15,22,33**;DEC 27, 1997
"RTN","GMRCGUIC",3,0)
 ;
"RTN","GMRCGUIC",4,0)
 ; This routine invokes IA #2398,#2698,#2713,#2960,#3991
"RTN","GMRCGUIC",5,0)
 ;
"RTN","GMRCGUIC",6,0)
RFQ(GMRCO,MSG,ND,NOW) ;File Reason For Request field 20
"RTN","GMRCGUIC",7,0)
 N GMRCND,GMRCNT
"RTN","GMRCGUIC",8,0)
 S GMRCND=$O(^GMR(123,GMRCO,20,0)) I GMRCND="" S GMRCFLD(20)="Reason For Request: No Previous Value^20" Q
"RTN","GMRCGUIC",9,0)
 M ^TMP("GMRCFLD20",$J,20)=^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",10,0)
 S GMRCFLD(20)=$NAME(^TMP("GMRCFLD20",$J,20))
"RTN","GMRCGUIC",11,0)
 K ^GMR(123,GMRCO,20)
"RTN","GMRCGUIC",12,0)
 S ^GMR(123,GMRCO,20,0)="^^^^"_DT_"^"
"RTN","GMRCGUIC",13,0)
 S GMRCND="",GMRCNT=1 F  S GMRCND=$O(@MSG@(ND,GMRCND)) Q:GMRCND=""  S ^GMR(123,GMRCO,20,GMRCNT,0)=@MSG@(ND,GMRCND),GMRCNT=GMRCNT+1
"RTN","GMRCGUIC",14,0)
 S $P(^GMR(123,GMRCO,20,0),"^",3)=GMRCNT-1,$P(^(0),"^",4)=GMRCNT-1
"RTN","GMRCGUIC",15,0)
 Q
"RTN","GMRCGUIC",16,0)
FILE(GMRCO,MSG,GMRCLM) ;File Edit changes
"RTN","GMRCGUIC",17,0)
 ;GMRCO=Record IEN,  GMRCCOM=Comment Array
"RTN","GMRCGUIC",18,0)
 ;MSG=^TMP global where the data resides, i.e., MSG="^TMP(""GMRCR"",$J)"
"RTN","GMRCGUIC",19,0)
 ;    Data is stored in subscripted nodes: ^TMP("GMRCR",$J,1)="GMRCSS^2"
"RTN","GMRCGUIC",20,0)
 ;    Word processing data is stored in second subscripted node:
"RTN","GMRCGUIC",21,0)
 ;    ^TMP("GMRCR",$J,9,1)="This is word processing data."
"RTN","GMRCGUIC",22,0)
 ;GMRCSS=To Service     GMRCPROC=procedure/Request Type
"RTN","GMRCGUIC",23,0)
 ;GMRCURG=Urgency       GMRCPL=Place Of Consultation
"RTN","GMRCGUIC",24,0)
 ;GMRCATN=Attention To  GMRCINO=Service is In/Out Patient
"RTN","GMRCGUIC",25,0)
 ;GMRCDIAG=Provisional Diagnosis  .GMRCRFQ=Reason For Request array
"RTN","GMRCGUIC",26,0)
 ;GMRCREQ=Procedure or Request; i.e., GMRCRQT=1727=^ORD(101,1727,0)='Procedure';GMRCRQT=1296=^ORD(101,1296,0)='Consult'
"RTN","GMRCGUIC",27,0)
 ;GMRCITM=Item ordered for field .1 (stored in ^GMR(123,GMRCO,1.11,
"RTN","GMRCGUIC",28,0)
 ;GMRCLM=coming from List Manager instead of the GUI
"RTN","GMRCGUIC",29,0)
 ;
"RTN","GMRCGUIC",30,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",31,0)
 N GMRCSS,GMRCPROC,GMRCURG,GMRCPL,GMRCATN,GMRCRQT
"RTN","GMRCGUIC",32,0)
 N GMRCION,GMRCDIAG,GMRCDXCD,GMRCACTN
"RTN","GMRCGUIC",33,0)
 S GMRCDT=$$NOW^XLFDT
"RTN","GMRCGUIC",34,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCGUIC",35,0)
 F  S GMRCNOD=$O(@MSG@(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=@MSG@(GMRCNOD) D
"RTN","GMRCGUIC",36,0)
 .I $P(GMRCMSG,"^",1)="COMMENT" D COMMENT^GMRCGUIU(GMRCO,MSG,GMRCNOD,$P(GMRCMSG,"^",2)) Q
"RTN","GMRCGUIC",37,0)
 .I $P(GMRCMSG,"^",1)="GMRCRFQ" D RFQ(GMRCO,MSG,GMRCNOD,GMRCDT) Q
"RTN","GMRCGUIC",38,0)
 .I $P(GMRCMSG,"^",1)="GMRCSS" S GMRCSS=$P(GMRCMSG,"^",2),GMRCFLD(1)=$P(^GMR(123.5,$P(^GMR(123,GMRCO,0),"^",5),0),"^",1)_"^1" Q
"RTN","GMRCGUIC",39,0)
 .I $P(GMRCMSG,"^",1)="GMRCITM" S GMRCITM=$P(GMRCMSG,"^",2),GMRCFLD(.1)=^GMR(123,GMRCO,1.11)_"^.1" Q
"RTN","GMRCGUIC",40,0)
 .I $P(GMRCMSG,"^",1)="GMRCPROC" Q  ;S GMRCFLD(4)=+$P(^GMR(123,+GMRCO,0),"^",8)_"^4" D  Q ;ignore procedure, can't be changed currently
"RTN","GMRCGUIC",41,0)
 .; ..S GMRCPROC=$P(GMRCMSG,"^",2) I $L($P(^GMR(123,GMRCO,0),"^",8)),$P(GMRCMSG,"^",2)="" S GMRCPROC="DELETE"
"RTN","GMRCGUIC",42,0)
 .I $P(GMRCMSG,"^",1)="GMRCURG" S GMRCURG=$P(GMRCMSG,"^",2),GMRCFLD(5)=$S(+$P(^GMR(123,+GMRCO,0),"^",9):$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",9),0),"^",2),1:"")_"^"_$P(^GMR(123,+GMRCO,0),"^",9) Q
"RTN","GMRCGUIC",43,0)
 .I $P(GMRCMSG,"^",1)="GMRCPL" D  Q
"RTN","GMRCGUIC",44,0)
 ..S GMRCPL=$P(GMRCMSG,"^",2) I '+GMRCPL D
"RTN","GMRCGUIC",45,0)
 ...S GMRCPL="GMRCPLACE - "_$S(GMRCPL="C":"ON CALL",GMRCPL="B":"BEDSIDE",GMRCPL="E":"EMERGENCY ROOM",1:GMRCPL),GMRCPL=$O(^ORD(101,"B",GMRCPL,0))
"RTN","GMRCGUIC",46,0)
 ..S GMRCFLD(6)=$S(+$P(^GMR(123,+GMRCO,0),"^",10):$P($P(^ORD(101,+$P(^GMR(123,+GMRCO,0),"^",10),0),"^",1)," - ",2),1:"")_"^6"
"RTN","GMRCGUIC",47,0)
 ..Q
"RTN","GMRCGUIC",48,0)
 .I $P(GMRCMSG,"^",1)="GMRCATN" S GMRCATN=$P(GMRCMSG,"^",2),GMRCFLD(7)=$S(+$P(^GMR(123,+GMRCO,0),"^",11):$P(^VA(200,+$P(^GMR(123,+GMRCO,0),"^",11),0),"^",1),1:"")_"^7" Q
"RTN","GMRCGUIC",49,0)
 .I $P(GMRCMSG,"^",1)="GMRCREQ" S GMRCREQ=$P(GMRCMSG,"^",2),GMRCFLD(13)=$S($P(^GMR(123,+GMRCO,0),"^",17)="P":"Procedure",1:"Consult")_"^13" Q
"RTN","GMRCGUIC",50,0)
 .I $P(GMRCMSG,"^",1)="GMRCION" S GMRCION=$P(GMRCMSG,"^",2),GMRCFLD(14)=$S($P(^GMR(123,+GMRCO,0),"^",18)="I":"Inpatient",$P(^(0),"^",18)="O":"Outpatient",1:"")_"^14" Q
"RTN","GMRCGUIC",51,0)
 .I $P(GMRCMSG,"^",1)="GMRCDIAG" D  Q
"RTN","GMRCGUIC",52,0)
 ..S GMRCDIAG=$P(GMRCMSG,"^",2)
"RTN","GMRCGUIC",53,0)
 ..S GMRCFLD(30)=$G(^GMR(123,+GMRCO,30))_"^30"
"RTN","GMRCGUIC",54,0)
 ..I $P(GMRCFLD(30),U)="" S $P(GMRCFLD(30),U)="No Previous Value"
"RTN","GMRCGUIC",55,0)
 ..I $L($P(GMRCMSG,U,3)) D
"RTN","GMRCGUIC",56,0)
 ...S GMRCDXCD=$P(GMRCMSG,"^",3)
"RTN","GMRCGUIC",57,0)
 ...S GMRCFLD(30.1)=$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",58,0)
 .Q
"RTN","GMRCGUIC",59,0)
 S:'$D(GMRCLM) GMRCGUIF=1
"RTN","GMRCGUIC",60,0)
 S GMRCACTN=$$EN^GMRCEDT3(GMRCO)
"RTN","GMRCGUIC",61,0)
 S DR=$$SETDA^GMRCGUIU($G(GMRCSS),$G(GMRCPROC),$G(GMRCURG),$G(GMRCPL),$G(GMRCATN),$G(GMRCRQT),$G(GMRCION),$G(GMRCDIAG),$G(GMRCDXCD)) I $L(DR) D
"RTN","GMRCGUIC",62,0)
 .S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCGUIC",63,0)
 .L +^GMR(123,GMRCO)
"RTN","GMRCGUIC",64,0)
 .D ^DIE
"RTN","GMRCGUIC",65,0)
 .S DR="8////^S X=5;9////^S X=11"
"RTN","GMRCGUIC",66,0)
 .D ^DIE
"RTN","GMRCGUIC",67,0)
 .L -^GMR(123,GMRCO)
"RTN","GMRCGUIC",68,0)
 .K DIE,DR,DA
"RTN","GMRCGUIC",69,0)
 .Q
"RTN","GMRCGUIC",70,0)
 S DFN=$P(^GMR(123,+GMRCO,0),"^",2),GMRCPROV=$P(^(0),"^",14),GMRCTYPE=$P(^(0),"^",17),GMRCTRLC="XX^RESUBMIT",VISIT="",RMBED=""
"RTN","GMRCGUIC",71,0)
 D EN^GMRCHL7(DFN,+GMRCO,GMRCTYPE,RMBED,GMRCTRLC,$G(DUZ),VISIT,.GMRCOM)
"RTN","GMRCGUIC",72,0)
 S GMRCSVC=$S($G(GMRCSS):GMRCSS,1:$P(^GMR(123,+GMRCO,0),U,5))
"RTN","GMRCGUIC",73,0)
 S GMRCORTX="Resubmitted consult "_$$ORTX^GMRCAU(+GMRCO)
"RTN","GMRCGUIC",74,0)
 S GMRCORTX=GMRCORTX_$S($G(GMRCURG):" ("_$P(^ORD(101,+GMRCURG,0),"^",2)_")",+$P(^GMR(123,+GMRCO,0),U,9):"( "_$P(^ORD(101,+$P(^GMR(123,+GMRCO,0),U,9),0),"^",2)_" )",1:"")
"RTN","GMRCGUIC",75,0)
 S GMRCFL=1
"RTN","GMRCGUIC",76,0)
 D MSG^GMRCP(DFN,GMRCORTX,+GMRCO,27,.GMRCADUZ,GMRCFL) ;Send notification of NEW consult
"RTN","GMRCGUIC",77,0)
 D PRNT^GMRCUTL1(+$P(^GMR(123,+GMRCO,0),U,5),+GMRCO) ;send 513 to service
"RTN","GMRCGUIC",78,0)
 ;Next line gets rid of alert
"RTN","GMRCGUIC",79,0)
 I $D(XQAID),$L(XQAID) D
"RTN","GMRCGUIC",80,0)
 . N GMRCCORY
"RTN","GMRCGUIC",81,0)
 . S XQAKILL=$$XQAKILL^ORB3F1 D DEL^ORB3FUP1(.GMRCCORY,XQAID)
"RTN","GMRCGUIC",82,0)
 I $P($G(^GMR(123,+GMRCO,12)),U,5)="P" D
"RTN","GMRCGUIC",83,0)
 . D TRIGR^GMRCIEVT(GMRCO,GMRCACTN)
"RTN","GMRCGUIC",84,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",85,0)
 Q
"RTN","GMRCGUIC",86,0)
SEND(GMRCO,GLOBAL) ;Get data fields to send to GUI for editing consult
"RTN","GMRCGUIC",87,0)
 ;GMRCO=record being edited GLOBAL=Global Referece, i.e., "^TMP("GMRCR",$J)"
"RTN","GMRCGUIC",88,0)
 K @GLOBAL
"RTN","GMRCGUIC",89,0)
 N ND,GMRCSX,TYPE,NDX
"RTN","GMRCGUIC",90,0)
 S ND=1,GMRCSX=""
"RTN","GMRCGUIC",91,0)
 I '$D(GMRCO)!('+GMRCO) Q
"RTN","GMRCGUIC",92,0)
 S GMRC(0)=$G(^GMR(123,+GMRCO,0)) Q:'$L(GMRC(0))
"RTN","GMRCGUIC",93,0)
 S GMRCSS=$P(GMRC(0),"^",5),GMRCPROC=$P(GMRC(0),"^",8)
"RTN","GMRCGUIC",94,0)
 S GMRCURG=$P(GMRC(0),"^",9),GMRCPL=$P(GMRC(0),"^",10)
"RTN","GMRCGUIC",95,0)
 S GMRCATN=$P(GMRC(0),"^",11),GMRCINO=$P(GMRC(0),"^",18)
"RTN","GMRCGUIC",96,0)
 S GMRCREQ=$P(GMRC(0),"^",17)
"RTN","GMRCGUIC",97,0)
 S GMRCDIAG=$G(^GMR(123,+GMRCO,30)) I $L($G(^(30.1))) D
"RTN","GMRCGUIC",98,0)
 . S GMRCDIAG=GMRCDIAG_U_$G(^GMR(123,+GMRCO,30.1))
"RTN","GMRCGUIC",99,0)
 . I '$$STATCHK^ICDAPIU($P(GMRCDIAG,U,2),DT) S GMRCDIAG=GMRCDIAG_U_1
"RTN","GMRCGUIC",100,0)
 S GMRCPROV=$S($P(^GMR(123,+GMRCO,0),U,14):$$GET1^DIQ(200,+$P(^(0),U,14),.01),1:"")
"RTN","GMRCGUIC",101,0)
 S @GLOBAL@(ND,0)="~SERVICE",ND=ND+1
"RTN","GMRCGUIC",102,0)
 I +GMRCSS S GMRCSX=$P(^GMR(123.5,GMRCSS,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCSX_"^"_GMRCSS_"^",ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",103,0)
 E  S @GLOBAL@(ND,0)="d"_"^^",ND=ND+1
"RTN","GMRCGUIC",104,0)
 S @GLOBAL@(ND,0)="~PROCEDURE",ND=ND+1
"RTN","GMRCGUIC",105,0)
 I $L(GMRCPROC),+GMRCPROC D
"RTN","GMRCGUIC",106,0)
 .S GMRCSX=$$UP^XLFSTR($$GET1^DIQ(123.3,+GMRCPROC,.01))
"RTN","GMRCGUIC",107,0)
 .S GMRCSY=$$FIND1^DIC(101.43,,"QX",+GMRCPROC_";99PRC","ID")
"RTN","GMRCGUIC",108,0)
 .I +GMRCSY D
"RTN","GMRCGUIC",109,0)
 ..S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX,ND=ND+1
"RTN","GMRCGUIC",110,0)
 ..Q
"RTN","GMRCGUIC",111,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",112,0)
 S @GLOBAL@(ND,0)="~TYPE",ND=ND+1
"RTN","GMRCGUIC",113,0)
 I $L(GMRCREQ) D  I '$L(GMRCREQ) S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",114,0)
 . S GMRCSX=$S(GMRCREQ="P":"PROCEDURE",1:"CONSULT")
"RTN","GMRCGUIC",115,0)
 . S @GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCREQ
"RTN","GMRCGUIC",116,0)
 . S GMRCSX=""
"RTN","GMRCGUIC",117,0)
 S ND=ND+1
"RTN","GMRCGUIC",118,0)
 S @GLOBAL@(ND,0)="~CATEGORY",ND=ND+1
"RTN","GMRCGUIC",119,0)
 I $L(GMRCINO) D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",120,0)
 .S @GLOBAL@(ND,0)="d"_GMRCINO_"^"_$S(GMRCINO="I":"INPATIENT",1:"OUTPATIENT")_"^"
"RTN","GMRCGUIC",121,0)
 .S @GLOBAL@(ND,0)=@GLOBAL@(ND,0)_$S(GMRCINO="I":$O(^ORD(101,"B","GMRCURGENCYM CSLT - INPATIENT",0)),1:$O(^ORD(101,"B","GMRCURGENCYM - OUTPATIENT",0)))
"RTN","GMRCGUIC",122,0)
 .Q
"RTN","GMRCGUIC",123,0)
 E  S @GLOBAL@(ND,0)="d^^"
"RTN","GMRCGUIC",124,0)
 S @GLOBAL@(ND,0)="~DIAGNOSIS",ND=ND+1
"RTN","GMRCGUIC",125,0)
 I $L(GMRCDIAG) S @GLOBAL@(ND,0)="d"_GMRCDIAG,ND=ND+1
"RTN","GMRCGUIC",126,0)
 E  S @GLOBAL@(ND,0)="d"
"RTN","GMRCGUIC",127,0)
 S @GLOBAL@(ND,0)="~PLACE",ND=ND+1
"RTN","GMRCGUIC",128,0)
 I +GMRCPL D  S ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",129,0)
 .S GMRCSX=$P($P(^ORD(101,GMRCPL,0),"^",1),"GMRCPLACE - ",2),GMRCSX=$S(GMRCSX="ON CALL":"CONSULTANTS CHOICE",1:GMRCSX),@GLOBAL@(ND,0)="d"_$E(GMRCSX,1)_"^"_GMRCSX_"^"_GMRCPL
"RTN","GMRCGUIC",130,0)
 .Q
"RTN","GMRCGUIC",131,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",132,0)
 S @GLOBAL@(ND,0)="~ATTENTION",ND=ND+1
"RTN","GMRCGUIC",133,0)
 I +GMRCATN S GMRCSX=$P(^VA(200,GMRCATN,0),"^",1),@GLOBAL@(ND,0)="d"_GMRCATN_"^"_GMRCSX_"^"_GMRCATN,ND=ND+1,GMRCSX=""
"RTN","GMRCGUIC",134,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",135,0)
 S @GLOBAL@(ND,0)="~URGENCY",ND=ND+1
"RTN","GMRCGUIC",136,0)
 I +GMRCURG S GMRCSX=$P($P(^ORD(101,GMRCURG,0),"^",1),"GMRCURGENCY - ",2),GMRCURGY=$O(^ORD(101.42,"S.GMRCO",GMRCSX,0)) I $L(GMRCSX) D
"RTN","GMRCGUIC",137,0)
 .S GMRCSY=$O(^ORD(101.42,"B",GMRCSX,0))
"RTN","GMRCGUIC",138,0)
 .S @GLOBAL@(ND,0)="d"_GMRCSY_"^"_GMRCSX_"^"_GMRCURG,ND=ND+1
"RTN","GMRCGUIC",139,0)
 .S GMRCSX="" K GMRCSY
"RTN","GMRCGUIC",140,0)
 .Q
"RTN","GMRCGUIC",141,0)
 E  S @GLOBAL@(ND,0)="d^^",ND=ND+1
"RTN","GMRCGUIC",142,0)
 ;Get reason for request
"RTN","GMRCGUIC",143,0)
 S @GLOBAL@(ND,0)="~REASON",ND=ND+1
"RTN","GMRCGUIC",144,0)
 I $O(^GMR(123,+GMRCO,20,0)) S NDX=0 F  S NDX=$O(^GMR(123,+GMRCO,20,NDX)) Q:NDX=""  S @GLOBAL@(ND,0)="t"_^GMR(123,+GMRCO,20,NDX,0),ND=ND+1
"RTN","GMRCGUIC",145,0)
 E  S @GLOBAL@(ND,0)="~REASON",ND=ND+1,@GLOBAL@(ND,0)="tREASON "
"RTN","GMRCGUIC",146,0)
 ;Get Comments, including Deny Comments
"RTN","GMRCGUIC",147,0)
 D SENDCOMT^GMRCGUIU(GMRCO,.ND)
"RTN","GMRCGUIC",148,0)
 D GUIC^GMRCGUIU
"RTN","GMRCGUIC",149,0)
 Q
"RTN","GMRCHL7A")
0^5^B27421740
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM,MA - Receive HL-7 Message from OERR ;3/7/02 13:20
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,21,22,33**;DEC 27, 1997
"RTN","GMRCHL7A",3,0)
 ;
"RTN","GMRCHL7A",4,0)
 ; This routine invokes IA #2849
"RTN","GMRCHL7A",5,0)
 ;
"RTN","GMRCHL7A",6,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","GMRCHL7A",7,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","GMRCHL7A",8,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","GMRCHL7A",9,0)
 Q X
"RTN","GMRCHL7A",10,0)
 ;
"RTN","GMRCHL7A",11,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",12,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",13,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",14,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",15,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",16,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",17,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",18,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",19,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",20,0)
 I $L(GMRCURGI) S GMRCURGI="GMRCURGENCY - "_$$URG(GMRCURGI),GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",21,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",22,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",23,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",24,0)
 Q
"RTN","GMRCHL7A",25,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",26,0)
 ;GMRCTYPE=GMRC consult or GMRC request  GMRCSS=To Service
"RTN","GMRCHL7A",27,0)
 ;GMRCPLI=place of consultation          GMRCODT=observation date/time
"RTN","GMRCHL7A",28,0)
 ;GMRCATN=person to alert (attention)    GMRCSTDT=status change date/time
"RTN","GMRCHL7A",29,0)
 ;GMRCS123=results status (table 123)    GMRCINTR=results interpreter
"RTN","GMRCHL7A",30,0)
 ;GMRCPRI=procedure from file ^ORD(101,  
"RTN","GMRCHL7A",31,0)
 ;GMRCXMF=foreign consult service
"RTN","GMRCHL7A",32,0)
 ;        a flag that tells the HL7 routine that
"RTN","GMRCHL7A",33,0)
 ;        consults does not need to return CPRS a file
"RTN","GMRCHL7A",34,0)
 ;        IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",35,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6)
"RTN","GMRCHL7A",36,0)
 S GMRCTYPE=$S(GMRCPR="99PRC":"P",1:"C")
"RTN","GMRCHL7A",37,0)
 S GMRCPRI="",GMRCSS=""
"RTN","GMRCHL7A",38,0)
 I GMRCPR="99PRC" D
"RTN","GMRCHL7A",39,0)
 . S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",40,0)
 . S GMRCPRI=$S(+GMRCPRI:GMRCPRI_";GMR(123.3,",1:"")
"RTN","GMRCHL7A",41,0)
 . Q
"RTN","GMRCHL7A",42,0)
 ;
"RTN","GMRCHL7A",43,0)
 S GMRCOTXT=$P($P(GMRCOBR,SEP1,5),SEP2,5) ;consult type or service name
"RTN","GMRCHL7A",44,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",45,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="OC":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",46,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",47,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",48,0)
 Q
"RTN","GMRCHL7A",49,0)
ZSV(GMRCZSV) ;Get service from ZSV segment and set into GMRCSS
"RTN","GMRCHL7A",50,0)
 S GMRCZSS=$P($P(GMRCZSV,SEP1,2),SEP2,4)
"RTN","GMRCHL7A",51,0)
 I +$G(GMRCZSS) S GMRCSS=+$G(GMRCZSS) ;Set the service if ZSV provided
"RTN","GMRCHL7A",52,0)
 I $L($P(GMRCZSV,"|",3)) S GMRCOTXT=$P(GMRCZSV,"|",3) ;consult type
"RTN","GMRCHL7A",53,0)
 Q
"RTN","GMRCHL7A",54,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",55,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",56,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",57,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",58,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",59,0)
 ;    free text or code^free text^I9C
"RTN","GMRCHL7A",60,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",61,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",62,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",63,0)
 .S GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",64,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",65,0)
 .Q
"RTN","GMRCHL7A",66,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","GMRCHL7A",67,0)
 . I GMRCVTYP="TX" S GMRCPRDG=$P(GMRCMSG,SEP1,6) Q
"RTN","GMRCHL7A",68,0)
 . I GMRCVTYP="CE" D  Q
"RTN","GMRCHL7A",69,0)
 .. N PRDXSEG S PRDXSEG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",70,0)
 .. S GMRCPRDG=$P(PRDXSEG,"^",2)_" ("_$P(PRDXSEG,"^")_")"
"RTN","GMRCHL7A",71,0)
 .. S GMRCPRCD=$P(PRDXSEG,"^")
"RTN","GMRCHL7A",72,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",73,0)
 .S GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",74,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",75,0)
 .Q
"RTN","GMRCHL7A",76,0)
 K LN
"RTN","GMRCHL7A",77,0)
 Q
"RTN","GMRCHL7A",78,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",79,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",80,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",81,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",82,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP
"RTN","GMRCHL7A",83,0)
 N GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN
"RTN","GMRCHL7A",84,0)
 N GMRCTRLC,GMRCAD,ORC,GMRCSBR,GMRCZSS,GMRCSS,GMRCOTXT,GMRCPRCD
"RTN","GMRCHL7A",85,0)
 N GMRCREJ,GMRCRECV
"RTN","GMRCHL7A",86,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",87,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4)
"RTN","GMRCHL7A",88,0)
 .S GMRCMTP=$P(GMRCMSG,SEP1,9),GMRCRECV=$P(GMRCMSG,SEP1,5)
"RTN","GMRCHL7A",89,0)
 .Q
"RTN","GMRCHL7A",90,0)
 I $G(GMRCRECV)'="CONSULTS" Q  ;not intended for Consults
"RTN","GMRCHL7A",91,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",92,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",93,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",94,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",95,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG) Q
"RTN","GMRCHL7A",96,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",97,0)
 .I $E(GMRCMSG,1,3)="ZSV" D ZSV(GMRCMSG) Q
"RTN","GMRCHL7A",98,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",99,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",100,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K MSG(GMRCNOD) Q 
"RTN","GMRCHL7A",101,0)
 .Q
"RTN","GMRCHL7A",102,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",103,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",104,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",105,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B(.GMRCREJ) D
"RTN","GMRCHL7A",106,0)
 . I $G(GMRCO) D RETURN^GMRCHL7U(GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",107,0)
 . D REJECT^GMRCHL7U(.MSG,$G(GMRCREJ))
"RTN","GMRCHL7A",108,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",109,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",110,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",111,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by CPRS
"RTN","GMRCHL7A",112,0)
 ; If consults sends an XX, CPRS returns an NA.
"RTN","GMRCHL7A",113,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",114,0)
 Q
"RTN","GMRCHL7A",115,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123, 
"RTN","GMRCHL7A",116,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",117,0)
 L +^GMR(123,DA) D ^DIE L -^GMR(123,DA)
"RTN","GMRCHL7A",118,0)
 K DIE,DR
"RTN","GMRCHL7A",119,0)
 Q
"RTN","GMRCHL7B")
0^6^B25860722
"RTN","GMRCHL7B",1,0)
GMRCHL7B ;SLC/DCM,MA,JFR - Process data from GMRCHL7A ; 3/7/03 14:42
"RTN","GMRCHL7B",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,21,17,22,33**;DEC 27, 1997
"RTN","GMRCHL7B",3,0)
 ;
"RTN","GMRCHL7B",4,0)
 ; This routine invokes IA #3991
"RTN","GMRCHL7B",5,0)
 ;
"RTN","GMRCHL7B",6,0)
NEW(MESSAGE) ;Add new order
"RTN","GMRCHL7B",7,0)
 ;GMRCO=^GMR(123,IFN, the new file number in file ^GMR(123,
"RTN","GMRCHL7B",8,0)
 ;GMRCORFN=OE/RR file number       GMRCWARD=ward patient is on
"RTN","GMRCHL7B",9,0)
 ;GMRCSS=service consult sent to   GMRCAD=date/time of request
"RTN","GMRCHL7B",10,0)
 ;GMRCPRI=procedure/request        GMRCURGI=urgency
"RTN","GMRCHL7B",11,0)
 ;GMRCATN=attention                GMRCSTS=OE/RR order status
"RTN","GMRCHL7B",12,0)
 ;GMRCORNP=patient's provider      GMRCTYPE=request type (request or consult)
"RTN","GMRCHL7B",13,0)
 ;GMRCSBR=service rendered on what basis (Inpatient, or Outpatient)
"RTN","GMRCHL7B",14,0)
 ;GMRCRFQ=reason for request array - word processing fields
"RTN","GMRCHL7B",15,0)
 ;GMRCOTXT=order display text from dialog or orderable item
"RTN","GMRCHL7B",16,0)
 ;GMRCPRDG=provisional DX
"RTN","GMRCHL7B",17,0)
 ;GMRCPRCD=provisional DX code 
"RTN","GMRCHL7B",18,0)
 ;
"RTN","GMRCHL7B",19,0)
 ; Output:
"RTN","GMRCHL7B",20,0)
 ;    MESSAGE = rejection message if problems encountered while filing
"RTN","GMRCHL7B",21,0)
 ;
"RTN","GMRCHL7B",22,0)
 ;    check for inactive ICD-9 code in Prov. DX
"RTN","GMRCHL7B",23,0)
 I $L($G(GMRCPRCD)) D  I $D(MESSAGE) Q  ; rejected due to inactive code
"RTN","GMRCHL7B",24,0)
 . I +$$STATCHK^ICDAPIU(GMRCPRCD,DT) Q  ;code is OK
"RTN","GMRCHL7B",25,0)
 . S MESSAGE="Provisional DX code is inactive. Unable to file request."
"RTN","GMRCHL7B",26,0)
 ;
"RTN","GMRCHL7B",27,0)
 N DIC,DLAYGO,X,DR,DIE,GMRCADUZ,GMRCCP
"RTN","GMRCHL7B",28,0)
 S DIC="^GMR(123,",DIC(0)="L",X="""N""",DLAYGO=123 D ^DIC K DLAYGO Q:Y<1
"RTN","GMRCHL7B",29,0)
 ; Patch #21 changed GMRCA=1 to GMRCA=2
"RTN","GMRCHL7B",30,0)
 S (DA,GMRCO)=+Y,GMRCSTS=5,GMRCA=2,DIE=DIC
"RTN","GMRCHL7B",31,0)
 L +^GMR(123,GMRCO)
"RTN","GMRCHL7B",32,0)
 S DR=".02////^S X=DFN;.03////^S X=GMRCORFN;.04////^S X=GMRCWARD;.05////^S X=GMRCFAC;.06////^S X=$G(GMRCOFN);1////^S X=GMRCSS;2////^S X=$G(GMRCWARD);3////^S X=GMRCAD;4////^S X=GMRCPRI;5////^S X=GMRCURGI;7////^S X=$G(GMRCATN)"
"RTN","GMRCHL7B",33,0)
 D ^DIE
"RTN","GMRCHL7B",34,0)
 I GMRCOTXT=$$GET1^DIQ(123.5,+GMRCSS,.01) S GMRCOTXT=""
"RTN","GMRCHL7B",35,0)
 ;Added new field .1 to DR on 7/11/98 to save the order text
"RTN","GMRCHL7B",36,0)
 S DR="6////^S X=GMRCPLI;8////^S X=GMRCSTS;9////^S X=GMRCA;10////^S X=GMRCORNP;13////^S X=GMRCTYPE;14////^S X=$G(GMRCSBR);30////^S X=$G(GMRCPRDG);.1////^S X=$G(GMRCOTXT)"
"RTN","GMRCHL7B",37,0)
 I $D(GMRCPRCD) S DR=DR_";30.1///^S X=GMRCPRCD"
"RTN","GMRCHL7B",38,0)
 S GMRCCP=$P($G(^GMR(123.3,+GMRCPRI,0)),U,4) I GMRCCP D  ;file CP 
"RTN","GMRCHL7B",39,0)
 . S DR=DR_";1.01///^S X=GMRCCP"
"RTN","GMRCHL7B",40,0)
 D  ;check to see if an IFC and add .07 ROUTING FACILITY
"RTN","GMRCHL7B",41,0)
 . I $G(GMRCPRI) D  Q  ;see if procedure is mapped
"RTN","GMRCHL7B",42,0)
 .. I '$D(^GMR(123.3,+GMRCPRI,"IFC")) Q
"RTN","GMRCHL7B",43,0)
 .. N IFC S IFC=$G(^GMR(123.3,+GMRCPRI,"IFC"))
"RTN","GMRCHL7B",44,0)
 .. I '+IFC Q  ; no ifc routing site
"RTN","GMRCHL7B",45,0)
 .. I '$L($P(^GMR(123.3,+GMRCPRI,"IFC"),U,2)) Q  ;no remote proc name
"RTN","GMRCHL7B",46,0)
 .. S DR=DR_";.07////"_+IFC_";.125////P"
"RTN","GMRCHL7B",47,0)
 . I '$G(GMRCPRI) D  Q  ;see if service is mapped
"RTN","GMRCHL7B",48,0)
 .. I '$D(^GMR(123.5,+GMRCSS,"IFC")) Q
"RTN","GMRCHL7B",49,0)
 .. N IFC S IFC=$G(^GMR(123.5,+GMRCSS,"IFC"))
"RTN","GMRCHL7B",50,0)
 .. I '+IFC Q  ; no ifc routing site
"RTN","GMRCHL7B",51,0)
 .. I '$L($P(IFC,U,2)) Q  ;no remote service name
"RTN","GMRCHL7B",52,0)
 .. S DR=DR_";.07////"_+IFC_";.125////P;.131////"_$P(IFC,U,2)
"RTN","GMRCHL7B",53,0)
 . Q
"RTN","GMRCHL7B",54,0)
 D ^DIE
"RTN","GMRCHL7B",55,0)
 I $O(GMRCRFQ(0)) D REASON
"RTN","GMRCHL7B",56,0)
 L -^GMR(123,GMRCO)
"RTN","GMRCHL7B",57,0)
 S GMRCA=1 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",58,0)
 I $D(GMRCXMF),$D(GMRCOFN) S $P(^GMR(123,GMRCO,0),"^",21)=GMRCOFN
"RTN","GMRCHL7B",59,0)
 I $D(GMRCACTN) S GMRCADUZ(GMRCACTN)=""
"RTN","GMRCHL7B",60,0)
 D ALERT^GMRCHL7U(DFN,GMRCSS,GMRCPRI,GMRCO,GMRCURGI,"")
"RTN","GMRCHL7B",61,0)
 D PRNT^GMRCUTL1(GMRCSS,GMRCO) ;contains print audit update
"RTN","GMRCHL7B",62,0)
 D EXIT
"RTN","GMRCHL7B",63,0)
 Q
"RTN","GMRCHL7B",64,0)
DC(GMRCO,ACTRL) ;Discontinue request from OERR
"RTN","GMRCHL7B",65,0)
 ;Denied request also gets this action. Deny request updates status to dc
"RTN","GMRCHL7B",66,0)
 ;GMRCO=IEN of record in file ^GMR(123, i.e., ^GMR(123,DA,
"RTN","GMRCHL7B",67,0)
 ;ACTRL=GMRCCTRL=control code defining action -
"RTN","GMRCHL7B",68,0)
 ;         DC control code = action DC for discontinued 
"RTN","GMRCHL7B",69,0)
 ;         CA control code = action DY for denied
"RTN","GMRCHL7B",70,0)
 ;Update the last action taken, order status, and processing activity
"RTN","GMRCHL7B",71,0)
 Q:'$L(GMRCO)
"RTN","GMRCHL7B",72,0)
 Q:'$D(^GMR(123,+GMRCO,0))
"RTN","GMRCHL7B",73,0)
 N GMRCACT,GMRCSVC,GMRCDFN,GMRCFL,GMRCADUZ,GMRCRQR,DA
"RTN","GMRCHL7B",74,0)
 S GMRCACT=$O(^GMR(123.1,"D",ACTRL,0))
"RTN","GMRCHL7B",75,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",76,0)
 S DIE="^GMR(123,",DA=GMRCO
"RTN","GMRCHL7B",77,0)
 S DR="8////^S X=GMRCSTS;9////^S X=GMRCACT" ; upd status + last action
"RTN","GMRCHL7B",78,0)
 D ^DIE
"RTN","GMRCHL7B",79,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",80,0)
 ; send 513 back through service printer if order DC'd
"RTN","GMRCHL7B",81,0)
 I $G(ACTRL)="DC",$$DCPRNT^GMRCUTL1(GMRCO,DUZ) D
"RTN","GMRCHL7B",82,0)
 . D PRNT^GMRCUTL1(+$P(^GMR(123,GMRCO,0),U,5),GMRCO)
"RTN","GMRCHL7B",83,0)
 S GMRCDFN=$P(^GMR(123,+GMRCO,0),"^",2)
"RTN","GMRCHL7B",84,0)
 S GMRCFL=$$DCNOTE^GMRCADC(GMRCO,DUZ),GMRCADUZ=""
"RTN","GMRCHL7B",85,0)
 S GMRCRQR=+$P($G(^GMR(123,+GMRCO,0)),"^",14)
"RTN","GMRCHL7B",86,0)
 I +GMRCRQR,GMRCRQR'=DUZ S GMRCADUZ(GMRCRQR)=""
"RTN","GMRCHL7B",87,0)
 S GMRCSVC=$P($G(^GMR(123,+GMRCO,0)),"^",5)
"RTN","GMRCHL7B",88,0)
 I +GMRCSVC S GMRCSVC=$S($D(^GMR(123.5,GMRCSVC,.1)):^(.1),1:$P(^GMR(123.5,GMRCSVC,0),"^",1))
"RTN","GMRCHL7B",89,0)
 E  S GMRCSVC="Unknown Service: Consult # "_GMRCO
"RTN","GMRCHL7B",90,0)
 S GMRCORTX=$S(ACTRL="DC":"Discontinued",1:"Cancelled")
"RTN","GMRCHL7B",91,0)
 S GMRCORTX=GMRCORTX_" Consult "_$$ORTX^GMRCAU(GMRCO)
"RTN","GMRCHL7B",92,0)
 N NOTYPE S NOTYPE=$S(ACTRL="DC":23,1:30)
"RTN","GMRCHL7B",93,0)
 D MSG^GMRCP(GMRCDFN,GMRCORTX,+GMRCO,NOTYPE,.GMRCADUZ,GMRCFL)
"RTN","GMRCHL7B",94,0)
 D EXIT
"RTN","GMRCHL7B",95,0)
 Q
"RTN","GMRCHL7B",96,0)
MODIFY ;Change an order/request when an HL7 'XX' code is received
"RTN","GMRCHL7B",97,0)
 ;This is currently not used.
"RTN","GMRCHL7B",98,0)
 ;    When Consults sends an XX, CPRS returns NA with a new order ien.
"RTN","GMRCHL7B",99,0)
 ;GMRCACT=processing activity - from file ^GMR(123.1,
"RTN","GMRCHL7B",100,0)
 S DIE="^GMR(123,",DA=+GMRCO
"RTN","GMRCHL7B",101,0)
 S GMRCWARD=$G(GMRCWARD),GMRCPRI=$G(GMRCPRI),GMRCURGI=$G(GMRCURGI),GMRCSTS=$G(GMRCSTS),GMRCTYPE=$G(GMRCTYPE),GMRCSS=$G(GMRCSS)
"RTN","GMRCHL7B",102,0)
 S GMRCACT=$O(^GMR(123.1,"D",GMRCTRLC,0))
"RTN","GMRCHL7B",103,0)
 S GMRCSTS=$P(^GMR(123.1,GMRCACT,0),"^",2)
"RTN","GMRCHL7B",104,0)
 S DIE=123,DR=".04////^S X=$G(GMRCWARD);1////^S X=$G(GMRCSS);4////^S X=$G(GMRCPRI);5////^S X=$G(GMRCURGI);8////^S X=$G(GMRCSTS);9////^S X=GMRCACT"
"RTN","GMRCHL7B",105,0)
 D ^DIE
"RTN","GMRCHL7B",106,0)
 D AUDIT0^GMRCHL7U
"RTN","GMRCHL7B",107,0)
 D EXIT Q
"RTN","GMRCHL7B",108,0)
REASON ;load the reason for request into ^GMR(123,IFN,20
"RTN","GMRCHL7B",109,0)
 S ^GMR(123,GMRCO,20,0)="^^^"_$S($D(GMRCDA):GMRCDA,1:DT)_"^"
"RTN","GMRCHL7B",110,0)
 S L=0,LN=1 F  S L=$O(GMRCRFQ(L)) Q:L=""  S ^GMR(123,GMRCO,20,LN,0)=GMRCRFQ(L),LN=LN+1
"RTN","GMRCHL7B",111,0)
 S LN=LN-1,$P(^GMR(123,GMRCO,20,0),"^",3)=LN
"RTN","GMRCHL7B",112,0)
 K L,LN
"RTN","GMRCHL7B",113,0)
 Q
"RTN","GMRCHL7B",114,0)
COMMENT(GMRCARY) ;add comments to the record.  Add the comment header, then the comment lines, and lastly, the number of comment lines to the header
"RTN","GMRCHL7B",115,0)
 ;GMRCARY= GMRCNTC array
"RTN","GMRCHL7B",116,0)
 S LN=0,^GMR(123,GMRCO,40,DA,1,0)="^^^^"_$P(GMRCDA,".",1)_"^"
"RTN","GMRCHL7B",117,0)
 F  S LN=$O(GMRCARY(LN)) Q:LN=""  S ^GMR(123,+GMRCO,40,DA,1,LN,0)=GMRCARY(LN),LN1=LN
"RTN","GMRCHL7B",118,0)
 S $P(^GMR(123,+GMRCO,40,DA,1,0),"^",3,4)=LN1_"^"_LN1
"RTN","GMRCHL7B",119,0)
 K LN,LN1 Q
"RTN","GMRCHL7B",120,0)
 Q
"RTN","GMRCHL7B",121,0)
EXIT ;kill off all variables
"RTN","GMRCHL7B",122,0)
 K DA,DIC,DIE,DR,GMRCORTX,GMRCADUZ
"RTN","GMRCHL7B",123,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
TIU*1.0*161
"BLD",4298,0)
TIU*1.0*161^TEXT INTEGRATION UTILITIES^0^3030731^y
"BLD",4298,1,0)
^^2^2^3030409^^
"BLD",4298,1,1,0)
The description for this patch may be found in the National Patch Module 
"BLD",4298,1,2,0)
under TIU*1.0*161.
"BLD",4298,4,0)
^9.64PA^^
"BLD",4298,"ABPKG")
n
"BLD",4298,"KRN",0)
^9.67PA^8989.52^19
"BLD",4298,"KRN",.4,0)
.4
"BLD",4298,"KRN",.401,0)
.401
"BLD",4298,"KRN",.402,0)
.402
"BLD",4298,"KRN",.403,0)
.403
"BLD",4298,"KRN",.5,0)
.5
"BLD",4298,"KRN",.84,0)
.84
"BLD",4298,"KRN",3.6,0)
3.6
"BLD",4298,"KRN",3.8,0)
3.8
"BLD",4298,"KRN",9.2,0)
9.2
"BLD",4298,"KRN",9.8,0)
9.8
"BLD",4298,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",4298,"KRN",9.8,"NM",1,0)
TIUPXAPI^^0^B67812452
"BLD",4298,"KRN",9.8,"NM",2,0)
TIUPXAPC^^0^B59137552
"BLD",4298,"KRN",9.8,"NM",3,0)
TIUPXAPM^^0^B5340040
"BLD",4298,"KRN",9.8,"NM","B","TIUPXAPC",2)

"BLD",4298,"KRN",9.8,"NM","B","TIUPXAPI",1)

"BLD",4298,"KRN",9.8,"NM","B","TIUPXAPM",3)

"BLD",4298,"KRN",19,0)
19
"BLD",4298,"KRN",19.1,0)
19.1
"BLD",4298,"KRN",101,0)
101
"BLD",4298,"KRN",409.61,0)
409.61
"BLD",4298,"KRN",771,0)
771
"BLD",4298,"KRN",870,0)
870
"BLD",4298,"KRN",8989.51,0)
8989.51
"BLD",4298,"KRN",8989.52,0)
8989.52
"BLD",4298,"KRN",8994,0)
8994
"BLD",4298,"KRN","B",.4,.4)

"BLD",4298,"KRN","B",.401,.401)

"BLD",4298,"KRN","B",.402,.402)

"BLD",4298,"KRN","B",.403,.403)

"BLD",4298,"KRN","B",.5,.5)

"BLD",4298,"KRN","B",.84,.84)

"BLD",4298,"KRN","B",3.6,3.6)

"BLD",4298,"KRN","B",3.8,3.8)

"BLD",4298,"KRN","B",9.2,9.2)

"BLD",4298,"KRN","B",9.8,9.8)

"BLD",4298,"KRN","B",19,19)

"BLD",4298,"KRN","B",19.1,19.1)

"BLD",4298,"KRN","B",101,101)

"BLD",4298,"KRN","B",409.61,409.61)

"BLD",4298,"KRN","B",771,771)

"BLD",4298,"KRN","B",870,870)

"BLD",4298,"KRN","B",8989.51,8989.51)

"BLD",4298,"KRN","B",8989.52,8989.52)

"BLD",4298,"KRN","B",8994,8994)

"BLD",4298,"QUES",0)
^9.62^^
"BLD",4298,"REQB",0)
^9.611^4^3
"BLD",4298,"REQB",2,0)
TIU*1.0*126^2
"BLD",4298,"REQB",3,0)
IBD*3.0*51^2
"BLD",4298,"REQB",4,0)
LEX*2.0*25^2
"BLD",4298,"REQB","B","IBD*3.0*51",3)

"BLD",4298,"REQB","B","LEX*2.0*25",4)

"BLD",4298,"REQB","B","TIU*1.0*126",2)

"MBREQ")
1
"PKG",193,-1)
1^1
"PKG",193,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",193,20,0)
^9.402P^^
"PKG",193,22,0)
^9.49I^1^1
"PKG",193,22,1,0)
1.0^3010321^3010321^11
"PKG",193,22,1,"PAH",1,0)
161^3030731
"PKG",193,22,1,"PAH",1,1,0)
^^2^2^3030731
"PKG",193,22,1,"PAH",1,1,1,0)
The description for this patch may be found in the National Patch Module 
"PKG",193,22,1,"PAH",1,1,2,0)
under TIU*1.0*161.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","TIUPXAPC")
0^2^B59137552
"RTN","TIUPXAPC",1,0)
TIUPXAPC ; SLC/JER - Get CPT stuff ;5/8/03@10:27
"RTN","TIUPXAPC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**15,24,62,82,161**;Jun 20, 1997
"RTN","TIUPXAPC",3,0)
TEST ; Check it out
"RTN","TIUPXAPC",4,0)
 N TIULOC,CPTARR,CPT,TIUI
"RTN","TIUPXAPC",5,0)
 S TIULOC=+$$SELLOC^TIUVSIT,TIUI=0
"RTN","TIUPXAPC",6,0)
 D GETCPT(TIULOC,.CPTARR)
"RTN","TIUPXAPC",7,0)
 D CPT(.CPT,.CPTARR)
"RTN","TIUPXAPC",8,0)
 W ! F  S TIUI=$O(CPT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPXAPC",9,0)
 . W !,"CPT(",TIUI,")=",CPT(TIUI),!,"CPT(",TIUI,",""QTY"")="
"RTN","TIUPXAPC",10,0)
 . W CPT(TIUI,"QTY")
"RTN","TIUPXAPC",11,0)
 Q
"RTN","TIUPXAPC",12,0)
 ; Pass encounter date from TIUPXAPI to IBDF18A **161**
"RTN","TIUPXAPC",13,0)
GETCPT(TIULOC,CPTARR,TIUVDT) ; Get CPT codes for clinic
"RTN","TIUPXAPC",14,0)
 N TIUI,TIUROW,TIUCOL,ARRY2,TIUITM,TIUPAGE,EMARRY,TIUCAT S TIUCAT=""
"RTN","TIUPXAPC",15,0)
 ; Pass encounter date as 5th parameter to IBDF18A **161**
"RTN","TIUPXAPC",16,0)
 D GETLST^IBDF18A(+TIULOC,"DG SELECT VISIT TYPE CPT PROCEDURES","EMARRY",,,1,TIUVDT)
"RTN","TIUPXAPC",17,0)
 D GETLST^IBDF18A(+TIULOC,"DG SELECT CPT PROCEDURE CODES","ARRY2",,,1,TIUVDT)
"RTN","TIUPXAPC",18,0)
 I $D(EMARRY)>9 D CMBLST^TIUPXAP2(.EMARRY,.ARRY2) K EMARRY
"RTN","TIUPXAPC",19,0)
 S (TIUI,TIUROW,TIUITM)=0,(TIUCOL,TIUPAGE)=1
"RTN","TIUPXAPC",20,0)
 F  S TIUI=$O(ARRY2(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPXAPC",21,0)
 . I $P(ARRY2(TIUI),U)]"" D  I 1
"RTN","TIUPXAPC",22,0)
 . . S TIUROW=+$G(TIUROW)+1,TIUITM=+$G(TIUITM)+1
"RTN","TIUPXAPC",23,0)
 . . ;Set CPT Display Array: Item #^CPT Code^Description^Group
"RTN","TIUPXAPC",24,0)
 . . S CPTARR(TIUROW,TIUCOL)=TIUITM_U_$P($G(ARRY2(TIUI)),U,1,2)_U_TIUCAT
"RTN","TIUPXAPC",25,0)
 . . S CPTARR("INDEX",TIUITM)=$P($G(ARRY2(TIUI)),U,1,2)_U_TIUCAT
"RTN","TIUPXAPC",26,0)
 . . ;If pre-selected CPT Modifiers are defined, add them to CPT Display Array
"RTN","TIUPXAPC",27,0)
 . . ;Pass encounter date to ADDMOD call to pass to ICPTMOD for CSV *161
"RTN","TIUPXAPC",28,0)
 . . I +$G(ARRY2(TIUI,"MODIFIER",0))>0 D ADDMOD(TIUITM,TIUI,.CPTARR,.ARRY2,.TIUROW,.TIUCOL,.TIUPAGE,TIUVDT)
"RTN","TIUPXAPC",29,0)
 . . K ARRY2(TIUI)
"RTN","TIUPXAPC",30,0)
 . E  D
"RTN","TIUPXAPC",31,0)
 . . S TIUROW=+$G(TIUROW)+1
"RTN","TIUPXAPC",32,0)
 . . S TIUCAT=$$UP^XLFSTR($P($G(ARRY2(TIUI)),U,2))
"RTN","TIUPXAPC",33,0)
 . . S CPTARR(TIUROW,TIUCOL)=U_U_TIUCAT
"RTN","TIUPXAPC",34,0)
 . . K ARRY2(TIUI)
"RTN","TIUPXAPC",35,0)
 . ;Update counters for CPT Display Array
"RTN","TIUPXAPC",36,0)
 . D UPDCNT(.TIUROW,.TIUCOL,.TIUPAGE)
"RTN","TIUPXAPC",37,0)
 I +$G(ARRY2(0))>0 D
"RTN","TIUPXAPC",38,0)
 . S TIUROW=+$G(TIUROW)+1,TIUITM=TIUITM+1
"RTN","TIUPXAPC",39,0)
 . S CPTARR(TIUROW,TIUCOL)=TIUITM_"^OTHER CPT^OTHER Procedure"
"RTN","TIUPXAPC",40,0)
 . S CPTARR("INDEX",TIUITM)="OTHER CPT^OTHER Procedure"
"RTN","TIUPXAPC",41,0)
 . S CPTARR(0)=+$G(ARRY2(0))_U_+$G(TIUROW)_U_+$G(TIUPAGE)
"RTN","TIUPXAPC",42,0)
 . ;Update counters for CPT Display Array
"RTN","TIUPXAPC",43,0)
 . D UPDCNT(.TIUROW,.TIUCOL,.TIUPAGE)
"RTN","TIUPXAPC",44,0)
 Q
"RTN","TIUPXAPC",45,0)
 ;
"RTN","TIUPXAPC",46,0)
UPDCNT(TIUROW,TIUCOL,TIUPAGE) ;Update Counters for CPT Display Array
"RTN","TIUPXAPC",47,0)
 ; Input  -- TIUROW   Row Counter
"RTN","TIUPXAPC",48,0)
 ;           TIUCOL   Column Counter
"RTN","TIUPXAPC",49,0)
 ;           TIUPAGE  Page Counter
"RTN","TIUPXAPC",50,0)
 ; Output -- Counters:
"RTN","TIUPXAPC",51,0)
 ;           TIUROW   Row Counter
"RTN","TIUPXAPC",52,0)
 ;           TIUCOL   Column Counter
"RTN","TIUPXAPC",53,0)
 ;           TIUPAGE  Page Counter
"RTN","TIUPXAPC",54,0)
 I TIUROW#20'>0 D
"RTN","TIUPXAPC",55,0)
 . S:TIUCOL=3 TIUPAGE=TIUPAGE+1
"RTN","TIUPXAPC",56,0)
 . S TIUCOL=$S(TIUCOL=3:1,1:TIUCOL+1)
"RTN","TIUPXAPC",57,0)
 . S TIUROW=20*(TIUPAGE-1)
"RTN","TIUPXAPC",58,0)
 Q
"RTN","TIUPXAPC",59,0)
 ;
"RTN","TIUPXAPC",60,0)
 ;Pass in encounter date to pass to ICPTMOD,TIUPXAPM for CSV **161**
"RTN","TIUPXAPC",61,0)
ADDMOD(TIUITM,TIUI,CPTARR,ARRY2,TIUROW,TIUCOL,TIUPAGE,TIUVDT) ;Add Pre-selected CPT Modifiers from AICS to CPT Display Array
"RTN","TIUPXAPC",62,0)
 ; Input  -- TIUITM   Item Number in CPT Display Array
"RTN","TIUPXAPC",63,0)
 ;           TIUI     Item Number in Combined AICS Selection List Array
"RTN","TIUPXAPC",64,0)
 ;           CPTARR   CPT Display Array
"RTN","TIUPXAPC",65,0)
 ;           ARRY2    Combined AICS Selection List Array
"RTN","TIUPXAPC",66,0)
 ;           TIUROW   Row Counter
"RTN","TIUPXAPC",67,0)
 ;           TIUCOL   Column Counter
"RTN","TIUPXAPC",68,0)
 ;           TIUPAGE  Page Counter
"RTN","TIUPXAPC",69,0)
 ; Output -- CPTARR   CPT Display Array
"RTN","TIUPXAPC",70,0)
 ;                 (TIUROW,TIUCOL)=
"RTN","TIUPXAPC",71,0)
 ;                    ^^^^CPT Modifier^CPT Modifier Name
"RTN","TIUPXAPC",72,0)
 ;                 ("INDEX",TIUITM,"MODIFIER",MODCNT)=
"RTN","TIUPXAPC",73,0)
 ;                    CPT Modifier IEN^CPT Modifier^CPT Modifier Name
"RTN","TIUPXAPC",74,0)
 ;           TIUROW   Row Counter
"RTN","TIUPXAPC",75,0)
 ;           TIUCOL   Column Counter
"RTN","TIUPXAPC",76,0)
 ;           TIUPAGE  Page Counter
"RTN","TIUPXAPC",77,0)
 ;    TIUVDT   Encounter Date
"RTN","TIUPXAPC",78,0)
 N MODCNT,MODIFIER,MODINFO
"RTN","TIUPXAPC",79,0)
 ;
"RTN","TIUPXAPC",80,0)
 ;Loop through pre-selected CPT Modifiers
"RTN","TIUPXAPC",81,0)
 S MODCNT=0
"RTN","TIUPXAPC",82,0)
 F  S MODCNT=$O(ARRY2(TIUI,"MODIFIER",MODCNT)) Q:'MODCNT  D
"RTN","TIUPXAPC",83,0)
 . S MODIFIER=$P(ARRY2(TIUI,"MODIFIER",MODCNT),U) Q:MODIFIER=""
"RTN","TIUPXAPC",84,0)
 . ;Invoke API to get CPT Modifier information
"RTN","TIUPXAPC",85,0)
 . ;Pass encounter date to ICPTMOD for CSV **161**
"RTN","TIUPXAPC",86,0)
 . S MODINFO=$$MOD^ICPTMOD(MODIFIER,,TIUVDT)
"RTN","TIUPXAPC",87,0)
 . I +MODINFO>0 D
"RTN","TIUPXAPC",88,0)
 . . S TIUROW=TIUROW+1
"RTN","TIUPXAPC",89,0)
 . . ;Set CPT Modifier and CPT Modifier Name into CPT Display Array
"RTN","TIUPXAPC",90,0)
 . . S CPTARR(TIUROW,TIUCOL)=U_U_U_U_$P(MODINFO,U,2,3)
"RTN","TIUPXAPC",91,0)
 . . ;Set CPT Modifier IEN, CPT Modifier and CPT Modifier Name into Index for CPT Display Array
"RTN","TIUPXAPC",92,0)
 . . S CPTARR("INDEX",TIUITM,"MODIFIER",MODCNT)=$P(MODINFO,U,1,3)
"RTN","TIUPXAPC",93,0)
 Q
"RTN","TIUPXAPC",94,0)
 ;
"RTN","TIUPXAPC",95,0)
 ;Pass encounter date to CPT to pass to ICPTCOD
"RTN","TIUPXAPC",96,0)
CPT(CPT,CPTARR,TIUVDT) ; Select Procedures
"RTN","TIUPXAPC",97,0)
 N I,J,L,Y,TIUCPT,TIUICNT,TIUPGS,TIUPG,TIUITM,TIULITM,TIUPNM
"RTN","TIUPXAPC",98,0)
 S TIUPNM=$S($L($G(TIU("PNM"))):$G(TIU("PNM")),+$G(DFN):$$PTNAME^TIULC1(DFN),1:"the Patient")
"RTN","TIUPXAPC",99,0)
 W !!,"Please Indicate the Procedure(s) Performed on "_TIUPNM_":"
"RTN","TIUPXAPC",100,0)
 W:+$O(CPTARR(0)) !
"RTN","TIUPXAPC",101,0)
 S TIUICNT=+$G(CPTARR(0)),TIUPGS=$P($G(CPTARR(0)),U,3)
"RTN","TIUPXAPC",102,0)
 S (I,J,L,Y)=0 I +TIUICNT S TIUPG=1
"RTN","TIUPXAPC",103,0)
 F  S I=$O(CPTARR(I)) Q:+I'>0  D
"RTN","TIUPXAPC",104,0)
 . S J=0 W ! F  S J=$O(CPTARR(I,J)) Q:+J'>0  D
"RTN","TIUPXAPC",105,0)
 . . W ?((J-1)*25) W:+$P(CPTARR(I,J),U) $J($P(CPTARR(I,J),U),2)_" " W $E($P(CPTARR(I,J),U,3),1,20)
"RTN","TIUPXAPC",106,0)
 . . ;Display pre-selected CPT Modifier
"RTN","TIUPXAPC",107,0)
 . . W:$P(CPTARR(I,J),U,5)'="" " -"_$P(CPTARR(I,J),U,5)_" "_$E($P(CPTARR(I,J),U,6),1,14)
"RTN","TIUPXAPC",108,0)
 . . S TIUITM=$S(+$G(CPTARR(I,J)):+$G(CPTARR(I,J)),1:$G(TIUITM))
"RTN","TIUPXAPC",109,0)
 . . S:TIUITM>+$G(TIULITM) TIULITM=TIUITM
"RTN","TIUPXAPC",110,0)
 . I I#20=0 S Y=$S(+Y:Y,1:"")_$P($$PICK^TIUPXAP2(1,+$G(TIULITM),"Select Procedures"_$S(+$G(TIUPG)<TIUPGS:" (<RETURN> to see next page of choices)",1:"")),U),TIUPG=+$G(TIUPG)+1 W !
"RTN","TIUPXAPC",111,0)
 . S L=I S:TIUITM>+$G(TIULITM) TIULITM=TIUITM
"RTN","TIUPXAPC",112,0)
 I L#20 S Y=$S(+Y:Y,1:"")_$P($$PICK^TIUPXAP2(1,TIULITM,"Select Procedures"),U)
"RTN","TIUPXAPC",113,0)
 I +Y,$P(CPTARR("INDEX",+Y),U)'="OTHER CPT" D  I 1
"RTN","TIUPXAPC",114,0)
 . N I,ITEM F I=1:1:($L(Y,",")-1) D
"RTN","TIUPXAPC",115,0)
 . . S ITEM=$P(Y,",",I)
"RTN","TIUPXAPC",116,0)
 . . I $P(CPTARR("INDEX",+ITEM),U)'="OTHER CPT" D  I 1
"RTN","TIUPXAPC",117,0)
 . . . S CPT(I)=$G(CPTARR("INDEX",+ITEM))
"RTN","TIUPXAPC",118,0)
 . . . S $P(CPT(I),U,4)=$P(CPT(I),U)
"RTN","TIUPXAPC",119,0)
 . . . ;Pass encounter date to CPT to pass to ICDTCOD for CSV **161**
"RTN","TIUPXAPC",120,0)
 . . . S $P(CPT(I),U)=+$$CPT^ICPTCOD($P(CPT(I),U),TIUVDT)
"RTN","TIUPXAPC",121,0)
 . . . I +CPT(I)'>0 D
"RTN","TIUPXAPC",122,0)
 . . . . K CPT(I)
"RTN","TIUPXAPC",123,0)
 . . . ELSE  D
"RTN","TIUPXAPC",124,0)
 . . . . ;Merge pre-selected CPT Modifiers from CPT Display Array into CPT Selection Array
"RTN","TIUPXAPC",125,0)
 . . . . M CPT(I,"MOD")=CPTARR("INDEX",ITEM,"MODIFIER")
"RTN","TIUPXAPC",126,0)
 . . ;Pass encounter date to CPTOUT for CSV **161**
"RTN","TIUPXAPC",127,0)
 . . E  D CPTOUT(.CPT,.I,TIUVDT)
"RTN","TIUPXAPC",128,0)
 E  D CPTOUT(.CPT,,TIUVDT)
"RTN","TIUPXAPC",129,0)
 I +$O(CPT(1)) D  I 1
"RTN","TIUPXAPC",130,0)
 . N TIUI S TIUI=0
"RTN","TIUPXAPC",131,0)
 . F  S TIUI=$O(CPT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPXAPC",132,0)
 . . S CPT(TIUI,"QTY")=+$$QTY(.CPT,TIUI)
"RTN","TIUPXAPC",133,0)
 . . K:CPT(TIUI,"QTY")'>0 CPT(TIUI)
"RTN","TIUPXAPC",134,0)
 . . ;Select CPT Modifiers
"RTN","TIUPXAPC",135,0)
 . . ;Pass encounter date to TIUPXAPM to pass to ICPTCOD for CVS **161**
"RTN","TIUPXAPC",136,0)
 . . I $D(CPT(TIUI)) D MOD^TIUPXAPM(.CPT,TIUI,TIUVDT)
"RTN","TIUPXAPC",137,0)
 E  I $D(CPT(1)) D
"RTN","TIUPXAPC",138,0)
 . S CPT(1,"QTY")=+$$QTY(.CPT,1)
"RTN","TIUPXAPC",139,0)
 . K:CPT(1,"QTY")'>0 CPT(1)
"RTN","TIUPXAPC",140,0)
 . ;Select CPT Modifiers
"RTN","TIUPXAPC",141,0)
 . ;Pass encounter date to TIUPXAPM to pass to ICPTCOD for CSV **161**
"RTN","TIUPXAPC",142,0)
 . I $D(CPT(1)) D MOD^TIUPXAPM(.CPT,1,TIUVDT)
"RTN","TIUPXAPC",143,0)
 Q
"RTN","TIUPXAPC",144,0)
QTY(CPT,TIUI) ; How many times was the procedure performed?
"RTN","TIUPXAPC",145,0)
 N PROMPT,HELP
"RTN","TIUPXAPC",146,0)
 S PROMPT="How many times was the procedure performed? "
"RTN","TIUPXAPC",147,0)
 S HELP="^D QTYHLP^TIUPXAPC"
"RTN","TIUPXAPC",148,0)
 W !!!,$$UP^XLFSTR($P(CPT(TIUI),U,2)),":",!
"RTN","TIUPXAPC",149,0)
 Q +$$READ^TIUU("NA^1:99",PROMPT,1,HELP)
"RTN","TIUPXAPC",150,0)
QTYHLP ; Help for QTY read
"RTN","TIUPXAPC",151,0)
 W !,"Please specify the number of repetitions for this procedure"
"RTN","TIUPXAPC",152,0)
 W !,"performed during this visit with the patient (1-99)."
"RTN","TIUPXAPC",153,0)
 Q
"RTN","TIUPXAPC",154,0)
 ; Pass in encounter date to pass to LEXSET for CSV **161**
"RTN","TIUPXAPC",155,0)
CPTOUT(CPT,TIUI,TIUVDT) ; Go off-list for Procedure(s)
"RTN","TIUPXAPC",156,0)
 N DIC,X,Y,TIUOUT
"RTN","TIUPXAPC",157,0)
 F  D  Q:+$G(TIUOUT)
"RTN","TIUPXAPC",158,0)
 . I $L($T(CONFIG^LEXSET)) D  I 1
"RTN","TIUPXAPC",159,0)
 . .; Pass encounter date to LEXSET for CSV **161**
"RTN","TIUPXAPC",160,0)
 . . D CONFIG^LEXSET("CHP","CHP",TIUVDT)  ; PCH 24
"RTN","TIUPXAPC",161,0)
 . E  S DIC="^ICPT("
"RTN","TIUPXAPC",162,0)
 . S DIC(0)="AEMQ"
"RTN","TIUPXAPC",163,0)
 . S DIC("A")="Select "_$S(+$G(CPTARR(0))'>0:"Procedure: ",1:"Another Procedure"_$S($D(CPTARR):" (NOT from Above List)",1:"")_": ")
"RTN","TIUPXAPC",164,0)
 . N X
"RTN","TIUPXAPC",165,0)
 . D ^DIC
"RTN","TIUPXAPC",166,0)
 . I +$D(DTOUT)!+$D(DUOUT)!(X="") S TIUOUT=1 Q
"RTN","TIUPXAPC",167,0)
 . I +Y>0 D  Q
"RTN","TIUPXAPC",168,0)
 . . ; Pass encounter date to LEXC to LEXSET for CSV **161**
"RTN","TIUPXAPC",169,0)
 . . I DIC="^LEX(757.01," S Y=$$LEXC(Y,TIUVDT)  ; PCH 24
"RTN","TIUPXAPC",170,0)
 . . S:$S(+$G(TIUI)'>0:1,$D(CPT(+$G(TIUI))):1,1:0) TIUI=$G(TIUI)+1
"RTN","TIUPXAPC",171,0)
 . . S CPT(TIUI)=Y
"RTN","TIUPXAPC",172,0)
 . W $C(7),!!,"Nothing found for ",X,"..."
"RTN","TIUPXAPC",173,0)
 . F  D  Q:(+Y>0)!+$G(TIUOUT)
"RTN","TIUPXAPC",174,0)
 . . N X
"RTN","TIUPXAPC",175,0)
 . . I $L($T(CONFIG^LEXSET)) D  I 1
"RTN","TIUPXAPC",176,0)
 . . .; Pass encounter date for CSV **161**
"RTN","TIUPXAPC",177,0)
 . . . D CONFIG^LEXSET("CHP","CHP",TIUVDT)  ; PCH 24
"RTN","TIUPXAPC",178,0)
 . . E  S DIC="^ICPT("
"RTN","TIUPXAPC",179,0)
 . . S DIC("A")="Please try another expression, or RETURN to continue: "
"RTN","TIUPXAPC",180,0)
 . . D ^DIC
"RTN","TIUPXAPC",181,0)
 . . I +$D(DTOUT)!+$D(DUOUT)!(X="") S TIUOUT=1 Q
"RTN","TIUPXAPC",182,0)
 . . I +Y>0 D  Q
"RTN","TIUPXAPC",183,0)
 . . . ; Pass encounter date to LEXC for CSV **161**
"RTN","TIUPXAPC",184,0)
 . . . I DIC="^LEX(757.01," S Y=$$LEXC(Y,TIUVDT)  ; PCH 24
"RTN","TIUPXAPC",185,0)
 . . . S:$S(+$G(TIUI)'>0:1,$D(CPT(+$G(TIUI))):1,1:0) TIUI=$G(TIUI)+1
"RTN","TIUPXAPC",186,0)
 . . . S CPT(TIUI)=Y
"RTN","TIUPXAPC",187,0)
 . . W $C(7),!!,"Nothing found for ",X,"..."
"RTN","TIUPXAPC",188,0)
 Q
"RTN","TIUPXAPC",189,0)
 ; Pass in encounter date for CSV **161**
"RTN","TIUPXAPC",190,0)
LEXC(Y,TIUVDT) ; Get CPT IEN from Lexicon returned code PCH 24
"RTN","TIUPXAPC",191,0)
 N TIUC,TIUCODE S Y=$G(Y)
"RTN","TIUPXAPC",192,0)
 ; Pass encounter date for CSV **161**
"RTN","TIUPXAPC",193,0)
 S TIUC=$$CPTONE^LEXU(+Y,TIUVDT) S:'$L(TIUC) TIUC=$$CPCONE^LEXU(+Y,TIUVDT)
"RTN","TIUPXAPC",194,0)
 I '$L(TIUC) S Y="-1"_U_$P(Y,U,2) Q Y
"RTN","TIUPXAPC",195,0)
 S TIUCODE=TIUC
"RTN","TIUPXAPC",196,0)
 ; Pass encounter date instead of current date to ICPTCOD for CSV **161**
"RTN","TIUPXAPC",197,0)
 S TIUC=+$$CPT^ICPTCOD(TIUCODE,TIUVDT) S Y=TIUC_U_$P(Y,U,2)
"RTN","TIUPXAPC",198,0)
 S Y=Y_"^^"_TIUCODE
"RTN","TIUPXAPC",199,0)
 Q Y
"RTN","TIUPXAPI")
0^1^B67812452
"RTN","TIUPXAPI",1,0)
TIUPXAPI ; SLC/JER - Interface w/PCE/Visit Tracking ;5/8/03@10:26
"RTN","TIUPXAPI",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**15,24,29,82,107,126,161**;Jun 20, 1997
"RTN","TIUPXAPI",3,0)
CREDIT(DFN,TIU,VSIT) ; Get Dx, CPT, (& SC) for the CMD's mandate
"RTN","TIUPXAPI",4,0)
 N CPT,ICD,ICDARR,CPTARR,SC,DTOUT,TIUOK,TIUPRLST
"RTN","TIUPXAPI",5,0)
 ; For Historical Visits, just QUEUE the PXAPI call and quit
"RTN","TIUPXAPI",6,0)
 I $P(TIU("VSTR"),";",3)="E" D QUE^TIUPXAP1 Q
"RTN","TIUPXAPI",7,0)
 ; If no Location, and not Historical Visit, then quit
"RTN","TIUPXAPI",8,0)
 Q:+$G(TIU("VSTR"))'>0
"RTN","TIUPXAPI",9,0)
REENTER I $G(VALMAR)="^TMP(""TIUR"",$J)",$D(TIU("PNM")) D
"RTN","TIUPXAPI",10,0)
 . W !!,"For ",$G(TIU("PNM"))," ",$G(TIU("PID"))," Visit on "
"RTN","TIUPXAPI",11,0)
 . W $P($G(TIU("EDT")),U,2),"..."
"RTN","TIUPXAPI",12,0)
 D PROVLIST(.TIUPRLST)
"RTN","TIUPXAPI",13,0)
 N TIUVDT S TIUVDT=$P($G(TIU("VSTR")),";",2)
"RTN","TIUPXAPI",14,0)
 ; *161 Pass encounter date to GETICD as 3rd and 4th variable, then to IBDF18A
"RTN","TIUPXAPI",15,0)
 D GETICD(TIU("LOC"),.ICDARR,TIUVDT)
"RTN","TIUPXAPI",16,0)
ICDCALL D ICD(.ICD,.ICDARR,TIUVDT) G:+$G(DTOUT) INSUFF ; **15**
"RTN","TIUPXAPI",17,0)
 I '$D(ICD),'$D(DTOUT) W !!,$C(7),"You MUST enter one or more Diagnoses." H 3 G ICDCALL
"RTN","TIUPXAPI",18,0)
 K ICDARR ; **15**
"RTN","TIUPXAPI",19,0)
 ; Pass encounter date to TIUPXAPC to pass to IBDF18A **161**
"RTN","TIUPXAPI",20,0)
 D GETCPT^TIUPXAPC(TIU("LOC"),.CPTARR,TIUVDT)
"RTN","TIUPXAPI",21,0)
 ; Pass encounter date to TIUPXAPC,ICPTCOD,TIUPXAPM for CSV **161**
"RTN","TIUPXAPI",22,0)
CPTCALL D CPT^TIUPXAPC(.CPT,.CPTARR,TIUVDT) G:+$G(DTOUT) INSUFF
"RTN","TIUPXAPI",23,0)
 I '$D(CPT),'$D(DTOUT) W !!,$C(7),"You MUST enter one or more Procedures." H 3 G CPTCALL
"RTN","TIUPXAPI",24,0)
 K CPTARR ; **15**
"RTN","TIUPXAPI",25,0)
 D SCASK^TIUPXAPS(.SC,+DFN,.TIU)
"RTN","TIUPXAPI",26,0)
INSUFF I $D(DTOUT)!(+$O(ICD(0))'>0)&(+$O(CPT(0))'>0)&(+$O(SC(0))'>0) D  G POST
"RTN","TIUPXAPI",27,0)
 . W !,$C(7),"Insufficient information for Workload Credit."
"RTN","TIUPXAPI",28,0)
 . W !,"Missing information will have to be captured by another method."
"RTN","TIUPXAPI",29,0)
 S TIUOK=$$CONFIRM(.ICD,.CPT,.SC)
"RTN","TIUPXAPI",30,0)
 I '+TIUOK D  G REENTER
"RTN","TIUPXAPI",31,0)
 . W !!,"Changes Discarded. Please Enter Corrected Workload Data..." H 3
"RTN","TIUPXAPI",32,0)
 . K ICD,CPT,SC,ICDARR,CPTARR
"RTN","TIUPXAPI",33,0)
 K CPTARR,ICDARR
"RTN","TIUPXAPI",34,0)
 W !!,"Posting Workload Credit..."
"RTN","TIUPXAPI",35,0)
POST D QUE^TIUPXAP1 ; Queue TIU/PXAPI RESOURCE
"RTN","TIUPXAPI",36,0)
 W:'+$G(DTOUT) "Done."
"RTN","TIUPXAPI",37,0)
 Q
"RTN","TIUPXAPI",38,0)
CONFIRM(ICD,CPT,SC) ; Show user and confirm
"RTN","TIUPXAPI",39,0)
 N TIUI,TIUY S TIUY=0
"RTN","TIUPXAPI",40,0)
 W !!,"You have indicated the following data apply to this visit:",!
"RTN","TIUPXAPI",41,0)
 W !,"DIAGNOSES:"
"RTN","TIUPXAPI",42,0)
 S TIUI=0
"RTN","TIUPXAPI",43,0)
 F  S TIUI=$O(ICD(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPXAPI",44,0)
 . W !?3,$P(ICD(TIUI),U,2),?12,$E($P(ICD(TIUI),U,3),1,67)
"RTN","TIUPXAPI",45,0)
 . W:+$G(ICD(TIUI,"PRIMARY")) "  <<< PRIMARY"
"RTN","TIUPXAPI",46,0)
 W !!,"PROCEDURES:"
"RTN","TIUPXAPI",47,0)
 S TIUI=0
"RTN","TIUPXAPI",48,0)
 F  S TIUI=$O(CPT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPXAPI",49,0)
 . W !?3,$P(CPT(TIUI),U,4),?12,$E($P(CPT(TIUI),U,2),1,67)
"RTN","TIUPXAPI",50,0)
 . ;Display CPT Modifiers
"RTN","TIUPXAPI",51,0)
 . D DISMOD^TIUPXAPM(.CPT,TIUI)
"RTN","TIUPXAPI",52,0)
 I $D(SC)>9 D
"RTN","TIUPXAPI",53,0)
 . W !!,"SERVICE CONNECTION:"
"RTN","TIUPXAPI",54,0)
 . W !?3,"Service Connected? ",$S(+$G(SC("SC")):"YES",1:"NO")
"RTN","TIUPXAPI",55,0)
 . I $D(SC("AO")),+$G(SC("SC"))'>0 W !?3,"Agent Orange? ",$S($G(SC("AO"))]"":$P($G(SC("AO")),U,2),1:"NOT ANSWERED")
"RTN","TIUPXAPI",56,0)
 . I $D(SC("IR")),+$G(SC("SC"))'>0 W !?3,"Ionizing Radiation? ",$S($G(SC("IR"))]"":$P($G(SC("IR")),U,2),1:"NOT ANSWERED")
"RTN","TIUPXAPI",57,0)
 . I $D(SC("EC")),+$G(SC("SC"))'>0 W !?3,"Environmental Contaminants? ",$S($G(SC("EC"))]"":$P($G(SC("EC")),U,2),1:"NOT ANSWERED")
"RTN","TIUPXAPI",58,0)
 . I $D(SC("MST")) W !?3,"MST? ",$S($G(SC("MST"))]"":$P($G(SC("MST")),U,2),1:"NOT ANSWERED")
"RTN","TIUPXAPI",59,0)
 . I $D(SC("HNC")) W !?3,"Head and/or Neck Cancer? ",$S($G(SC("HNC"))]"":$P($G(SC("HNC")),U,2),1:"NOT ANSWERED")
"RTN","TIUPXAPI",60,0)
 W ! S TIUY=+$$READ^TIUU("Y","   ...OK","YES")
"RTN","TIUPXAPI",61,0)
 Q +$G(TIUY)
"RTN","TIUPXAPI",62,0)
 ; Pass encounter date to GETICD to pass to IBDF18A **161**
"RTN","TIUPXAPI",63,0)
GETICD(TIULOC,ICDARR,TIUVDT) ; Get ICD-9 codes for clinic
"RTN","TIUPXAPI",64,0)
 N TIUI,TIUROW,TIUCOL,ARRY2,TIUITM,TIUPAGE,TIUCAT S TIUCAT=""
"RTN","TIUPXAPI",65,0)
 ; Pass encounter date as the 5th parameter to IBDF18A **161**
"RTN","TIUPXAPI",66,0)
 D GETLST^IBDF18A(+TIULOC,"DG SELECT ICD-9 DIAGNOSIS CODES","ARRY2",,,,TIUVDT)
"RTN","TIUPXAPI",67,0)
 S (TIUI,TIUROW,TIUITM)=0,(TIUCOL,TIUPAGE)=1
"RTN","TIUPXAPI",68,0)
 F  S TIUI=$O(ARRY2(TIUI)) Q:+TIUI'>0  D
"RTN","TIUPXAPI",69,0)
 . I $P(ARRY2(TIUI),U)]"" D  I 1
"RTN","TIUPXAPI",70,0)
 . . S TIUROW=+$G(TIUROW)+1,TIUITM=+$G(TIUITM)+1
"RTN","TIUPXAPI",71,0)
 . . S ICDARR(TIUROW,TIUCOL)=TIUITM_U_$G(ARRY2(TIUI))_U_TIUCAT
"RTN","TIUPXAPI",72,0)
 . . S ICDARR("INDEX",TIUITM)=$G(ARRY2(TIUI))_U_TIUCAT K ARRY2(TIUI)
"RTN","TIUPXAPI",73,0)
 . E  D
"RTN","TIUPXAPI",74,0)
 . . S TIUROW=+$G(TIUROW)+1,TIUCAT=$$UP^XLFSTR($P($G(ARRY2(TIUI)),U,2))
"RTN","TIUPXAPI",75,0)
 . . S ICDARR(TIUROW,TIUCOL)=U_U_TIUCAT
"RTN","TIUPXAPI",76,0)
 . . K ARRY2(TIUI)
"RTN","TIUPXAPI",77,0)
 . I (TIUROW#20'>0),(TIUCOL=3) S TIUPAGE=TIUPAGE+1
"RTN","TIUPXAPI",78,0)
 . I TIUROW#20'>0 S TIUCOL=$S(TIUCOL=3:1,1:TIUCOL+1),TIUROW=20*(TIUPAGE-1)
"RTN","TIUPXAPI",79,0)
 I +$G(ARRY2(0))>0 D
"RTN","TIUPXAPI",80,0)
 . S TIUROW=+$G(TIUROW)+1,TIUITM=TIUITM+1
"RTN","TIUPXAPI",81,0)
 . S ICDARR(TIUROW,TIUCOL)=TIUITM_"^OTHER ICD^OTHER Diagnosis"
"RTN","TIUPXAPI",82,0)
 . S ICDARR("INDEX",TIUITM)="OTHER ICD^OTHER Diagnosis"
"RTN","TIUPXAPI",83,0)
 . S ICDARR(0)=+$G(ARRY2(0))_U_+$G(TIUROW)_U_+$G(TIUPAGE)
"RTN","TIUPXAPI",84,0)
 . I (TIUROW#20'>0),(TIUCOL=3) S TIUPAGE=TIUPAGE+1
"RTN","TIUPXAPI",85,0)
 . I TIUROW#20'>0 S TIUCOL=$S(TIUCOL=3:1,1:TIUCOL+1),TIUROW=20*(TIUPAGE-1)
"RTN","TIUPXAPI",86,0)
 Q
"RTN","TIUPXAPI",87,0)
 ; Pass encounter date as TIUVDT for CSV **161**
"RTN","TIUPXAPI",88,0)
ICD(ICD,ICDARR,TIUVDT) ; Select Dx's
"RTN","TIUPXAPI",89,0)
 N I,J,Y,TIUICD,TIUICNT,TIUPGS,TIUPG,TIUITM,TIULITM,TIUPNM
"RTN","TIUPXAPI",90,0)
 S TIUPNM=$S($L($G(TIU("PNM"))):$G(TIU("PNM")),+$G(DFN):$$PTNAME^TIULC1(DFN),1:"the Patient")
"RTN","TIUPXAPI",91,0)
 W !!,"Please Indicate the Diagnoses for which "_TIUPNM_" was Seen:"
"RTN","TIUPXAPI",92,0)
 W:+$O(ICDARR(0)) !
"RTN","TIUPXAPI",93,0)
 S TIUICNT=+$G(ICDARR(0)),TIUPGS=$P($G(ICDARR(0)),U,3)
"RTN","TIUPXAPI",94,0)
 S (I,J,L,Y)=0 I +TIUICNT S TIUPG=1
"RTN","TIUPXAPI",95,0)
 F  S I=$O(ICDARR(I)) Q:+I'>0  D  Q:+$G(DTOUT)
"RTN","TIUPXAPI",96,0)
 . S J=0 W ! F  S J=$O(ICDARR(I,J)) Q:+J'>0  D
"RTN","TIUPXAPI",97,0)
 . . W ?((J-1)*25) W:+$P(ICDARR(I,J),U) $J($P(ICDARR(I,J),U),2)_" " W $E($P(ICDARR(I,J),U,3),1,20)
"RTN","TIUPXAPI",98,0)
 . . S TIUITM=$S(+$G(ICDARR(I,J)):+$G(ICDARR(I,J)),1:$G(TIUITM))
"RTN","TIUPXAPI",99,0)
 . . S:TIUITM>+$G(TIULITM) TIULITM=TIUITM
"RTN","TIUPXAPI",100,0)
 . I I#20=0 S Y=$S(+Y:Y,1:"")_$P($$PICK^TIUPXAP2(1,+$G(TIULITM),"Select Diagnoses"_$S(+$G(TIUPG)<TIUPGS:" (<RETURN> to see next page of choices)",1:"")),U),TIUPG=+$G(TIUPG)+1 W !
"RTN","TIUPXAPI",101,0)
 . S L=I S:TIUITM>+$G(TIULITM) TIULITM=TIUITM
"RTN","TIUPXAPI",102,0)
 I +$G(DTOUT) Q
"RTN","TIUPXAPI",103,0)
 I L#20 S Y=$S(+Y:Y,1:"")_$P($$PICK^TIUPXAP2(1,TIULITM,"Select Diagnoses"),U)
"RTN","TIUPXAPI",104,0)
 I +Y,$P(ICDARR("INDEX",+Y),U)'="OTHER ICD" D  I 1
"RTN","TIUPXAPI",105,0)
 . N I,ITEM F I=1:1:($L(Y,",")-1) D  Q:+$G(DTOUT)
"RTN","TIUPXAPI",106,0)
 . . S ITEM=$P(Y,",",I)
"RTN","TIUPXAPI",107,0)
 . . I $P(ICDARR("INDEX",+ITEM),U)'="OTHER ICD" D
"RTN","TIUPXAPI",108,0)
 . . . S TIUICD=+$O(^ICD9("AB",$P(ICDARR("INDEX",+ITEM),U)_" ",0))
"RTN","TIUPXAPI",109,0)
 . . . S ICD(I)=TIUICD_U_$G(ICDARR("INDEX",+ITEM))
"RTN","TIUPXAPI",110,0)
 . . ; Pass encounter date to ICDOUT to pass to LEXSET for CSV **161**
"RTN","TIUPXAPI",111,0)
 . . E  D ICDOUT(.ICD,.I,TIUVDT)
"RTN","TIUPXAPI",112,0)
 Q:+$G(DTOUT)
"RTN","TIUPXAPI",113,0)
 ; Pass encounter date to ICDOUT to pass to LEXSET for CSV **161**
"RTN","TIUPXAPI",114,0)
 E  D ICDOUT(.ICD,,TIUVDT)
"RTN","TIUPXAPI",115,0)
 I +$O(ICD(1)) D ASKPRMRY(.ICD) I 1
"RTN","TIUPXAPI",116,0)
 Q:+$G(DTOUT)
"RTN","TIUPXAPI",117,0)
 E  I $D(ICD(1)) S ICD(1,"PRIMARY")=1
"RTN","TIUPXAPI",118,0)
 Q
"RTN","TIUPXAPI",119,0)
ASKPRMRY(ICD) ; Which Dx is Primary
"RTN","TIUPXAPI",120,0)
 N I,L,Y
"RTN","TIUPXAPI",121,0)
PRMAGN W !!,"Please indicate which of the Diagnoses is the Primary Diagnosis:",!
"RTN","TIUPXAPI",122,0)
 S (I,L,Y)=0 F  S I=$O(ICD(I)) Q:+I'>0!+Y  D
"RTN","TIUPXAPI",123,0)
 . W:$P(ICD(I),U)]"" !,I,?7,$P(ICD(I),U,3)
"RTN","TIUPXAPI",124,0)
 . I I#20=0 S Y=$P($$PICK^TIUPXAP2(1,I,"Select Diagnosis","NO"),U)
"RTN","TIUPXAPI",125,0)
 . S L=I
"RTN","TIUPXAPI",126,0)
 I L#20,'+Y S Y=$P($$PICK^TIUPXAP2(1,L,"Select Diagnosis","NO"),U)
"RTN","TIUPXAPI",127,0)
 I +Y'>0 W !!?3,$C(7),"You must specify a Primary Diagnosis." G PRMAGN
"RTN","TIUPXAPI",128,0)
 I +Y,$D(ICD(+Y)) S ICD(+Y,"PRIMARY")=1
"RTN","TIUPXAPI",129,0)
 Q
"RTN","TIUPXAPI",130,0)
ICDOUT(ICD,TIUI,TIUVDT) ; Go off-list for Dx
"RTN","TIUPXAPI",131,0)
 N DIC,X,Y,TIUICD,TIUOUT
"RTN","TIUPXAPI",132,0)
 F  D  Q:+$G(TIUOUT)
"RTN","TIUPXAPI",133,0)
 . I $L($T(CONFIG^LEXSET)) D  I 1
"RTN","TIUPXAPI",134,0)
 . . ; Pass encounter date to LEXSET for CSV **161**
"RTN","TIUPXAPI",135,0)
 . . D CONFIG^LEXSET("ICD","ICD",TIUVDT)
"RTN","TIUPXAPI",136,0)
 . E  D  Q
"RTN","TIUPXAPI",137,0)
 . . W !,$C(7),"You must install LEXICON UTILITY v2.0 for this function to work...Contact IRM.",!
"RTN","TIUPXAPI",138,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPXAPI",139,0)
 . . S TIUOUT=1
"RTN","TIUPXAPI",140,0)
 . S DIC(0)="AEMQ"
"RTN","TIUPXAPI",141,0)
 . S DIC("A")="Select "_$S(+$G(ICDARR(0))'>0:"Diagnosis: ",1:"Another Diagnosis"_$S($D(ICDARR):" (NOT from Above List)",1:"")_": ")
"RTN","TIUPXAPI",142,0)
 . N X K DIC("B")
"RTN","TIUPXAPI",143,0)
 . D ^DIC
"RTN","TIUPXAPI",144,0)
 . I +$D(DTOUT)!+$D(DUOUT)!(X="") S TIUOUT=1 Q
"RTN","TIUPXAPI",145,0)
 . I $G(Y(1))]"" D  Q
"RTN","TIUPXAPI",146,0)
 . . S TIUICD=+$O(^ICD9("AB",$P(Y(1),U)_" ",0))
"RTN","TIUPXAPI",147,0)
 . . S:TIUICD'>0 TIUICD=+$O(^ICD9("AB",$P(Y(1),U)_"0 ",0))
"RTN","TIUPXAPI",148,0)
 . . I +TIUICD'>0 W !,$C(7),"ICD CODE NOT FOUND FOR EXPRESSION." Q
"RTN","TIUPXAPI",149,0)
 . . S:$S(+$G(TIUI)'>0:1,$D(ICD(+$G(TIUI))):1,1:0) TIUI=$G(TIUI)+1
"RTN","TIUPXAPI",150,0)
 . . S ICD(TIUI)=TIUICD_U_Y(1)_U_$P(Y,U,2)
"RTN","TIUPXAPI",151,0)
 . W $C(7),!!,"Nothing found for ",X,"..."
"RTN","TIUPXAPI",152,0)
 . F  D  Q:(+Y>0)!+$G(TIUOUT)
"RTN","TIUPXAPI",153,0)
 . . N X
"RTN","TIUPXAPI",154,0)
 . . I $L($T(CONFIG^LEXSET)) D  I 1
"RTN","TIUPXAPI",155,0)
 . . . ; Pass encounter date to LEXSET for CSV **161**
"RTN","TIUPXAPI",156,0)
 . . . D CONFIG^LEXSET("ICD","ICD",TIUVDT)
"RTN","TIUPXAPI",157,0)
 . . E  D  Q
"RTN","TIUPXAPI",158,0)
 . . . W !,$C(7),"You must install LEXICON UTILITY v2.0 for this function to work...Contact IRM.",!
"RTN","TIUPXAPI",159,0)
 . . . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIUPXAPI",160,0)
 . . . S TIUOUT=1
"RTN","TIUPXAPI",161,0)
 . . S DIC("A")="Please try another expression, or RETURN to continue: "
"RTN","TIUPXAPI",162,0)
 . . D ^DIC
"RTN","TIUPXAPI",163,0)
 . . I +$D(DTOUT)!+$D(DUOUT)!(X="") S TIUOUT=1 Q
"RTN","TIUPXAPI",164,0)
 . . I +$G(Y(1))>0 D  Q
"RTN","TIUPXAPI",165,0)
 . . . S TIUICD=+$O(^ICD9("AB",$P(Y(1),U)_" ",0))
"RTN","TIUPXAPI",166,0)
 . . . S:$S(+$G(TIUI)'>0:1,$D(ICD(+$G(TIUI))):1,1:0) TIUI=$G(TIUI)+1
"RTN","TIUPXAPI",167,0)
 . . . S ICD(TIUI)=TIUICD_U_Y(1)_U_$P(Y,U,2)
"RTN","TIUPXAPI",168,0)
 . . W $C(7),!!,"Nothing found for ",X,"..."
"RTN","TIUPXAPI",169,0)
 Q
"RTN","TIUPXAPI",170,0)
PROVLIST(PROVLIST) ; Identify primary provider
"RTN","TIUPXAPI",171,0)
 N PRIMARY,DFLT,DUOUT S DFLT=""
"RTN","TIUPXAPI",172,0)
 W !
"RTN","TIUPXAPI",173,0)
 I +$P($G(TIUPRM0),U,8)=0 Q
"RTN","TIUPXAPI",174,0)
 I +$P($G(TIUPRM0),U,8)=1 S DFLT=$$DFLTDOC(+TIU("VLOC"))
"RTN","TIUPXAPI",175,0)
 I +DFLT=DUZ S PROVLIST(1,"NAME")=DUZ,PROVLIST(1,"PRIMARY")=1 Q
"RTN","TIUPXAPI",176,0)
 I +DFLT S DFLT=$P(DFLT,U,2)
"RTN","TIUPXAPI",177,0)
 S:DFLT']"" DFLT=$S($$PROVIDER^TIUPXAP1(DUZ,DT):$$PERSNAME^TIULC1(DUZ),1:"")
"RTN","TIUPXAPI",178,0)
ASKPR S PRIMARY=+$$ASKDOC(DFLT)
"RTN","TIUPXAPI",179,0)
 I +PRIMARY'>0 Q
"RTN","TIUPXAPI",180,0)
 I '+$$PROVIDER^TIUPXAP1(PRIMARY,DT) D  G ASKPR
"RTN","TIUPXAPI",181,0)
 . W !,$C(7),"  Selected user is not a known PROVIDER. Please choose another..."
"RTN","TIUPXAPI",182,0)
 S PROVLIST(1,"NAME")=DUZ
"RTN","TIUPXAPI",183,0)
 I PRIMARY=DUZ S PROVLIST(1,"PRIMARY")=1
"RTN","TIUPXAPI",184,0)
 E  S PROVLIST(2,"NAME")=PRIMARY,PROVLIST(2,"PRIMARY")=1,PROVLIST(1,"PRIMARY")=0
"RTN","TIUPXAPI",185,0)
 Q
"RTN","TIUPXAPI",186,0)
ASKDOC(DFLT) ; Call ^DIC to look-up provider
"RTN","TIUPXAPI",187,0)
 N DIC,X,Y
"RTN","TIUPXAPI",188,0)
 S DIC=200,DIC(0)="AEMQ",DIC("A")="Select PRIMARY PROVIDER: "
"RTN","TIUPXAPI",189,0)
 I $G(DFLT)]"" S DIC("B")=$G(DFLT)
"RTN","TIUPXAPI",190,0)
 D ^DIC
"RTN","TIUPXAPI",191,0)
 Q +Y
"RTN","TIUPXAPI",192,0)
DFLTDOC(HLOC) ; Get the default Provider
"RTN","TIUPXAPI",193,0)
 N PXBPMT,TIUPNM,Y S Y=""
"RTN","TIUPXAPI",194,0)
 D PRV^PXBUTL2(HLOC)
"RTN","TIUPXAPI",195,0)
 I $D(PXBPMT("DEF")) S TIUPNM=$O(PXBPMT("DEF","")),Y=$O(PXBPMT("DEF",TIUPNM,0))_U_TIUPNM
"RTN","TIUPXAPI",196,0)
 Q Y
"RTN","TIUPXAPM")
0^3^B5340040
"RTN","TIUPXAPM",1,0)
TIUPXAPM ;SLC/RMO - CPT Modifier API(s) ;03/06/03@1500
"RTN","TIUPXAPM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**82,161**;Jun 20, 1997
"RTN","TIUPXAPM",3,0)
 ;
"RTN","TIUPXAPM",4,0)
 ;Pass in encounter date for CSV **161**
"RTN","TIUPXAPM",5,0)
MOD(CPT,TIUI,TIUVDT) ;Select CPT Modifiers for CPT Code
"RTN","TIUPXAPM",6,0)
 ; Input  -- CPT      CPT Selection Array
"RTN","TIUPXAPM",7,0)
 ;           TIUI     Item Number in CPT Selection Array
"RTN","TIUPXAPM",8,0)
 ;           TIUVDT   Encounter Date  
"RTN","TIUPXAPM",9,0)
 ; Output -- CPT      CPT Selection Array
"RTN","TIUPXAPM",10,0)
 N CPTIEN,I,MOD,MODATA,MODCNT
"RTN","TIUPXAPM",11,0)
 S CPTIEN=+CPT(TIUI)
"RTN","TIUPXAPM",12,0)
 ;
"RTN","TIUPXAPM",13,0)
 ;Check if there are any selectable CPT Modifiers for the CPT Code
"RTN","TIUPXAPM",14,0)
 ;Current date passed to ICPTCOD, changed to encounter date for CSV **161**
"RTN","TIUPXAPM",15,0)
 I +$$CODM^ICPTCOD(CPTIEN,,"",TIUVDT)'>0 G MODQ
"RTN","TIUPXAPM",16,0)
 ;
"RTN","TIUPXAPM",17,0)
 ;Set CPT Modifier Selection Array for pre-selected CPT Modifiers
"RTN","TIUPXAPM",18,0)
 S (I,MODCNT)=0
"RTN","TIUPXAPM",19,0)
 F  S I=$O(CPT(TIUI,"MOD",I)) Q:'I  D
"RTN","TIUPXAPM",20,0)
 . S MODCNT=MODCNT+1
"RTN","TIUPXAPM",21,0)
 . S MOD(+$G(CPT(TIUI,"MOD",MODCNT)))=""
"RTN","TIUPXAPM",22,0)
 ;
"RTN","TIUPXAPM",23,0)
 ;Display pre-selected CPT Modifiers
"RTN","TIUPXAPM",24,0)
 D DISMOD(.CPT,TIUI,1)
"RTN","TIUPXAPM",25,0)
 ;
"RTN","TIUPXAPM",26,0)
 ;Ask CPT Modifiers
"RTN","TIUPXAPM",27,0)
 S MODCNT=$S($G(MODCNT):MODCNT,1:0)
"RTN","TIUPXAPM",28,0)
 ;Pass encounter date to ASKMOD for CSV **161**
"RTN","TIUPXAPM",29,0)
 F  Q:'$$ASKMOD(CPTIEN,.MOD,MODCNT,.MODATA,TIUVDT)  D
"RTN","TIUPXAPM",30,0)
 . S MOD(+MODATA)=""
"RTN","TIUPXAPM",31,0)
 . S MODCNT=MODCNT+1
"RTN","TIUPXAPM",32,0)
 . S CPT(TIUI,"MOD",MODCNT)=MODATA
"RTN","TIUPXAPM",33,0)
 . S MODATA=""
"RTN","TIUPXAPM",34,0)
MODQ Q
"RTN","TIUPXAPM",35,0)
 ;
"RTN","TIUPXAPM",36,0)
 ;Pass in encounter date for CSV **161**
"RTN","TIUPXAPM",37,0)
ASKMOD(CPTIEN,MOD,MODCNT,MODATA,TIUVDT) ;Ask CPT Modifier
"RTN","TIUPXAPM",38,0)
 ; Input  -- CPTIEN   CPT file (#81) IEN
"RTN","TIUPXAPM",39,0)
 ;           MOD      CPT Modifier Selection Array
"RTN","TIUPXAPM",40,0)
 ;           MODCNT   Number of Modifiers Selected
"RTN","TIUPXAPM",41,0)
 ;   TIUVDT   Encounter Date
"RTN","TIUPXAPM",42,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUPXAPM",43,0)
 ;           MODATA   Modifier Data from Modifier file (#81.3)
"RTN","TIUPXAPM",44,0)
 ;                    1st Piece=IEN
"RTN","TIUPXAPM",45,0)
 ;                    2nd Piece=Modifier field (#.01)
"RTN","TIUPXAPM",46,0)
 ;                    3rd Piece=Name field (#.02)
"RTN","TIUPXAPM",47,0)
 N DIR,DTOUT,DUOUT,Y
"RTN","TIUPXAPM",48,0)
 S DIR(0)="PAO^81.3:AEMQZ^K:'$$CHKMOD^TIUPXAPM(.MOD,+Y) X"
"RTN","TIUPXAPM",49,0)
 S DIR("A")="Select "_$S($G(MODCNT):"another ",1:"")_"CPT MODIFIER: "
"RTN","TIUPXAPM",50,0)
 ;Pass encounter date to ICPTMOD for CSV **161**
"RTN","TIUPXAPM",51,0)
 S DIR("S")="I +$$MODP^ICPTMOD(CPTIEN,+Y,""I"",TIUVDT)>0"
"RTN","TIUPXAPM",52,0)
 D ^DIR
"RTN","TIUPXAPM",53,0)
 I Y>0 S MODATA=+Y_U_$P(Y(0),U,1,2)
"RTN","TIUPXAPM",54,0)
 Q $S($G(MODATA)="":0,1:1)
"RTN","TIUPXAPM",55,0)
 ;
"RTN","TIUPXAPM",56,0)
CHKMOD(MOD,MODIEN) ;Check Selected CPT Modifier
"RTN","TIUPXAPM",57,0)
 ; Input  -- MOD      CPT Modifier Selection Array
"RTN","TIUPXAPM",58,0)
 ;           MODIEN   Modifier file (#81.3) IEN
"RTN","TIUPXAPM",59,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIUPXAPM",60,0)
 N Y
"RTN","TIUPXAPM",61,0)
 S Y=1
"RTN","TIUPXAPM",62,0)
 ;Check if CPT Modifier has already been selected
"RTN","TIUPXAPM",63,0)
 I $D(MOD(MODIEN)) D EN^DDIOL("This CPT Modifier has already been selected.","","!?5") S Y=0
"RTN","TIUPXAPM",64,0)
 Q +$G(Y)
"RTN","TIUPXAPM",65,0)
 ;
"RTN","TIUPXAPM",66,0)
DISMOD(CPT,TIUI,TIUSELF) ;Display Selected CPT Modifiers
"RTN","TIUPXAPM",67,0)
 ; Input  -- CPT      CPT Selection Array
"RTN","TIUPXAPM",68,0)
 ;           TIUI     Item Number in CPT Selection Array
"RTN","TIUPXAPM",69,0)
 ;           TIUSELF  Selection Process Flag  (Optional)
"RTN","TIUPXAPM",70,0)
 ;                    1=Selection Process
"RTN","TIUPXAPM",71,0)
 ; Output -- None
"RTN","TIUPXAPM",72,0)
 N CAP,MODATA,MODCNT,TC
"RTN","TIUPXAPM",73,0)
 ;
"RTN","TIUPXAPM",74,0)
 ;Set caption and format parameter
"RTN","TIUPXAPM",75,0)
 I $G(TIUSELF) D
"RTN","TIUPXAPM",76,0)
 . S CAP="Current CPT Modifiers:",TC=0
"RTN","TIUPXAPM",77,0)
 ELSE  D
"RTN","TIUPXAPM",78,0)
 . S CAP="CPT Modifier(s):",TC=8
"RTN","TIUPXAPM",79,0)
 S MODCNT=0
"RTN","TIUPXAPM",80,0)
 F  S MODCNT=$O(CPT(TIUI,"MOD",MODCNT)) Q:'MODCNT  D
"RTN","TIUPXAPM",81,0)
 . S MODATA=$G(CPT(TIUI,"MOD",MODCNT))
"RTN","TIUPXAPM",82,0)
 . W:MODCNT=1 !,?TC,CAP
"RTN","TIUPXAPM",83,0)
 . W !?12,"-",$P(MODATA,U,2),?19,$P(MODATA,U,3)
"RTN","TIUPXAPM",84,0)
 Q
"VER")
8.0^22.0
**END**
**END**
